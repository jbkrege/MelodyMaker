webpackJsonp([0],[,function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),n(117),n(244);var i=n(234);e.nextFrame=i.nextFrame;var o=n(3);e.environment=o;var a=n(3),s=n(241);e.io=s;var u=n(291);e.math=u;var l=n(26);e.serialization=l;var c=n(15),p=n(318);e.test_util=p;var h=n(2);e.util=h;var f=n(320);e.version_core=f.version;var d=n(321);e.webgl=d;var m=n(86);e.AdadeltaOptimizer=m.AdadeltaOptimizer;var y=n(87);e.AdagradOptimizer=y.AdagradOptimizer;var g=n(88);e.AdamOptimizer=g.AdamOptimizer;var v=n(89);e.AdamaxOptimizer=v.AdamaxOptimizer;var b=n(90);e.MomentumOptimizer=b.MomentumOptimizer;var _=n(34);e.Optimizer=_.Optimizer;var w=n(91);e.RMSPropOptimizer=w.RMSPropOptimizer;var S=n(59);e.SGDOptimizer=S.SGDOptimizer;var x=n(15);e.Tensor=x.Tensor,e.TensorBuffer=x.TensorBuffer,e.variable=x.variable,e.Variable=x.Variable;var T=n(60);e.Rank=T.Rank,r(n(22));var P=n(135);e.Reduction=P.Reduction,r(n(319)),r(n(17));var E=n(3);e.ENV=E.ENV,e.Environment=E.Environment,e.setBackend=a.Environment.setBackend,e.getBackend=a.Environment.getBackend,e.disposeVariables=a.Environment.disposeVariables,e.memory=a.Environment.memory;var A=n(76);e.KernelBackend=A.KernelBackend,e.DataStorage=A.DataStorage;var N=n(22);c.setOpHandler(N)},function(t,e,n){(function(t){"use strict";function n(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,e--,n=t[e],t[e]=t[r],t[r]=n}function r(t,e,n){return Math.max(t,Math.min(e,n))}function i(t){return t%2===0?t:t+1}function o(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function a(t,e){var n=Math.random();return e*n+(1-n)*t}function s(t,e){for(var n=0,r=0;r<t.length;r++){var i=Number(t[r])-Number(e[r]);n+=i*i}return n}function u(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function l(t,e,n){void 0===n&&(n=""),u(d(t,e),n+(" Shapes "+t+" and "+e+" must match"))}function c(t){u(null!=t,"The input to the tensor constructor must be a non-null value.")}function p(t,e){if(void 0===e&&(e=[]),Array.isArray(t))for(var n=0;n<t.length;++n)p(t[n],e);else e.push(t);return e}function h(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function f(t){return 0===t.length}function d(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function m(t){return t%1===0}function y(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-(1/0))return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function g(t){for(var e=Math.floor(Math.sqrt(t));e>1;--e)if(t%e===0)return[e,t/e];return[1,t]}function v(t){for(var e=new Uint32Array(t),r=0;r<t;++r)e[r]=r;return n(e),e}function b(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function _(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,i){var o=0,a=function(){if(t())return void r();o++;var s=e(o);return null!=n&&o>=n?void i():void setTimeout(a,s)};a()})}function w(t,e){for(var n=1,r=-1,i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. "+("Found -1 at dim "+r+" and dim "+i));r=i}else if(t[i]<0)throw Error("Shapes can not be < 0. Found "+t[i]+" at dim "+i);if(r===-1){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!==0)throw Error("The implicit shape can't be a fractional number. "+("Got "+e+" / "+n));var o=t.slice();return o[r]=e/n,o}function S(t,e){for(var n=[],r=[],i=0,o=0;o<t.length;++o){if(null!=e){if(e[i]===o&&1!==t[o])throw new Error("Can't squeeze axis "+o+" since its dim '"+t[o]+"' is not 1");(null==e[i]||e[i]>o)&&1===t[o]&&(n.push(t[o]),r.push(o)),e[i]<=o&&i++}1!==t[o]&&(n.push(t[o]),r.push(o))}return{newShape:n,keptDims:r}}function x(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function T(t,e,n){if("float32"===e)for(var r=0;r<t.length;r++)if(isNaN(t[r]))throw Error("The result of the '"+n+"' has NaNs.")}function P(t,e){if("float32"!==e)for(var n=0;n<t.length;n++)if(isNaN(t[n]))throw Error("NaN is not a valid value for dtype: '"+e+"'.")}function E(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function A(t,e,n){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return n&&P(t,e),new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),i=0;i<r.length;++i)0!==Math.round(t[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function N(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function O(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function k(t){return!!(t&&t.constructor&&t.call&&t.apply)}function I(t,e){for(var n=e;n<t;++n)if(t%n===0)return n;return t}function C(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function M(t,e,n){return R(t,e)?t:(Array.isArray(t)&&(t=p(t)),A(t,e,n))}function R(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}function D(t,e){for(var n=L(t,e),r=0;r<n.length;r++)n[r]=1;return n}function L(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function F(){if("undefined"!=typeof performance)return performance.now();if("undefined"!=typeof t){var e=t.hrtime();return 1e3*e[0]+e[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}Object.defineProperty(e,"__esModule",{value:!0}),e.shuffle=n,e.clamp=r,e.nearestLargerEven=i,e.sum=o,e.randUniform=a,e.distSquared=s,e.assert=u,e.assertShapesMatch=l,e.assertNonNull=c,e.flatten=p,e.sizeFromShape=h,e.isScalarShape=f,e.arraysEqual=d,e.isInt=m,e.tanh=y,e.sizeToSquarishShape=g,e.createShuffledIndices=v,e.rightPad=b,e.repeatedTry=_,e.inferFromImplicitShape=w,e.squeezeShape=S,e.getTypedArrayFromDType=x,e.checkComputationForNaN=T,e.checkConversionForNaN=P,e.hasEncodingLoss=E,e.isTypedArray=N,e.bytesPerElement=O,e.isFunction=k,e.nearestDivisor=I,e.computeStrides=C,e.toTypedArray=M,e.makeOnesTypedArray=D,e.makeZerosTypedArray=L,e.now=F}).call(e,n(66))},function(t,e,n){(function(t){"use strict";function r(){var e;if("undefined"!=typeof window)e=window;else{if("undefined"==typeof t)throw new Error("Could not find a global object");e=t}return e}function i(){var t=r();return null==t.ENV&&(t.ENV=new d(s.getFeaturesFromURL()),u.setTensorTracker(function(){return t.ENV.engine})),t.ENV}Object.defineProperty(e,"__esModule",{value:!0});var o=n(235),a=n(236),s=n(237),u=n(15),l=n(49),c=.001,p=.1,h=1e-7,f=.001,d=function(){function n(t){this.features={},this.registry={},null!=t&&(this.features=t),this.get("DEBUG")&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}return n.setBackend=function(t,n){if(void 0===n&&(n=!1),!(t in e.ENV.registry))throw new Error("Backend name '"+t+"' not found in registry");e.ENV.engine.backend=e.ENV.findBackend(t),e.ENV.backendName=t},n.getBackend=function(){return e.ENV.initEngine(),e.ENV.backendName},n.disposeVariables=function(){e.ENV.engine.disposeVariables()},n.memory=function(){return e.ENV.engine.memory()},n.profile=function(t){return e.ENV.engine.profile(t)},n.tidy=function(t,n,r){return void 0===r&&(r=!1),e.ENV.engine.tidy(t,n,r)},n.dispose=function(t){var e=l.getTensorsInContainer(t);e.forEach(function(t){return t.dispose()})},n.keep=function(t){return e.ENV.engine.keep(t)},n.time=function(t){return e.ENV.engine.time(t)},n.prototype.get=function(t){return t in this.features?this.features[t]:(this.features[t]=this.evaluateFeature(t),this.features[t])},n.prototype.getFeatures=function(){return this.features},n.prototype.set=function(t,e){this.features[t]=e},n.prototype.getBestBackendName=function(){var t=this;if(0===Object.keys(this.registry).length)throw new Error("No backend found in registry.");var e=Object.keys(this.registry).map(function(e){return{name:e,entry:t.registry[e]}}).sort(function(t,e){return e.entry.priority-t.entry.priority});return e[0].name},n.prototype.evaluateFeature=function(e){if("DEBUG"===e)return!1;if("IS_BROWSER"===e)return"undefined"!=typeof window;if("IS_NODE"===e)return"undefined"!=typeof t&&"undefined"!=typeof t.versions.node;if("IS_CHROME"===e)return s.isChrome();if("WEBGL_CPU_FORWARD"===e)return!0;if("WEBGL_PACK_BATCHNORMALIZATION"===e)return!1;if("WEBGL_LAZILY_UNPACK"===e)return!1;if("WEBGL_CONV_IM2COL"===e)return!1;if("WEBGL_PAGING_ENABLED"===e)return this.get("IS_BROWSER")&&!this.get("PROD");if("WEBGL_MAX_TEXTURE_SIZE"===e)return s.getWebGLMaxTextureSize(this.get("WEBGL_VERSION"));if("IS_TEST"===e)return!1;if("BACKEND"===e)return this.getBestBackendName();if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"===e){var n=this.get("WEBGL_VERSION");return 0===n?0:s.getWebGLDisjointQueryTimerVersion(n)}if("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE"===e)return this.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!o.isMobile();if("HAS_WEBGL"===e)return this.get("WEBGL_VERSION")>0;if("WEBGL_VERSION"===e)return s.isWebGLVersionEnabled(2)?2:s.isWebGLVersionEnabled(1)?1:0;if("WEBGL_RENDER_FLOAT32_ENABLED"===e)return s.isRenderToFloatTextureEnabled(this.get("WEBGL_VERSION"));if("WEBGL_DOWNLOAD_FLOAT_ENABLED"===e)return s.isDownloadFloatTextureEnabled(this.get("WEBGL_VERSION"));if("WEBGL_FENCE_API_ENABLED"===e)return s.isWebGLFenceEnabled(this.get("WEBGL_VERSION"));if("WEBGL_SIZE_UPLOAD_UNIFORM"===e){var r=this.get("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0}if("TEST_EPSILON"===e)return 32===this.backend.floatPrecision()?f:p;if("EPSILON"===e)return 32===this.backend.floatPrecision()?h:c;if("PROD"===e)return!1;if("TENSORLIKE_CHECK_SHAPE_CONSISTENCY"===e)return!this.get("PROD");throw new Error("Unknown feature "+e+".")},n.prototype.setFeatures=function(t){this.features=Object.assign({},t)},n.prototype.reset=function(){this.features=s.getFeaturesFromURL(),null!=this.globalEngine&&(this.globalEngine=null)},Object.defineProperty(n.prototype,"backend",{get:function(){return this.engine.backend},enumerable:!0,configurable:!0}),n.prototype.findBackend=function(t){return t in this.registry?this.registry[t].backend:null},n.prototype.registerBackend=function(t,e,n,r){var i=this;if(void 0===n&&(n=1),t in this.registry)return console.warn(t+" backend was already registered. Reusing existing backend"),null!=r&&r(function(){return i.engine}),!1;try{var o=e();return o.setDataMover({moveData:function(t){return i.engine.moveData(t)}}),this.registry[t]={backend:o,priority:n},!0}catch(e){return console.warn("Registration of backend "+t+" failed"),console.warn(e.stack||e.message),!1}},n.prototype.removeBackend=function(t){if(!(t in this.registry))throw new Error(t+" backend not found in registry");this.registry[t].backend.dispose(),delete this.registry[t]},Object.defineProperty(n.prototype,"engine",{get:function(){return this.initEngine(),this.globalEngine},enumerable:!0,configurable:!0}),n.prototype.initEngine=function(){var t=this;if(null==this.globalEngine){this.backendName=this.get("BACKEND");var e=this.findBackend(this.backendName);this.globalEngine=new a.Engine(e,!1,function(){return t.get("DEBUG")})}},n}();e.Environment=d,e.ENV=i()}).call(e,n(66))},function(t,e,n){var r;r=function(){"use strict";function t(t){return void 0===t}function e(t){return"function"==typeof t}var n;if(t(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),t(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),t(AudioContext))throw new Error("Web Audio is not supported in this browser");n=new AudioContext,e(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),e(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),e(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),e(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),e(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),e(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),e(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),e(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(e,n,r){if(e.input)Array.isArray(e.input)?(t(r)&&(r=0),this.connect(e.input[r])):this.connect(e.input,n,r);else try{e instanceof AudioNode?this._nativeConnect(e,n,r):this._nativeConnect(e,n)}catch(t){throw new Error("error connecting to node: "+e)}};var r=function(e,n){t(e)||1===e?this.input=this.context.createGain():e>1&&(this.input=new Array(e)),t(n)||1===n?this.output=this.context.createGain():n>1&&(this.output=new Array(e))};r.prototype.set=function(e,n,i){if(this.isObject(e))i=n;else if(this.isString(e)){var o={};o[e]=n,e=o}for(var a in e){n=e[a];var s=this;if(a.indexOf(".")!==-1){for(var u=a.split("."),l=0;l<u.length-1;l++)s=s[u[l]];a=u[u.length-1]}var c=s[a];t(c)||(r.Signal&&c instanceof r.Signal||r.Param&&c instanceof r.Param?c.value!==n&&(t(i)?c.value=n:c.rampTo(n,i)):c instanceof AudioParam?c.value!==n&&(c.value=n):c instanceof r?c.set(n):c!==n&&(s[a]=n))}return this},r.prototype.get=function(n){t(n)?n=this._collectDefaults(this.constructor):this.isString(n)&&(n=[n]);for(var i={},o=0;o<n.length;o++){var a=n[o],s=this,u=i;if(a.indexOf(".")!==-1){for(var l=a.split("."),c=0;c<l.length-1;c++){var p=l[c];u[p]=u[p]||{},u=u[p],s=s[p]}a=l[l.length-1]}var h=s[a];this.isObject(n[a])?u[a]=h.get():r.Signal&&h instanceof r.Signal?u[a]=h.value:r.Param&&h instanceof r.Param?u[a]=h.value:h instanceof AudioParam?u[a]=h.value:h instanceof r?u[a]=h.get():e(h)||t(h)||(u[a]=h)}return i},r.prototype._collectDefaults=function(e){var n=[];if(t(e.defaults)||(n=Object.keys(e.defaults)),!t(e._super))for(var r=this._collectDefaults(e._super),i=0;i<r.length;i++)n.indexOf(r[i])===-1&&n.push(r[i]);return n},r.prototype.toString=function(){for(var t in r){var n=t[0].match(/^[A-Z]$/),i=r[t]===this.constructor;if(e(r[t])&&n&&i)return t}return"Tone"},r.context=n,r.prototype.context=r.context,r.prototype.bufferSize=2048,r.prototype.blockTime=128/r.context.sampleRate,r.prototype.sampleTime=1/r.context.sampleRate,r.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var i=null;r.prototype.noGC=function(){return this.output.connect(i),this},AudioNode.prototype.noGC=function(){return this.connect(i),this},r.prototype.connect=function(t,e,n){return Array.isArray(this.output)?(e=this.defaultArg(e,0),this.output[e].connect(t,0,n)):this.output.connect(t,e,n),this},r.prototype.disconnect=function(t){return Array.isArray(this.output)?(t=this.defaultArg(t,0),this.output[t].disconnect()):this.output.disconnect(),this},r.prototype.connectSeries=function(){if(arguments.length>1)for(var t=arguments[0],e=1;e<arguments.length;e++){var n=arguments[e];t.connect(n),t=n}return this},r.prototype.connectParallel=function(){var t=arguments[0];if(arguments.length>1)for(var e=1;e<arguments.length;e++){var n=arguments[e];t.connect(n)}return this},r.prototype.chain=function(){if(arguments.length>0)for(var t=this,e=0;e<arguments.length;e++){var n=arguments[e];t.connect(n),t=n}return this},r.prototype.fan=function(){if(arguments.length>0)for(var t=0;t<arguments.length;t++)this.connect(arguments[t]);return this},AudioNode.prototype.chain=r.prototype.chain,AudioNode.prototype.fan=r.prototype.fan,r.prototype.defaultArg=function(e,n){if(this.isObject(e)&&this.isObject(n)){var r={};for(var i in e)r[i]=this.defaultArg(n[i],e[i]);for(var o in n)r[o]=this.defaultArg(e[o],n[o]);return r}return t(e)?n:e},r.prototype.optionsObject=function(t,e,n){var r={};if(1===t.length&&this.isObject(t[0]))r=t[0];else for(var i=0;i<e.length;i++)r[e[i]]=t[i];return this.isUndef(n)?r:this.defaultArg(r,n)},r.prototype.isUndef=t,r.prototype.isFunction=e,r.prototype.isNumber=function(t){return"number"==typeof t},r.prototype.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object},r.prototype.isBoolean=function(t){return"boolean"==typeof t},r.prototype.isArray=function(t){return Array.isArray(t)},r.prototype.isString=function(t){return"string"==typeof t},r.noOp=function(){},r.prototype._readOnly=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._readOnly(t[e]);else Object.defineProperty(this,t,{writable:!1,enumerable:!0})},r.prototype._writable=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._writable(t[e]);else Object.defineProperty(this,t,{writable:!0})},r.State={Started:"started",Stopped:"stopped",Paused:"paused"},r.prototype.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)},r.prototype.dbToGain=function(t){return Math.pow(2,t/6)},r.prototype.gainToDb=function(t){return 20*(Math.log(t)/Math.LN10)},r.prototype.now=function(){return this.context.currentTime},r.now=function(){return r.context.currentTime},r.extend=function(e,n){function i(){}t(n)&&(n=r),i.prototype=n.prototype,e.prototype=new i,e.prototype.constructor=e,e._super=n};var o=[];return r._initAudioContext=function(t){t(r.context),o.push(t)},r.setContext=function(t){r.prototype.context=t,r.context=t;for(var e=0;e<o.length;e++)o[e](t)},r.startMobile=function(){var t=r.context.createOscillator(),e=r.context.createGain();e.gain.value=0,t.connect(e),e.connect(r.context.destination);var n=r.context.currentTime;t.start(n),t.stop(n+1)},r._initAudioContext(function(t){r.prototype.blockTime=128/t.sampleRate,r.prototype.sampleTime=1/t.sampleRate,i=t.createGain(),i.gain.value=0,i.connect(t.destination)}),r.version="r7-dev",console.log("%c * Tone.js "+r.version+" * ","background: #000; color: #fff"),r}.call(e,n,e,t),/**
	 *  Tone.js
	 *  @author Yotam Mann
	 *  @license http://opensource.org/licenses/MIT MIT License
	 *  @copyright 2014-2016 Yotam Mann
	 */
!(void 0!==r&&(t.exports=r))},function(t,e,n){"use strict";function r(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i.ENV.engine.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i.ENV.engine.endScope(o),o}catch(t){throw i.ENV.engine.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3);e.op=r},function(t,e,n){"use strict";function r(t){var e=t;if(l.isTypedArray(t))return[t.length];if(!Array.isArray(t))return[];for(var n=[];e instanceof Array;)n.push(e.length),e=e[0];return t instanceof Array&&s.ENV.get("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&i(t,n,[]),n}function i(t,e,n){if(n=n||[],!(t instanceof Array))return void l.assert(0===e.length,function(){return"Element arr["+n.join("][")+"] is a primitive, "+("but should be an array of "+e[0]+" elements")});l.assert(e.length>0,function(){return"Element arr["+n.join("][")+"] should be a primitive, "+("but is an array of "+t.length+" elements")}),l.assert(t.length===e[0],function(){return"Element arr["+n.join("][")+"] should have "+e[0]+" "+("elements, but has "+t.length+" elements")});for(var r=e.slice(1),o=0;o<t.length;++o)i(t[o],r,n.concat(o))}function o(t,e,n,i){if(void 0===i&&(i="float32"),i=i||"float32",t instanceof u.Tensor)return t;if(!l.isTypedArray(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t)throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got "+t.constructor.name);var o=r(t);return l.isTypedArray(t)||Array.isArray(t)||(t=[t]),u.Tensor.make(o,{values:l.toTypedArray(t,i,s.ENV.get("DEBUG"))},i)}function a(t,e,n){if(!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");var r=t;return r.map(function(t,r){return o(t,e+"["+r+"]",n)})}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),u=n(15),l=n(2);e.inferShape=r,e.convertToTensor=o,e.convertToTensorArray=a},function(t,e){"use strict";var n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.AttributeError=r;var i=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.RuntimeError=i;var o=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.ValueError=o;var a=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.NotImplementedError=a;var s=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.AssertionError=s;var u=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return n(e,t),e}(Error);e.IndexError=u},function(t,e,n){"use strict";function r(){return u++}function i(t){return void 0===t&&(t=""),t in l||(l[t]=0),l[t]+=1,t+l[t].toString()}function o(t,e){return void 0===e&&(e=p),null==c[e][t]&&(c[e][t]=s.scalar(t,e),s.keep(c[e][t])),c[e][t]}function a(){for(var t in c)for(var e in c[t])c[t][e].dispose(),delete c[t][e]}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=0;e.getNextUniqueTensorId=r;var l={};e.getUid=i;var c={float32:{},int32:{}},p="float32";e.getScalar=o,e.disposeScalarCache=a},function(t,e,n){"use strict";function r(t,e,n){if(void 0===n&&(n="float32"),"complex64"===n)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!S.isTypedArray(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t)throw new Error("values passed to tensor(values) must be an array of numbers or booleans, or a TypedArray");var r=w.inferShape(t);return null!=e&&1!==r.length&&S.assertShapesMatch(e,r,"Error creating a new Tensor. "+("Inferred shape ("+r+") does not match the ")+("provided shape ("+e+"). ")),S.isTypedArray(t)||Array.isArray(t)||(t=[t]),e=e||r,b.Tensor.make(e,{values:S.toTypedArray(t,n,v.ENV.get("DEBUG"))},n)}function i(t,e){if(void 0===e&&(e="float32"),(S.isTypedArray(t)||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean)");return r(t,[],e)}function o(t,e){void 0===e&&(e="float32"),S.assertNonNull(t);var n=w.inferShape(t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return r(t,n,e)}function a(t,e,n){if(void 0===n&&(n="float32"),S.assertNonNull(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var i=w.inferShape(t);if(2!==i.length&&1!==i.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return e=e||i,r(t,e,n)}function s(t,e,n){if(void 0===n&&(n="float32"),S.assertNonNull(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var i=w.inferShape(t);if(3!==i.length&&1!==i.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return e=e||i,r(t,e,n)}function u(t,e,n){if(void 0===n&&(n="float32"),S.assertNonNull(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var i=w.inferShape(t);if(4!==i.length&&1!==i.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return e=e||i,r(t,e,n)}function l(t,e,n){if(void 0===n&&(n="float32"),S.assertNonNull(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var i=w.inferShape(t);if(5!==i.length&&1!==i.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return e=e||i,r(t,e,n)}function c(t,e,n){if(void 0===n&&(n="float32"),S.assertNonNull(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var i=w.inferShape(t);if(6!==i.length&&1!==i.length)throw new Error("tensor6d() requires values to be number[][][][] or flat/TypedArray");if(1===i.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||i,r(t,e,n)}function p(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=p(t,"float32"),r=p(t,"float32");return x.complex(n,r)}var i=S.makeOnesTypedArray(S.sizeFromShape(t),e);return b.Tensor.make(t,{values:i},e)}function h(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=h(t,"float32"),r=h(t,"float32");return x.complex(n,r)}var i=S.makeZerosTypedArray(S.sizeFromShape(t),e);return b.Tensor.make(t,{values:i},e)}function f(t,e,n){void 0===n&&(n="float32");var r=S.getTypedArrayFromDType(n,S.sizeFromShape(t));return r.fill(e),b.Tensor.make(t,{values:r},n)}function d(t){var e=_.convertToTensor(t,"x","onesLike");return p(e.shape,e.dtype)}function m(t){var e=_.convertToTensor(t,"x","zerosLike");return h(e.shape,e.dtype)}function y(t,e,n){if(0===n)throw new Error("Cannot request zero samples");var r=(e-t)/(n-1),i=S.makeZerosTypedArray(n,"float32");i[0]=t;for(var a=1;a<i.length;a++)i[a]=i[a-1]+r;return o(i,"float32")}function g(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");var i=t===e,a=t<e&&n<0,s=e<t&&n>1;if(i||a||s)return h([0],r);var u=Math.abs(Math.ceil((e-t)/n)),l=S.makeZerosTypedArray(u,r);e<t&&1===n&&(n=-1),l[0]=t;for(var c=1;c<l.length;c++)l[c]=l[c-1]+n;return o(l,r)}Object.defineProperty(e,"__esModule",{value:!0});var v=n(3),b=n(15),_=n(6),w=n(6),S=n(2),x=n(79),T=n(5);e.tensor=r,e.scalar=i,e.tensor1d=o,e.tensor2d=a,e.tensor3d=s,e.tensor4d=u,e.tensor5d=l,e.tensor6d=c,e.ones=p,e.zeros=h,e.fill=f,e.linspace=y,e.range=g,e.onesLike=T.op({onesLike_:d}),e.zerosLike=T.op({zerosLike_:m})},function(t,e,n){"use strict";function r(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<e;r++)n=n.concat(t);return n}var n=new Array(e);return n.fill(t),n}function i(t,e){if(!t)throw new S.AssertionError(e)}function o(t,e){for(var n=0,r=0,i=t;r<i.length;r++){var o=i[r];o===e&&n++}return n}function a(t){return 1===t.length?t[0]:t}function s(t){return Array.isArray(t)?t:[t]}function u(t){for(var e=s(t),n="",r=0,i=e;r<i.length;r++){var o=i[r];if(null==o.id)throw new S.ValueError("Object "+o+" passed to objectListUid without an id");""!==n&&(n+=", "),n+=Math.abs(o.id)}return n}function l(t){var e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),n=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==n[0]?n:"private"+n}function c(t){return t.length<=1?t:t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,function(t,e){return e.toUpperCase()})}function p(t){return null===t||void 0===t?null:{className:t.getClassName(),config:t.getConfig()}}function h(t,e,n,r){if(void 0===e&&(e={}),void 0===n&&(n={}),void 0===r&&(r="object"),"string"==typeof t){var i=t,o=void 0;if(i in n)o=n[i];else if(i in x)o=x[i];else if(o=e[i],null==o)throw new S.ValueError("Unknown "+r+": "+t+". This may be due to one of the following reasons:\n"+("1. The "+r+" is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+("2. The custom "+r+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return o}var a=t;if(null==a.className||null==a.config)throw new S.ValueError(r+": Improper config format: "+(JSON.stringify(a)+".\n")+"'className' and 'config' must set.");var s=a.className,u=void 0,l=void 0;if(s in n?(E=n.get(s),u=E[0],l=E[1]):s in x?(A=x.className,u=A[0],l=A[1]):s in e&&(N=e[s],u=N[0],l=N[1]),null==u)throw new S.ValueError("Unknown "+r+": "+s+". This may be due to one of the following reasons:\n"+("1. The "+r+" is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+("2. The custom "+r+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=l){for(var c={},p=0,h=Object.keys(x);p<h.length;p++){var f=h[p];c[f]=x[f]}for(var d=0,m=Object.keys(n);d<m.length;d++){var f=m[d];c[f]=n[f]}var y=a.config;y.customObjects=c;for(var g=w({},x),v=0,b=Object.keys(n);v<b.length;v++){var f=b[v];x[f]=n[f]}var _=l(u,a.config);return x=w({},g),_}for(var g=w({},x),T=0,P=Object.keys(n);T<P.length;T++){var f=P[T];x[f]=n[f]}var _=new u(a.config);return x=w({},g),_;var E,A,N}function f(t,e){return t<e?-1:t>e?1:0}function d(t,e){return-1*f(t,e)}function m(t){switch(t){case"float32":return"float32";default:throw new S.ValueError("Invalid dtype: "+t)}}function y(t,e){if(null==t||null==e)return t===e;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function g(t){if(null==t)return t;for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];e.indexOf(i)===-1&&e.push(i)}return e}function v(t){if(null==t)throw new S.ValueError("Invalid value in obj: "+JSON.stringify(t));for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function b(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new S.ValueError(n+" is not a valid "+e+".  Valid values are "+t+" or null/undefined.")}function _(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=1/0),i(n>=0),i(r>=n),Array.isArray(t)&&t.length>=n&&t.length<=r&&t.every(function(t){return typeof t===e})}var w=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t};Object.defineProperty(e,"__esModule",{value:!0});var S=n(7);e.pyListRepeat=r,e.assert=i,e.count=o,e.singletonOrArray=a,e.toList=s,e.objectListUid=u,e.toSnakeCase=l,e.toCamelCase=c;var x={};e.serializeKerasObject=p,e.deserializeKerasObject=h,e.numberCompare=f,e.reverseNumberCompare=d,e.stringToDType=m,e.stringsEqual=y,e.unique=g,e.isObjectEmpty=v,e.checkStringTypeUnionValue=b,e.checkArrayTypeAndLength=_},function(t,e){"use strict";function n(t,e,n,i){var o=e.params[t];if(o&&void 0!==o.inputIndex){if("tensor"===o.type)return r(e.inputNames[o.inputIndex],n,i);if("tensors"===o.type){var a=0===o.inputIndex?0===o.inputParamLength?e.inputNames:e.inputNames.slice(o.inputIndex,-o.inputParamLength):e.inputNames.splice(o.inputIndex);return a.map(function(t){return r(t,n,i)})}var s=Array.prototype.slice.call(r(e.inputNames.slice(o.inputIndex)[0],n,i).dataSync());return"number"===o.type?s[0]:s}return o&&o.value}function r(t,e,n){var r=s(t),i=r[0],o=r[1],u=n.currentContextIds.find(function(t){return!!e[a(i,t)]});return void 0!==u?e[a(i,u)][o]:void 0}function i(t,e,n){return e[a(t,n.currentContextId)]}function o(t,e){var n=s(t),r=n[0],i=n[1];return[a(r,e&&e.currentContextId),i]}function a(t,e){return e?t+"-"+e:t}function s(t){var e=t.lastIndexOf(":");if(e===-1)return[t,0];var n=t.substring(0,e);return[n,Number(t.substring(e+1))]}function u(t,e){for(var n=[],r=0;r<t.length;r+=e)n.push(t.slice(r,r+e));return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getParamValue=n,e.getTensor=r,e.getTensorsForCurrentContenxt=i,e.getNodeNameAndIndex=o,e.parseNodeName=s,e.split=u},function(t,e,n){"use strict";function r(t){t=p.toList(t);for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];e.push(i.shape)}return p.singletonOrArray(e)}function i(t){return"float32"}function o(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];var r=e.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var i=[],a=0;a<r.inboundLayers.length;a++)for(var s=r.inputTensors[a],u=r.inboundLayers[a],l=r.nodeIndices[a],c=o(s,u,l),p=0,h=c;p<h.length;p++){var f=h[p];i.indexOf(f)===-1&&i.push(f)}return i}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(8),l=n(27),c=n(7),p=n(10),h=n(16),f=n(146),d=n(64),m=function(){function t(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}return t}();e.InputSpec=m;var y=function(){function t(t,e,n,r,i,o,a){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=u.getNextUniqueTensorId(),null!=o&&(this.originalName=l.getScopedTensorName(o),this.name=l.getUniqueTensorName(this.originalName)),this.rank=e.length}return t}();e.SymbolicTensor=y;var g=0,v=function(){function t(t,e){this.callArgs=e,this.id=g++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(var n=0,r=t.inboundLayers;n<r.length;n++){var i=r[n];null!=i&&i.outboundNodes.push(this)}t.outboundLayer.inboundNodes.push(this)}return t.prototype.getConfig=function(){for(var t=[],e=0,n=this.inboundLayers;e<n.length;e++){var r=n[e];null!=r?t.push(r.name):t.push(null)}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},t}();e.Node=v;var b=0,_=function(t){function e(e){var n=t.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=b++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var r=e.name;if(!r){var i=n.getClassName();r=p.toSnakeCase(i)+"_"+u.getUid(i)}if(n.name=r,n.trainable=null==e.trainable||e.trainable,n.updatable=null==e.updatable||e.updatable,null!=e.inputShape||null!=e.batchInputShape){var o=void 0;if(null!=e.batchInputShape)o=e.batchInputShape;else if(null!=e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),o=[a].concat(e.inputShape)}n.batchInputShape=o;var s=e.dtype;null==s&&(s=e.inputDType),null==s&&(s="float32"),n.dtype=s}return null!=e.weights?n.initialWeights=e.weights:n.initialWeights=null,n._refCount=null,n}return a(e,t),e.nodeKey=function(t,e){return t.name+"_ib-"+e.toString()},e.prototype.getNodeAtIndex=function(t,e){if(0===this.inboundNodes.length)throw new c.RuntimeError("The layer has never been called "+("and thus has no defined "+e+"."));if(this.inboundNodes.length<=t)throw new c.ValueError("Asked to get "+e+" at node "+t+", "+("but the layer has only "+this.inboundNodes.length+" inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return p.singletonOrArray(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return p.singletonOrArray(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new c.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new c.AttributeError("Layer "+this.name+" is not connected, no input to return.");return p.singletonOrArray(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(0===this.inboundNodes.length)throw new c.AttributeError("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new c.AttributeError("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return p.singletonOrArray(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this._trainableWeights:[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._nonTrainableWeights:this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=p.toList(t),null!=this.inputSpec&&0!==this.inputSpec.length){var e=p.toList(this.inputSpec);if(t.length!==e.length)throw new c.ValueError("Layer "+this.name+" expects "+e.length+" inputs, "+("but it received "+t.length+" input tensors. ")+("Input received: "+t));for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(null!=i){var o=r.rank;if(null!=i.ndim&&o!==i.ndim)throw new c.ValueError("Input "+n+" is incompatible with layer "+this.name+": "+("expected ndim="+i.ndim+", found ndim="+o));if(null!=i.maxNDim&&o>i.maxNDim)throw new c.ValueError("Input "+n+" is incompatible with layer "+this.name+(": expected max_ndim="+i.maxNDim+", found ndim="+o));if(null!=i.minNDim&&o<i.minNDim)throw new c.ValueError("Input "+n+" is incompatible with layer "+this.name+(": expected min_ndim="+i.minNDim+", found ndim="+o+"."));if(null!=i.dtype&&r.dtype!==i.dtype)throw new c.ValueError("Input "+n+" is incompatible with layer "+this.name+" "+(": expected dtype="+i.dtype+", found dtype="+r.dtype+"."));if(i.axes){var a=r.shape;for(var s in i.axes){var u=Number(s),l=i.axes[s],h=u>=0?a[u]:a[a.length+u];if(null!=l&&[l,null].indexOf(h)===-1)throw new c.ValueError("Input "+n+" is incompatible with layer "+(this.name+": expected axis "+u+" of input shape to ")+("have value "+l+" but got shape "+a+"."))}}if(null!=i.shape)for(var f=0;f<i.shape.length;++f){var d=i.shape[f],m=r.shape[f];if(null!=d&&null!=m&&d!==m)throw new c.ValueError("Input "+n+" is incompatible with layer "+(this.name+": expected shape="+i.shape+", ")+"found shape=${xShape}.")}}}}},e.prototype.call=function(t,e){return t},e.prototype.invokeCallHook=function(t,e){null!=this._callHook&&this._callHook(t,e)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,e){var n=this;e=e||{},this.assertNotDisposed();for(var o=p.toList(t),a=!0,s=0,u=o;s<u.length;s++){var h=u[s];if(!(h instanceof y)){a=!1;break}}for(var f=!0,d=0,m=o;d<m.length;d++){var h=m[d];if(h instanceof y){f=!1;break}}if(a===f)throw new c.ValueError("Arguments to apply() must be all SymbolicTensors or all Tensors");return l.nameScope(this.name,function(){if(!n.built){n.assertInputCompatibility(t);for(var a=[],s=0,u=p.toList(t);s<u.length;s++){var l=u[s];a.push(l.shape)}n.build(p.singletonOrArray(a)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&f&&(n._refCount=1)}if(n.assertInputCompatibility(t),f){for(var h=n.call(t,e),d=p.toList(h),m=[],g=0,v=d;g<v.length;g++){var b=v[g];o.indexOf(b)!==-1&&(b=b.clone()),m.push(b)}if(h=p.singletonOrArray(m),null!=n.activityRegularizer)throw new c.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return h}var _=r(t),w=n.computeOutputShape(_),h=void 0,S=i(t);if(n.warnOnIncompatibleInputShape(Array.isArray(t)?_[0]:_),h=null!=w&&w.length>0&&Array.isArray(w[0])?w.map(function(r,i){return new y(S,r,n,p.toList(t),e,n.name,i)}):new y(S,w,n,p.toList(t),e,n.name),n.addInboundNode(t,h,null,null,_,w,e),n._refCount++,null!=n.activityRegularizer)throw new c.NotImplementedError("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return h})},e.prototype.warnOnIncompatibleInputShape=function(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+(JSON.stringify(t)+") does not match that of the ")+("batchInputShape ("+JSON.stringify(this.batchInputShape)+") ")+("of the layer "+this.name));else{var e=!1;this.batchInputShape.forEach(function(n,r){null!=n&&null!=t[r]&&t[r]!==n&&(e=!0)}),e&&console.warn("The shape of the input tensor "+("("+JSON.stringify(t)+") does not ")+("match the expectation of layer "+this.name+": ")+(""+JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new c.AttributeError("The layer "+this.name+" has never been called and thus has no defined output shape.");for(var t=[],e=0,n=this.inboundNodes;e<n.length;e++){var r=n[e],i=JSON.stringify(r.outputShapes);t.indexOf(i)===-1&&t.push(i)}if(1===t.length){var o=this.inboundNodes[0].outputShapes;return Array.isArray(o)&&Array.isArray(o[0])&&1===o.length?o[0]:o}throw new c.AttributeError("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "outut shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new c.RuntimeError("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return f.countParamsInWeights(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return void 0===t&&(t=!1),d.batchGetValue(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var e=this;s.tidy(function(){var n=e.weights;if(n.length!==t.length)throw new c.ValueError('You called setWeights(weights) on layer "'+e.name+'" '+("with a weight list of length "+t.length+", ")+("but the layer was expecting "+n.length+" weights. ")+("Provided weights: "+t+"..."));if(0!==n.length){for(var r=[],i=d.batchGetValue(n),o=0;o<i.length;++o){var a=i[o],u=n[o],l=t[o];if(!s.util.arraysEqual(a.shape,l.shape))throw new c.ValueError("Layer weight shape "+a.shape+" not compatible with provided weight shape "+l.shape);r.push([u,l])}d.batchSetValue(r)}})},e.prototype.addWeight=function(t,e,n,r,i,o,a){if(this._addedWeightNames.indexOf(t)!==-1)throw new c.ValueError("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),null==n&&(n="float32");var s=new d.LayerVariable(r.apply(e,n),n,t,o,a);return null!=i&&this.addLoss(function(){return i.apply(s.read())}),null==o&&(o=!0),o?this._trainableWeights.push(s):this._nonTrainableWeights.push(s),s},e.prototype.addLoss=function(t){if(!(null==t||Array.isArray(t)&&0===t.length)){t=p.toList(t),void 0!==this._losses&&null!==this._losses&&(e=this.losses).push.apply(e,t);var e}},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,e){var n=this;if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError("Layer "+this.name+" does not support masking,but was passed an inputMask.");e.forEach(function(t){if(null!=t)throw new TypeError("Layer "+n.name+" does not support masking,but was passed an inputMask.")})}return null}return e},e.prototype.addInboundNode=function(t,e,n,r,i,o,a){void 0===a&&(a=null);var s=p.toList(t);e=p.toList(e),n=p.toList(n),r=p.toList(r),i=h.normalizeShapeList(i),o=h.normalizeShapeList(o);for(var u=[],l=[],c=[],f=0,d=s;f<d.length;f++){var m=d[f];u.push(m.sourceLayer),l.push(m.nodeIndex),c.push(m.tensorIndex)}new v({outboundLayer:this,inboundLayers:u,nodeIndices:l,tensorIndices:c,inputTensors:s,outputTensors:e,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:o},a);for(var y=0;y<e.length;y++)e[y].sourceLayer=this,e[y].nodeIndex=this.inboundNodes.length-1,e[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t.batchInputShape=this.batchInputShape),null!=this.dtype&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return 0===--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(s.serialization.Serializable);e.Layer=_,e.getSourceInputs=o},function(t,e,n){"use strict";function r(t){I.setBackend(t),z=t,M.disposeScalarCache()}function i(){return z}function o(){return!1}function a(t){var e=t.shape;return e.length>0?e.reduce(function(t,e){return t*e}):1}function s(t,e){return t.asType(e)}function u(t,e){void 0===e&&(e=-1);var n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function l(t,e){return C.tidy(function(){if(2!==t.shape.length)throw new D.ValueError("repeat() expects a rank-2 tensor, but received a "+("rank-"+t.shape.length+" tensor."));var n=u(t,1);return g(n,[1,e,1])})}function c(t){var e=[L.arrayProd(t.shape)];return t.reshape(e)}function p(t){if(t.rank<=1)throw new D.ValueError("batchFlatten requires a minimum rank of 2. Got rank: "+t.rank+".");var e=[t.shape[0],L.arrayProd(t.shape,1)];return t.reshape(e)}function h(t,e,n){return C.tidy(function(){switch(t.rank){case 1:return I.slice1d(t,e,n);case 2:return I.slice2d(t,[e,0],[n,t.shape[1]]);case 3:return I.slice3d(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return I.slice4d(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);default:throw new D.ValueError("sliceAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}})}function f(t,e,n){return C.tidy(function(){switch(t.rank){case 1:return I.slice1d(t,e,n);case 2:return I.slice2d(t,[0,e],[t.shape[0],n]);case 3:return I.slice3d(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return I.slice4d(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new D.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function d(t,e,n,r){return C.tidy(function(){switch(t.rank){case 1:return I.slice1d(t,e,n);case 2:switch(r){case 1:return h(t,e,n);case 2:return f(t,e,n);default:throw new D.ValueError("The axis is not within the rank of the tensor "+r)}case 3:switch(r){case 1:return h(t,e,n);case 2:return I.slice3d(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return f(t,e,n);default:throw new D.ValueError("The axis is not within the rank of the tensor "+r)}case 4:switch(r){case 1:return h(t,e,n);case 2:return I.slice4d(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return I.slice4d(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return f(t,e,n);default:throw new D.ValueError("The axis is not within the rank of the tensor "+r)}default:throw new D.ValueError("sliceAlongLastAxis() received an unsupported tensor rank: "+t.rank)}})}function m(t,e){void 0===e&&(e=-1);var n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),I.concat(t,e)}function y(t,e){switch(t.rank){case 1:return I.concat1d([t,e]);case 2:return I.concat2d([t,e],0);case 3:return I.concat3d([t,e],0);case 4:return I.concat4d([t,e],0);default:throw new D.ValueError("concatAlongFirstAxis() received an unsupported tensor rank: "+t.rank)}}function g(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new D.ValueError("The length of input n ("+e.length+") does not match "+("the number of dimensions in input x ("+t.rank+")"));return I.tile(t,e)}function v(t,e,n,r,i){return void 0===e&&(e=0),void 0===n&&(n=1),I.randomNormal(t,e,n,r,i)}function b(t,e){if(t.rank<2||e.rank<2)throw new D.NotImplementedError("dot requires both inputs to be rank >= 2"+(" but got x shape = "+t.shape+" and y shape = "+e.shape));if(e.rank>=3){var n=t.shape.slice(-1)[0],r=e.shape.slice(-2)[0];if(n!==r)throw new D.NotImplementedError("If rank y >= 3, then the second last dim"+(" of y must equal the last dim of x but got x shape = "+t.shape+" and ")+(" y shape = "+e.shape))}if(2===t.rank&&2===e.rank)return I.matMul(t,e);var i=t.shape.slice(),n=i.pop();t=t.reshape([-1,n]);var o=e.shape.slice(),a=o.pop(),r=o.pop(),s=o.concat([a]),u=Array.from({
length:e.rank},function(t,n){return 0===n?e.rank-2:n<=e.rank-2?n-1:n});e=e.transpose(u).reshape([r,-1]);var l=i.concat(s);return I.matMul(t,e).reshape(l)}function _(t){return C.tidy(function(){var e=C.zerosLike(t),n=C.onesLike(t);return C.where(I.equal(t,e),e,C.where(I.greater(t,C.zerosLike(t)),n,I.mul(M.getScalar(-1),n)))})}function w(t,e){return C.tidy(function(){if(1!==t.rank)throw new Error("Only 1D one-hot tensors are supported in the deeplearn backend, at present.");return t=t.toInt(),I.oneHot(t,e).toFloat()})}function S(t,e,n){return C.tidy(function(){return e=Array.isArray(e)?C.tensor1d(e,"int32"):e.toInt(),I.gather(t,e,n)})}function x(t){return I.mulStrict(t,t)}function T(t,e){return C.tidy(function(){if("number"==typeof e&&(e=C.scalar(Math.round(e),"int32")),"int32"!==e.dtype)throw new D.NotImplementedError("Non-int32 dtype ("+e.dtype+") is not supported by pow() yet");return I.pow(t,e)})}function P(t,e,n){return C.tidy(function(){if(null==n&&(n=F.imageDataFormat()),R.checkDataFormat(n),1!==e.rank&&e.rank!==t.rank)throw new D.ValueError("Unexpected bias dimensions: "+e.rank+"; expected it to be 1 or "+t.rank);var r,i=e.shape;if(5===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1,1,1])):t.add(e.reshape([1,i[3],i[0],i[1],i[2]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,1,1,i[0]])):t.add(e.reshape([1].concat(i))));else if(4===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1,1])):t.add(e.reshape([1,i[2],i[0],i[1]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,1,i[0]])):t.add(e.reshape([1].concat(i))));else if(3===t.rank)"channelsFirst"===n?r=1===i.length?t.add(e.reshape([1,i[0],1])):t.add(e.reshape([1,i[1],i[0]])):"channelsLast"===n&&(r=1===i.length?t.add(e.reshape([1,1,i[0]])):t.add(e.reshape([1].concat(i))));else{if(!(t.rank<3))throw new D.ValueError("Unsupported input rank by biasAdd: "+t.rank);r=t.add(e)}return r})}function E(t,e){if(void 0===e&&(e=1),1!==e)throw new D.NotImplementedError("Support for alpha values other than 1 ("+e+") is not implemented yet.");return I.elu(t)}function A(t){return C.tidy(function(){return I.div(t,I.add(M.getScalar(1),I.abs(t)))})}function N(t,e,n,r){return C.tidy(function(){if(null!=n&&!C.util.arraysEqual(t.shape,n))throw new D.NotImplementedError("Non-default noise shape is not implemented yet: "+JSON.stringify(n));if(null!=r)throw new D.NotImplementedError("seed is not implemented for dropout yet.");var i=I.step(I.add(I.neg(e),I.randomUniform(t.shape,0,1,"float32")));return i=I.mul(I.div(M.getScalar(1),I.sub(M.getScalar(1),e)),i),I.mul(t,i)})}function O(t){return C.tidy(function(){var e=I.add(M.getScalar(.5),I.mul(M.getScalar(.2),t));return I.clipByValue(e,0,1)})}function k(t,e,n){return void 0===n&&(n=!1),n?t():e()}Object.defineProperty(e,"__esModule",{value:!0});var I=n(1),C=n(1),M=n(8),R=n(27),D=n(7),L=n(28),F=n(29),z="webgl";e.setBackend=r,e.getBackend=i,e.isBackendSymbolic=o,e.countParams=a,e.cast=s,e.expandDims=u,e.repeat=l,e.flatten=c,e.batchFlatten=p,e.sliceAlongFirstAxis=h,e.sliceAlongLastAxis=f,e.sliceAlongAxis=d,e.concatenate=m,e.concatAlongFirstAxis=y,e.tile=g,e.randomNormal=v,e.dot=b,e.sign=_,e.oneHot=w,e.gather=S,e.square=x,e.pow=T,e.biasAdd=P,e.elu=E,e.softsign=A,e.dropout=N,e.hardSigmoid=O,e.inTrainPhase=k},function(t,e,n){"use strict";function r(t,e,n,r,i){var o=t.map(function(t){var e=z.sizeFromShape(t.shapeInfo.logicalShape);return t.shapeInfo.isUniform?"uniform float "+t.name+(e>1?"["+e+"]":"")+";":"uniform sampler2D "+t.name+";"});o=o.join("\n");var l,c,p=t.map(function(t){return a(t,e,r)}).join("\n"),h=e.texShape,f=Y;e.isPacked?(l=s(e.logicalShape,h),c=K):(l=u(e.logicalShape,h),c=Q),i&&(f+=X);var d=[f,H,c,o,l,p,n].join("\n");return d}function i(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return _(t);case 1:return S(t);case 2:return T(t);case 3:return E(t);case 4:return N(t);case 5:return O(t);case 6:return k(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function o(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 1:return w(t);case 2:return x(t);case 3:return P(t);case 4:return A(t);default:throw new Error("Packed "+e.length+"-D input sampling is not yet supported")}}function a(t,e,n){var r=I(t);return r+=t.shapeInfo.isPacked?o(t):i(t),(n||z.arraysEqual(t.shapeInfo.logicalShape,e.logicalShape))&&(r+=M(t,e,n)),r}function s(t,e){switch(t.length){case 0:return l();case 1:return c(t,e);case 2:return v(t,e);case 3:return h(t,e);case 4:return d(t,e);default:throw new Error(t.length+"-D packed output coordinate fetching is not yet supported")}}function u(t,e){switch(t.length){case 0:return l();case 1:return p(t,e);case 2:return b(t,e);case 3:return f(t,e);case 4:return m(t,e);case 5:return y(t,e);case 6:return g(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}}function l(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function c(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===e[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return resTexRC.x * "+n[1]+" + resTexRC.y;\n    }\n  "}function p(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}function h(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  "}function f(t,e){var n=q.getLogicalCoordinatesFromFlatIndex(["r","c","d"],t);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec3(r, c, d);\n    }\n  "}function d(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[3]/2),i=r*Math.ceil(t[2]/2),o=i*t[1];return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      int b2 = index / "+o+";\n      index -= b2 * "+o+";\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  "}function m(t,e){var n=q.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}function y(t,e){var n=q.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}function g(t,e){var n=q.getLogicalCoordinatesFromFlatIndex(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}function v(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(z.arraysEqual(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}function b(t,e){return z.arraysEqual(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}function _(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return t.shapeInfo.isUniform?"float "+n+"() {return "+e+";}":"\n    float "+n+"() {\n      return sampleTexture("+e+", halfCR);\n    }\n  "}function w(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return texture2D("+e+", uv);\n    }\n  "}function S(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);return"\n    float "+n+"(int index) {\n      return "+n+"Flat(index);\n    }\n  "}function x(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1];if(null!=i&&z.arraysEqual(e,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return texture2D("+n+", uv);\n      }\n    ";var s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(e[1]/2);return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+u+", "+s[0]+", "+s[1]+", row, col);\n      return texture2D("+n+", uv);\n    }\n  "}function T(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape;if(null!=o&&z.arraysEqual(e,o)){var a=o[0],s=o[1];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+s+".0, "+a+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var u=z.squeezeShape(e),l=u.newShape,c=u.keptDims,p=l;if(p.length<e.length){var h=D(t,p),f=["row","col"];return"\n      "+i(h)+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+L(f,c)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        float index = dot(vec2(row, col), vec2("+e[1]+", 1));\n        return "+r+"Flat(round(index));\n      }\n    ";var d=o[0],m=o[1];return 1===m?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+e[1]+", 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===d?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec2(row, col), vec2("+e[1]+", 1));\n      vec2 uv = vec2((index + 0.5) / "+m+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    vec2 uv = UVfrom2D("+d+", "+m+", "+e[1]+", row, col);\n    return sampleTexture("+n+", uv);\n  }\n"}function P(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===e[0]){var s=e.slice(1),u=[1,2],l=D(t,s),c=["b","row","col"];return"\n        "+o(l)+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+L(c,u)+");\n        }\n      "}var p=a[0],h=a[1],f=Math.ceil(e[2]/2),d=f*Math.ceil(e[1]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+p+", "+h+", "+d+", "+f+", b, row, col);\n      return texture2D("+n+", uv);\n    }\n  "}function E(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[1]*e[2],a=e[2],s=z.squeezeShape(e),u=s.newShape,l=s.keptDims,c=u;if(c.length<e.length){var p=D(t,c),h=["row","col","depth"];return"\n        "+i(p)+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+L(h,l)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        float index = dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1));\n        return "+r+"Flat(round(index));\n      }\n    ";var f=t.shapeInfo.texShape,d=f[0],m=f[1];return m===o?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+m+".0, "+d+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":m===a?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+".0, "+d+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        vec2 uv = UVfrom3D(\n            "+d+", "+m+", "+o+", "+a+", row, col, depth);\n        return sampleTexture("+n+", uv);\n      }\n  "}function A(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=o[0],s=o[1],u=Math.ceil(e[3]/2),l=u*Math.ceil(e[2]/2),c=l*e[1];return"\n    vec4 "+r+"(int b2, int b, int row, int col) {\n      vec2 uv = packedUVfrom4D(\n        "+a+", "+s+", "+c+",\n        "+l+", "+u+", b2, b, row, col);\n      return texture2D("+n+", uv);\n    }\n  "}function N(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[3],a=e[2]*o,s=e[1]*a,u=z.squeezeShape(e),l=u.newShape,c=u.keptDims;if(l.length<e.length){var p=D(t,l),h=["row","col","depth","depth2"];return"\n      "+i(p)+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+L(h,c)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float index = dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+o+", 1));\n        return "+r+"Flat(round(index));\n      }\n    ";var f=t.shapeInfo.texShape,d=f[0],m=f[1];return m===s?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2), vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":m===o?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      vec2 uv = UVfrom4D("+d+", "+m+", "+s+", "+a+",\n          "+o+", row, col, depth, depth2);\n      return sampleTexture("+n+", uv);\n    }\n  "}function O(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[4],a=e[3]*o,s=e[2]*a,u=e[1]*s,l=z.squeezeShape(e),c=l.newShape,p=l.keptDims;if(c.length<e.length){var h=D(t,c),f=["row","col","depth","depth2","depth3"];return"\n      "+i(h)+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+L(f,p)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+o+")) +\n          depth3;\n        return "+r+"Flat(index);\n      }\n    ";var d=t.shapeInfo.texShape,m=d[0],y=d[1];return y===u?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+s+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+y+".0, "+m+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":y===o?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+", "+e[2]*e[3]+",\n            "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+y+".0, "+m+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      vec2 uv = UVfrom5D("+m+", "+y+", "+u+", "+s+",\n          "+a+", "+o+", row, col, depth, depth2, depth3);\n      return sampleTexture("+n+", uv);\n    }\n  "}function k(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[5],a=e[4]*o,s=e[3]*a,u=e[2]*s,l=e[1]*u,c=z.squeezeShape(e),p=c.newShape,h=c.keptDims;if(p.length<e.length){var f=D(t,p),d=["row","col","depth","depth2","depth3","depth4"];return"\n      "+i(f)+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+L(d,h)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+l+", "+u+", "+s+", "+a+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+o+", 1));\n        return "+r+"Flat(index);\n      }\n    ";var m=t.shapeInfo.texShape,y=m[0],g=m[1];return g===l?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(\n          vec4(col, depth, depth2, depth3),\n          vec4("+u+", "+s+", "+a+", "+o+")) + depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+y+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":g===o?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + depth3;\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+y+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      vec2 uv = UVfrom6D("+y+", "+g+", "+l+", "+u+",\n          "+s+", "+a+", "+o+"\n          ,row, col, depth, depth2, depth3, depth4);\n      return sampleTexture("+n+", uv);\n    }\n  "}function I(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1)+"Flat",r=z.sizeFromShape(t.shapeInfo.logicalShape);if(t.shapeInfo.isUniform)return 1===r?"float "+n+"(int index) {return "+e+";}":"\n      float "+n+"(int index) {\n        for (int i = 0; i < "+r+"; i++) {\n          if (i == index) {\n            return "+e+"[i];\n          }\n        }\n      }\n    ";var i=t.shapeInfo.texShape,o=i[0],a=i[1];return 1===a&&1===o?"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ":1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index) + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index) + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = UVfrom1D("+o+", "+a+", index);\n      return sampleTexture("+e+", uv);\n    }\n  "}function C(t,e,n,r){var i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a="int";2===o?a="ivec2":3===o?a="ivec3":4===o&&(a="ivec4");var s,u=F.getBroadcastDims(t.shapeInfo.logicalShape,e.logicalShape),l=o-i;s=0===i?"":o<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords["+(t+l)+"] = 0;"}).join("\n");var c="";return c=o<2&&i>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords["+(e+l)+"]"}).join(", "),"\n    float "+r+"() {\n      "+a+" coords = getOutputCoords();\n      "+s+"\n      return get"+n+"("+c+");\n    }\n  "}function M(t,e,n){var r=t.name,i=r.charAt(0).toUpperCase()+r.slice(1),o="get"+i+"AtOutCoords",a=F.getBroadcastDims(t.shapeInfo.logicalShape,e.logicalShape),s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length,l=n&&(u>s||a.length>0),c=F.broadcastDimsAreOuter(a),p=t.shapeInfo.isUniform;if(l&&!c)return C(t,e,i,o);var h=z.sizeFromShape(t.shapeInfo.logicalShape),f="";l&&c&&(f="\n        int mainPart = index / "+h+";\n        index -= mainPart * "+h+";\n      ");var d=e.texShape;if(p)return 1===h?"float "+o+"() {return "+r+";}":"\n      float "+o+"() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                              vec2("+d[0]+", "+d[1]+"));\n        int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n        "+f+"\n        return get"+i+"Flat(index);\n      }\n    ";var m=t.shapeInfo.texShape;return z.arraysEqual(m,d)?"\n      float "+o+"() {\n        return sampleTexture("+r+", resultUV);\n      }\n    ":"\n    float "+o+"() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+d[0]+", "+d[1]+"));\n      int index = resTexRC.x * "+d[1]+" + resTexRC.y;\n      "+f+"\n      int texR = index / "+m[1]+";\n      int texC = index - texR * "+m[1]+";\n      vec2 uv = (vec2(texC, texR) + halfCR) /\n                 vec2("+m[1]+".0, "+m[0]+".0);\n\n      return sampleTexture("+r+", uv);\n    }\n  "}function R(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function D(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function L(t,e){return e.map(function(e){return t[e]}).join(", ")}Object.defineProperty(e,"__esModule",{value:!0});var F=n(25),z=n(2),q=n(127);e.makeShader=r;var V="\nvec2 UVfrom1D(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",B="\nvec2 UVfrom2D(int texNumR, int texNumC, int numC, int row, int col) {\n  int index = row * numC + col;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",j="\nvec2 UVfrom3D(int texNumR, int texNumC, int stride0,\n    int stride1, int row, int col, int depth) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",U="\nvec2 UVfrom4D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int row, int col, int depth,\n    int depth2) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom4D(int texNumR, int texNumC, int texelsInBatch2,\n    int texelsInBatch, int texelsInLogicalRow, int b2, int b,\n    int row, int col) {\n  int index = b2 * texelsInBatch2 + b * texelsInBatch +\n    (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",G="\nvec2 UVfrom5D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int row, int col, int depth,\n    int depth2, int depth3) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 +\n              depth * stride2 + depth2 * stride3 + depth3;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",W="\nvec2 UVfrom6D(int texNumR, int texNumC, int stride0,\n    int stride1, int stride2, int stride3, int stride4,\n    int row, int col, int depth, int depth2, int depth3, int depth4) {\n  // Explicitly use integer operations as dot() only works on floats.\n  int index = row * stride0 + col * stride1 + depth * stride2 + depth2 *\n    stride3 + depth3 * stride4 + depth4;\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",H="\n  float sampleTexture(sampler2D textureSampler, vec2 uv) {\n    return texture2D(textureSampler, uv).r;\n  }\n",Q="\n  void setOutput(float val) {\n    gl_FragColor = vec4(val, 0, 0, 0);\n  }\n",K="\n  void setOutput(vec4 val) {\n    gl_FragColor = val;\n  }\n",Y="\n  precision highp float;\n  precision highp int;\n  varying vec2 resultUV;\n  const vec2 halfCR = vec2(0.5, 0.5);\n\n  struct ivec5\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n  };\n\n  struct ivec6\n  {\n    int x;\n    int y;\n    int z;\n    int w;\n    int u;\n    int v;\n  };\n\n  bool isNaN(float val) {\n    return (val < 1.0 || 0.0 < val || val == 0.0) ? false : true;\n  }\n\n  bool hasNaN(vec4 values) {\n    vec4 v1 = values * values;\n    vec4 v2 = values * values;\n    return any(notEqual(v1, v2));\n  }\n\n  float getNaN(vec4 values) {\n    return dot(vec4(1), values);\n  }\n\n  int round(float value) {\n    return int(floor(value + 0.5));\n  }\n\n  int imod(int x, int y) {\n    return x - y * (x / y);\n  }\n\n  //Based on the work of Dave Hoskins\n  //https://www.shadertoy.com/view/4djSRW\n  #define HASHSCALE1 443.8975\n  float random(float seed){\n    vec2 p = resultUV * seed;\n    vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n    p3 += dot(p3, p3.yzx + 19.19);\n    return fract((p3.x + p3.y) * p3.z);\n  }\n\n  "+V+"\n  "+B+"\n  "+j+"\n  "+U+"\n  "+G+"\n  "+W+"\n",X="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";e.getCoordsDataType=R},function(t,e,n){"use strict";function r(t){h=t}function i(t){f=t}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var u=n(317),l=n(2),c=n(2),p=function(){function t(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=l.sizeFromShape(t),null!=n){var r=n.length;l.assert(r===this.size,"Length of values '"+r+"' does not match the size "+("inferred by the shape '"+this.size+"'."))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||l.getTypedArrayFromDType(e,l.sizeFromShape(this.shape)),this.strides=c.computeStrides(t)}return t.prototype.set=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];0===e.length&&(e=[0]),l.assert(e.length===this.rank,"The number of provided coordinates ("+e.length+") must "+("match the rank ("+this.rank+")"));var r=this.locToIndex(e);this.values[r]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.values[n]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];
if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return d.make(this.shape,{values:this.values},this.dtype)},t}();e.TensorBuffer=p;var h=null,f=null;e.setTensorTracker=r,e.setOpHandler=i;var d=function(){function t(t,e,n,r){this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=l.sizeFromShape(t),null!=n&&l.assert(this.size===n.length,"Based on the provided shape, ["+t+"], and dtype "+(this.dtype+", the tensor should have ")+(this.size+" values but has "+n.length)),this.strides=c.computeStrides(t),this.dataId=null!=r?r:{},this.id=h().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",h().registerTensor(this),null!=n&&h().write(this.dataId,n)}return t.make=function(e,n,r){return new t(e,r,n.values,n.dataId)},t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),l.assert(1===this.size,"The array must have only 1 element."),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.asType=function(t){return this.throwIfDisposed(),f.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];l.assert(t.length===this.rank,"Number of coordinates in get() must match the rank of the tensor"),l.assert("complex64"!==this.dtype,"Tensor.get() is not supported for complex64 tensors yet."),this.throwIfDisposed(),0===t.length&&(t=[0]);for(var n=t[t.length-1],r=0;r<t.length-1;++r)n+=this.strides[r]*t[r];return this.dataSync()[n]},t.prototype.buffer=function(){return f.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.data=function(){return a(this,void 0,void 0,function(){return s(this,function(t){return this.throwIfDisposed(),[2,h().read(this.dataId)]})})},t.prototype.dataSync=function(){return this.throwIfDisposed(),h().readSync(this.dataId)},t.prototype.dispose=function(){this.isDisposed||(h().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),f.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),f.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),f.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),f.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),f.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),f.clone(this)},t.prototype.toString=function(t){void 0===t&&(t=!1);var e=this.dataSync();return u.tensorToString(e,this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),f.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),f.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),f.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),f.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),f.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),f.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),f.reverse(this,t)},t.prototype.concat=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),f.concat([this,t],e)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),f.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),f.stack([this,t],e)},t.prototype.unstack=function(t,e){return void 0===e&&(e=0),f.unstack(this,e)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),f.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,i){return void 0===n&&(n=.001),this.throwIfDisposed(),f.batchNormalization(this,t,e,n,r,i)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),f.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),f.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),f.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),f.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),f.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),f.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),f.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),f.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),f.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),f.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),f.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),f.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),f.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),f.div(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),f.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),f.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),f.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),f.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),f.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),f.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),f.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),f.modStrict(this,t)},t.prototype.squaredDifference=function(t){return this.throwIfDisposed(),f.squaredDifference(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),f.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),f.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),f.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),f.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),f.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),f.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),f.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),f.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),f.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),f.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),f.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),f.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),f.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),f.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),f.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),f.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),f.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),f.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),f.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),f.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),f.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),f.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),f.sign(this)},t.prototype.exp=function(){return this.throwIfDisposed(),f.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),f.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),f.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),f.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),f.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),f.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),f.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),f.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),f.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),f.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),f.relu(this)},t.prototype.elu=function(){return this.throwIfDisposed(),f.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),f.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),f.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),f.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),f.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),f.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),f.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),f.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),f.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),f.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),f.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),f.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),f.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),f.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),f.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),f.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),f.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),f.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),f.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),f.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),f.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),f.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),f.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),f.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),f.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),f.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),f.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),f.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),f.conv1d(this,t,e,n,r,i,o)},t.prototype.conv2d=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),f.conv2d(this,t,e,n,r,i,o)},t.prototype.conv2dTranspose=function(t,e,n,r,i){return this.throwIfDisposed(),f.conv2dTranspose(this,t,e,n,r,i)},t.prototype.depthwiseConv2D=function(t,e,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),f.depthwiseConv2d(this,t,e,n,r,i,o)},t.prototype.separableConv2d=function(t,e,n,r,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),f.separableConv2d(this,t,e,n,r,i,o)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),f.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),f.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),f.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,i){return this.throwIfDisposed(),f.pool(this,t,e,n,r,i)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),m.variable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),f.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),f.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),f.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),f.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,i){return void 0===r&&(r=0),void 0===i&&(i=0),this.throwIfDisposed(),f.stridedSlice(this,t,e,n,r,i)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),f.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),f.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),f.spectral.ifft(this)},t}();e.Tensor=d,Object.defineProperty(d,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.shape&&null!=t.dtype}});var m=function(t){function e(e,n,r){void 0===n&&(n=!0);var i=t.call(this,e.shape,e.dtype,null,e.dataId)||this;i.trainable=n,i.name=r,null==i.name&&(i.name=h().nextVariableId().toString());try{h().registerVariable(i)}catch(t){throw h().disposeTensor(i),t}return i}return o(e,t),e.variable=function(t,n,r,i){return void 0===n&&(n=!0),null!=i&&i!==t.dtype&&(t=t.asType(i)),new e(t,n,r)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!l.arraysEqual(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));h().disposeTensor(this),this.dataId=t.dataId,h().registerTensor(this)},e}(d);e.Variable=m,Object.defineProperty(m,Symbol.hasInstance,{value:function(t){return t instanceof d&&null!=t.assign&&t.assign instanceof Function}});var y=m.variable;e.variable=y},function(t,e,n){"use strict";function r(t){return Array.isArray(t)&&Array.isArray(t[0])}function i(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function o(t){var e;if(Array.isArray(t)){if(1!==t.length)throw new s.ValueError("Expected Tensor length to be 1; got "+t.length);e=t[0]}else e=t;return e}function a(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return t=t,t[0];throw new s.ValueError("Expected exactly 1 Shape; got "+t.length)}return t}Object.defineProperty(e,"__esModule",{value:!0});var s=n(7);e.isArrayOfShapes=r,e.normalizeShapeList=i,e.getExactlyOneTensor=o,e.getExactlyOneShape=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),i=n(113);e.customGrad=i.customGrad,e.grad=i.grad,e.grads=i.grads,e.valueAndGrad=i.valueAndGrad,e.valueAndGrads=i.valueAndGrads,e.variableGrads=i.variableGrads,e.tidy=r.Environment.tidy,e.keep=r.Environment.keep,e.dispose=r.Environment.dispose,e.time=r.Environment.time,e.profile=r.Environment.profile},function(t,e,n){var r,i;r=[n(4),n(69),n(20),n(161),n(38)],i=function(t){"use strict";return t.Signal=function(){var e=this.optionsObject(arguments,["value","units"],t.Signal.defaults);this.output=this._gain=this.context.createGain(),e.param=this._gain.gain,t.Param.call(this,e),this.input=this._param=this._gain.gain,t.Signal._constant.chain(this._gain)},t.extend(t.Signal,t.Param),t.Signal.defaults={value:0,units:t.Type.Default,convert:!0},t.Signal.prototype.connect=t.SignalBase.prototype.connect,t.Signal.prototype.dispose=function(){return t.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},t.Signal._constant=null,t._initAudioContext(function(e){for(var n=e.createBuffer(1,128,e.sampleRate),r=n.getChannelData(0),i=0;i<r.length;i++)r[i]=1;t.Signal._constant=e.createBufferSource(),t.Signal._constant.channelCount=1,t.Signal._constant.channelCountMode="explicit",t.Signal._constant.buffer=n,t.Signal._constant.loop=!0,t.Signal._constant.start(0),t.Signal._constant.noGC()}),t.Signal}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4)],__WEBPACK_AMD_DEFINE_RESULT__=function(Tone){"use strict";function getTransportBpm(){return Tone.Transport&&Tone.Transport.bpm?Tone.Transport.bpm.value:120}function getTransportTimeSignature(){return Tone.Transport&&Tone.Transport.timeSignature?Tone.Transport.timeSignature:4}function toNotationHelper(t,e,n,r){for(var i=this.toSeconds(t),o=this.notationToSeconds(r[r.length-1],e,n),a="",s=0;s<r.length;s++){var u=this.notationToSeconds(r[s],e,n),l=i/u,c=1e-6;if(1-l%1<c&&(l+=c),l=Math.floor(l),l>0){if(a+=1===l?r[s]:l.toString()+"*"+r[s],i-=l*u,i<o)break;a+=" + "}}return""===a&&(a="0"),a}Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"},Tone.prototype.isNowRelative=function(){var t=new RegExp(/^\s*\+(.)+/i);return function(e){return t.test(e)}}(),Tone.prototype.isTicks=function(){var t=new RegExp(/^\d+i$/i);return function(e){return t.test(e)}}(),Tone.prototype.isNotation=function(){var t=new RegExp(/^[0-9]+[mnt]$/i);return function(e){return t.test(e)}}(),Tone.prototype.isTransportTime=function(){var t=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(e){return t.test(e)}}(),Tone.prototype.isNote=function(){var t=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(e){return t.test(e)}}(),Tone.prototype.isFrequency=function(){var t=new RegExp(/^\d*\.?\d+hz$/i);return function(e){return t.test(e)}}(),Tone.prototype.notationToSeconds=function(t,e,n){e=this.defaultArg(e,getTransportBpm()),n=this.defaultArg(n,getTransportTimeSignature());var r=60/e;"1n"===t&&(t="1m");var i=parseInt(t,10),o=0;0===i&&(o=0);var a=t.slice(-1);return o="t"===a?4/i*2/3:"n"===a?4/i:"m"===a?i*n:0,r*o},Tone.prototype.transportTimeToSeconds=function(t,e,n){e=this.defaultArg(e,getTransportBpm()),n=this.defaultArg(n,getTransportTimeSignature());var r=0,i=0,o=0,a=t.split(":");2===a.length?(r=parseFloat(a[0]),i=parseFloat(a[1])):1===a.length?i=parseFloat(a[0]):3===a.length&&(r=parseFloat(a[0]),i=parseFloat(a[1]),o=parseFloat(a[2]));var s=r*n+i+o/4;return s*(60/e)},Tone.prototype.ticksToSeconds=function(t,e){if(this.isUndef(Tone.Transport))return 0;t=parseFloat(t),e=this.defaultArg(e,getTransportBpm());var n=60/e/Tone.Transport.PPQ;return n*t},Tone.prototype.frequencyToSeconds=function(t){return 1/parseFloat(t)},Tone.prototype.samplesToSeconds=function(t){return t/this.context.sampleRate},Tone.prototype.secondsToSamples=function(t){return t*this.context.sampleRate},Tone.prototype.secondsToTransportTime=function(t,e,n){e=this.defaultArg(e,getTransportBpm()),n=this.defaultArg(n,getTransportTimeSignature());var r=60/e,i=t/r,o=Math.floor(i/n),a=i%1*4;i=Math.floor(i)%n;var s=[o,i,a];return s.join(":")},Tone.prototype.secondsToFrequency=function(t){return 1/t},Tone.prototype.toTransportTime=function(t,e,n){var r=this.toSeconds(t);return this.secondsToTransportTime(r,e,n)},Tone.prototype.toFrequency=function(t,e){return this.isFrequency(t)?parseFloat(t):this.isNotation(t)||this.isTransportTime(t)?this.secondsToFrequency(this.toSeconds(t,e)):this.isNote(t)?this.noteToFrequency(t):t},Tone.prototype.toTicks=function(t){if(this.isUndef(Tone.Transport))return 0;var e=Tone.Transport.bpm.value,n=0;if(this.isNowRelative(t))t=t.replace("+",""),n=Tone.Transport.ticks;else if(this.isUndef(t))return Tone.Transport.ticks;var r=this.toSeconds(t),i=60/e,o=r/i,a=o*Tone.Transport.PPQ;return Math.round(a+n)},Tone.prototype.toSamples=function(t){var e=this.toSeconds(t);return Math.round(e*this.context.sampleRate)},Tone.prototype.toSeconds=function(time,now){if(now=this.defaultArg(now,this.now()),this.isNumber(time))return time;if(this.isString(time)){var plusTime=0;this.isNowRelative(time)&&(time=time.replace("+",""),plusTime=now);var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens)for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,""),symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}if(time.indexOf("@")!==-1){var quantizationSplit=time.split("@");if(this.isUndef(Tone.Transport))throw new Error("quantization requires Tone.Transport");var toQuantize=quantizationSplit[0].trim();""===toQuantize&&(toQuantize=void 0),plusTime>0&&(toQuantize="+"+toQuantize,plusTime=0);var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){for(var originalTime=time,i=0;i<components.length;i++){var symb=components[i].trim();if(""!==symb){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(t){throw new EvalError("cannot evaluate Time: "+originalTime)}}else time=this.isNotation(time)?this.notationToSeconds(time):this.isTransportTime(time)?this.transportTimeToSeconds(time):this.isFrequency(time)?this.frequencyToSeconds(time):this.isTicks(time)?this.ticksToSeconds(time):parseFloat(time)}return time+plusTime}return now},Tone.prototype.toNotation=function(t,e,n){var r=["1m","2n","4n","8n","16n","32n","64n","128n"],i=toNotationHelper.call(this,t,e,n,r),o=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],a=toNotationHelper.call(this,t,e,n,o);return a.split("+").length<i.split("+").length?a:i},Tone.prototype.fromUnits=function(t,e){if(!this.convert&&!this.isUndef(this.convert))return t;switch(e){case Tone.Type.Time:return this.toSeconds(t);case Tone.Type.Frequency:return this.toFrequency(t);case Tone.Type.Decibels:return this.dbToGain(t);case Tone.Type.NormalRange:return Math.min(Math.max(t,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(t,-1),1);case Tone.Type.Positive:return Math.max(t,0);default:return t}},Tone.prototype.toUnits=function(t,e){if(!this.convert&&!this.isUndef(this.convert))return t;switch(e){case Tone.Type.Decibels:return this.gainToDb(t);default:return t}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.A4=440,Tone.prototype.noteToFrequency=function(t){var e=t.split(/(-?\d+)/);if(3===e.length){var n=noteToScaleIndex[e[0].toLowerCase()],r=e[1],i=n+12*(parseInt(r,10)+1);return this.midiToFrequency(i)}return 0},Tone.prototype.frequencyToNote=function(t){var e=Math.log(t/Tone.A4)/Math.LN2,n=Math.round(12*e)+57,r=Math.floor(n/12);r<0&&(n+=-12*r);var i=scaleIndexToNote[n%12];return i+r.toString()},Tone.prototype.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)},Tone.prototype.midiToNote=function(t){var e=Math.floor(t/12)-1,n=t%12;return scaleIndexToNote[n]+e},Tone.prototype.noteToMidi=function(t){var e=t.split(/(\d+)/);if(3===e.length){var n=noteToScaleIndex[e[0].toLowerCase()],r=e[1];return n+12*(parseInt(r,10)+1)}return 0},Tone.prototype.midiToFrequency=function(t){return Tone.A4*Math.pow(2,(t-69)/12)},Tone}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_QUARTERS_PER_MINUTE=120,e.DEFAULT_STEPS_PER_BAR=16,e.DEFAULT_STEPS_PER_QUARTER=4,e.DEFAULT_STEPS_PER_SECOND=100,e.DEFAULT_VELOCITY=80,e.DEFAULT_PROGRAM=0,e.DEFAULT_TICKS_PER_QUARTER=220,e.DEFAULT_CHANNEL=0,e.DRUM_CHANNEL=9,e.MIN_MIDI_VELOCITY=0,e.MAX_MIDI_VELOCITY=127,e.MIDI_VELOCITIES=e.MAX_MIDI_VELOCITY-e.MIN_MIDI_VELOCITY+1,e.NO_CHORD="N.C.",e.NUM_PITCH_CLASSES=12,e.MIN_MIDI_PITCH=0,e.MAX_MIDI_PITCH=127,e.MIDI_PITCHES=e.MAX_MIDI_PITCH-e.MIN_MIDI_PITCH+1,e.MIN_MIDI_PROGRAM=0,e.MAX_MIDI_PROGRAM=127,e.LO_CLICK_PITCH=89,e.HI_CLICK_PITCH=90,e.LO_CLICK_CLASS=9,e.HI_CLICK_CLASS=10},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(292)),r(n(79)),r(n(80)),r(n(294)),r(n(136)),r(n(304)),r(n(301)),r(n(308)),r(n(85)),r(n(139)),r(n(131)),r(n(48)),r(n(303)),r(n(81)),r(n(33)),r(n(9)),r(n(313)),r(n(140)),r(n(298)),r(n(137)),r(n(306)),r(n(299)),r(n(300)),r(n(311)),r(n(312)),r(n(305)),r(n(141)),r(n(309)),r(n(295));var i=n(5);e.op=i.op;var o=n(135);e.losses=o;var a=n(297);e.linalg=a;var s=n(296);e.image=s;var u=n(141);e.spectral=u},function(t,e,n){var r,i;r=[n(4),n(396),n(20),n(106),n(397),n(38),n(398)],i=function(t){"use strict";t.Transport=function(){t.Emitter.call(this),this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=e.defaults.PPQ,this._clock=new t.Clock({callback:this._processTick.bind(this),frequency:0}),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=t.Type.BPM,this.bpm.value=e.defaults.bpm,this._readOnly("bpm"),this._timeSignature=e.defaults.timeSignature,this._scheduledEvents={},this._eventID=0,this._timeline=new t.Timeline,this._repeatedEvents=new t.IntervalTimeline,this._onceEvents=new t.Timeline,this._syncedSignals=[];var n=this.notationToSeconds(e.defaults.swingSubdivision,e.defaults.bpm,e.defaults.timeSignature);this._swingTicks=n/(60/e.defaults.bpm)*this._ppq,this._swingAmount=0},t.extend(t.Transport,t.Emitter),t.Transport.defaults={bpm:120,swing:0,swingSubdivision:"16n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:48},t.Transport.prototype._processTick=function(t){this._swingAmount>0&&this._clock.ticks%this._ppq!==0&&this._clock.ticks%this._swingTicks===0&&(t+=this.ticksToSeconds(this._swingTicks)*this._swingAmount),this.loop&&this._clock.ticks===this._loopEnd&&(this.ticks=this._loopStart,this.trigger("loop",t));var e=this._clock.ticks;this._timeline.forEachAtTime(e,function(e){e.callback(t)}),this._repeatedEvents.forEachOverlap(e,function(n){(e-n.time)%n.interval===0&&n.callback(t)}),this._onceEvents.forEachBefore(e,function(e){e.callback(t)}),this._onceEvents.cancelBefore(e)},t.Transport.prototype.schedule=function(t,e){var n={time:this.toTicks(e),callback:t},r=this._eventID++;return this._scheduledEvents[r.toString()]={event:n,timeline:this._timeline},this._timeline.addEvent(n),r},t.Transport.prototype.scheduleRepeat=function(t,e,n,r){if(e<=0)throw new Error("repeat events must have an interval larger than 0");var i={time:this.toTicks(n),duration:this.toTicks(this.defaultArg(r,1/0)),interval:this.toTicks(e),callback:t},o=this._eventID++;return this._scheduledEvents[o.toString()]={event:i,timeline:this._repeatedEvents},this._repeatedEvents.addEvent(i),o},t.Transport.prototype.scheduleOnce=function(t,e){var n={time:this.toTicks(e),callback:t},r=this._eventID++;return this._scheduledEvents[r.toString()]={event:n,timeline:this._onceEvents},this._onceEvents.addEvent(n),r},t.Transport.prototype.clear=function(t){if(this._scheduledEvents.hasOwnProperty(t)){var e=this._scheduledEvents[t.toString()];e.timeline.removeEvent(e.event),delete this._scheduledEvents[t.toString()]}return this},t.Transport.prototype.cancel=function(t){return t=this.defaultArg(t,0),t=this.toTicks(t),this._timeline.cancel(t),this._onceEvents.cancel(t),this._repeatedEvents.cancel(t),this},t.Transport.prototype.quantize=function(e,n){n=this.defaultArg(n,"4n");var r=this.toTicks(e);n=this.toTicks(n);var i=n-r%n;i===n&&(i=0);var o=this.now();return this.state===t.State.Started&&(o=this._clock._nextTick),this.toSeconds(e,o)+this.ticksToSeconds(i)},Object.defineProperty(t.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),t.Transport.prototype.start=function(t,e){return t=this.toSeconds(t),e=this.isUndef(e)?this.defaultArg(e,this._clock.ticks):this.toTicks(e),this._clock.start(t,e),this.trigger("start",t,this.ticksToSeconds(e)),this},t.Transport.prototype.stop=function(t){return t=this.toSeconds(t),this._clock.stop(t),this.trigger("stop",t),this},t.Transport.prototype.pause=function(t){return t=this.toSeconds(t),this._clock.pause(t),this.trigger("pause",t),this},Object.defineProperty(t.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(t){this.isArray(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}}),Object.defineProperty(t.Transport.prototype,"loopStart",{get:function(){return this.ticksToSeconds(this._loopStart)},set:function(t){this._loopStart=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"loopEnd",{get:function(){return this.ticksToSeconds(this._loopEnd)},set:function(t){this._loopEnd=this.toTicks(t)}}),t.Transport.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(t.Transport.prototype,"swing",{get:function(){return 2*this._swingAmount},set:function(t){this._swingAmount=.5*t}}),Object.defineProperty(t.Transport.prototype,"swingSubdivision",{get:function(){return this.toNotation(this._swingTicks+"i")},set:function(t){this._swingTicks=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"position",{get:function(){var t=this.ticks/this._ppq,e=Math.floor(t/this._timeSignature),n=t%1*4;n%1>0&&(n=n.toFixed(3)),t=Math.floor(t)%this._timeSignature;var r=[e,t,n];return r.join(":")},set:function(t){var e=this.toTicks(t);this.ticks=e}}),Object.defineProperty(t.Transport.prototype,"progress",{get:function(){return this.loop?(this.ticks-this._loopStart)/(this._loopEnd-this._loopStart):0}}),Object.defineProperty(t.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(t){
this._clock.ticks=t}}),Object.defineProperty(t.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(t){this._ppq=t,this.bpm.value=this.bpm.value}}),t.Transport.prototype._fromUnits=function(t){return 1/(60/t/this.PPQ)},t.Transport.prototype._toUnits=function(t){return t/this.PPQ*60},t.Transport.prototype.syncSignal=function(e,n){n||(n=0!==e._param.value?e._param.value/this.bpm._param.value:0);var r=new t.Gain(n);return this.bpm.chain(r,e._param),this._syncedSignals.push({ratio:r,signal:e,initial:e._param.value}),e._param.value=0,this},t.Transport.prototype.unsyncSignal=function(t){for(var e=this._syncedSignals.length-1;e>=0;e--){var n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal._param.value=n.initial,this._syncedSignals.splice(e,1))}return this},t.Transport.prototype.dispose=function(){return t.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._onceEvents.dispose(),this._onceEvents=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var e=t.Transport;return t._initAudioContext(function(){if("function"==typeof t.Transport)t.Transport=new t.Transport;else{t.Transport.stop();var n=t.Transport.get();t.Transport.dispose(),e.call(t.Transport),t.Transport.set(n)}}),t.Transport}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function i(t,e,n){for(var r=t.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)n.indexOf(s)===-1?i.push(t[o++]):i.push(e[a++]);return i}function o(t,e){for(var n=[],r=t.length,i=0;i<r;i++)e.indexOf(i)===-1&&n.push(t[i]);var o=e.map(function(e){return t[e]});return[n,o]}function a(t,e){var n=e.map(function(t){return 1});return i(t,n,e)}function s(t,e){var n=e.length;return t=null==t?e.map(function(t,e){return e}):[].concat(t),h.assert(t.every(function(t){return t>=-n&&t<n}),"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t),h.assert(t.every(function(t){return h.isInt(t)}),"All values in axis param must be integers but got axis "+t),t.map(function(t){return t<0?n+t:t})}function u(t,e,n){h.assert(r(e,n),t+" supports only inner-most axes for now. "+("Got axes "+e+" and rank-"+n+" input."))}function l(t,e){if(r(t,e))return null;for(var n=[],i=0;i<e;++i)t.indexOf(i)===-1&&n.push(i);return t.forEach(function(t){return n.push(t)}),n}function c(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function p(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}Object.defineProperty(e,"__esModule",{value:!0});var h=n(2);e.axesAreInnerMostDims=r,e.combineLocations=i,e.computeOutAndReduceShapes=o,e.expandShapeToKeepDim=a,e.parseAxisParam=s,e.assertAxesAreInnerMostDims=u,e.getAxesPermutation=l,e.getUndoAxesPermutation=c,e.getInnerMostAxes=p},function(t,e){"use strict";function n(t,e){for(var n=t.length,r=[],i=0;i<n;i++){var o=n-1-i,a=t[o]||1,s=e[e.length-1-i]||1;s>1&&1===a&&r.unshift(o)}return r}function r(t,e){for(var n=[],r=0;r<e.length;r++){var i=t[t.length-r-1],o=e.length-r-1,a=e[o];(null==i||1===i&&a>1)&&n.unshift(o)}return n}function i(t){for(var e=0;e<t.length;e++)if(t[e]!==e)return!1;return!0}function o(t,e){for(var n=[],r=Math.max(t.length,e.length),i=0;i<r;i++){var o=t[t.length-i-1];null==o&&(o=1);var a=e[e.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a){var s="Operands could not be broadcast together with shapes "+(t+" and "+e+".");throw Error(s)}n.unshift(o)}}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getBroadcastDims=n,e.getReductionAxes=r,e.broadcastDimsAreOuter=i,e.assertAndGetBroadcastShape=o},function(t,e,n){"use strict";function r(t){i.assert(null!=t.className,"Class being registered does not have the static className property defined."),i.assert("string"==typeof t.className,"className is required to be a string, but got type "+typeof t.className),i.assert(t.className.length>0,"Class being registered has an empty-string as its className, which is disallowed."),a.register(t)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),o=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}();e.Serializable=o;var a=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();e.SerializationMap=a,e.registerClass=r},function(t,e,n){"use strict";function r(t){p.checkStringTypeUnionValue(e.VALID_DATA_FORMAT_VALUES,"DataFormat",t)}function i(t){p.checkStringTypeUnionValue(e.VALID_PADDING_MODE_VALUES,"PaddingMode",t)}function o(t){p.checkStringTypeUnionValue(e.VALID_POOL_MODE_VALUES,"PoolMode",t)}function a(t,e){f.push(t);try{var n=e();return f.pop(),n}catch(t){throw f.pop(),t}}function s(){return 0===f.length?"":f.join(d)+d}function u(t){if(!c(t))throw new Error("Not a valid tensor name: '"+t+"'");return s()+t}function l(t){if(!c(t))throw new Error("Not a valid tensor name: '"+t+"'");h.has(t)||h.set(t,0);var e=h.get(t);if(h.set(t,h.get(t)+1),e>0){var n=t+"_"+e;return h.set(n,1),n}return t}function c(t){return!!t.match(m)}Object.defineProperty(e,"__esModule",{value:!0});var p=n(10),h=new Map;e.VALID_DATA_FORMAT_VALUES=["channelsFirst","channelsLast"],e.checkDataFormat=r,e.VALID_PADDING_MODE_VALUES=["valid","same","causal"],e.checkPaddingMode=i,e.VALID_POOL_MODE_VALUES=["max","avg"],e.checkPoolMode=o;var f=[],d="/";e.nameScope=a,e.getScopedTensorName=u,e.getUniqueTensorName=l;var m=new RegExp(/^[A-Za-z][-A-Za-z0-9\._\/]*$/);e.isValidTensorName=c},function(t,e,n){"use strict";function r(t){return t===parseInt(t.toString(),10)}function i(t,e,n){null==e&&(e=0),null==n&&(n=t.length);for(var r=1,i=e;i<n;++i)r*=t[i];return r}function o(t){return t=Array.isArray(t)?new Float32Array(t):t,d.tensor1d(t)}function a(t){return f.min(o(t)).dataSync()[0]}function s(t){return f.max(o(t)).dataSync()[0]}function u(t){return f.sum(o(t)).dataSync()[0]}function l(t){return u(t)/t.length}function c(t){var e=f.sub(o(t),d.scalar(l(t))),n=f.sum(f.mulStrict(e,e)).dataSync()[0];return n/t.length}function p(t){var e=t.slice().sort(function(t,e){return t-e}),n=Math.floor((e.length-1)/2),r=Math.ceil((e.length-1)/2);return n===r?e[n]:(e[n]+e[r])/2}function h(t,e){if(e<t)throw new m.ValueError("end ("+e+") < begin ("+t+") is forbidden.");for(var n=[],r=t;r<e;++r)n.push(r);return n}Object.defineProperty(e,"__esModule",{value:!0});var f=n(1),d=n(1),m=n(7);e.isInteger=r,e.arrayProd=i,e.min=a,e.max=s,e.sum=u,e.mean=l,e.variance=c,e.median=p,e.range=h},function(t,e,n){"use strict";function r(){return s}function i(t){s=t}function o(){return"channelsLast"}Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=a.ENV.get("EPSILON");e.epsilon=r,e.setEpsilon=i,e.imageDataFormat=o},function(t,e,n){"use strict";function r(t){return new m({l1:null!=t?t.l1:null,l2:0})}function i(t){return new m({l2:null!=t?t.l2:null,l1:0})}function o(t){return f.serializeKerasObject(t)}function a(t,e){return void 0===e&&(e={}),f.deserializeKerasObject(t,c.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function s(t){if(null==t)return null;if("string"==typeof t){var n=t in e.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?e.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[t]:t,r={className:n,config:{}};return a(r)}return t instanceof d?t:a(t)}var u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var l=n(1),c=n(1),p=n(8),h=n(13),f=n(10),d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return u(e,t),e}(c.serialization.Serializable);e.Regularizer=d;var m=function(t){function e(e){var n=t.call(this)||this,r=null==e||null==e.l1?.01:e.l1,i=null==e||null==e.l2?.01:e.l2;return n.hasL1=0!==r,n.hasL2=0!==i,n.l1=p.getScalar(r),n.l2=p.getScalar(i),n}return u(e,t),e.prototype.apply=function(t){var e=this;return c.tidy(function(){var n=c.zeros([1]);return e.hasL1&&(n=c.add(n,c.sum(l.mul(e.l1,c.abs(t))))),e.hasL2&&(n=c.add(n,c.sum(l.mul(e.l2,h.square(t))))),n.asScalar()})},e.prototype.getConfig=function(){return{l1:this.l1.dataSync()[0],l2:this.l2.dataSync()[0]}},e.fromConfig=function(t,e){return new t({l1:e.l1,l2:e.l2})},e.className="L1L2",e}(d);e.L1L2=m,c.serialization.registerClass(m),e.l1=r,e.l2=i,e.REGULARIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={l1l2:"L1L2"},e.serializeRegularizer=o,e.deserializeRegularizer=a,e.getRegularizer=s},function(t,e,n){var r,i;r=[n(4),n(23),n(159),n(160),n(20),n(107),n(18)],i=function(t){"use strict";return t.Source=function(e){t.call(this),e=this.defaultArg(e,t.Source.defaults),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new t.TimelineState(t.State.Stopped),this._syncStart=function(t,e){t=this.toSeconds(t),t+=this.toSeconds(this._startDelay),this.start(t,e)}.bind(this),this._syncStop=this.stop.bind(this),this._startDelay=0,this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit"},t.extend(t.Source),t.Source.defaults={volume:0},Object.defineProperty(t.Source.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),t.Source.prototype.start=function(e){return e=this.toSeconds(e),(this._state.getStateAtTime(e)!==t.State.Started||this.retrigger)&&(this._state.setStateAtTime(t.State.Started,e),this._start&&this._start.apply(this,arguments)),this},t.Source.prototype.stop=function(e){return e=this.toSeconds(e),this._state.getStateAtTime(e)===t.State.Started&&(this._state.setStateAtTime(t.State.Stopped,e),this._stop&&this._stop.apply(this,arguments)),this},t.Source.prototype.sync=function(e){return this._startDelay=this.defaultArg(e,0),t.Transport.on("start",this._syncStart),t.Transport.on("stop pause",this._syncStop),this},t.Source.prototype.unsync=function(){return this._startDelay=0,t.Transport.off("start",this._syncStart),t.Transport.off("stop pause",this._syncStop),this},t.Source.prototype.dispose=function(){this.stop(),t.prototype.dispose.call(this),this.unsync(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null,this._syncStart=null,this._syncStart=null},t.Source}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(185),i=r.tensorflow.magenta.NoteSequence;e.NoteSequence=i},function(t,e,n){"use strict";function r(t){var e=L.convertToTensor(t,"x","clone"),n=function(t){return{$x:function(){return t.toFloat()}}};return R.ENV.engine.runKernel(function(t){return D.Tensor.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},n)}function i(t,n,r,i){void 0===i&&(i="float32"),null==n&&(n=t);for(var o=k([t,n],i),a=t<=n?t:n,s=0;s<a;++s)o.set(1,s,s);var u=o.toTensor().as2D(t,n);if(null==r)return u;if(1===r.length)return e.tile(e.expandDims(u,0),[r[0],1,1]);if(2===r.length)return e.tile(e.expandDims(e.expandDims(u,0),0),[r[0],r[1],1,1]);if(3===r.length)return e.tile(e.expandDims(e.expandDims(e.expandDims(u,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+r.length+"D."))}function o(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new B.MPRandGauss(e,n,r,!1,i),a=k(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}function a(t,e,n,r,i){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new B.MPRandGauss(e,n,r,!0,i),a=k(t,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}function s(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=k(t,r),o=0;o<i.values.length;o++)i.values[o]=F.randUniform(e,n);return i.toTensor()}function u(t,e,n){var r=F.sizeFromShape(t),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return D.Tensor.make(t,{values:i},n)}function l(t,e,n,r){void 0===r&&(r=!1);var i=L.convertToTensor(t,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(o+"."));if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?i.as2D(1,-1):i,u=R.ENV.engine.runKernel(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}function c(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=0);var i=L.convertToTensor(t,"indices","oneHot","int32");if(F.assert("int32"===i.dtype,"Indices must be of dtype `int32`"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=function(t){return{$indices:function(){return j.zerosLike(i)}}};return R.ENV.engine.runKernel(function(t){return t.oneHot(i,e,n,r)},{$indices:i},o)}function p(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return R.ENV.engine.fromPixels(t,e)}function h(t,e){return C(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,p,h,f,d,m,y,g,v,b,_,w;return M(this,function(S){switch(S.label){case 0:if(n=L.convertToTensor(t,"img","toPixels","int32"),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],a=2===n.rank?1:n.shape[2],a>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return s=n.min(),u=n.max(),[4,s.data()];case 1:return l=S.sent()[0],[4,u.data()];case 2:if(c=S.sent()[0],s.dispose(),u.dispose(),"float32"===n.dtype){if(l<0||c>1)throw new Error("Tensor values for a float32 Tensor must be in the "+("range [0 - 1] but got range ["+l+" - "+c+"]."))}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(l<0||c>255)throw new Error("Tensor values for a int32 Tensor must be in the "+("range [0 - 255] but got range ["+l+" - "+c+"]."))}return[4,n.data()];case 3:for(p=S.sent(),h="float32"===n.dtype?255:1,f=new Uint8ClampedArray(o*i*4),d=0;d<i*o;++d)m=void 0,y=void 0,g=void 0,v=void 0,1===a?(m=p[d]*h,y=p[d]*h,g=p[d]*h,v=255):3===a?(m=p[3*d]*h,y=p[3*d+1]*h,g=p[3*d+2]*h,v=255):4===a&&(m=p[4*d]*h,y=p[4*d+1]*h,g=p[4*d+2]*h,v=p[4*d+3]*h),b=4*d,f[b+0]=Math.round(m),f[b+1]=Math.round(y),f[b+2]=Math.round(g),f[b+3]=Math.round(v);return null!=e&&(e.width=o,e.height=i,_=e.getContext("2d"),w=new ImageData(f,o,i),_.putImageData(w,0,0)),n!==t&&n.dispose(),[2,f]}})})}function f(t,e){var n=L.convertToTensor(t,"x","reshape");e=F.inferFromImplicitShape(e,n.size),F.assert(n.size===F.sizeFromShape(e),"new shape and old shape must have the same number of elements.");var r=function(t){return{$x:function(){return t.reshape(n.shape)}}};return R.ENV.engine.runKernel(function(t){return t.reshape(n,e)},{$x:n},r)}function d(t,n){var r=L.convertToTensor(t,"x","squeeze");return e.reshape(r,F.squeezeShape(r.shape,n).newShape)}function m(t,e){var n=L.convertToTensor(t,"x","cast"),r=function(t){return{$x:function(){return t.clone()}}};return R.ENV.engine.runKernel(function(t){return t.cast(n,e)},{$x:n},r)}function y(t,e){var n=L.convertToTensor(t,"x","tile");F.assert(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" "+("must match length of reps "+e+"."));var r=function(t){var r=function(){var r=j.zerosLike(n);if(1===n.rank)for(var i=0;i<e[0];++i)r=r.add(t.slice([i*n.shape[0]],[n.shape[0]]));else if(2===n.rank)for(var i=0;i<e[0];++i)for(var o=0;o<e[1];++o)r=r.add(t.slice([i*n.shape[0],o*n.shape[1]],[n.shape[0],n.shape[1]]));else if(3===n.rank)for(var i=0;i<e[0];++i)for(var o=0;o<e[1];++o)for(var a=0;a<e[2];++a)r=r.add(t.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(4!==n.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+(n.rank+" tensors yet."));for(var i=0;i<e[0];++i)for(var o=0;o<e[1];++o)for(var a=0;a<e[2];++a)for(var s=0;s<e[3];++s)r=r.add(t.slice([i*n.shape[0],o*n.shape[1],a*n.shape[2],s*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return r};return{$x:r}};return R.ENV.engine.runKernel(function(t){return t.tile(n,e)},{$x:n},r)}function g(t,n,r){return void 0===r&&(r=0),F.assert(2===n.length,"Invalid number of paddings. Must be length of 2."),e.pad(t,[n],r)}function v(t,n,r){return void 0===r&&(r=0),F.assert(2===n.length&&2===n[0].length&&2===n[1].length,"Invalid number of paddings. Must be length of 2 each."),e.pad(t,n,r)}function b(t,n,r){return void 0===r&&(r=0),F.assert(3===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length,"Invalid number of paddings. Must be length of 2 each."),e.pad(t,n,r)}function _(t,n,r){return void 0===r&&(r=0),F.assert(4===n.length&&2===n[0].length&&2===n[1].length&&2===n[2].length&&2===n[3].length,"Invalid number of paddings. Must be length of 2 each."),e.pad(t,n,r)}function w(t,e,n){void 0===n&&(n=0);var r=L.convertToTensor(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(t){return t[0]}),o=function(t){return{$x:function(){return t.slice(i,r.shape)}}};return R.ENV.engine.runKernel(function(t){return t.pad(r,e,n)},{$x:r},o)}function S(t,e){void 0===e&&(e=0);var n=L.convertToTensorArray(t,"tensors","stack");if(F.assert(n.length>=1,"Pass at least one tensor to tf.stack"),1===n.length)return n[0].expandDims(e);var r=n[0].rank,i=n[0].shape,o=n[0].dtype;F.assert(e<=r,"Axis must be <= rank of the tensor"),n.forEach(function(t){F.assertShapesMatch(i,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){F.assert(o===t.dtype,"All tensors passed to stack must have matching dtypes")});var a=n.map(function(t){return t.expandDims(e)});return q.concat(a,e)}function x(t,e,n){var r=L.convertToTensor(t,"x","batchToSpaceND"),i=e.reduce(function(t,e){return t*e});F.assert(r.rank>=1+e.length,"input rank is "+r.rank+" but should be > than blockShape.length "+e.length),F.assert(n.length===e.length,"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length),F.assert(r.shape[0]%i===0,"input tensor batch is "+r.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+i));var o=function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}};return R.ENV.engine.runKernel(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},o)}function T(t,e,n){var r=L.convertToTensor(t,"x","spaceToBatchND");F.assert(r.rank>=1+e.length,"input rank "+r.rank+" should be > than [blockShape] "+e.length),F.assert(n.length===e.length,"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length),F.assert(r.shape.reduce(function(t,r,i){return i>0&&i<=e.length?t&&(r+n[i-1][0]+n[i-1][1])%e[i-1]===0:t},!0),"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString());var i=function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}};return R.ENV.engine.runKernel(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},i)}function P(t,e){void 0===e&&(e=0);for(var n=L.convertToTensor(t,"x","unstack"),r=n.shape[e],i=Array(n.rank-1).fill(0),o=0,a=0;a<n.rank;a++)a!==e&&(i[o]=n.shape[a],o++);var s;s=Array(r).fill(1);var u=Array(n.rank).fill(0),l=n.shape.slice();return s.map(function(t){l[e]=t;var r=n.slice(u,l);return u[e]+=t,r.reshape(i)})}function E(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=L.convertToTensor(t,"x","cumsum");e|=0;var o=z.getAxesPermutation([e],i.rank),a=i;null!=o&&(a=i.transpose(o));var s=z.getInnerMostAxes(1,i.rank)[0],u=function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}},l=R.ENV.engine.runKernel(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},u);return null!=o&&(l=l.transpose(o)),l}function A(t,n){void 0===n&&(n=0);var r=L.convertToTensor(t,"x","expandDims");F.assert(n<=r.rank,"Axis must be <= rank of the tensor");var i=r.shape.slice();return n<0&&(F.assert(-(r.rank+1)<=n,"Axis must be in the interval ["+-(r.rank+1)+", "+r.rank+"]"),n=r.rank+n+1),i.splice(n,0,1),e.reshape(r,i)}function N(t,e,n){void 0===n&&(n="NHWC");var r=L.convertToTensor(t,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return F.assert(i*e>=0,"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+"  for depthToSpace with input shape\n      "+r.shape),F.assert(o*e>=0,"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+" for depthToSpace with input shape\n          "+r.shape),F.assert(a%(e*e)===0,"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape),R.ENV.engine.runKernel(function(t){return t.depthToSpace(r,e,n)},{$x:r})}function O(t,e){return C(this,void 0,void 0,function(){var n,r,i,o,a,s,u,l,c,u,p;return M(this,function(h){switch(h.label){case 0:return n=L.convertToTensor(t,"x","setdiff1d"),r=L.convertToTensor(e,"y","setdiff1d"),F.assert(n.dtype===r.dtype,"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."),F.assert(1===n.rank,"x should be 1D tensor, but got x ("+n.shape+")."),F.assert(1===r.rank,"y should be 1D tensor, but got y ("+r.shape+")."),[4,n.data()];case 1:return i=h.sent(),[4,r.data()];case 2:for(o=h.sent(),a=new Set(o),s=0,u=0;u<i.length;u++)a.has(i[u])||s++;for(l=new D.TensorBuffer([s],n.dtype),c=new D.TensorBuffer([s],"int32"),u=0,p=0;u<i.length;u++)a.has(i[u])||(l.values[p]=i[u],c.values[p]=u,p++);return[2,[l.toTensor(),c.toTensor()]]}})})}function k(t,e,n){return void 0===e&&(e="float32"),new D.TensorBuffer(t,e,n)}function I(t,e){void 0===e&&(e=!1),console.log(t.toString(e))}var C=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},M=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var R=n(3),D=n(15),L=n(6),F=n(2),z=n(24),q=n(80),V=n(5),B=n(302),j=n(9);e.toPixels=h,e.buffer=k,e.print=I,e.batchToSpaceND=V.op({batchToSpaceND_:x}),e.cast=V.op({cast_:m}),e.clone=V.op({clone_:r}),e.cumsum=V.op({cumsum_:E}),e.depthToSpace=V.op({depthToSpace_:N}),e.expandDims=V.op({expandDims_:A}),e.eye=V.op({eye_:i}),e.fromPixels=V.op({fromPixels_:p}),e.multinomial=V.op({multinomial_:l}),e.oneHot=V.op({oneHot_:c}),e.pad=V.op({pad_:w}),e.pad1d=V.op({pad1d_:g}),e.pad2d=V.op({pad2d_:v}),e.pad3d=V.op({pad3d_:b}),e.pad4d=V.op({pad4d_:_}),e.rand=V.op({rand_:u}),e.randomNormal=V.op({randomNormal_:o}),e.randomUniform=V.op({randomUniform_:s}),e.reshape=V.op({reshape_:f}),e.spaceToBatchND=V.op({spaceToBatchND_:T}),e.squeeze=V.op({squeeze_:d}),e.stack=V.op({stack_:S}),e.tile=V.op({tile_:y}),e.truncatedNormal=V.op({truncatedNormal_:a}),e.unstack=V.op({unstack_:P}),e.setdiff1dAsync=O},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(17),o=n(26),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),i=r.value,o=r.grads;this.applyGradients(o);var a=Object.keys(o);return a.forEach(function(t){return o[t].dispose()}),e?i:(i.dispose(),null)},e.prototype.computeGradients=function(t,e){return i.variableGrads(t,e)},e}(o.Serializable);e.Optimizer=a},function(t,e,n){"use strict";function r(t,e){return l.tidy(function(){return u.sqrt(u.sum(u.mulStrict(t,t),e,!0))})}function i(t){return h.serializeKerasObject(t)}function o(t,e){return void 0===e&&(e={}),h.deserializeKerasObject(t,l.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function a(t){if(null==t)return null;if("string"==typeof t){var n=t in e.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP?e.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP[t]:t,r={className:n,config:{}};return o(r)}return t instanceof f?t:o(t)}var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=n(1),c=n(29),p=n(8),h=n(10),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.getConfig=function(){return{}},e}(l.serialization.Serializable);e.Constraint=f;var d=function(t){function e(e){var n=t.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return s(e,t),e.prototype.apply=function(t){var e=this;return l.tidy(function(){var n=r(t,e.axis),i=u.clipByValue(n,0,e.maxValue);return u.mul(t,u.div(i,u.add(p.getScalar(c.epsilon()),n)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e.className="MaxNorm",e}(f);e.MaxNorm=d,l.serialization.registerClass(d);var m=function(t){function e(e){var n=t.call(this)||this;return n.defaultAxis=0,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return s(e,t),e.prototype.apply=function(t){var e=this;return l.tidy(function(){return u.div(t,u.add(p.getScalar(c.epsilon()),r(t,e.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e.className="UnitNorm",e}(f);e.UnitNorm=m,l.serialization.registerClass(m);var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.apply=function(t){return u.relu(t)},e.className="NonNeg",e}(f);e.NonNeg=y,l.serialization.registerClass(y);var g=function(t){function e(e){var n=t.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=null!=e.minValue?e.minValue:n.defaultMinValue,n.maxValue=null!=e.maxValue?e.maxValue:n.defaultMaxValue,n.rate=null!=e.rate?e.rate:n.defaultRate,n.axis=null!=e.axis?e.axis:n.defaultAxis,n}return s(e,t),e.prototype.apply=function(t){var e=this;return l.tidy(function(){var n=r(t,e.axis),i=u.add(u.mul(p.getScalar(e.rate),u.clipByValue(n,e.minValue,e.maxValue)),u.mul(p.getScalar(1-e.rate),n));return u.mul(t,u.div(i,u.add(p.getScalar(c.epsilon()),n)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e.className="MinMaxNorm",e}(f);e.MinMaxNorm=g,l.serialization.registerClass(g),e.CONSTRAINT_IDENTIFIER_REGISTRY_SYMBOL_MAP={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"},e.serializeConstraint=i,e.deserializeConstraint=o,e.getConstraint=a},function(t,e,n){"use strict";function r(t){m.checkStringTypeUnionValue(e.VALID_FAN_MODE_VALUES,"FanMode",t)}function i(t){m.checkStringTypeUnionValue(e.VALID_DISTRIBUTION_VALUES,"Distribution",t)}function o(t,e){void 0===e&&(e="channelsLast");var n,r;if(f.checkDataFormat(e),2===t.length)n=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if("channelsFirst"===e){var i=y.arrayProd(t,2);n=t[1]*i,r=t[0]*i}else if("channelsLast"===e){var i=y.arrayProd(t,0,t.length-2);n=t[t.length-2]*i,r=t[t.length-1]*i}}else{var o=y.arrayProd(t);n=Math.sqrt(o),r=Math.sqrt(o)}return[n,r]}function a(t,e){return void 0===e&&(e={}),m.deserializeKerasObject(t,c.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function s(t){return m.serializeKerasObject(t)}function u(t){if("string"==typeof t){var n=t in e.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP?e.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP[t]:t;if("GlorotUniform"===n)return new E;if("GlorotNormal"===n)return new A;if("HeNormal"===n)return new N;if("LeCunNormal"===n)return new O;var r={className:n,config:{}};return a(r)}return t instanceof g?t:a(t)}var l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var c=n(1),p=n(8),h=n(13),f=n(27),d=n(7),m=n(10),y=n(28);e.VALID_FAN_MODE_VALUES=["fanIn","fanOut","fanAvg"],e.checkFanMode=r,e.VALID_DISTRIBUTION_VALUES=["normal","uniform"],e.checkDistribution=i;var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(c.serialization.Serializable);e.Initializer=g;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.apply=function(t,e){return c.zeros(t,e)},e.className="Zeros",e}(g);e.Zeros=v,c.serialization.registerClass(v);var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return l(e,t),e.prototype.apply=function(t,e){return c.ones(t,e)},e.className="Ones",e}(g);e.Ones=b,c.serialization.registerClass(b);var _=function(t){function e(e){var n=t.call(this)||this;if("object"!=typeof e)throw new d.ValueError("Expected argument of type ConstantConfig but got "+e);if(void 0===e.value)throw new d.ValueError("config must have value set but got "+e);return n.value=e.value,n}return l(e,t),e.prototype.apply=function(t,e){var n=this;return c.tidy(function(){return c.mul(c.scalar(n.value),c.ones(t,e))})},e.prototype.getConfig=function(){return{value:this.value}},e.className="Constant",e}(g);e.Constant=_,c.serialization.registerClass(_);var w=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=e.minval||n.DEFAULT_MINVAL,n.maxval=e.maxval||n.DEFAULT_MAXVAL,n.seed=e.seed,n}return l(e,t),e.prototype.apply=function(t,e){return c.randomUniform(t,this.minval,this.maxval,e)},e.prototype.getConfig=function(){
return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e.className="RandomUniform",e}(g);e.RandomUniform=w,c.serialization.registerClass(w);var S=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return l(e,t),e.prototype.apply=function(t,e){if(e=e||"float32","float32"!==e&&"int32"!==e)throw new d.NotImplementedError("randomNormal does not support dType "+e+".");return h.randomNormal(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="RandomNormal",e}(g);e.RandomNormal=S,c.serialization.registerClass(S);var x=function(t){function e(e){var n=t.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=e.mean||n.DEFAULT_MEAN,n.stddev=e.stddev||n.DEFAULT_STDDEV,n.seed=e.seed,n}return l(e,t),e.prototype.apply=function(t,e){if(e=e||"float32","float32"!==e&&"int32"!==e)throw new d.NotImplementedError("truncatedNormal does not support dType "+e+".");return c.truncatedNormal(t,this.mean,this.stddev,e,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e.className="TruncatedNormal",e}(g);e.TruncatedNormal=x,c.serialization.registerClass(x);var T=function(t){function e(e){var n=t.call(this)||this;return n.gain=null!=e.gain?c.scalar(e.gain):p.getScalar(1),n}return l(e,t),e.prototype.apply=function(t,e){var n=this;return c.tidy(function(){if(2!==t.length||t[0]!==t[1])throw new d.ValueError("Identity matrix initializer can only be used for 2D square matrices.");return c.mul(n.gain,c.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain.get()}},e.className="Identity",e}(g);e.Identity=T,c.serialization.registerClass(T);var P=function(t){function e(e){var n=t.call(this)||this;if(e.scale<0)throw new d.ValueError("scale must be a positive float. Got: "+e.scale);return n.scale=null==e.scale?1:e.scale,n.mode=e.mode,r(n.mode),n.distribution=e.distribution,i(n.distribution),n.seed=e.seed,n}return l(e,t),e.prototype.apply=function(t,e){var n=o(t),r=n[0],i=n[1],a=this.scale;if(a/="fanIn"===this.mode?Math.max(1,r):"fanOut"===this.mode?Math.max(1,i):Math.max(1,(r+i)/2),"normal"===this.distribution){var s=Math.sqrt(a);if(e=e||"float32","float32"!==e&&"int32"!==e)throw new d.NotImplementedError(this.getClassName()+" does not support dType "+e+".");return c.truncatedNormal(t,0,s,e,this.seed)}var u=Math.sqrt(3*a);return c.randomUniform(t,-u,u,e)},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e.className="VarianceScaling",e}(g);e.VarianceScaling=P,c.serialization.registerClass(P);var E=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return P.className},e.className="GlorotUniform",e}(P);e.GlorotUniform=E,c.serialization.registerClass(E);var A=function(t){function e(e){return t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return P.className},e.className="GlorotNormal",e}(P);e.GlorotNormal=A,c.serialization.registerClass(A);var N=function(t){function e(e){return t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return P.className},e.className="HeNormal",e}(P);e.HeNormal=N,c.serialization.registerClass(N);var O=function(t){function e(e){return t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})||this}return l(e,t),e.prototype.getClassName=function(){return P.className},e.className="LeCunNormal",e}(P);e.LeCunNormal=O,c.serialization.registerClass(O);var k=function(t){function e(e){var n=t.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=null==e.gain?n.DEFAULT_GAIN:e.gain,n.seed=e.seed,null!=n.seed)throw new d.NotImplementedError("Random seed is not implemented for Orthogonal Initializer yet.");return n}return l(e,t),e.prototype.apply=function(t,e){var n=this;return c.tidy(function(){if(2!==t.length)throw new d.NotImplementedError("The Orthogonal Initializer does not support non-2D shapes yet.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+("than 2000 ("+t[0]*t[1]+") elements: ")+"Slowness may result.");var e=t[0]>t[1]?[t[1],t[0]]:t,r=h.randomNormal(e,0,1,"float32"),i=c.linalg.gramSchmidt(r);return t[0]>t[1]&&(i=i.transpose()),c.mul(p.getScalar(n.gain),i)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e.className="Orthogonal",e}(g);e.Orthogonal=k,c.serialization.registerClass(k),e.INITIALIZER_IDENTIFIER_REGISTRY_SYMBOL_MAP={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",identity:"Identity",leCunNormal:"LeCunNormal",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"},e.serializeInitializer=s,e.getInitializer=u},function(t,e,n){(function(t){"use strict";function r(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function i(t){function e(t,n){return this instanceof e?(Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),void(n&&r(this,n))):new e(t,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}var o=e;o.asPromise=n(190),o.base64=n(191),o.EventEmitter=n(192),o.float=n(193),o.inquire=n(194),o.utf8=n(196),o.pool=n(195),o.LongBits=n(372),o.global="undefined"!=typeof window&&window||"undefined"!=typeof t&&t||"undefined"!=typeof self&&self||this,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isNode=Boolean(o.global.process&&o.global.process.versions&&o.global.process.versions.node),o.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},o.isString=function(t){return"string"==typeof t||t instanceof String},o.isObject=function(t){return t&&"object"==typeof t},o.isset=o.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},o.Buffer=function(){try{var t=o.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(t){return"number"==typeof t?o.Buffer?o._Buffer_allocUnsafe(t):new o.Array(t):o.Buffer?o._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},o.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire("long"),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(t){return t?o.LongBits.from(t).toHash():o.LongBits.zeroHash},o.longFromHash=function(t,e){var n=o.LongBits.fromHash(t);return o.Long?o.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},o.merge=r,o.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},o.newError=i,o.ProtocolError=i("ProtocolError"),o.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},o.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var t=o.Buffer;return t?(o._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},void(o._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)})):void(o._Buffer_from=o._Buffer_allocUnsafe=null)}}).call(e,function(){return this}())},function(t,e,n){var r,i;r=[n(4),n(161),n(20)],i=function(t){"use strict";return t.Gain=function(){var e=this.optionsObject(arguments,["gain","units"],t.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new t.Param({param:this._gainNode.gain,units:e.units,value:e.gain,convert:e.convert}),this._readOnly("gain")},t.extend(t.Gain),t.Gain.defaults={gain:1,convert:!0},t.Gain.prototype.dispose=function(){t.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},t.Gain}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){!(t.exports={gridHeight:15,gridWidth:8,tileMargin:2,notes:["C","D","E","F","G","A","B","C","D","E","F","G","A","B","C"],pitches:["C3","D3","E3","F3","G3","A3","B3","C4","D4","E4","F4","G4","A4","B4","C5"],activeTime:200,modelUrls:["https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/basic_rnn"],singleColor:!0,playPredictedNotes:!0,stepsPerQuarter:2})},function(t,e,n){(function(t){"use strict";function r(t){return h(this,void 0,void 0,function(){var e,n,r,i,a;return f(this,function(s){switch(s.label){case 0:e=[],n=[];for(r in t){if(i=t[r],"float32"!==i.dtype&&"int32"!==i.dtype&&"bool"!==i.dtype)throw new Error("Unsupported dtype in weight '"+r+"': "+i.dtype);e.push({name:r,shape:i.shape,dtype:i.dtype}),n.push(i.data())}return[4,Promise.all(n)];case 1:return a=s.sent(),[2,{data:o(a),specs:e}]}})})}function i(t,e){for(var n={},r=0,i=(function(e){var i=e.name,o=e.dtype,a=e.shape,s=m.sizeFromShape(a),u=void 0;if("quantization"in e){var l=e.quantization;if("uint8"!==l.dtype&&"uint16"!==l.dtype)throw new Error("Weight "+e.name+" has unknown "+("quantization dtype "+l.dtype+". ")+"Supported quantization dtypes are: 'uint8' and 'uint16'.");var c=y.DTYPE_VALUE_SIZE_MAP[l.dtype],p=t.slice(r,r+s*c),h="uint8"===l.dtype?new Uint8Array(p):new Uint16Array(p);if("float32"===o)u=Float32Array.from(h,function(t){return t*l.scale+l.min});else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=Int32Array.from(h,function(t){return Math.round(t*l.scale+l.min)})}r+=s*c}else{var f=y.DTYPE_VALUE_SIZE_MAP[o],p=t.slice(r,r+s*f);if("float32"===o)u=new Float32Array(p);else if("int32"===o)u=new Int32Array(p);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=new Uint8Array(p)}r+=s*f}var g=void 0;if("float32"===o)g=d.tensor(u,a,"float32");else if("int32"===o)g=d.tensor(u,a,"int32");else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);g=d.tensor(u,a,"bool")}n[i]=g}),o=0,a=e;o<a.length;o++){var s=a[o];i(s)}return n}function o(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),i=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),i),i+=t.byteLength}),r.buffer}function a(e){return g?t.byteLength(e):new Blob([e]).size}function s(e){return g?t.from(e).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function u(e){if(g){var n=t.from(e,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}for(var r=atob(e),i=new Uint8Array(r.length),o=0;o<r.length;++o)i.set([r.charCodeAt(o)],o);return i.buffer}function l(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function c(t){var e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);var n=t.split(e);return n[n.length-1]}function p(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:a(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:a(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var h=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},f=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var d=n(9),m=n(2),y=n(114);e.encodeWeights=r,e.decodeWeights=i,e.concatenateTypedArrays=o;var g="undefined"!=typeof t&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);e.stringByteLength=a,e.arrayBufferToBase64String=s,e.base64StringToArrayBuffer=u,e.concatenateArrayBuffers=l,e.basename=c,e.getModelArtifactsInfoForJSON=p}).call(e,n(149).Buffer)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e){return t.getHandlers(e,"load")},t.getHandlers=function(t,e){var n=[],r="load"===e?this.getInstance().loadRouters:this.getInstance().saveRouters;return r.forEach(function(e){var r=e(t);null!==r&&n.push(r)}),n},t}();e.IORouterRegistry=n},function(t,e){"use strict";function n(t){"string"!=typeof t&&(t="");var e=u.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}function r(t,e){void 0===e&&(e=!1),t=Math.round(t);var n=e===!0?a:s,r=n[t%12],i=Math.floor(t/12)-1;return r+i}Object.defineProperty(e,"__esModule",{value:!0});var i="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),o=function(t){return"string"!=typeof t?i.slice():i.filter(function(e){var n=e[1]||" ";return t.indexOf(n)!==-1})},a=o(" #"),s=o(" b"),u=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/,l=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),c=[0,2,4,5,7,9,11],p=function(t){var e=n(t);if(""===e[0]||""!==e[3])return l;var r=e[0],i=e[1],o=e[2],a={letter:r,acc:i,octStr:o,pc:r+i,name:r+i+o,step:(r.charCodeAt(0)+3)%7,alt:"b"===i[0]?-i.length:i.length,oct:o.length?+o:null,chroma:0,midi:null,freq:null};return a.chroma=(c[a.step]+a.alt+120)%12,a.midi=null!==a.oct?c[a.step]+a.alt+12*(a.oct+1):null,a.freq=v(a.midi),Object.freeze(a)},h=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}},f=h(p),d=function(t){return f(t).name},m=function(t){return f(t).pc},y=function(t){return t>=0&&t<=127},g=function(t){if("number"!=typeof t&&"string"!=typeof t)return null;var e=f(t).midi,n=e||0===e?e:+t;return y(n)?n:null},v=function(t,e){return void 0===e&&(e=440),"number"==typeof t?Math.pow(2,(t-69)/12)*e:null},b=function(t){return f(t).freq||v(t)},_=Math.log(2),w=Math.log(440),S=function(t){var e=12*(Math.log(t)-w)/_+69;return Math.round(100*e)/100},x=function(t){return f(t).chroma},T=function(t){return f(t).oct},P="CDEFGAB",E=function(t){return P[t]},A=function(t,e){return Array(e+1).join(t)},N=function(t,e){return"number"!=typeof t?"":e(t)},O=function(t){return N(t,function(t){return t<0?A("b",-t):A("#",t)})},k=function(t,e){void 0===t&&(t={}),void 0===e&&(e=null);var n=e?Object.assign({},f(e),t):t,r=n.step,i=n.alt,o=n.oct;if("number"!=typeof r)return null;var a=E(r);if(!a)return null;var s=a+O(i);return o||0===o?s+o:s},I=k,C=function(t,e){void 0===e&&(e=!0);var n=f(t),i=n.alt,o=n.chroma,a=n.midi;if(null===o)return null;var s=i,u=e===!1?s<0:s>0;return null===a?m(r(o,u)):r(a,u)},M=function(t){return C(t,!1)};e.names=o,e.tokenize=n,e.props=f,e.name=d,e.pc=m,e.midi=g,e.midiToFreq=v,e.freq=b,e.freqToMidi=S,e.chroma=x,e.oct=T,e.stepToLetter=E,e.altToAcc=O,e.from=k,e.build=I,e.fromMidi=r,e.simplify=C,e.enharmonic=M},function(t,e){(function(e){t.exports=e}).call(e,{})},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e,n){var r,i;r=[n(4),n(18),n(31),n(23)],i=function(t){"use strict";return t.Oscillator=function(){var e=this.optionsObject(arguments,["frequency","type"],t.Oscillator.defaults);t.Source.call(this,e),this._oscillator=null,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._wave=null,this._partials=this.defaultArg(e.partials,[1]),this._phase=e.phase,this._type=null,this.type=e.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},t.extend(t.Oscillator,t.Source),t.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},t.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},t.Oscillator.prototype._start=function(t){this._oscillator=this.context.createOscillator(),this._oscillator.setPeriodicWave(this._wave),this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(this.toSeconds(t))},t.Oscillator.prototype._stop=function(t){return this._oscillator&&(this._oscillator.stop(this.toSeconds(t)),this._oscillator=null),this},t.Oscillator.prototype.syncFrequency=function(){return t.Transport.syncSignal(this.frequency),this},t.Oscillator.prototype.unsyncFrequency=function(){return t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Oscillator.prototype,"type",{get:function(){return this._type},set:function(t){var e=this._getRealImaginary(t,this._phase),n=this.context.createPeriodicWave(e[0],e[1]);this._wave=n,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),this._type=t}}),t.Oscillator.prototype._getRealImaginary=function(e,n){var r=4096,i=r/2,o=new Float32Array(i),a=new Float32Array(i),s=1;if(e===t.Oscillator.Type.Custom)s=this._partials.length+1,i=s;else{var u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);u&&(s=parseInt(u[2])+1,e=u[1],s=Math.max(s,2),i=s)}for(var l=1;l<i;++l){var c,p=2/(l*Math.PI);switch(e){case t.Oscillator.Type.Sine:c=l<=s?1:0;break;case t.Oscillator.Type.Square:c=1&l?2*p:0;break;case t.Oscillator.Type.Sawtooth:c=p*(1&l?1:-1);break;case t.Oscillator.Type.Triangle:c=1&l?2*(p*p)*(l-1>>1&1?-1:1):0;break;case t.Oscillator.Type.Custom:c=this._partials[l-1];break;default:throw new Error("invalid oscillator type: "+e)}0!==c?(o[l]=-c*Math.sin(n*l),a[l]=c*Math.cos(n*l)):(o[l]=0,a[l]=0)}return[o,a]},t.Oscillator.prototype._inverseFFT=function(t,e,n){for(var r=0,i=t.length,o=0;o<i;o++)r+=t[o]*Math.cos(o*n)+e[o]*Math.sin(o*n);return r},t.Oscillator.prototype._getInitialValue=function(){for(var t=this._getRealImaginary(this._type,0),e=t[0],n=t[1],r=0,i=2*Math.PI,o=0;o<8;o++)r=Math.max(this._inverseFFT(e,n,o/8*i),r);return-this._inverseFFT(e,n,this._phase)/r},Object.defineProperty(t.Oscillator.prototype,"partials",{get:function(){return this._type!==t.Oscillator.Type.Custom?[]:this._partials},set:function(e){this._partials=e,this.type=t.Oscillator.Type.Custom}}),Object.defineProperty(t.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(t){this._phase=t*Math.PI/180,this.type=this._type}}),t.Oscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.disconnect(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},t.Oscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e){"use strict";function n(t,n,r){if(void 0===n&&(n="Magenta.js"),void 0===r&&(r=10),0===r)throw Error("Logging level cannot be NONE.");if(e.verbosity>=r){var i=5===r?console.warn:console.log;i("%c "+n+" ","background:magenta; color:white",t)}}function r(t,e,r,i){void 0===r&&(r="Magenta.js"),void 0===i&&(i=10);var o=(performance.now()-e)/1e3;n(t+" in "+o.toPrecision(3)+"s",r,i)}Object.defineProperty(e,"__esModule",{value:!0});var i;!function(t){t[t.NONE=0]="NONE",t[t.WARN=5]="WARN",t[t.INFO=10]="INFO",t[t.DEBUG=20]="DEBUG"}(i=e.Level||(e.Level={})),e.verbosity=10,e.log=n,e.logWithDuration=r},function(t,e,n){"use strict";function r(t){return t&&0===(t&t-1)}function i(t){return _.NoteSequence.decode(_.NoteSequence.encode(t).finish())}function o(t,e){return t*e/60}function a(t,e,n){void 0===n&&(n=S);var r=t*e;return Math.floor(r+(1-n))}function s(t){return t.controlChanges.concat(t.textAnnotations)}function u(t,e){for(var n=0,r=t.notes;n<r.length;n++){var i=r[n];if(i.quantizedStartStep=a(i.startTime,e),i.quantizedEndStep=a(i.endTime,e),i.quantizedEndStep===i.quantizedStartStep&&(i.quantizedEndStep+=1),i.quantizedStartStep<0||i.quantizedEndStep<0)throw new P("Got negative note time: start_step = "+(i.quantizedStartStep+", end_step = ")+(""+i.quantizedEndStep));i.quantizedEndStep>t.totalQuantizedSteps&&(t.totalQuantizedSteps=i.quantizedEndStep)}s(t).forEach(function(t){if(t.quantizedStep=a(t.time,e),t.quantizedStep<0)throw new P("Got negative event time: step = "+t.quantizedStep)})}function l(t){if(t.tempos&&0!==t.tempos.length){if(t.tempos.sort(function(t,e){return t.time-e.time}),0!==t.tempos[0].time&&t.tempos[0].qpm!==w.DEFAULT_QUARTERS_PER_MINUTE)throw new E("NoteSequence has an implicit tempo change from initial "+(w.DEFAULT_QUARTERS_PER_MINUTE+" qpm to ")+(t.tempos[0].qpm+" qpm at "+t.tempos[0].time+" seconds."));for(var e=1;e<t.tempos.length;e++)if(t.tempos[e].qpm!==t.tempos[0].qpm)throw new E("NoteSequence has at least one tempo change from "+(t.tempos[0].qpm+" qpm to "+t.tempos[e].qpm)+("qpm at "+t.tempos[e].time+" seconds."))}}function c(t,e){var n=i(t);if(n.quantizationInfo=_.NoteSequence.QuantizationInfo.create({stepsPerQuarter:e}),n.timeSignatures.length>0){if(n.timeSignatures.sort(function(t,e){return t.time-e.time}),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new x("NoteSequence has an implicit change from initial 4/4 time "+("signature to "+n.timeSignatures[0].numerator+"/")+(n.timeSignatures[0].denominator+" at ")+(n.timeSignatures[0].time+" seconds."));for(var s=1;s<n.timeSignatures.length;s++){var c=n.timeSignatures[s];if(c.numerator!==n.timeSignatures[0].numerator||c.denominator!==n.timeSignatures[0].denominator)throw new x("NoteSequence has at least one time signature change from "+(n.timeSignatures[0].numerator+"/")+(n.timeSignatures[0].denominator+" to ")+(c.numerator+"/"+c.denominator+" ")+("at "+c.time+" seconds"))}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{var c=_.NoteSequence.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(c)}var p=n.timeSignatures[0];if(!r(p.denominator))throw new T("Denominator is not a power of 2. Time signature: "+(p.numerator+"/"+p.denominator));if(0===p.numerator)throw new T("Numerator is 0. Time signature: "+(p.numerator+"/"+p.denominator));if(n.tempos.length>0)l(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{var h=_.NoteSequence.Tempo.create({qpm:w.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(h)}var f=o(e,n.tempos[0].qpm);return n.totalQuantizedSteps=a(t.totalTime,f),u(n,f),n}function p(t){return t.quantizationInfo&&(t.quantizationInfo.stepsPerQuarter>0||t.quantizationInfo.stepsPerSecond>0)}function h(t){if(!p(t))throw new A("NoteSequence "+t.id+" is not quantized (missing quantizationInfo)")}function f(t){return t.quantizationInfo&&t.quantizationInfo.stepsPerQuarter>0}function d(t){if(!f(t))throw new A("NoteSequence "+t.id+" is not quantized or is quantized based on absolute timing")}function m(t){return t.quantizationInfo&&t.quantizationInfo.stepsPerSecond>0}function y(t){if(!m(t))throw new A("NoteSequence "+t.id+" is not quantized or is quantized based on relative timing")}function g(t,e){d(t),l(t);var n=i(t);e?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=e:n.tempos.push(_.NoteSequence.Tempo.create({time:0,qpm:e})):e=t.tempos&&t.tempos.length>0?n.tempos[0].qpm:w.DEFAULT_QUARTERS_PER_MINUTE;var r=function(t){return t/n.quantizationInfo.stepsPerQuarter*(60/e)};return n.totalTime=r(n.totalQuantizedSteps),n.notes.forEach(function(t){t.startTime=r(t.quantizedStartStep),t.endTime=r(t.quantizedEndStep),n.totalTime=Math.max(n.totalTime,t.endTime)}),s(n).forEach(function(t){t.time=r(t.time)}),n}function v(t){var e=i(t),n=e.notes.concat(e.pitchBends).concat(e.controlChanges),r=Array.from(new Set(n.filter(function(t){return!t.isDrum}).map(function(t){return t.program})));return n.forEach(function(t){t.isDrum?(t.program=0,t.instrument=r.length):t.instrument=r.indexOf(t.program)}),e}var b=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var _=n(32),w=n(21),S=.5,x=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return b(e,t),e}(Error);e.MultipleTimeSignatureException=x;var T=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return b(e,t),e}(Error);e.BadTimeSignatureException=T;var P=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return b(e,t),e}(Error);e.NegativeTimeException=P;var E=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return b(e,t),e}(Error);e.MultipleTempoException=E;var A=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return b(e,t),e}(Error);e.QuantizationStatusException=A,e.clone=i,e.stepsPerQuarterToStepsPerSecond=o,e.quantizeToStep=a,e.quantizeNoteSequence=c,e.isQuantizedSequence=p,e.assertIsQuantizedSequence=h,e.isRelativeQuantizedSequence=f,e.assertIsRelativeQuantizedSequence=d,e.isAbsoluteQuantizedSequence=m,e.assertIsAbsoluteQuantizedSequence=y,e.unquantizeSequence=g,e.mergeInstruments=v},function(t,e,n){"use strict";function r(t,e){var n=E.convertToTensor(t,"a","add"),r=E.convertToTensor(e,"b","add");P.assertTypesMatch(n,r);var i=O.assertAndGetBroadcastShape(n.shape,r.shape),o=function(t){var e=function(){var e=t,r=O.getReductionAxes(n.shape,i);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},o=function(){var e=t,n=O.getReductionAxes(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)};return{$a:e,$b:o}};return T.ENV.engine.runKernel(function(t){return t.add(n,r)},{$a:n,$b:r},o)}function i(t){N.assert(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),N.assert(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return E.convertToTensor(t,"tensors"+e,"addN")}),n=e[0];e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!N.arraysEqual(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n},i=e;return T.ENV.engine.runKernel(function(t){return t.addN(e)},i,r)}function o(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in addStrict: "),t.add(e)}function a(t,e){var n=E.convertToTensor(t,"a","sub"),r=E.convertToTensor(e,"b","sub");P.assertTypesMatch(n,r);var i=O.assertAndGetBroadcastShape(n.shape,r.shape),o=function(t){var e=function(){var e=t,r=O.getReductionAxes(n.shape,i);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},o=function(){var e=t,n=O.getReductionAxes(r.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(r.shape)};return{$a:e,$b:o}};return T.ENV.engine.runKernel(function(t){return t.subtract(n,r)},{$a:n,$b:r},o)}function s(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in subStrict: "),t.sub(e)}function u(t,e){var n=E.convertToTensor(t,"base","pow"),r=E.convertToTensor(e,"exp","pow"),i=O.assertAndGetBroadcastShape(n.shape,r.shape);t=n.cast(A.upcastType(n.dtype,r.dtype)),e=r.cast(A.upcastType(n.dtype,r.dtype));var o=function(t,e){var o=e[0],a=function(){var e=r.toFloat(),o=t.mul(e.mul(n.pow(e.sub(I.scalar(1))))),a=O.getReductionAxes(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},s=function(){var e=t.mul(o.mul(n.log()).toFloat()),a=O.getReductionAxes(r.shape,i);return a.length>0&&(e=e.sum(a)),e.reshape(r.shape)};return{$base:a,$exp:s}};return T.ENV.engine.runKernel(function(t,e){return e(t.pow(n,r))},{$base:n,$exp:r},o)}function l(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}function c(t,e){var n=E.convertToTensor(t,"a","mul"),r=E.convertToTensor(e,"b","mul");P.assertTypesMatch(n,r);var i=O.assertAndGetBroadcastShape(n.shape,r.shape),o=function(t){var e=function(){var e=t.mul(r.toFloat()),o=O.getReductionAxes(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},o=function(){var e=t.mul(n.toFloat()),o=O.getReductionAxes(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e};return{$a:e,$b:o}};return T.ENV.engine.runKernel(function(t){return t.multiply(n,r)},{$a:n,$b:r},o)}function p(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in multiplyStrict: "),t.mul(e)}function h(t,n){var r=E.convertToTensor(t,"a","div"),i=E.convertToTensor(n,"b","div");P.assertTypesMatch(r,i);var o;if("int32"===r.dtype&&"int32"===i.dtype)return e.floorDiv(r,i);o=function(t){return t.realDivide(r,i)};var a=O.assertAndGetBroadcastShape(r.shape,i.shape),s=function(t){var e=function(){var e=t.div(i.toFloat()),n=O.getReductionAxes(r.shape,a);return n.length>0?e.sum(n).reshape(r.shape):e},n=function(){var e=t.mul(r.toFloat()),n=O.getReductionAxes(i.shape,a);n.length>0&&(e=e.sum(n).reshape(i.shape));var o=i.square();return e.div(o.toFloat()).neg()};return{$a:e,$b:n}};return T.ENV.engine.runKernel(o,{$a:r,$b:i},s)}function f(t,e){var n=E.convertToTensor(t,"a","floorDiv"),r=E.convertToTensor(e,"b","floorDiv");P.assertTypesMatch(n,r);var i=function(t){return t.floorDiv(n,r)},o=O.assertAndGetBroadcastShape(n.shape,r.shape),a=function(t){var e=function(){var e=t.div(r.toFloat()),i=O.getReductionAxes(n.shape,o);
return i.length>0?e.sum(i).reshape(n.shape):e},i=function(){var e=t.mul(n.toFloat()),i=O.getReductionAxes(r.shape,o);i.length>0&&(e=e.sum(i).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()};return{$a:e,$b:i}};return T.ENV.engine.runKernel(i,{$a:n,$b:r},a)}function d(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in divideStrict: "),t.div(e)}function m(t,e){var n=E.convertToTensor(t,"a","mod"),r=E.convertToTensor(e,"b","mod");P.assertTypesMatch(n,r);var i=O.assertAndGetBroadcastShape(n.shape,r.shape),o=function(t){var e=function(){var e=O.getReductionAxes(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},o=function(){var e=t.mul(n.div(r).floor().neg()),o=O.getReductionAxes(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e};return{$a:e,$b:o}};return T.ENV.engine.runKernel(function(t){return t.mod(n,r)},{$a:n,$b:r},o)}function y(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in modStrict: "),t.mod(e)}function g(t,e){var n=E.convertToTensor(t,"a","minimum"),r=E.convertToTensor(e,"b","minimum");P.assertTypesMatch(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),O.assertAndGetBroadcastShape(n.shape,r.shape);var i=function(t){var e=function(){return t.mul(n.lessEqual(r).toFloat())},i=function(){return t.mul(n.greater(r).toFloat())};return{$a:e,$b:i}};return T.ENV.engine.runKernel(function(t){return t.minimum(n,r)},{$a:n,$b:r},i)}function v(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in minimumStrict: "),t.minimum(e)}function b(t,e){var n=E.convertToTensor(t,"a","maximum"),r=E.convertToTensor(e,"b","maximum");P.assertTypesMatch(n,r),"bool"===n.dtype&&(n=n.toInt()),"bool"===r.dtype&&(r=r.toInt()),O.assertAndGetBroadcastShape(n.shape,r.shape);var i=function(t){var e=function(){return t.mul(n.greaterEqual(r).toFloat())},i=function(){return t.mul(n.less(r).toFloat())};return{$a:e,$b:i}};return T.ENV.engine.runKernel(function(t){return t.maximum(n,r)},{$a:n,$b:r},i)}function _(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in maximumStrict: "),t.maximum(e)}function w(t,e){var n=E.convertToTensor(t,"a","squaredDifference"),r=E.convertToTensor(e,"b","squaredDifference");P.assertTypesMatch(n,r),O.assertAndGetBroadcastShape(n.shape,r.shape);var i=function(t){var e=I.scalar(2),i=function(){return t.mul(n.sub(r).mul(e))},o=function(){return t.mul(r.sub(n).mul(e))};return{$a:i,$b:o}};return T.ENV.engine.runKernel(function(t){return t.squaredDifference(n,r)},{$a:n,$b:r},i)}function S(t,e){return N.assertShapesMatch(t.shape,e.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(e)}function x(t,n){var r=E.convertToTensor(t,"a","atan2"),i=E.convertToTensor(n,"b","atan2");P.assertTypesMatch(r,i);var o=O.assertAndGetBroadcastShape(r.shape,i.shape),a=function(t){var n=function(){var n=e.add(r.square(),i.square()),a=t.mul(i.div(n)),s=O.getReductionAxes(r.shape,o);return s.length>0&&(a=a.sum(s)),a.reshape(r.shape)},a=function(){var n=e.add(r.square(),i.square()),a=C.neg(t.mul(r.div(n))),s=O.getReductionAxes(i.shape,o);return s.length>0&&(a=a.sum(s)),a.reshape(i.shape)};return{$a:n,$b:a}};return T.ENV.engine.runKernel(function(t){return t.atan2(r,i)},{$a:r,$b:i},a)}Object.defineProperty(e,"__esModule",{value:!0});var T=n(3),P=n(49),E=n(6),A=n(60),N=n(2),O=n(25),k=n(5),I=n(9),C=n(85);e.add=k.op({add_:r}),e.addN=k.op({addN_:i}),e.addStrict=k.op({addStrict_:o}),e.atan2=k.op({atan2_:x}),e.div=k.op({div_:h}),e.divStrict=k.op({divStrict_:d}),e.floorDiv=k.op({floorDiv_:f}),e.maximum=k.op({maximum_:b}),e.maximumStrict=k.op({maximumStrict_:_}),e.minimum=k.op({minimum_:g}),e.minimumStrict=k.op({minimumStrict_:v}),e.mod=k.op({mod_:m}),e.modStrict=k.op({modStrict_:y}),e.mul=k.op({mul_:c}),e.mulStrict=k.op({mulStrict_:p}),e.pow=k.op({pow_:u}),e.powStrict=k.op({powStrict_:l}),e.squaredDifference=k.op({squaredDifference_:w}),e.squaredDifferenceStrict=k.op({squaredDifferenceStrict_:S}),e.sub=k.op({sub_:a}),e.subStrict=k.op({subStrict_:s})},function(t,e,n){"use strict";function r(t,e){p.assert(t.dtype===e.dtype,"The dtypes of the first("+t.dtype+") and"+(" second("+e.dtype+") input must match"))}function i(t,e){for(var n=0;n<e.length;n++)if(e[n].id===t.id)return!0;return!1}function o(t,e){var n=[];if(t instanceof c.Tensor)n.push(t);else for(var r=t,i=0;i<e.length;i++)n.push(r[e[i]]);return n}function a(t,e){if(t.length!==e.length)throw new Error("Cannot unflatten Tensor[], keys and arrays are not of same length.");for(var n={},r=0;r<t.length;r++)n[t[r]]=e[r];return n}function s(t){var e=[],n=new Set;return u(t,e,n),e}function u(t,e,n){if(null!=t){if(t instanceof c.Tensor)return void e.push(t);if(l(t)){var r=t;for(var i in r){var o=r[i];n.has(o)||(n.add(o),u(o,e,n))}}}}function l(t){return Array.isArray(t)||"object"==typeof t}Object.defineProperty(e,"__esModule",{value:!0});var c=n(15),p=n(2);e.assertTypesMatch=r,e.isTensorInList=i,e.flattenNameArrayMap=o,e.unflattenToNameArrayMap=a,e.getTensorsInContainer=s},function(t,e,n){"use strict";function r(t){if(null==t)return null;if(t instanceof d)return[t];if(Array.isArray(t)&&t[0]instanceof d)return t;var e=f.toList(t);return e.map(function(t){return new b(t)})}function i(t,e,n,r,i,o,a,s,u,l){var c=new v,p=[new g(e)].concat(_.createCallbacks(n));null!=t&&p.push.apply(p,t),p.push(c);var h=new m(p);return h.setParams({epochs:r,initialEpoch:i,samples:o,steps:a,batchSize:s,verbose:n,doValidation:u,metrics:l}),{callbackList:h,history:c}}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var u,l=n(1),c=n(8),p=n(7),h=n(94),f=n(10);!function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"}(u=e.ModelLoggingVerbosity||(e.ModelLoggingVerbosity={}));var d=function(){function t(){this.validationData=null}return t.prototype.setParams=function(t){this.params=t},t.prototype.onEpochBegin=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.onEpochEnd=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.onBatchBegin=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.onBatchEnd=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.onTrainBegin=function(t){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.onTrainEnd=function(t){return a(this,void 0,void 0,function(){return s(this,function(t){return[2]})})},t.prototype.setModel=function(t){},t}();e.BaseCallback=d;var m=function(){function t(t,e){void 0===e&&(e=10),null==t&&(t=[]),this.callbacks=t,this.queueLength=e}return t.prototype.append=function(t){this.callbacks.push(t)},t.prototype.setParams=function(t){for(var e=0,n=this.callbacks;e<n.length;e++){var r=n[e];r.setParams(t)}},t.prototype.setModel=function(t){for(var e=0,n=this.callbacks;e<n.length;e++){var r=n[e];r.setModel(t)}},t.prototype.onEpochBegin=function(t,e){return a(this,void 0,void 0,function(){var n,r,i;return s(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?(i=r[n],[4,i.onEpochBegin(t,e)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onEpochEnd=function(t,e){return a(this,void 0,void 0,function(){var n,r,i;return s(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?(i=r[n],[4,i.onEpochEnd(t,e)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchBegin=function(t,e){return a(this,void 0,void 0,function(){var n,r,i;return s(this,function(o){switch(o.label){case 0:null==e&&(e={}),n=0,r=this.callbacks,o.label=1;case 1:return n<r.length?(i=r[n],[4,i.onBatchBegin(t,e)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},t.prototype.onBatchEnd=function(t,e){return a(this,void 0,void 0,function(){var n,r,i;return s(this,function(o){switch(o.label){case 0:return null==e&&(e={}),[4,h.resolveScalarsInLogs(e)];case 1:o.sent(),n=0,r=this.callbacks,o.label=2;case 2:return n<r.length?(i=r[n],[4,i.onBatchEnd(t,e)]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2]}})})},t.prototype.onTrainBegin=function(t){return a(this,void 0,void 0,function(){var e,n,r;return s(this,function(i){switch(i.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,i.label=1;case 1:return e<n.length?(r=n[e],[4,r.onTrainBegin(t)]):[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t.prototype.onTrainEnd=function(t){return a(this,void 0,void 0,function(){var e,n,r;return s(this,function(i){switch(i.label){case 0:null==t&&(t={}),e=0,n=this.callbacks,i.label=1;case 1:return e<n.length?(r=n[e],[4,r.onTrainEnd(t)]):[3,4];case 2:i.sent(),i.label=3;case 3:return e++,[3,1];case 4:return[2]}})})},t}();e.CallbackList=m;var y=function(){function t(t){this.yieldEvery=t,this.batchCount=0,this.batchDurationsMillis=[],this.autoYieldEveryBatches=null,this.batchStartMillis=l.util.now()}return t.prototype.resolveOneTensorInLogs=function(t){return a(this,void 0,void 0,function(){var e,n,r,i,o;return s(this,function(a){switch(a.label){case 0:e=[];for(n in t)e.push(n);r=0,a.label=1;case 1:return r<e.length?(i=e[r],o=t[i],"number"==typeof o?[3,3]:[4,o.data()]):[3,4];case 2:return a.sent(),[3,4];case 3:return r++,[3,1];case 4:return[2]}})})},t.prototype.maybeYieldOnBatch=function(e){return a(this,void 0,void 0,function(){var n,r;return s(this,function(i){switch(i.label){case 0:return"auto"!==this.yieldEvery?[3,7]:(this.batchCount++,null!=this.autoYieldEveryBatches?[3,3]:[4,this.resolveOneTensorInLogs(e)]);case 1:return i.sent(),n=l.util.now(),[4,l.nextFrame()];case 2:return i.sent(),this.batchCount>t.SKIP_FIRST_BATCHES&&(this.batchDurationsMillis.push(n-this.batchStartMillis),this.batchDurationsMillis.length>=t.DECISION_BATCH_COUNT&&(r=this.batchDurationsMillis.reduce(function(t,e){return t+e})/this.batchDurationsMillis.length,this.autoYieldEveryBatches=Math.round(t.THRESHOLD_MILLIS/r),this.autoYieldEveryBatches<1&&(this.autoYieldEveryBatches=1))),this.batchStartMillis=l.util.now(),this.lastYieldBatchCount=this.batchCount,[3,6];case 3:return this.batchCount-this.lastYieldBatchCount>=this.autoYieldEveryBatches?[4,l.nextFrame()]:[3,6];case 4:return i.sent(),[4,this.resolveOneTensorInLogs(e)];case 5:i.sent(),this.lastYieldBatchCount=this.batchCount,i.label=6;case 6:return[3,9];case 7:return"batch"!==this.yieldEvery?[3,9]:[4,l.nextFrame()];case 8:i.sent(),i.label=9;case 9:return[2]}})})},t.prototype.maybeYieldOnEpoch=function(){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return"epoch"!==this.yieldEvery?[3,2]:[4,l.nextFrame()];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.SKIP_FIRST_BATCHES=1,t.DECISION_BATCH_COUNT=2,t.THRESHOLD_MILLIS=16,t}();e.ModelTrainingYielder=y;var g=function(t){function e(e){var n=t.call(this)||this;return n.yieldEvery=e||"auto",n}return o(e,t),e.prototype.onTrainBegin=function(t){return a(this,void 0,void 0,function(){return s(this,function(t){return this.autoYielder=new y(this.yieldEvery),[2]})})},e.prototype.onEpochBegin=function(t){return a(this,void 0,void 0,function(){return s(this,function(t){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,e){return a(this,void 0,void 0,function(){var t,n,r,i,o=this;return s(this,function(a){switch(a.label){case 0:return[4,this.autoYielder.maybeYieldOnBatch(e)];case 1:a.sent(),null==e&&(e={}),t=null==e.size?0:e.size,this.seen+=t,n=function(n){var i=e[n];if("number"==typeof i)r.totals.hasOwnProperty(n)||(r.totals[n]=0),r.totals[n]=r.totals[n]+i*t;else{var a=void 0;n in r.totals?a=r.totals[n]:r.totals[n]=c.getScalar(0),r.totals[n]=l.tidy(function(){return l.add(o.totals[n],l.mul(i,c.getScalar(t)))}),null!=a&&a.dispose()}},r=this;for(i in e)n(i);return[2]}})})},e.prototype.onEpochEnd=function(t,e){return a(this,void 0,void 0,function(){var t,n,r,i,o,a=this;return s(this,function(s){switch(s.label){case 0:return[4,this.autoYielder.maybeYieldOnEpoch()];case 1:if(s.sent(),null!=e)for(t=function(t){return null==n.totals[t]?"continue":void("number"==typeof n.totals[t]?e[t]=n.totals[t]/n.seen:l.tidy(function(){e[t]=l.mul(l.div(c.getScalar(1),c.getScalar(a.seen)),a.totals[t]),a.totals[t].dispose(),l.keep(e[t])}))},n=this,r=0,i=this.params.metrics;r<i.length;r++)o=i[r],t(o);return[2]}})})},e}(d);e.BaseLogger=g;var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onTrainBegin=function(t){return a(this,void 0,void 0,function(){return s(this,function(t){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,e){return a(this,void 0,void 0,function(){var n;return s(this,function(r){null==e&&(e={}),this.epoch.push(t);for(n in e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n]);return[2]})})},e.prototype.syncData=function(){return a(this,void 0,void 0,function(){var t,e,n,r,i,o,a,u,l,c;return s(this,function(s){switch(s.label){case 0:t=[],e=[],n=[];for(r in this.history)for(i=this.history[r],o=0;o<i.length;++o)"number"!=typeof i[o]&&(a=i[o],t.push(a.data()),e.push(r),n.push(o));return[4,Promise.all(t)];case 1:for(u=s.sent(),l=0;l<u.length;++l)c=this.history[e[l]][n[l]],c.dispose(),this.history[e[l]][n[l]]=u[l][0];return[2]}})})},e}(d);e.History=v;var b=function(t){function e(e){var n=t.call(this)||this;return n.trainBegin=e.onTrainBegin,n.trainEnd=e.onTrainEnd,n.epochBegin=e.onEpochBegin,n.epochEnd=e.onEpochEnd,n.batchBegin=e.onBatchBegin,n.batchEnd=e.onBatchEnd,n}return o(e,t),e.prototype.onEpochBegin=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return null==this.epochBegin?[3,3]:[4,h.resolveScalarsInLogs(e)];case 1:return n.sent(),[4,this.epochBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return null==this.epochEnd?[3,3]:[4,h.resolveScalarsInLogs(e)];case 1:return n.sent(),[4,this.epochEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchBegin=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return null==this.batchBegin?[3,3]:[4,h.resolveScalarsInLogs(e)];case 1:return n.sent(),[4,this.batchBegin(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,e){return a(this,void 0,void 0,function(){return s(this,function(n){switch(n.label){case 0:return null==this.batchEnd?[3,3]:[4,h.resolveScalarsInLogs(e)];case 1:return n.sent(),[4,this.batchEnd(t,e)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainBegin=function(t){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return null==this.trainBegin?[3,3]:[4,h.resolveScalarsInLogs(t)];case 1:return e.sent(),[4,this.trainBegin(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return a(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return null==this.trainEnd?[3,3]:[4,h.resolveScalarsInLogs(t)];case 1:return e.sent(),[4,this.trainEnd(t)];case 2:e.sent(),e.label=3;case 3:return[2]}})})},e}(d);e.CustomCallback=b,e.standardizeCallbacks=r;var _=function(){function t(){}return t.registerCallbackConstructor=function(e,n){l.util.assert(e>=0&&Number.isInteger(e),"Verbosity level is expected to be an integer >= 0, but got "+e),t.checkForDuplicate(n),null==t.constructors[e]&&(t.constructors[e]=[]),t.constructors[e].push(n)},t.checkForDuplicate=function(e){for(var n in t.constructors){var r=t.constructors[+n];r.forEach(function(t){if(t===e)throw new p.ValueError("Duplicate callback constructor.")})}},t.clear=function(){t.constructors={}},t.createCallbacks=function(e){var n=[];for(var r in t.constructors){var i=+r;e>=i&&n.push.apply(n,t.constructors[i])}return n.map(function(t){return new t})},t.constructors={},t}();e.CallbackConstructorRegistry=_,e.configureCallbacks=i},function(t,e,n){"use strict";function r(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new s.ValueError("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));var n=t.dtype;null==n&&(n="float32");var r=new l({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}),i=r.inboundNodes[0].outputTensors;return i[0]}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(8),s=n(7),u=n(12),l=function(t){function e(e){var n=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:a.getUid("input").toString()})||this;if(null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new s.ValueError("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var r=e.batchInputShape;if(null==r){if(null==e.inputShape)throw new s.ValueError("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new s.ValueError("Cannot specify batchSize if batchInputShape isspecified when creating an InputLayer.");var i=e.dtype||"float32";n.batchInputShape=r,n.dtype=i,n.inputSpec=[{shape:r}];var o=new u.SymbolicTensor(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new u.Node({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]}),n}return i(e,t),e.prototype.apply=function(t,e){throw new s.ValueError("Cannot pass any input to an InputLayer's apply() method. InputLayer name: "+this.name)},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e.className="InputLayer",e}(u.Layer);e.InputLayer=l,o.serialization.registerClass(l),e.Input=r},function(t,e,n){"use strict";function r(t,e){return w.tidy(function(){var n=_.sum(T.square(t),e,!0),r=_.mul(w.scalar(S.epsilon()),_.onesLike(t)),i=_.sqrt(_.maximum(n,r));return _.div(t,i)})}function i(t,e){return w.tidy(function(){return _.mean(T.square(_.sub(e,t)),-1)})}function o(t,e){return w.tidy(function(){return _.mean(_.abs(_.sub(e,t)),-1)})}function a(t,e){return w.tidy(function(){var n=_.sub(t,e),r=_.clipByValue(_.abs(t),S.epsilon(),Number.MAX_VALUE),i=_.abs(_.div(n,r));return _.mul(x.getScalar(100),_.mean(i,-1))})}function s(t,e){return w.tidy(function(){var n=x.getScalar(1),r=_.clipByValue(e,S.epsilon(),Number.MAX_VALUE),i=_.log(_.add(n,r)),o=_.clipByValue(t,S.epsilon(),Number.MAX_VALUE),a=_.log(_.add(n,o));return _.mean(T.square(_.sub(i,a)),-1)})}function u(t,e){return w.tidy(function(){var n=x.getScalar(0),r=x.getScalar(1),i=_.maximum(n,_.sub(r,_.mul(t,e)));return _.mean(T.square(i),-1)})}function l(t,e){return w.tidy(function(){var n=x.getScalar(0),r=x.getScalar(1),i=_.maximum(n,_.sub(r,_.mul(t,e)));return _.mean(i,-1)})}function c(t,e){return w.tidy(function(){var n=x.getScalar(0),r=x.getScalar(1),i=_.sum(_.mul(t,e),-1),o=_.max(_.mul(_.sub(r,t),e),-1);return _.maximum(n,_.add(r,_.sub(o,i)))})}function p(t,e){return w.tidy(function(){var n=x.getScalar(Math.log(2)),r=_.sub(e,t),i=_.sub(_.add(r,_.softplus(_.mul(x.getScalar(-2),r))),n);return _.mean(i,-1)})}function h(t,e,n){return void 0===n&&(n=!1),w.tidy(function(){if(n)e=_.softmax(e);else{var r=_.sum(e,e.shape.length-1,!0);e=_.div(e,r)}return e=_.clipByValue(e,S.epsilon(),1-S.epsilon()),_.neg(_.sum(_.mul(t.toFloat(),_.log(e)),e.shape.length-1))})}function f(t,e,n){return void 0===n&&(n=!1),w.tidy(function(){var r=_.floor(T.flatten(t)).toInt(),i=e.shape,o=_.oneHot(r,i[i.length-1]).reshape(i);return h(o,e,n)})}function d(t,e){return w.tidy(function(){var n=_.maximum(e,_.zerosLike(e)),r=_.mul(e,t),i=_.log(_.add(x.getScalar(1),_.exp(_.neg(_.abs(e))))),o=_.add(_.sub(n,r),i);return o})}function m(t,e){return w.tidy(function(){var n;return n=_.clipByValue(e,S.epsilon(),1-S.epsilon()),n=_.log(_.div(n,_.sub(_.onesLike(n),n))),_.mean(d(t,n),-1)})}function y(t,e){return w.tidy(function(){var n=_.clipByValue(t,S.epsilon(),1),r=_.clipByValue(e,S.epsilon(),1);return _.sum(_.mul(t,_.log(_.div(n,r))),-1)})}function g(t,e){return w.tidy(function(){var n=_.log(_.add(x.getScalar(S.epsilon()),e));return _.mean(_.sub(e,_.mul(t,n)),-1)})}function v(t,e){return w.tidy(function(){var n=r(t,-1),i=r(e,-1),o=_.mul(n,i);return _.neg(_.sum(o,-1))})}function b(t){var e={meanSquaredError:i,meanAbsoluteError:o,meanAbsolutePercentageError:a,meanSquaredLogarithmicError:s,squaredHinge:u,hinge:l,categoricalHinge:c,logcosh:p,categoricalCrossentropy:h,sparseCategoricalCrossentropy:f,binaryCrossentropy:m,kullbackLeiblerDivergence:y,poisson:g,cosineProximity:v};if("string"==typeof t){if(t in e)return e[t];var n="Unknown loss "+t;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n="Unknown loss "+t+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new P.ValueError(n)}return t}Object.defineProperty(e,"__esModule",{value:!0});var _=n(1),w=n(1),S=n(29),x=n(8),T=n(13),P=n(7);e.l2Normalize=r,e.meanSquaredError=i,e.meanAbsoluteError=o,e.meanAbsolutePercentageError=a,e.meanSquaredLogarithmicError=s,e.squaredHinge=u,e.hinge=l,e.categoricalHinge=c,e.logcosh=p,e.categoricalCrossentropy=h,e.sparseCategoricalCrossentropy=f,e.sigmoidCrossEntropyWithLogits=d,e.binaryCrossentropy=m,e.kullbackLeiblerDivergence=y,e.poisson=g,e.cosineProximity=v,e.mse=i,e.MSE=i,e.mae=o,e.MAE=o,e.mape=a,e.MAPE=a,e.msle=s,e.MSLE=s,e.kld=y,e.KLD=y,e.cosine=v,e.get=b},function(t,e,n){var r,i;r=[n(4),n(18)],i=function(t){"use strict";return t.Multiply=function(e){t.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(e,0)},t.extend(t.Multiply,t.Signal),t.Multiply.prototype.dispose=function(){return t.prototype.dispose.call(this),this._mult.disconnect(),this._mult=null,this._param=null,this},t.Multiply}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r;r=function(){return{ml:"rgb(72,133,237,.5)",singleColor:"rgb(244,194,13)",charcoal:"rgb(50,51,52)",lightGrey:"rgb(223,224,225)",lighterGrey:"rgb(244,244,244)",grey:"rgb(204, 204, 204)",darkGrey:"rgb(104, 104, 104)",orange:"#FFC234",lightOrange:"#996e19",blue:"rgb(22, 168, 240)",lightBlue:"rgb(131, 211, 248)",gold:"#FFD700",C:"#BF4FA8","C#":"#8064c6",Db:"#8064c6",D:"#4D61D8","D#":"#ed3883",Eb:"#ed3883",E:"#45B5A1",F:"#95C631","F#":"#f6be37",Gb:"#f6be37",G:"#EDD929","G#":"#95c631",Ab:"#95c631",A:"#F7943D","A#":"#45b5a1",Bb:"#45b5a1",B:"#E33159"}}.call(e,n,e,t),!(void 0!==r&&(t.exports=r))},function(t,e,n){"use strict";function r(t){switch(t.type){case"MelodyConverter":return new y(t.args);case"DrumsConverter":return new f(t.args);case"DrumRollConverter":return new d(t.args);case"TrioConverter":return new g(t.args);case"DrumsOneHotConverter":return new m(t.args);case"MultitrackConverter":return new v(t.args);default:throw new Error("Unknown DataConverter type: "+t)}}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(32),l=n(21),c=n(110),p=n(47);e.DEFAULT_DRUM_PITCH_CLASSES=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],e.converterFromSpec=r;var h=function(){function t(t){this.numSteps=t.numSteps,this.numSegments=t.numSegments}return t.prototype.tensorSteps=function(t){return s.scalar(t.shape[0],"int32")},t}();e.DataConverter=h;var f=function(t){function n(n){var r=t.call(this,n)||this;r.NUM_SPLITS=0,r.SEGMENTED_BY_TRACK=!1,r.pitchClasses=n.pitchClasses||e.DEFAULT_DRUM_PITCH_CLASSES,r.pitchToClass=new Map;for(var i=function(t){o.pitchClasses[t].forEach(function(e){r.pitchToClass.set(e,t)})},o=this,a=0;a<r.pitchClasses.length;++a)i(a);return r.depth=r.pitchClasses.length,r}return i(n,t),n.prototype.toTensor=function(t){var e=this;p.assertIsQuantizedSequence(t);for(var n=this.numSteps||t.totalQuantizedSteps,r=s.buffer([n,this.pitchClasses.length+1]),i=0;i<n;++i)r.set(1,i,-1);return t.notes.forEach(function(t){r.set(1,t.quantizedStartStep,e.pitchToClass.get(t.pitch)),r.set(0,t.quantizedStartStep,-1)}),r.toTensor()},n.prototype.toNoteSequence=function(t,e){return void 0===e&&(e=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,function(){var n,r,i,o,s;return a(this,function(a){switch(a.label){case 0:return n=u.NoteSequence.create(),n.quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:e}),r=t.argMax(1),[4,r.data()];case 1:for(i=a.sent(),r.dispose(),o=0;o<i.length;++o)for(s=0;s<this.pitchClasses.length;s++)i[o]>>s&1&&n.notes.push(u.NoteSequence.Note.create({pitch:this.pitchClasses[s][0],quantizedStartStep:o,quantizedEndStep:o+1,isDrum:!0}));return n.totalQuantizedSteps=i.length,[2,n]}})})},n}(h);e.DrumsConverter=f;var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.toNoteSequence=function(t,e){return void 0===e&&(e=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,function(){var n,r,i,o,s;return a(this,function(a){switch(a.label){case 0:return n=u.NoteSequence.create(),n.quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:e}),[4,t.data()];case 1:for(r=a.sent(),i=0;i<t.shape[0];++i)for(o=r.slice(i*this.depth,(i+1)*this.depth),s=0;s<o.length;++s)o[s]&&n.notes.push(u.NoteSequence.Note.create({pitch:this.pitchClasses[s][0],quantizedStartStep:i,quantizedEndStep:i+1,isDrum:!0}));return n.totalQuantizedSteps=t.shape[0],[2,n]}})})},e}(f);e.DrumRollConverter=d;var m=function(t){function e(e){var n=t.call(this,e)||this;return n.depth=Math.pow(2,n.pitchClasses.length),n}return i(e,t),e.prototype.toTensor=function(t){var e=this;p.assertIsRelativeQuantizedSequence(t);for(var n=this.numSteps||t.totalQuantizedSteps,r=Array(n).fill(0),i=0,o=t.notes;i<o.length;i++){var a=o[i],u=a.pitch,l=a.quantizedStartStep;r[l]+=Math.pow(2,this.pitchToClass.get(u))}return s.tidy(function(){return s.oneHot(s.tensor1d(r,"int32"),e.depth)})},e}(f);e.DrumsOneHotConverter=m;var y=function(t){function e(e){var n=t.call(this,e)||this;return n.NUM_SPLITS=0,n.SEGMENTED_BY_TRACK=!1,n.NOTE_OFF=1,n.FIRST_PITCH=2,n.minPitch=e.minPitch,n.maxPitch=e.maxPitch,n.ignorePolyphony=void 0===e.ignorePolyphony||e.ignorePolyphony,n.depth=e.maxPitch-e.minPitch+1+n.FIRST_PITCH,n}return i(e,t),e.prototype.toTensor=function(t){var e=this;p.assertIsQuantizedSequence(t);var n=this.numSteps||t.totalQuantizedSteps,r=t.notes.sort(function(t,e){return t.quantizedStartStep===e.quantizedStartStep?e.pitch-t.pitch:t.quantizedStartStep-e.quantizedStartStep}),i=s.buffer([n],"int32"),o=-1;return r.forEach(function(t){if(t.quantizedStartStep===o){if(e.ignorePolyphony)return;throw new Error("`NoteSequence` is not monophonic.")}if(t.pitch<e.minPitch||t.pitch>e.maxPitch)throw Error("`NoteSequence` has a pitch outside of the valid range: "+t.pitch);i.set(t.pitch-e.minPitch+e.FIRST_PITCH,t.quantizedStartStep),i.set(e.NOTE_OFF,t.quantizedEndStep),o=t.quantizedStartStep}),s.tidy(function(){return s.oneHot(i.toTensor(),e.depth)})},e.prototype.toNoteSequence=function(t,e){return void 0===e&&(e=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,function(){var n,r,i,o,s,l;return a(this,function(a){switch(a.label){case 0:return n=u.NoteSequence.create(),n.quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:e}),r=t.argMax(1),[4,r.data()];case 1:for(i=a.sent(),r.dispose(),o=null,s=0;s<i.length;++s)switch(l=i[s]){case 0:break;case 1:o&&(o.quantizedEndStep=s,n.notes.push(o),o=null);break;default:o&&(o.quantizedEndStep=s,n.notes.push(o)),o=u.NoteSequence.Note.create({pitch:l-this.FIRST_PITCH+this.minPitch,quantizedStartStep:s})}return o&&(o.quantizedEndStep=i.length,
n.notes.push(o)),n.totalQuantizedSteps=i.length,[2,n]}})})},e}(h);e.MelodyConverter=y;var g=function(t){function e(e){var n=t.call(this,e)||this;return n.NUM_SPLITS=3,n.SEGMENTED_BY_TRACK=!1,n.MEL_PROG_RANGE=[0,31],n.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,n.melConverter=new y(e.melArgs),n.bassConverter=new y(e.bassArgs),n.drumsConverter=new m(e.drumsArgs),n.depth=n.melConverter.depth+n.bassConverter.depth+n.drumsConverter.depth,n}return i(e,t),e.prototype.toTensor=function(t){var e=this;p.assertIsQuantizedSequence(t);var n=p.clone(t),r=p.clone(t),i=p.clone(t);return n.notes=t.notes.filter(function(t){return!t.isDrum&&t.program>=e.MEL_PROG_RANGE[0]&&t.program<=e.MEL_PROG_RANGE[1]}),r.notes=t.notes.filter(function(t){return!t.isDrum&&t.program>=e.BASS_PROG_RANGE[0]&&t.program<=e.BASS_PROG_RANGE[1]}),i.notes=t.notes.filter(function(t){return t.isDrum}),s.tidy(function(){return s.concat([e.melConverter.toTensor(n),e.bassConverter.toTensor(r),e.drumsConverter.toTensor(i)],-1)})},e.prototype.toNoteSequence=function(t,e){return void 0===e&&(e=l.DEFAULT_QUARTERS_PER_MINUTE),o(this,void 0,void 0,function(){var n,r,i,o,u,l,c=this;return a(this,function(a){switch(a.label){case 0:return i=s.split(t,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),[4,this.melConverter.toNoteSequence(i[0],e)];case 1:return o=a.sent(),o.notes.forEach(function(t){t.instrument=0,t.program=0}),[4,this.bassConverter.toNoteSequence(i[1])];case 2:return u=a.sent(),(n=o.notes).push.apply(n,u.notes.map(function(t){return t.instrument=1,t.program=c.BASS_PROG_RANGE[0],t})),[4,this.drumsConverter.toNoteSequence(i[2])];case 3:return l=a.sent(),(r=o.notes).push.apply(r,l.notes.map(function(t){return t.instrument=2,t})),i.forEach(function(t){return t.dispose()}),[2,o]}})})},e}(h);e.TrioConverter=g;var v=function(t){function e(e){var n=t.call(this,e)||this;return n.NUM_SPLITS=0,n.SEGMENTED_BY_TRACK=!0,n.stepsPerQuarter=e.stepsPerQuarter,n.totalSteps=e.totalSteps,n.numVelocityBins=e.numVelocityBins,n.minPitch=e.minPitch?e.minPitch:l.MIN_MIDI_PITCH,n.maxPitch=e.maxPitch?e.maxPitch:l.MAX_MIDI_PITCH,n.numPitches=n.maxPitch-n.minPitch+1,n.performanceEventDepth=2*n.numPitches+n.totalSteps+n.numVelocityBins,n.numPrograms=l.MAX_MIDI_PROGRAM-l.MIN_MIDI_PROGRAM+2,n.endToken=n.performanceEventDepth+n.numPrograms,n.depth=n.endToken+1,n.endTensor=s.tidy(function(){return s.oneHot(s.tensor1d([n.endToken],"int32"),n.depth).as1D()}),n}return i(e,t),e.prototype.trackToTensor=function(t){var e=this,n=this.numSteps/this.numSegments,r=void 0;if(t){for(;t.events.length>n-2;)t.events.pop();r=s.buffer([t.events.length+2],"int32"),r.set(this.performanceEventDepth+(t.isDrum?this.numPrograms-1:t.program),0),t.events.forEach(function(t,n){switch(t.type){case"note-on":r.set(t.pitch-e.minPitch,n+1);break;case"note-off":r.set(e.numPitches+t.pitch-e.minPitch,n+1);break;case"time-shift":r.set(2*e.numPitches+t.steps-1,n+1);break;case"velocity-change":r.set(2*e.numPitches+e.totalSteps+t.velocityBin-1,n+1);break;default:throw new Error("Unrecognized performance event: "+t)}}),r.set(this.endToken,t.events.length+1)}else r=s.buffer([1],"int32",new Int32Array([this.endToken]));return s.tidy(function(){var t=s.oneHot(r.toTensor(),e.depth);return t.pad([[0,n-t.shape[0]],[0,0]])})},e.prototype.toTensor=function(t){var e=this;if(p.assertIsRelativeQuantizedSequence(t),t.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: "+t.quantizationInfo.stepsPerQuarter+" != "+this.stepsPerQuarter);var n=p.clone(t);n.notes=t.notes.filter(function(t){return t.pitch>=e.minPitch&&t.pitch<=e.maxPitch});for(var r=new Set(n.notes.map(function(t){return t.instrument})),i=Array.from(r).map(function(t){return c.Performance.fromNoteSequence(n,e.totalSteps,e.numVelocityBins,t)}),o=i.sort(function(t,e){return e.isDrum?-1:t.isDrum?1:t.program-e.program});o.length>this.numSegments;)o.pop();for(o.forEach(function(t){return t.setNumSteps(e.totalSteps)});o.length<this.numSegments;)o.push(void 0);return s.tidy(function(){return s.concat(o.map(function(t){return e.trackToTensor(t)}),0)})},e.prototype.tokensToTrack=function(t){var e=this,n=t.indexOf(this.endToken),r=n>=0?n:t.length,i=t.slice(0,r),o=i.filter(function(t){return t<e.performanceEventDepth}),a=i.filter(function(t){return t>=e.performanceEventDepth}),s=a.length?a[0]-this.performanceEventDepth<this.numPrograms-1?[a[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=s[0],l=s[1],p=Array.from(o).map(function(t){if(t<e.numPitches)return{type:"note-on",pitch:e.minPitch+t};if(t<2*e.numPitches)return{type:"note-off",pitch:e.minPitch+t-e.numPitches};if(t<2*e.numPitches+e.totalSteps)return{type:"time-shift",steps:t-2*e.numPitches+1};if(t<2*e.numPitches+e.totalSteps+e.numVelocityBins)return{type:"velocity-change",velocityBin:t-2*e.numPitches-e.totalSteps+1};throw new Error("Invalid performance event token: "+t)});return new c.Performance(p,this.totalSteps,this.numVelocityBins,u,l)},e.prototype.toNoteSequence=function(t,e){return void 0===e&&(e=this.stepsPerQuarter),o(this,void 0,void 0,function(){var n,r,i,l=this;return a(this,function(c){switch(c.label){case 0:return n=u.NoteSequence.create(),n.quantizationInfo=u.NoteSequence.QuantizationInfo.create({stepsPerQuarter:e}),n.totalQuantizedSteps=this.totalSteps,r=s.tidy(function(){return s.split(t.argMax(1),l.numSegments)}),[4,Promise.all(r.map(function(t){return o(l,void 0,void 0,function(){var e,n;return a(this,function(r){switch(r.label){case 0:return[4,t.data()];case 1:return e=r.sent(),n=this.tokensToTrack(e),t.dispose(),[2,n]}})})}))];case 1:return i=c.sent(),i.forEach(function(t,e){var r;t.setNumSteps(l.totalSteps),(r=n.notes).push.apply(r,t.toNoteSequence(e).notes)}),[2,n]}})})},e}(h);e.MultitrackConverter=v},function(t,e,n){"use strict";function r(t,e){return[e,t]}function i(t,e){return t*e}function o(t,e){return[4*e,t]}function a(t,e){if(t%e!==0)throw new Error("unpackedSize ("+t+") must be a multiple of "+e);return t/e}function s(t,e,n){var r=i(t.length,n);if(e.length<r)throw new Error("unpackedArray length ("+e.length+") must be >= "+r);for(var o=0,a=0;a<t.length;++a)e[o]=t[a],o+=n}function u(t,e,n){var r=a(t.length,n);if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<t.length;o+=n)e[i++]=t[o]}function l(t,e,n){var r=t.length*n/4;if(e.length<r)throw new Error("matrix length ("+e.length+") must be >= "+r);for(var i=0,o=0;o<t.length;o+=4)for(var a=0;a<n;a++)e[i++]=t[o+a]}function c(t,e){return[Math.ceil(e/2),Math.ceil(t/2)]}function p(t,e){var n=c(t,e),r=n[0],i=n[1];return r*i*4}function h(t,e,n,r,i){var o=p(n,r);if(i.length<o)throw new Error("packedRGBA length ("+i.length+") must be >=\n        "+o);for(var a=r%2===1,s=n%2===1,u=Math.floor(r/2),l=Math.floor(n/2),c=Math.ceil(r/2),h=c*Math.ceil(n/2),f=m.nearestLargerEven(n)*m.nearestLargerEven(r),d=0;d<e;d++){for(var y=d*n*r,g=d*f,v=a?4:0,b=r,_=g,w=0;w<l;++w){for(var S=2*w*r,x=0;x<u;++x){var T=2*x,P=y+S+T;i[_]=t[P],i[_+1]=t[P+1],i[_+2]=t[P+b],i[_+3]=t[P+b+1],_+=4}_+=v}if(a)for(var P=y+r-1,_=g+4*(c-1),E=2*r,v=4*c,w=0;w<l;++w)i[_]=t[P],i[_+2]=t[P+r],P+=E,_+=v;if(s){for(var P=y+(n-1)*r,_=g+4*(h-c),x=0;x<u;++x)i[_++]=t[P++],i[_++]=t[P++],_+=2;a&&s&&(i[g+f-4]=t[P])}}return i}function f(t,e,n,r,i){var o=n*r;if(i.length<o)throw new Error("matrix length ("+i.length+") must be >= "+o);for(var a=r%2===1,s=n%2===1,u=Math.floor(r/2),l=Math.floor(n/2),c=Math.ceil(r/2),p=c*Math.ceil(n/2),h=m.nearestLargerEven(n)*m.nearestLargerEven(r),f=0;f<e;f++){for(var d=f*n*r,y=f*h,g=a?4:0,v=r+(a?1:0),b=y,_=d,w=d+r,S=0;S<l;++S){for(var x=0;x<u;++x)i[_++]=t[b++],i[_++]=t[b++],i[w++]=t[b++],i[w++]=t[b++];b+=g,_+=v,w+=v}if(a)for(var b=y+4*(c-1),T=d+r-1,g=4*c,v=2*r,S=0;S<l;++S)i[T]=t[b],i[T+r]=t[b+2],b+=g,T+=v;if(s){for(var b=y+4*(p-c),T=d+(n-1)*r,x=0;x<u;++x)i[T++]=t[b++],i[T++]=t[b++],b+=2;a&&(i[d+n*r-1]=t[b])}}return i}Object.defineProperty(e,"__esModule",{value:!0});var d,m=n(2);!function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(d=e.TextureUsage||(e.TextureUsage={}));var y;!function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(y=e.PhysicalTextureType||(e.PhysicalTextureType={})),e.getUnpackedMatrixTextureShapeWidthHeight=r,e.getUnpackedArraySizeFromMatrixSize=i,e.getColorMatrixTextureShapeWidthHeight=o,e.getMatrixSizeFromUnpackedArraySize=a,e.encodeMatrixToUnpackedArray=s,e.decodeMatrixFromUnpackedArray=u,e.decodeMatrixFromUnpackedColorRGBAArray=l,e.getPackedMatrixTextureShapeWidthHeight=c,e.getPackedRGBAArraySizeFromMatrixShape=p,e.encodeMatrixToPackedRGBA=h,e.decodeMatrixFromPackedRGBA=f},function(t,e,n){"use strict";function r(t,e){var n=e();return o(t),n}function i(t){z=t}function o(t){if(z){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+a(t,e))}}function a(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function s(t,e){return I(t,function(){return t.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function u(t,e){var n=I(t,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(r(t,function(){return t.shaderSource(n,e)}),r(t,function(){return t.compileShader(n)}),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function l(t,e){var n=I(t,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(r(t,function(){return t.shaderSource(n,e)}),r(t,function(){return t.compileShader(n)}),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw c(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}function c(t,e){var n=q.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],i=t.split("\n"),o=i.length.toString().length+2,a=i.map(function(t,e){return F.rightPad((e+1).toString(),o)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var l=a.slice(0,r-1),c=a.slice(r-1,r),p=a.slice(r);console.log(l.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+F.rightPad(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function p(t){return I(t,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function h(t,e){if(r(t,function(){return t.linkProgram(e)}),t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function f(t,e){if(r(t,function(){return t.validateProgram(e)}),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function d(t,e){var n=I(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return r(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)}),r(t,function(){return t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function m(t,e){var n=I(t,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return r(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)}),r(t,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)}),n}function y(){return 2===L.ENV.get("WEBGL_VERSION")?1:4}function g(t){return I(t,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function v(t,e){var n=L.ENV.get("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n){var r="["+t+"x"+e+"]",i="["+n+"x"+n+"]";throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+i+".")}}function b(t){return I(t,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function _(t,e,n,i,o,a,s){var u=t.getAttribLocation(e,n);return u!==-1&&(r(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,i)}),r(t,function(){return t.vertexAttribPointer(u,o,t.FLOAT,!1,a,s)}),r(t,function(){return t.enableVertexAttribArray(u)}),!0)}function w(t,e,n){C(t,n),r(t,function(){return t.activeTexture(t.TEXTURE0+n)}),r(t,function(){return t.bindTexture(t.TEXTURE_2D,e)})}function S(t,e){C(t,e),r(t,function(){return t.activeTexture(t.TEXTURE0+e)}),r(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function x(t,e,n){return I(t,function(){return t.getUniformLocation(e,n)},'uniform "'+n+'" not present in program.')}function T(t,e,n){return t.getUniformLocation(e,n)}function P(t,e,n,i,o){r(t,function(){return w(t,n,o)}),r(t,function(){return t.uniform1i(i,o)})}function E(t){r(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),r(t,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),r(t,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})}function A(t,e,n){r(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),r(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)})}function N(t,e){r(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,e)}),r(t,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function O(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+k(t,e))}function k(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function I(t,e,n){var i=r(t,function(){return e()});if(null==i)throw new Error(n);return i}function C(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n){var i="[gl.TEXTURE0, gl.TEXTURE"+n+"]";throw new Error("textureUnit must be in "+i+".")}}function M(t,e){void 0===e&&(e=!1);var n=L.ENV.get("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,t=t.map(function(e,n){return n>=t.length-2?F.nearestLargerEven(t[n]):t[n]})),2!==t.length){var r=F.squeezeShape(t);t=r.newShape}var i=F.sizeFromShape(t);return t.length<=1&&i<=n?[i,1]:2===t.length&&t[0]<=n&&t[1]<=n?t:3===t.length&&t[0]*t[1]<=n&&t[2]<=n?[t[0]*t[1],t[2]]:3===t.length&&t[0]<=n&&t[1]*t[2]<=n?[t[0],t[1]*t[2]]:4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n?[t[0]*t[1]*t[2],t[3]]:4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n?[t[0],t[1]*t[2]*t[3]]:F.sizeToSquarishShape(i)}function R(t){return t%2===0}function D(t,e){if(t=t.slice(-2),e=e.slice(-2),F.arraysEqual(t,e))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){if(F.arraysEqual(F.squeezeShape(t).newShape,F.squeezeShape(e).newShape))return!0}else if(R(t[0])&&R(e[0])){if(R(t[1])&&R(e[1]))return!0;if(t[1]===e[1])return!0}return!1}Object.defineProperty(e,"__esModule",{value:!0});var L=n(3),F=n(2);e.callAndCheck=r;var z=!1;e.enableDebugWebGLErrorChecking=i,e.checkWebGLError=o,e.getWebGLErrorMessage=a,e.getExtensionOrThrow=s,e.createVertexShader=u,e.createFragmentShader=l;var q=/ERROR: [0-9]+:([0-9]+):/g;e.createProgram=p,e.linkProgram=h,e.validateProgram=f,e.createStaticVertexBuffer=d,e.createStaticIndexBuffer=m,e.getNumChannels=y,e.createTexture=g,e.validateTextureSize=v,e.createFramebuffer=b,e.bindVertexBufferToProgramAttribute=_,e.bindTextureUnit=w,e.unbindTextureUnit=S,e.getProgramUniformLocationOrThrow=x,e.getProgramUniformLocation=T,e.bindTextureToProgramUniformSampler=P,e.bindCanvasToFramebuffer=E,e.bindColorTextureToFramebuffer=A,e.unbindColorTextureFromFramebuffer=N,e.validateFramebuffer=O,e.getFramebufferErrorMessage=k,e.getTextureShapeFromLogicalShape=M,e.isReshapeFree=D},function(t,e,n){"use strict";function r(t,e){var n=t[0].length;t.forEach(function(t,e){o.assert(t.length===n,"Error in concat"+n+"D: rank of tensors["+e+"] must be the same "+("as the rank of the rest ("+n+")"))}),o.assert(e>=0&&e<n,"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+".");var r=t[0];t.forEach(function(t,i){for(var a=0;a<n;a++)o.assert(a===e||t[a]===r[a],"Error in concat"+n+"D: Shape of tensors["+i+"] ("+t+") "+("does not match the shape of the rest ("+r+") ")+("along the non-concatenated axis "+i+"."))})}function i(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2);e.assertParamsConsistent=r,e.computeOutShape=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return r(e,t),e.prototype.applyGradients=function(t){var e=this,n=Object.keys(t);n.forEach(function(n){var r=t[n],a=i.ENV.engine.registeredVariables[n];o.tidy(function(){var t=e.c.mul(r).add(a);a.assign(t)})})},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=o.keep(a.scalar(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGDOptimizer",e}(u.Optimizer);e.SGDOptimizer=l,s.registerClass(l)},function(t,e){"use strict";function n(t,e){return c[t][e]}function r(t){return n(t,"int32")}Object.defineProperty(e,"__esModule",{value:!0});var i;!function(t){t.float32="float32",t.int32="int32",t.bool="bool"}(i=e.DType||(e.DType={}));var o;!function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(o=e.Rank||(e.Rank={}));var a;!function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(a||(a={}));var s;!function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(s||(s={}));var u;!function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(u||(u={}));var l;!function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(l||(l={}));var c={float32:u,int32:a,bool:s,complex64:l};e.upcastType=n,e.sumOutType=r},function(t,e,n){"use strict";function r(t){return t.getClassName()}function i(t,e){return void 0===e&&(e={}),p.deserializeKerasObject(t,u.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function o(t){if(null==t){var e={className:"linear",config:{}};return i(e)}if("string"==typeof t){var e={className:t,config:{}};return i(e)}return t instanceof h?t:i(t)}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(1),l=n(13),c=n(8),p=n(10),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.getConfig=function(){return{}},e}(u.serialization.Serializable);e.Activation=h;var f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=1),l.elu(t,e)},e.className="elu",e}(h);e.Elu=f,u.serialization.registerClass(f);var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return s.selu(t)},e.className="selu",e}(h);e.Selu=d,u.serialization.registerClass(d);var m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return s.relu(t)},e.className="relu",e}(h);e.Relu=m,u.serialization.registerClass(m);var y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return u.tidy(function(){return s.minimum(c.getScalar(6),s.relu(t))})},e.className="relu6",e}(h);e.Relu6=y,u.serialization.registerClass(y);var g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return t},e.className="linear",e}(h);e.Linear=g,u.serialization.registerClass(g);var v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return s.sigmoid(t)},e.className="sigmoid",e}(h);e.Sigmoid=v,u.serialization.registerClass(v);var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return l.hardSigmoid(t)},e.className="hardSigmoid",e}(h);e.HardSigmoid=b,u.serialization.registerClass(b);var _=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return s.softplus(t)},e.className="softplus",e}(h);e.Softplus=_,u.serialization.registerClass(_);var w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return l.softsign(t)},e.className="softsign",e}(h);e.Softsign=w,u.serialization.registerClass(w);var S=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t){return s.tanh(t)},e.className="tanh",e}(h);e.Tanh=S,u.serialization.registerClass(S);var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){return void 0===e&&(e=-1),s.softmax(t,e)},e.className="softmax",e}(h);e.Softmax=x,u.serialization.registerClass(x),e.serializeActivation=r,e.deserializeActivation=i,e.getActivation=o},function(t,e,n){"use strict";function r(t){return t instanceof m.Tensor}function i(t){return Array.isArray(t)}function o(t){return!r(t)&&!i(t)}function a(t,e,n,r,a){if(void 0===r&&(r=!0),void 0===a&&(a=""),null==e||0===e.length){if(null!=t){var s=!1;if(i(t)&&t.length>0)s=!0;else if(o(t)){for(var u in t)if(t.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new b.ValueError("Error when checking model "+a+" expected no data, but got "+t)}return[]}if(null==t)return e.map(function(t){return null});var l;if(o(t)){t=t,l=[];for(var c=0,p=e;c<p.length;c++){var h=p[c];if(null==t[h])throw new b.ValueError('No data provided for "'+h+'". Need data for each key in: '+e);l.push(t[h])}}else if(i(t)){if(t=t,t.length!==e.length)throw new b.ValueError("Error when checking model "+a+": the Array of Tensors that you are passing to your model is not the size the "+("model expected. Expected to see "+e.length+" Tensor(s), but ")+("instead got the following list of Tensor(s): "+t));l=t}else{if(t=t,e.length>1)throw new b.ValueError("The model "+a+" expects "+e.length+" Tensor(s), but only received one Tensor. Found: Tensor with shape "+t.shape);l=[t]}if(l=O.ensureTensorsRank2OrHigher(l),null!=n)for(var f=0;f<e.length;++f)if(null!=n[f]){var d=l[f];if(d.shape.length!==n[f].length)throw new b.ValueError("Error when checking "+a+": expected "+e[f]+" "+("to have "+n[f].length+" dimension(s). but got array with ")+("shape "+d.shape));for(var m=0;m<n[f].length;++m)if(0!==m||r){var y=d.shape[m],g=n[f][m];if(null!=g&&g>=0&&y!==g)throw new b.ValueError("Error when checking "+a+": expected "+e[f]+" "+("to have shape ["+n[f]+"], but got array with shape ")+("["+d.shape+"]."))}}return l}function s(t,e,n){var r=x.unique(t.map(function(t){return t.shape[0]}));r.sort();var i=x.unique(e.map(function(t){return t.shape[0]}));if(i.sort(),r.length>1)throw new b.ValueError("All input Tensors (x) should have the same number of samples. Got array shapes: "+JSON.stringify(t.map(function(t){return t.shape})));if(i.length>1)throw new b.ValueError("All target Tensors (y) should have the same number of samples. Got array shapes: "+JSON.stringify(e.map(function(t){return t.shape})));if(r.length>0&&i.length>0&&!m.util.arraysEqual(r,i))throw new b.ValueError("Input Tensors should have the same number of samples as target "+("Tensors. Found "+r[0]+" input sample(s) and "+i[0]+" target ")+"sample(s).")}function u(t,e,n){for(var r=[_.meanSquaredError,_.binaryCrossentropy,_.categoricalCrossentropy],i=0;i<t.length;++i){var o=t[i],a=e[i],s=n[i];if(null!=a){if(a===_.categoricalCrossentropy&&1===o.shape[o.shape.length-1])throw new b.ValueError("You are passing a target array of shape "+o.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(r.indexOf(a)!==-1)for(var u=o.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var p=u[c],h=l[c];if(null!=h&&p!==h)throw new b.ValueError("A target Tensor with shape "+o.shape+" was passed for an "+("output of shape "+s+", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function l(t,e,n,r,i){void 0===r&&(r=!0),void 0===i&&(i="");var o;if(Array.isArray(t)){if(t.length!==e.length)throw new b.ValueError("Error when checking model "+i+": the Array of Tensors that you are passing to your model is not the size the "+("the model expected. Expected to see "+e.length+" Tensor(s),")+(" but instead got "+t.length+" Tensors(s)."));o=t}else{if(e.length>1)throw new b.ValueError("The model expects "+e.length+" "+i+" Tensors, but only received one Tensor. Found: array with shape "+(JSON.stringify(t.shape)+"."));o=[t]}if(null!=n)for(var a=0;a<e.length;++a)if(null!=n[a]){var s=o[a];if(s.shape.length!==n[a].length)throw new b.ValueError("Error when checking "+i+": expected "+e[a]+" "+("to have "+n[a].length+" dimension(s), but got array with ")+("shape "+JSON.stringify(s.shape)));for(var u=0;u<n[a].length;++u)if(0!==u||r){var l=s.shape[u],c=n[a][u];if(null!=c&&c!==l)throw new b.ValueError("Error when checking "+i+": expected "+(e[a]+" to have shape "+JSON.stringify(n[a])+" but ")+("got array with shape "+JSON.stringify(s.shape)+"."))}}}function c(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map(function(t){return[]});if(Array.isArray(t))return e.map(function(e){return t});if(null!=t){for(var n=[],r=0,i=e;r<i.length;r++){var o=i[r],a=t.hasOwnProperty(o)?t[o]:[];Array.isArray(a)||(a=[a]),n.push(a)}return n}throw new TypeError("Type of metrics argument not understood. Expected an Array or Object, found: "+t)}var p=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),h=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},f=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var d=n(1),m=n(1),y=n(8),g=n(13),v=n(27),b=n(7),_=n(52),w=n(144),S=n(342),x=n(10),T=n(343),P=n(28),E=n(323),A=n(324),N=n(325),O=n(326);e.isDataTensor=r,e.isDataArray=i,e.isDataDict=o,e.standardizeInputData=a,e.checkArrayLengths=s;var k=function(t){function e(e){var n=t.call(this,e)||this;return n.isTraining=!1,n}return p(e,t),e.prototype.summary=function(t,e,n){if(void 0===n&&(n=console.log),!this.built)throw new b.ValueError("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");T.printSummary(this,t,e,n)},e.prototype.compile=function(t){var e=this;if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"==typeof t.optimizer)this.optimizer=S.getOptimizer(t.optimizer);else{if(!(t.optimizer instanceof m.Optimizer))throw new b.ValueError("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer=t.optimizer}var n=[];if(Array.isArray(t.loss)||"string"==typeof t.loss||"function"==typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new b.ValueError("When passing an Array as loss, it should have one entry per "+("model output. The model has "+this.outputs.length+" output(s), ")+("but you passed loss="+t.loss+"."));var r=t.loss;n=r.map(function(t){return _.get(t)})}else{var i=_.get(t.loss);this.outputs.map(function(t){n.push(i)})}else{t.loss=t.loss;for(var o in t.loss)if(this.outputNames.indexOf(o)===-1)throw new b.ValueError('Unknown entry in loss dictionary: "'+o+'". Only expect the following keys: '+this.outputNames);for(var a in this.outputNames)null==t.loss[a]&&console.warn('Output "'+a+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data '+("to be passed to "+a+" during training")),n.push(_.get(t.loss[a]))}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var s=0;s<this.outputs.length;++s){var u=this.internalOutputShapes[s],l=this.outputNames[s];this.feedOutputNames.push(l),this.feedOutputShapes.push(u),this.feedLossFns.push(this.lossFunctions[s])}var p=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],v.nameScope("loss",function(){for(var t=0;t<e.outputs.length;++t)if(p.indexOf(t)===-1){var n=e.lossFunctions[t];e.outputs.length>1&&(e.metricsTensors.push([n,t]),e.metricsNames.push(e.outputNames[t]+"_loss"))}});var h=c(t.metrics,this.outputNames),f=function(t,n,r){e.outputNames.length>1&&(n=e.outputNames[t]+"_"+n),e.metricsNames.push(n),e.metricsTensors.push([r,t])};v.nameScope("metric",function(){for(var t=function(t){if(p.indexOf(t)!==-1)return"continue";var n=h[t],r=function(n){for(var r,i,o,a="",s=function(n){if(["accuracy","acc","crossentropy","ce"].indexOf(n)!==-1){var s=e.internalOutputShapes[t];1===s[s.length-1]||e.lossFunctions[t]===_.binaryCrossentropy?["accuracy","acc"].indexOf(n)!==-1?i=w.binaryAccuracy:["crossentropy","ce"].indexOf(n)!==-1&&(i=w.binaryCrossentropy):e.lossFunctions[t]===_.sparseCategoricalCrossentropy?["accuracy","acc"].indexOf(n)!==-1?i=w.sparseCategoricalAccuracy:["crossentropy","ce"].indexOf(n)!==-1&&(i=w.sparseCategoricalCrossentropy):["accuracy","acc"].indexOf(n)!==-1?i=w.categoricalAccuracy:["crossentropy","ce"].indexOf(n)!==-1&&(i=w.categoricalCrossentropy);
var u=void 0;["accuracy","acc"].indexOf(n)!==-1?u="acc":["crossentropy","ce"].indexOf(n)!==-1&&(u="ce"),o=i,r=a+u}else{var l=w.get(n);o=l,r=a+n}var c;v.nameScope(r,function(){c=o}),f(t,r,c)},u=0,l=n;u<l.length;u++){var c=l[u];s(c)}};r(n)},n=0;n<e.outputs.length;++n)t(n)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,e,n){void 0===n&&(n={});var r=null==n.batchSize?32:n.batchSize;O.checkBatchSize(r);var i=this.standardizeUserData(t,e,!0,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var a=this.testFunction,s=this.testLoop(a,o,r,n.verbose,n.steps);return x.singletonOrArray(s)}finally{O.disposeNewTensors(i[0],t),O.disposeNewTensors(i[1],e)}},e.prototype.evaluateDataset=function(t,e){return h(this,void 0,void 0,function(){return f(this,function(n){return this.makeTestFunction(),[2,N.evaluateDataset(this,t,e)]})})},e.prototype.checkNumSamples=function(t,e,n,r){void 0===r&&(r="steps");var i;if(null!=n){if(i=null,null!=e)throw new b.ValueError("If "+r+" is set, batchSize must be null or undefined.Got batchSize = "+e)}else{if(null==t)throw new b.ValueError("Either the input data should have a defined shape, or "+(r+" shoud be specified."));i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i},e.prototype.execute=function(t,e){if(Array.isArray(e)&&0===e.length)throw new b.ValueError("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(e),r=n?e:[e],i=this.retrieveSymbolicTensors(r),o=new A.FeedDict;if(t instanceof m.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new b.ValueError("The number of inputs provided ("+t.length+") does not match the number of inputs of this model "+("("+this.inputs.length+")."));for(var a=0;a<this.inputs.length;++a)o.add(this.inputs[a],t[a])}else for(var s=0,u=this.inputs;s<u.length;s++){var l=u[s],c=t[l.name];if(null==c)throw new b.ValueError("No value is provided for the model's input "+l.name);o.add(l,c)}var p=A.execute(i,o);return n?p:p[0]},e.prototype.retrieveSymbolicTensors=function(t){for(var e=x.pyListRepeat(null,t.length),n=t.length,r=0,i=this.layers;r<i.length;r++){for(var o=i[r],a=Array.isArray(o.output)?o.output:[o.output],s=a.map(function(t){return t.name}),u=0;u<t.length;++u){var l=s.indexOf(t[u]);if(l!==-1&&(e[u]=a[l],n--),0===n)break}if(0===n)break}if(n>0){var c=[];throw e.forEach(function(e,n){null==e&&c.push(t[n])}),new b.ValueError("Cannot find SymbolicTensors for output name(s): "+JSON.stringify(c))}return e},e.prototype.predictLoop=function(t,e,n){var r=this;return void 0===e&&(e=32),void 0===n&&(n=!1),d.tidy(function(){var i=r.checkNumSamples(t);if(n)throw new b.NotImplementedError("Verbose predictLoop() is not implemented yet.");for(var o=O.makeBatches(i,e),a=[],s=function(e){var n=d.tidy(function(){var n=o[e][0],i=o[e][1],a=O.sliceArrays(t,n,i),s=[];if(Array.isArray(a))for(var u=0;u<a.length;++u)s.push({key:r.inputs[u],value:a[u]});else s.push({key:r.inputs[0],value:a});var l=new A.FeedDict(s);return A.execute(r.outputs,l)});if(0===e)for(var i=0,s=n;i<s.length;i++){var u=s[i];a.push(u)}else for(var l=0;l<n.length;++l)a[l]=g.concatAlongFirstAxis(a[l],n[l])},u=0;u<o.length;++u)s(u);return x.singletonOrArray(a)})},e.prototype.predict=function(t,e){void 0===e&&(e={});var n=O.ensureTensorsRank2OrHigher(t);l(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==e.batchSize?32:e.batchSize;return O.checkBatchSize(r),this.predictLoop(n,r)}finally{O.disposeNewTensors(n,t)}},e.prototype.predictOnBatch=function(t){return l(t,this.inputNames,this.feedInputShapes,!0),this.predictLoop(t,t.shape[0])},e.prototype.standardizeUserData=function(t,e,n,r){if(void 0===n&&(n=!0),null==this.optimizer)throw new b.RuntimeError("You must compile a model before training/testing. Use Model.compile(modelCompileConfig).");for(var i=[],o=0;o<this.feedOutputShapes.length;++o){var l=this.feedOutputShapes[o],c=this.feedLossFns[o];c===_.sparseCategoricalCrossentropy?i.push(l.slice(0,l.length-1).concat([1])):i.push(l)}if(t=a(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=a(e,this.feedOutputNames,i,!1,"target"),s(t,e,null),u(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=r&&r>0&&t[0].shape[0]%r!==0)throw new b.ValueError("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+(r+". Found: "+t[0].shape[0]+" sample(s)."));return[t,e,null]},e.prototype.testLoop=function(t,e,n,r,i){var o=this;return void 0===r&&(r=0),d.tidy(function(){var a=o.checkNumSamples(e,n,i,"steps"),s=[];if(r>0)throw new b.NotImplementedError("Verbose mode is not implemented yet.");if(null!=i)throw new b.NotImplementedError("steps mode in testLoop() is not implemented yet");for(var u=O.makeBatches(a,n),l=m.tensor1d(P.range(0,a)),c=0;c<u.length;++c){var p=u[c][0],h=u[c][1],f=g.sliceAlongFirstAxis(l,p,h-p),v=O.sliceArraysByIndices(e,f),_=t(v);if(0===c)for(var w=0;w<_.length;++w)s.push(y.getScalar(0));for(var w=0;w<_.length;++w){var S=_[w];s[w]=d.add(s[w],d.mul(y.getScalar(h-p),S))}}for(var w=0;w<s.length;++w)s[w]=d.div(s[w],y.getScalar(a));return s})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,e=[],n=0;n<t.length;++n){var r=t[n],i=r;if(x.count(t,r)>1){var o=x.count(t.slice(0,n),r);i+="_"+o}e.push(i)}return e},e.prototype.makeTrainFunction=function(){var t=this;return function(e){var n=[],r=[],i=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=[],s=function(){for(var e=[],s=0;s<t.inputs.length;++s)e.push({key:t.inputs[s],value:i[s]});for(var u,l=new A.FeedDict(e),c=A.execute(t.outputs,l,{training:!0}),s=0;s<t.lossFunctions.length;++s){var p=t.lossFunctions[s],h=p(o[s],c[s]);n.push(h);var f=d.mean(h);r.push(f),u=0===s?h:d.add(u,h)}for(var s=0;s<t.metricsTensors.length;++s){var m=t.metricsTensors[s][0],y=t.metricsTensors[s][1],g=d.mean(m(o[y],c[y]));d.keep(g),a.push(g)}return u=d.mean(u),t.calculateLosses().forEach(function(t){u=d.add(u,t)}),u},u=t.collectedTrainableWeights.map(function(t){return t.read()}),l=!0,c=t.optimizer.minimize(s,l,u);return[c].concat(a)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(e){return d.tidy(function(){for(var n,r=[],i=e.slice(0,t.inputs.length),o=e.slice(t.inputs.length,t.inputs.length+t.outputs.length),a=[],s=0;s<t.inputs.length;++s)a.push({key:t.inputs[s],value:i[s]});for(var u=new A.FeedDict(a),l=A.execute(t.outputs,u),s=0;s<t.lossFunctions.length;++s){var c=t.lossFunctions[s],p=d.mean(c(o[s],l[s]));n=0===s?p:d.add(n,p),r.push(n)}for(var s=0;s<t.metricsTensors.length;++s){var h=t.metricsTensors[s][0],f=t.metricsTensors[s][1],m=d.mean(h(o[f],l[f]));r.push(m)}return r})}},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),h(this,void 0,void 0,function(){return f(this,function(r){return[2,O.fitTensors(this,t,e,n)]})})},e.prototype.fitDataset=function(t,e){return h(this,void 0,void 0,function(){return f(this,function(n){return[2,N.fitDataset(this,t,e)]})})},e.prototype.getNamedWeights=function(t){for(var e={},n=null!=t&&t.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n),o=0;o<r.length;++o)n&&!r[o].trainable||(e[r[o].originalName]=i[o]);return e},Object.defineProperty(e.prototype,"stopTraining",{set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),e.prototype.save=function(t,e){return h(this,void 0,void 0,function(){var n,r,i,o,a;return f(this,function(s){switch(s.label){case 0:if("string"==typeof t){if(n=m.io.getSaveHandlers(t),0===n.length)throw new b.ValueError("Cannot find any save handlers for URL '"+t+"'");if(n.length>1)throw new b.ValueError("Found more than one ("+n.length+") save handlers for "+("URL '"+t+"'"));t=n[0]}if(null==t.save)throw new b.ValueError("Model.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,m.io.encodeWeights(this.getNamedWeights(e))];case 1:return r=s.sent(),i=!1,o=null,a=this.toJSON(o,i),[2,t.save({modelTopology:a,weightData:r.data,weightSpecs:r.specs})]}})})},e.className="Model",e}(E.Container);e.Model=k,m.serialization.registerClass(k)},function(t,e,n){"use strict";function r(t,e){return void 0===e&&(e={}),o.deserializeKerasObject(t,i.serialization.SerializationMap.getMap().classNameMap,e,"layer")}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(10);e.deserialize=r},function(t,e,n){"use strict";function r(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function i(t,e,n,r){return new P(t,e,n,!0,r)}function o(t,e,n){return new P(b.zeros(t),e,n)}function a(t,e,n){return new P(b.zerosLike(t),e,n)}function s(t,e,n){var r=b.ones(t);return new P(r,e,n)}function u(t,e,n){var r=b.onesLike(t);return new P(r,e,n)}function l(t,e,n){return new P(b.eye(t),e,n)}function c(t,e,n,r,i,o){return void 0===o&&(o="randomUniform"),new P(b.randomUniform(t,e,n,r),r,o)}function p(t,e,n,r,i,o){if(void 0===e&&(e=0),void 0===n&&(n=1),void 0===o&&(o="truncatedNormal"),r=r||"float32","float32"!==r&&"int32"!==r)throw new x.NotImplementedError("randomNormal does not support dType "+r+".");return new P(b.truncatedNormal(t,e,n,r,i),r,o)}function h(t,e,n,r,i,o){if(void 0===e&&(e=0),void 0===n&&(n=1),void 0===o&&(o="randomNormal"),r=r||"float32","float32"!==r&&"int32"!==r)throw new x.NotImplementedError("randomNormalVariable does not support dType "+r+".");return new P(b.randomNormal(t,e,n,r,i),r,o)}function f(t,e){return t.write(e)}function d(t,e){return t.write(b.add(t.read(),e))}function m(t,e){return t.write(b.sub(t.read(),e))}function y(t){return t.map(function(t){return t.read()})}function g(t){t.map(function(t){var e=t[0];e.write(t[1])})}function v(t,e){var n=e.map(function(t){return t.read()}),r=_.variableGrads(t,n);return e.map(function(t){return r.grads[t.name]})}Object.defineProperty(e,"__esModule",{value:!0});var b=n(1),_=n(1),w=n(8),S=n(27),x=n(7),T="Variable",P=function(){function t(t,e,n,r,i){void 0===e&&(e="float32"),void 0===n&&(n=T),void 0===r&&(r=!0),void 0===i&&(i=null),this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=w.getNextUniqueTensorId(),n=null==n?T:n,this.originalName=S.getScopedTensorName(n),this.name=S.getUniqueTensorName(this.originalName),this.trainable=r,this.constraint=i,this.val=b.variable(t,this.trainable,this.name,this.dtype)}return t.prototype.read=function(){return this.assertNotDisposed(),this.val},t.prototype.write=function(t){return this.assertNotDisposed(),r(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this},t.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},t.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},t}();e.LayerVariable=P,e.variable=i,e.zerosVariable=o,e.zerosLike=a,e.onesVariable=s,e.onesLike=u,e.eyeVariable=l,e.randomUniformVariable=c,e.truncatedNormalVariable=p,e.randomNormalVariable=h,e.update=f,e.updateAdd=d,e.updateSub=m,e.batchGetValue=y,e.batchSetValue=g,e.gradients=v},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(r[o]=!0)}for(i=0;i<e.length;i++){var a=e[i];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(p===clearTimeout)return clearTimeout(t);if((p===r||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(t);try{return p(t)}catch(e){try{return p.call(null,t)}catch(e){return p.call(this,t)}}}function a(){m&&f&&(m=!1,f.length?d=f.concat(d):y=-1,d.length&&s())}function s(){if(!m){var t=i(a);m=!0;for(var e=d.length;e;){for(f=d,d=[];++y<e;)f&&f[y].run();y=-1,e=d.length}f=null,m=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var c,p,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{p="function"==typeof clearTimeout?clearTimeout:r}catch(t){p=r}}();var f,d=[],m=!1,y=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];d.push(new u(t,e)),1!==d.length||m||i(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e,n){function r(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=f[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(l(r.parts[o],e))}else{for(var a=[],o=0;o<r.parts.length;o++)a.push(l(r.parts[o],e));f[r.id]={id:r.id,refs:1,parts:a}}}}function i(t){for(var e=[],n={},r=0;r<t.length;r++){var i=t[r],o=i[0],a=i[1],s=i[2],u=i[3],l={css:a,media:s,sourceMap:u};n[o]?n[o].parts.push(l):e.push(n[o]={id:o,parts:[l]})}return e}function o(t,e){var n=y(),r=b[b.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),b.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function a(t){t.parentNode.removeChild(t);var e=b.indexOf(t);e>=0&&b.splice(e,1)}function s(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function u(t){var e=document.createElement("link");return e.rel="stylesheet",o(t,e),e}function l(t,e){var n,r,i;if(e.singleton){var o=v++;n=g||(g=s(e)),r=c.bind(null,n,o,!1),i=c.bind(null,n,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=u(e),r=h.bind(null,n),i=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(e),r=p.bind(null,n),i=function(){a(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else i()}}function c(t,e,n,r){var i=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=_(e,i);else{var o=document.createTextNode(i),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function p(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function h(t,e){var n=e.css,r=e.sourceMap;r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var f={},d=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},m=d(function(){return/msie [6-9]\b/.test(self.navigator.userAgent.toLowerCase())}),y=d(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,v=0,b=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=m()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var n=i(t);return r(n,e),function(t){for(var o=[],a=0;a<n.length;a++){var s=n[a],u=f[s.id];u.refs--,o.push(u)}if(t){var l=i(t);r(l,e)}for(var a=0;a<o.length;a++){var u=o[a];if(0===u.refs){for(var c=0;c<u.parts.length;c++)u.parts[c]();delete f[u.id]}}}};var _=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e,n){"use strict";function r(t){if(a(t))return t;if(!Array.isArray(t))return"";var e=[0,0,0,0,0,0,0,0,0,0,0,0];return t.map(y).forEach(function(t){e[t]=1}),e.join("")}function i(t){return b=b||m.range(2048,4095).map(function(t){return t.toString(2)}),"number"==typeof t?b.filter(function(e){return v(e)===t}):b.slice()}function o(t,e){e=e!==!1;var n=r(t).split("");return m.compact(n.map(function(t,r){var i=m.rotate(r,n);return e&&"0"===i[0]?null:i.join("")}))}function a(t){return _.test(t)}function s(t){return a(t)?m.compact(t.split("").map(function(t,e){return"1"===t?w[e]:null})):[]}function u(t,e){return 1===arguments.length?function(e){return u(t,e)}:r(t)===r(e)}function l(t,e){return arguments.length>1?l(t)(e):(t=g(t),function(e){return e=g(e),e!==t&&(e&t)===e})}function c(t,e){return arguments.length>1?c(t)(e):(t=g(t),function(e){return e=g(e),e!==t&&(e|t)===e})}function p(t,e){return arguments.length>1?p(t)(e):(t=r(t),function(e){return"1"===t[y(e)]})}function h(t,e){return 1===arguments.length?function(e){return h(t,e)}:e.filter(p(t))}Object.defineProperty(e,"__esModule",{value:!0});var f=n(42),d=n(103),m=n(100),y=function(t){return f.chroma(t)||d.chroma(t)||0},g=function(t){return parseInt(r(t),2)},v=function(t){return t.replace(/0/g,"").length},b=null,_=/^[01]{12}$/,w="1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");e.chroma=r,e.chromas=i,e.modes=o,e.isChroma=a,e.intervals=s,e.isEqual=u,e.isSubsetOf=l,e.isSupersetOf=c,e.includes=p,e.filter=h},function(t,e,n){var r,i;r=[n(4),n(410)],i=function(t){"use strict";return t.WaveShaper=function(t,e){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(t)?this.curve=t:isFinite(t)||this.isUndef(t)?this._curve=new Float32Array(this.defaultArg(t,1024)):this.isFunction(t)&&(this._curve=new Float32Array(this.defaultArg(e,1024)),this.setMap(t))},t.extend(t.WaveShaper,t.SignalBase),t.WaveShaper.prototype.setMap=function(t){for(var e=0,n=this._curve.length;e<n;e++){var r=e/n*2-1;this._curve[e]=t(r,e)}return this._shaper.curve=this._curve,this},Object.defineProperty(t.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(t){this._curve=new Float32Array(t),this._shaper.curve=this._curve}}),Object.defineProperty(t.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){if(["none","2x","4x"].indexOf(t)===-1)throw new Error("invalid oversampling: "+t);this._shaper.oversample=t}}),t.WaveShaper.prototype.dispose=function(){return t.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},t.WaveShaper}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(384),n(39),n(54),n(167),n(166),n(155),n(108)],i=function(t,e,n,r,i,o,a){var s=function(t,n){this.element=document.createElement("DIV"),this.element.id="Grid",t.appendChild(this.element),this.bgCanvas=document.createElement("CANVAS"),this.element.appendChild(this.bgCanvas),this.bgContext=this.bgCanvas.getContext("2d"),this.canvas=document.createElement("CANVAS"),this.element.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.width=0,this.height=0,this.tileWidth=0,this.tileHeight=0,this._activeColumn=-1,this.mouseDrag=!1,this.lastDragTile={x:null,y:null},this._resize(),window.addEventListener("resize",this._resize.bind(this)),this.canvas.addEventListener("mousemove",this._hover.bind(this)),this.canvas.addEventListener("mousedown",this._clicked.bind(this)),this.canvas.addEventListener("mouseup",this._mouseUp.bind(this)),this.canvas.addEventListener("touchmove",this._hover.bind(this)),this.canvas.addEventListener("touchend",this._mouseUp.bind(this)),this.canvas.addEventListener("touchstart",this._clicked.bind(this)),this._tiles=new Array(e.gridWidth),this._ai=[],this._mlTiles=new Array(e.gridWidth),this._aiOffset={x:0,y:0},this._needsUpdate=!1,this._direction="none",this._iterationCounter=0,this._boundDraw=this.draw.bind(this),this.draw(),this.onNote=function(){}};return s.prototype.removeML=function(){this._needsUpdate=!0;for(var t=0;t<this._mlTiles.length;t++)this._mlTiles[t]=null},s.prototype._resize=function(){this._needsUpdate=!0,this.width=2*this.canvas.offsetWidth,this.height=2*this.canvas.offsetHeight,this.context.canvas.width=this.width,this.context.canvas.height=this.height,this.bgContext.canvas.width=this.width,this.bgContext.canvas.height=this.height,this.tileWidth=this.width/e.gridWidth,this.tileHeight=this.height/e.gridHeight,this._drawLines()},s.prototype._tileAtPosition=function(t,e){return{x:Math.floor(t/(this.tileWidth/2)),y:Math.floor(e/(this.tileHeight/2))}},s.prototype._clicked=function(t){if(this.mouseDrag=!0,t.preventDefault(),"touchstart"===t.type||"touchmove"===t.type)for(var e=0;e<t.changedTouches.length;e++){var n=t.changedTouches[e],r=this._tileAtPosition(n.clientX,n.clientY);this._addTile(r.x,r.y),this.lastDragTile=r}else{var i=this._tileAtPosition(t.clientX,t.clientY);this._addTile(i.x,i.y,!0),this.lastDragTile=i}},s.prototype._mouseUp=function(t){t.preventDefault(),this.mouseDrag=!1},s.prototype._hover=function(t){const e=t.clientX||t.touches[0].clientX,n=t.clientY||t.touches[0].clientY;var r=this._tileAtPosition(e,n),i=this._tiles[r.x];!this.mouseDrag||void 0===this.lastDragTile.x||r.x===this.lastDragTile.x&&r.y===this.lastDragTile.y||(this.lastDragTile=r,this._clicked(t)),i&&!i.isHovered()&&r.y===i.y&&(this._needsUpdate=!0,i.hover());for(var o=0;o<this._tiles.length;o++){var a=this._tiles[o];a&&a.isHovered()&&(a.x!==r.x||a.y!==r.y)&&(this._needsUpdate=!0,a.unhover())}},s.prototype._addTile=function(t,e,n,o,a){if(void 0!=t&&void 0!=e)if(this._needsUpdate=!0,o===!0){var s=new r(t,e,n,o,a);this._mlTiles[t]=s}else if(this._tiles[t]){var u=this._tiles[t];u.y==e?this._removeTile(t,e,u):(this._removeTile(t,e,u),this._addTile(t,e,n))}else if(this._mlTiles[t]){var u=this._mlTiles[t];this._removeTile(t,e,u),this._addTile(t,e,n)}else{var s=new r(t,e,n);this.onNote(e);var l=new i(s,this);this._tiles[t]=s,this._ai.push(l)}},s.prototype.getState=function(){var t,n=[];for(t=0;t<e.gridWidth;t++){var r=this.select(t);n.push(r)}return n},s.prototype._removeTile=function(t,e,n){for(var r=0;r<this._ai.length;r++){var i=this._ai[r];if(i.tile===n){i.dispose(),this._ai.splice(r,1);break}}this._tiles[t]=null,this._mlTiles[t]=null,this._needsUpdate=!0},s.prototype.draw=function(){requestAnimationFrame(this._boundDraw),this._needsUpdate&&(this._needsUpdate=!1,this.context.clearRect(0,0,this.width,this.height),this._activeColumn!==-1&&(this.context.fillStyle="rgba(22, 168, 240, .08)",this.context.fillRect(this._activeColumn*this.tileWidth,0,this.tileWidth,this.height)),this._drawAI(),this._drawTiles(),this._drawML(),o.update())},s.prototype._drawLines=function(){var t=e.gridWidth,n=e.gridHeight;this.bgContext.strokeStyle="rgba(22, 168, 240, 0.4)",this.bgContext.lineWidth=1;for(var r=0;r<t;r++)for(var i=0;i<n;i++)this.bgContext.beginPath(),this.bgContext.strokeRect(r*this.tileWidth,i*this.tileHeight,this.tileWidth,this.tileHeight)},s.prototype._drawTiles=function(){for(var t=0;t<this._tiles.length;t++){var e=this._tiles[t];e&&e.draw(this.context,this.tileWidth,this.tileHeight,this._activeColumn)}},s.prototype._drawML=function(){for(var t=0;t<this._mlTiles.length;t++){var e=this._mlTiles[t];e&&e.draw(this.context,this.tileWidth,this.tileHeight,this._activeColumn)}},s.prototype._drawAI=function(){for(var t=0;t<this._ai.length;t++)this._ai[t].draw(this.context,this.tileWidth,this.tileHeight,this._activeColumn,this._aiOffset,this._direction)},s.prototype.select=function(t){this._needsUpdate=!0,this._activeColumn=t;var n={melody:-1,harmony:-1};this._tiles[t]?n.melody=this._tiles[t].y:e.playPredictedNotes&&this._mlTiles[t]&&(n.melody=this._mlTiles[t].y);for(var r=0;r<this._ai.length;r++){var i=this._ai[r];if(i.isInColumn(t)){var o=i.getRow();n.melody!==o&&(n.harmony=o)}}return n},s.prototype._moveAI=function(){switch(this._needsUpdate=!0,this._direction){case"down":this._aiOffset.y=(this._aiOffset.y+2)%e.gridHeight;break;case"up":this._aiOffset.y-=2,this._aiOffset.y<0&&(this._aiOffset.y=e.gridHeight-2);break;case"left":this._aiOffset.x-=2,this._aiOffset.x<0&&(this._aiOffset.x=e.gridWidth-2);break;case"right":this._aiOffset.x=(this._aiOffset.x+2)%e.gridWidth;break;case"none":this._aiOffset.x=0,this._aiOffset.y=0}for(var t=0;t<this._ai.length;t++)this._ai[t].move(this._aiOffset.x,this._aiOffset.y,this._direction)},s.prototype.setDirection=function(t){this._needsUpdate=!0,this._activeColumn<2?this._iterationCounter=1:this._iterationCounter=0,this._direction=t;for(var e=0;e<this._ai.length;e++)this._ai[e].dispose();this._ai=[];for(var n=0;n<this._tiles.length;n++){var r=this._tiles[n];if(r){var o=new i(r,this);this._ai.push(o)}}this._aiOffset={x:0,y:0},this._moveAI()},s}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){"use strict";function r(t){switch(t){case"MajorMinorChordEncoder":return new d;case"TriadChordEncoder":return new m;case"PitchChordEncoder":return new y;default:throw new Error("Unknown chord encoder type: "+t)}}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o,a=n(1),s=n(390),u=n(21),l=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];!function(t){t[t.Major=0]="Major",t[t.Minor=1]="Minor",t[t.Augmented=2]="Augmented",t[t.Diminished=3]="Diminished",t[t.Other=4]="Other"}(o=e.ChordQuality||(e.ChordQuality={}));var c=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(e,t),e}(Error);e.ChordSymbolException=c;var p=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return i(e,t),e}(Error);e.ChordEncodingException=p;var h=function(){function t(){}return t.pitches=function(t){if(!s.Chord.exists(t))throw new c("Unrecognized chord symbol: "+t);var e=s.Chord.notes(t);return e.map(s.Note.chroma)},t.root=function(t){var e=s.Chord.tokenize(t)[0];if(!e)throw new c("Chord symbol has unknown root: "+t);return s.Note.chroma(e)},t.quality=function(t){if(!s.Chord.exists(t))throw new c("Unrecognized chord symbol: "+t);var e=s.Chord.intervals(t),n=l.map(function(t){return t.every(function(t){return e.includes(t)})}),r=n.indexOf(!0),i=n.lastIndexOf(!0);return r>=0&&r===i?r:o.Other},t}();e.ChordSymbols=h;var f=function(){function t(){}return t.prototype.encodeProgression=function(t,e){var n=this,r=t.map(function(t){return n.encode(t)}),i=Array.from(Array(e).keys()).map(function(t){return Math.floor(t*r.length/e)});return a.stack(i.map(function(t){return r[t]}))},t}();e.ChordEncoder=f,e.chordEncoderFromType=r;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+2*u.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.index=function(t){if(t===u.NO_CHORD)return 0;var e=h.root(t),n=h.quality(t),r=1+n*u.NUM_PITCH_CLASSES+e;if(r>=this.depth)throw new p("Chord is neither major nor minor: "+t);return r},e.prototype.encode=function(t){var e=this;return a.tidy(function(){return a.oneHot(a.tensor1d([e.index(t)],"int32"),e.depth).as1D()})},e}(f);e.MajorMinorChordEncoder=d;var m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+4*u.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.index=function(t){if(t===u.NO_CHORD)return 0;var e=h.root(t),n=h.quality(t),r=1+n*u.NUM_PITCH_CLASSES+e;if(r>=this.depth)throw new p("Chord is not a standard triad: "+t);return r},e.prototype.encode=function(t){var e=this;return a.tidy(function(){return a.oneHot(a.tensor1d([e.index(t)],"int32"),e.depth).as1D()})},e}(f);e.TriadChordEncoder=m;var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.depth=1+3*u.NUM_PITCH_CLASSES,e}return i(e,t),e.prototype.encode=function(t){var e=this;return a.tidy(function(){if(t===u.NO_CHORD)return a.oneHot(a.tensor1d([0],"int32"),e.depth).as1D();var n=h.root(t),r=a.oneHot(a.tensor1d([n],"int32"),u.NUM_PITCH_CLASSES).as1D(),i=a.buffer([u.NUM_PITCH_CLASSES]);h.pitches(t).forEach(function(t){return i.set(1,t)});var o=i.toTensor().as1D(),s=r;return a.concat1d([a.tensor1d([0]),r,o,s])})},e}(f);e.PitchChordEncoder=y},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0});var i=n(109);e.aux_inputs=i;var o=n(71);e.chords=o;var a=n(21);e.constants=a;var s=n(55);e.data=s;var u=n(46);e.logging=u;var l=n(110);e.performance=l;var c=n(47);e.sequences=c,r(n(174)),r(n(175)),r(n(176)),r(n(178))},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SAMPLE_RATE=16e3,e.SPEC_HOP_LENGTH=512,e.FRAME_LENGTH_SECONDS=e.SPEC_HOP_LENGTH/e.SAMPLE_RATE,e.MEL_SPEC_BINS=229,e.MIN_MIDI_PITCH=21,e.MAX_MIDI_PITCH=108,e.MIDI_PITCHES=e.MAX_MIDI_PITCH-e.MIN_MIDI_PITCH+1},function(t,e){"use strict";function n(t){if(!(t in i)){var e=document.createElement("canvas");e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete i[t]},!1),i[t]=r(t)}var o=i[t];return o.isContextLost()?(delete i[t],n(t)):(o.disable(o.DEPTH_TEST),o.disable(o.STENCIL_TEST),o.disable(o.BLEND),o.disable(o.DITHER),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SAMPLE_COVERAGE),o.enable(o.SCISSOR_TEST),o.enable(o.CULL_FACE),o.cullFace(o.BACK),i[t])}function r(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=document.createElement("canvas");return 1===t?e.getContext("webgl",o)||e.getContext("experimental-webgl",o):e.getContext("webgl2",o)}Object.defineProperty(e,"__esModule",{value:!0});var i={},o={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};e.getWebGLContext=n},function(t,e,n){"use strict";function r(t){if(t.indexOf(f)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+d.getSchemes().join(","));return{scheme:t.split(f)[0],path:t.split(f)[1]}}function i(t,e,n){return void 0===n&&(n=!1),l(this,void 0,void 0,function(){var i,o,a,s,u,l,f,m,y;return c(this,function(c){switch(c.label){case 0:return p.assert(t!==e,"Old path and new path are the same: '"+t+"'"),i=h.IORouterRegistry.getLoadHandlers(t),p.assert(i.length>0,"Copying failed because no load handler is found for source URL "+t+"."),p.assert(i.length<2,"Copying failed because more than one ("+i.length+") "+("load handlers for source URL "+t+".")),o=i[0],a=h.IORouterRegistry.getSaveHandlers(e),p.assert(a.length>0,"Copying failed because no save handler is found for destination URL "+(e+".")),p.assert(a.length<2,"Copying failed because more than one ("+i.length+") "+("save handlers for destination URL "+e+".")),s=a[0],u=r(t).scheme,l=r(t).path,f=u===r(t).scheme,[4,o.load()];case 1:return m=c.sent(),n&&f?[4,d.getManager(u).removeModel(l)]:[3,3];case 2:c.sent(),c.label=3;case 3:return[4,s.save(m)];case 4:return y=c.sent(),!n||f?[3,6]:[4,d.getManager(u).removeModel(l)];case 5:c.sent(),c.label=6;case 6:return[2,y.modelArtifactsInfo]}})})}function o(){
return l(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s;return c(this,function(u){switch(u.label){case 0:t=d.getSchemes(),e={},n=0,r=t,u.label=1;case 1:return n<r.length?(i=r[n],[4,d.getManager(i).listModels()]):[3,4];case 2:o=u.sent();for(a in o)s=i+f+a,e[s]=o[a];u.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})}function a(t){return l(this,void 0,void 0,function(){var e,n;return c(this,function(i){switch(i.label){case 0:return e=r(t),n=d.getManager(e.scheme),[4,n.removeModel(e.path)];case 1:return[2,i.sent()]}})})}function s(t,e){return l(this,void 0,void 0,function(){var n;return c(this,function(r){switch(r.label){case 0:return n=!1,[4,i(t,e,n)];case 1:return[2,r.sent()]}})})}function u(t,e){return l(this,void 0,void 0,function(){var n;return c(this,function(r){switch(r.label){case 0:return n=!0,[4,i(t,e,n)];case 1:return[2,r.sent()]}})})}var l=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var p=n(2),h=n(41),f="://",d=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){p.assert(null!=e,"scheme must not be undefined or null."),e.endsWith(f)&&(e=e.slice(0,e.indexOf(f))),p.assert(e.length>0,"scheme must not be an empty string.");var r=t.getInstance();p.assert(null==r.managers[e],"A model store manager is already registered for scheme '"+e+"'."),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();e.ModelStoreManagerRegistry=d,e.listModels=o,e.removeModel=a,e.copyModel=s,e.moveModel=u},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.dataMover=t,this.data=new WeakMap}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(t),this.data.get(t)},t.prototype.set=function(t,e){this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.data.delete(t)},t}();e.DataStorage=n;var r=function(){function t(){}return t.prototype.time=function(t){throw new Error("Not yet implemented.")},t.prototype.read=function(t){throw new Error("Not yet implemented.")},t.prototype.readSync=function(t){throw new Error("Not yet implemented.")},t.prototype.disposeData=function(t){throw new Error("Not yet implemented.")},t.prototype.write=function(t,e){throw new Error("Not yet implemented.")},t.prototype.fromPixels=function(t,e){throw new Error("Not yet implemented.")},t.prototype.register=function(t,e,n){throw new Error("Not yet implemented.")},t.prototype.memory=function(){throw new Error("Not yet implemented.")},t.prototype.floatPrecision=function(){throw new Error("Not yet implemented")},t.prototype.batchMatMul=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.slice=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.stridedSlice=function(t,e,n,r,i,o,a,s,u){throw new Error("Not yet implemented")},t.prototype.reverse=function(t,e){throw new Error("Not yet implemented")},t.prototype.concat=function(t,e){throw new Error("Not yet implemented")},t.prototype.neg=function(t){throw new Error("Not yet implemented")},t.prototype.add=function(t,e){throw new Error("Not yet implemented")},t.prototype.addN=function(t){throw new Error("Not yet implemented")},t.prototype.subtract=function(t,e){throw new Error("Not yet implemented")},t.prototype.multiply=function(t,e){throw new Error("Not yet implemented")},t.prototype.realDivide=function(t,e){throw new Error("Not yet implemented")},t.prototype.floorDiv=function(t,e){throw new Error("Not yet implemented")},t.prototype.sum=function(t,e){throw new Error("Not yet implemented")},t.prototype.prod=function(t,e){throw new Error("Not yet implemented")},t.prototype.unsortedSegmentSum=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.argMin=function(t,e){throw new Error("Not yet implemented")},t.prototype.argMax=function(t,e){throw new Error("Not yet implemented")},t.prototype.equal=function(t,e){throw new Error("Not yet implemented")},t.prototype.notEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.less=function(t,e){throw new Error("Not yet implemented")},t.prototype.lessEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.greater=function(t,e){throw new Error("Not yet implemented")},t.prototype.greaterEqual=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalNot=function(t){throw new Error("Not yet implemented")},t.prototype.logicalAnd=function(t,e){throw new Error("Not yet implemented")},t.prototype.logicalOr=function(t,e){throw new Error("Not yet implemented")},t.prototype.where=function(t){throw new Error("Not yet implemented")},t.prototype.select=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.topk=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.min=function(t,e){throw new Error("Not yet implemented")},t.prototype.minimum=function(t,e){throw new Error("Not yet implemented")},t.prototype.mod=function(t,e){throw new Error("Not yet implemented")},t.prototype.max=function(t,e){throw new Error("Not yet implemented")},t.prototype.maximum=function(t,e){throw new Error("Not yet implemented")},t.prototype.all=function(t,e){throw new Error("Not yet implemented")},t.prototype.any=function(t,e){throw new Error("Not yet implemented")},t.prototype.squaredDifference=function(t,e){throw new Error("Not yet implemented")},t.prototype.ceil=function(t){throw new Error("Not yet implemented")},t.prototype.floor=function(t){throw new Error("Not yet implemented")},t.prototype.round=function(t){throw new Error("Not yet implemented")},t.prototype.sign=function(t){throw new Error("Not yet implemented")},t.prototype.pow=function(t,e){throw new Error("Not yet implemented")},t.prototype.exp=function(t){throw new Error("Not yet implemented")},t.prototype.expm1=function(t){throw new Error("Not yet implemented")},t.prototype.log=function(t){throw new Error("Not yet implemented")},t.prototype.log1p=function(t){throw new Error("Not yet implemented")},t.prototype.sqrt=function(t){throw new Error("Not yet implemented")},t.prototype.rsqrt=function(t){throw new Error("Not yet implemented")},t.prototype.square=function(t){throw new Error("Not yet implemented")},t.prototype.reciprocal=function(t){throw new Error("Not yet implemented")},t.prototype.relu=function(t){throw new Error("Not yet implemented")},t.prototype.elu=function(t){throw new Error("Not yet implemented")},t.prototype.eluDer=function(t,e){throw new Error("Not yet implemented")},t.prototype.selu=function(t){throw new Error("Not yet implemented")},t.prototype.int=function(t){throw new Error("Not yet implemented")},t.prototype.clip=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.abs=function(t){throw new Error("Not yet implemented")},t.prototype.complexAbs=function(t){throw new Error("Not yet implemented")},t.prototype.sigmoid=function(t){throw new Error("Not yet implemented")},t.prototype.softplus=function(t){throw new Error("Not yet implemented")},t.prototype.sin=function(t){throw new Error("Not yet implemented")},t.prototype.cos=function(t){throw new Error("Not yet implemented")},t.prototype.tan=function(t){throw new Error("Not yet implemented")},t.prototype.asin=function(t){throw new Error("Not yet implemented")},t.prototype.acos=function(t){throw new Error("Not yet implemented")},t.prototype.atan=function(t){throw new Error("Not yet implemented")},t.prototype.atan2=function(t,e){throw new Error("Not yet implemented")},t.prototype.sinh=function(t){throw new Error("Not yet implemented")},t.prototype.cosh=function(t){throw new Error("Not yet implemented")},t.prototype.tanh=function(t){throw new Error("Not yet implemented")},t.prototype.asinh=function(t){throw new Error("Not yet implemented")},t.prototype.acosh=function(t){throw new Error("Not yet implemented")},t.prototype.atanh=function(t){throw new Error("Not yet implemented")},t.prototype.erf=function(t){throw new Error("Not yet implemented")},t.prototype.step=function(t,e){throw new Error("Not yet implemented")},t.prototype.conv2d=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.conv2dDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2D=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.maxPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.maxPoolBackprop=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.avgPool=function(t,e){throw new Error("Not yet implemented")},t.prototype.avgPoolBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.reshape=function(t,e){throw new Error("Not yet implemented")},t.prototype.cast=function(t,e){throw new Error("Not yet implemented")},t.prototype.tile=function(t,e){throw new Error("Not yet implemented")},t.prototype.pad=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.transpose=function(t,e){throw new Error("Not yet implemented")},t.prototype.gather=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.gatherND=function(t,e){throw new Error("Not yet implemented")},t.prototype.scatterND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchToSpaceND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.spaceToBatchND=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeBilinear=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeBilinearBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.batchNormalization=function(t,e,n,r,i,o){throw new Error("Not yet implemented")},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){throw new Error("Not yet implemented")},t.prototype.LRNGrad=function(t,e,n,r,i,o,a){throw new Error("Not yet implemented")},t.prototype.multinomial=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.oneHot=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.cumsum=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.nonMaxSuppression=function(t,e,n,r,i){throw new Error("Not yet implemented")},t.prototype.fft=function(t){throw new Error("Not yet implemented")},t.prototype.ifft=function(t){throw new Error("Not yet implemented")},t.prototype.complex=function(t,e){throw new Error("Not yet implemented")},t.prototype.real=function(t){throw new Error("Not yet implemented")},t.prototype.imag=function(t){throw new Error("Not yet implemented")},t.prototype.cropAndResize=function(t,e,n,r,i,o){throw new Error("Not yet implemented")},t.prototype.depthToSpace=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.split=function(t,e,n){throw new Error("Not yet implemented")},t.prototype.sparseToDense=function(t,e,n,r){throw new Error("Not yet implemented")},t.prototype.setDataMover=function(t){throw new Error("Not yet implemented")},t.prototype.dispose=function(){throw new Error("Not yet implemented")},t}();e.KernelBackend=r},function(t,e,n){"use strict";function r(t,e,n,r,a){for(var s=Array.from(e).map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>a}).sort(function(t,e){return e.score-t.score}),u=[],l=0;l<s.length;l++){var c=s[l],p=c.score,h=c.boxIndex;if(p<a)break;for(var f=!1,d=u.length-1;d>=0;--d){var m=i(t,h,u[d]);if(m>=r){f=!0;break}}if(!f&&(u.push(h),u.length>=n))break}return o.tensor1d(u,"int32")}function i(t,e,n){var r=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),p=Math.max(i[0],i[2]),h=Math.max(i[1],i[3]),f=(s-o)*(u-a),d=(p-l)*(h-c);if(f<=0||d<=0)return 0;var m=Math.max(o,l),y=Math.max(a,c),g=Math.min(s,p),v=Math.min(u,h),b=Math.max(g-m,0)*Math.max(v-y,0);return b/(f+d-b)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(9);e.nonMaxSuppressionImpl=r},function(t,e,n){"use strict";function r(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);for(var o=i.buffer(t,"int32"),a=i.buffer([n.length,t.length],"int32"),r=0;r<n.length;r++){var s=o.indexToLoc(n[r]),u=r*t.length;a.values.set(s,u)}return a.toTensor()}Object.defineProperty(e,"__esModule",{value:!0});var i=n(33);e.whereImpl=r},function(t,e,n){"use strict";function r(t,e){var n=s.convertToTensor(t,"real","complex"),r=s.convertToTensor(e,"imag","complex");return u.assertShapesMatch(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),a.ENV.engine.runKernel(function(t){return t.complex(n,r)},{$real:n,$imag:r})}function i(t){var e=s.convertToTensor(t,"input","real");return a.ENV.engine.runKernel(function(t){return t.real(e)},{$input:e})}function o(t){var e=s.convertToTensor(t,"input","imag");return a.ENV.engine.runKernel(function(t){return t.imag(e)},{$input:e})}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),s=n(6),u=n(2),l=n(5);e.complex=l.op({complex_:r}),e.real=l.op({real_:i}),e.imag=l.op({imag_:o})},function(t,e,n){"use strict";function r(t){return e.concat(t,0)}function i(t,n){return e.concat(t,n)}function o(t,n){return e.concat(t,n)}function a(t,n){return e.concat(t,n)}function s(t,n){void 0===n&&(n=0),p.assert(t.length>=1,"Pass at least one tensor to concat");var r=c.convertToTensorArray(t,"tensors","concat");n=h.parseAxisParam(n,r[0].shape)[0];var i=f.computeOutShape(r.map(function(t){return t.shape}),n);if(0===p.sizeFromShape(i))return m.tensor([],i);if(r=r.filter(function(t){return t.size>0}),1===r.length)return r[0];var o=r.map(function(t){return t.shape});f.assertParamsConsistent(o,n);var a=function(t){var r=o.map(function(t){return t[n]}),i=e.split(t,r,n);return i.map(function(t){return function(){return t}})},s=r;return l.ENV.engine.runKernel(function(t){return t.concat(r,n)},s,a)}function u(t,n,r){void 0===r&&(r=0);var i=c.convertToTensor(t,"x","split");r=h.parseAxisParam(r,i.shape)[0];var o;"number"==typeof n?(p.assert(i.shape[r]%n===0,"Number of splits must evenly divide the axis."),o=Array(n).fill(i.shape[r]/n)):(p.assert(i.shape[r]===n.reduce(function(t,e){return t+e}),"The sum of sizes must match the size of the axis dimension."),o=n);var a=function(t){return{$x:function(){return e.concat(t,r)}}};return l.ENV.engine.runKernel(function(t){return t.split(i,o,r)},{$x:i},a)}Object.defineProperty(e,"__esModule",{value:!0});var l=n(3),c=n(6),p=n(2),h=n(24),f=n(58),d=n(5),m=n(9);e.concat=d.op({concat_:s}),e.concat1d=d.op({concat1d_:r}),e.concat2d=d.op({concat2d_:i}),e.concat3d=d.op({concat3d_:o}),e.concat4d=d.op({concat4d_:a}),e.split=d.op({split_:u})},function(t,e,n){"use strict";function r(t){var e=f.convertToTensor(t,"x","logicalNot","bool");return d.assert("bool"===e.dtype,"Error Array must be of type bool."),p.ENV.engine.runKernel(function(t){return t.logicalNot(e)},{$x:e})}function i(t,e){var n=f.convertToTensor(t,"a","logicalAnd","bool"),r=f.convertToTensor(e,"b","logicalAnd","bool");return d.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),m.assertAndGetBroadcastShape(n.shape,r.shape),p.ENV.engine.runKernel(function(t){return t.logicalAnd(n,r)},{$a:n,$b:r})}function o(t,e){var n=f.convertToTensor(t,"a","logicalOr","bool"),r=f.convertToTensor(e,"b","logicalOr","bool");return d.assert("bool"===n.dtype&&"bool"===r.dtype,"Error Array must be of type bool."),m.assertAndGetBroadcastShape(n.shape,r.shape),p.ENV.engine.runKernel(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}function a(t,n){var r=f.convertToTensor(t,"a","logicalXor","bool"),i=f.convertToTensor(n,"b","logicalXor","bool");return d.assert("bool"===r.dtype&&"bool"===i.dtype,"Error Array must be of type bool."),m.assertAndGetBroadcastShape(r.shape,i.shape),e.logicalOr(t,n).logicalAnd(e.logicalAnd(t,n).logicalNot())}function s(t,e,n){var r=f.convertToTensor(e,"a","where"),i=f.convertToTensor(n,"b","where"),o=f.convertToTensor(t,"condition","where","bool");d.assert("bool"===o.dtype,"Error Condition must be of type bool."),d.assertShapesMatch(r.shape,i.shape,"Error in where: "),1===o.rank?d.assert(o.shape[0]===r.shape[0],"The first dimension of `a` must match the size of `condition`."):d.assertShapesMatch(o.shape,i.shape,"Error in where: ");var a=function(t){return{$condition:function(){return g.zerosLike(o)},$a:function(){return t.mul(o.cast(r.dtype))},$b:function(){return t.mul(o.logicalNot().cast(i.dtype))}}};return p.ENV.engine.runKernel(function(t){return t.select(o,r,i)},{$condition:o,$a:r,$b:i},a)}function u(t){return l(this,void 0,void 0,function(){var e,n,r;return c(this,function(i){switch(i.label){case 0:return e=f.convertToTensor(t,"condition","where","bool"),d.assert("bool"===e.dtype,"Condition must be of type bool."),[4,e.data()];case 1:return n=i.sent(),r=h.whereImpl(e.shape,n),t!==e&&e.dispose(),[2,r]}})})}var l=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var p=n(3),h=n(78),f=n(6),d=n(2),m=n(25),y=n(5),g=n(9);e.logicalAnd=y.op({logicalAnd_:i}),e.logicalNot=y.op({logicalNot_:r}),e.logicalOr=y.op({logicalOr_:o}),e.logicalXor=y.op({logicalXor_:a}),e.where=y.op({where_:s}),e.whereAsync=u},function(t,e,n){"use strict";function r(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+(", indices.shape: "+e.shape+", shape: "+t)+(", sliceDim: "+r+", and batchDim: "+i+".");if(n.rank<i)throw new Error(o+(" update.rank < "+i+". "));if(t.length<r+(n.rank-i))throw new Error(o+(" Output shape length < "+(r+(n.rank-i))));if(n.rank!==i+t.length-r)throw new Error(o+(" update.rank != "+(i+t.length-r)));for(var a=0;a<i;++a)if(n.shape[a]!==e.shape[a])throw new Error(o+(" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+")."));for(var a=0;a<n.rank-i;++a)if(n.shape[a+i]!==t[a+r])throw new Error(o+(" updates.shape["+(a+i)+"] ("+n.shape[a+i]+") != shape["+(a+i)+"] ("+t[a+i]+")"))}function i(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+t.rank+"."));if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}r(n,e,t)}function o(t,e,n){for(var r=e.rank>1?e.shape[e.rank-1]:1,i=n.length,o=1,s=r;s<i;++s)o*=n[s];var u=r<1?1:r,l=e.size/u,c=a.computeStrides(n).concat([1]),p=c.slice(c.length-r,c.length),h=a.sizeFromShape(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:p,outputSize:h}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2);e.validateUpdateShape=r,e.validateInput=i,e.calculateShapes=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SELU_SCALEALPHA=1.7580993408473768,e.SELU_SCALE=1.0507009873554805},function(t,e,n){"use strict";function r(t,e,n){s.assert(t.rank===e.length,"Error in slice"+t.rank+"D: Length of begin "+e+" must "+("match the rank of the array ("+t.rank+").")),s.assert(t.rank===n.length,"Error in slice"+t.rank+"D: Length of size "+n+" must "+("match the rank of the array ("+t.rank+")."));for(var r=0;r<t.rank;++r)s.assert(e[r]+n[r]<=t.shape[r],"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] "+("("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"))}function i(t,e,n,r,i,s,u,l,c){if(void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0),0!==u)throw new Error("ellipsis mask is not yet supported");if(0!==l)throw new Error("new axis mask is not yet supported");for(var p=[],h=[],f=[],d=0;d<t.length;d++)p[d]=o(i,e,r,t,d),h[d]=a(s,n,r,t,d),c&1<<d&&(h[d]=p[d]+1,f.push(d));var m=new Array(t.length).fill(0);return m=m.map(function(t,e){for(var n=0,i=p[e];!(r[e]>0?i>=h[e]:i<=h[e]);i+=r[e])n+=1;return n}),[p,m,f]}function o(t,e,n,r,i){var o=e[i];t&1<<i&&(o=n[i]>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=s.clamp(0,o,a-1)}function a(t,e,n,r,i){var o=e[i];t&1<<i&&(o=n[i]>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),o=n[i]>0?s.clamp(0,o,a):s.clamp(-1,o,a-1)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2);e.assertParamsValid=r,e.getStridedSlicedInfo=i,e.startForAxis=o,e.stopForAxis=a},function(t,e,n){"use strict";function r(t){var e=L.convertToTensor(t,"x","neg"),n=function(t){return{$x:function(){return t.neg()}}};return D.ENV.engine.runKernel(function(t){return t.neg(e)},{$x:e},n)}function i(t){var e=L.convertToTensor(t,"x","ceil"),n=function(t){return{$x:function(){return q.zerosLike(t)}}};return D.ENV.engine.runKernel(function(t){return t.ceil(e)},{$x:e},n)}function o(t){var e=L.convertToTensor(t,"x","floor"),n=function(t){return{$x:function(){return q.zerosLike(t)}}};return D.ENV.engine.runKernel(function(t){return t.floor(e)},{$x:e},n)}function a(t){var e=L.convertToTensor(t,"x","sign"),n=function(t){return{$x:function(){return q.zerosLike(t)}}};return D.ENV.engine.runKernel(function(t){return t.sign(e)},{$x:e},n)}function s(t){var e=L.convertToTensor(t,"x","round"),n=function(t){return{$x:function(){return q.zerosLike(t)}}};return D.ENV.engine.runKernel(function(t){return t.round(e)},{$x:e},n)}function u(t){var e=L.convertToTensor(t,"x","exp"),n=function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n)}}};return D.ENV.engine.runKernel(function(t,n){return n(t.exp(e))},{$x:e},n)}function l(t){var e=L.convertToTensor(t,"x","expm1"),n=function(t){return{$x:function(){return t.mulStrict(e.exp())}}};return D.ENV.engine.runKernel(function(t){return t.expm1(e)},{$x:e},n)}function c(t){var e=L.convertToTensor(t,"x","log"),n=function(t){return{$x:function(){return t.divStrict(e.toFloat())}}};return D.ENV.engine.runKernel(function(t){return t.log(e)},{$x:e},n)}function p(t){var e=L.convertToTensor(t,"x","log1p"),n=function(t){return{$x:function(){return t.divStrict(e.add(q.scalar(1)))}}};return D.ENV.engine.runKernel(function(t){return t.log1p(e)},{$x:e},n)}function h(t){var e=L.convertToTensor(t,"x","sqrt"),n=function(t){return{$x:function(){return t.divStrict(e.toFloat().sqrt().mul(q.scalar(2)))}}};return D.ENV.engine.runKernel(function(t){return t.sqrt(e)},{$x:e},n)}function f(t){var e=L.convertToTensor(t,"x","rsqrt"),n=function(t){return{$x:function(){return t.divStrict(e.pow(q.scalar(1.5)).mul(q.scalar(2))).neg()}}};return D.ENV.engine.runKernel(function(t){return t.rsqrt(e)},{$x:e},n)}function d(t){var e=L.convertToTensor(t,"x","square"),n=function(t){return{$x:function(){return t.mulStrict(e.toFloat().mul(q.scalar(2)))}}};return D.ENV.engine.runKernel(function(t){return t.square(e)},{$x:e},n)}function m(t){var e=L.convertToTensor(t,"x","reciprocal"),n=function(t){return{$x:function(){return t.divStrict(e.square().neg())}}};return D.ENV.engine.runKernel(function(t){return t.reciprocal(e)},{$x:e},n)}function y(t){var e=L.convertToTensor(t,"x","abs");if("complex64"===e.dtype)return D.ENV.engine.runKernel(function(t){return t.complexAbs(e)},{$x:e});var n=function(t){return{$x:function(){return t.mulStrict(e.toFloat().step(-1))}}};return D.ENV.engine.runKernel(function(t){return t.abs(e)},{$x:e},n)}function g(t,e,n){var r=L.convertToTensor(t,"x","clipByValue");F.assert(e<=n,"Error in clip: min ("+e+") must be "+("less than or equal to max ("+n+")."));var i=function(t){return{$x:function(){return t.where(r.greaterEqual(q.scalar(e)).logicalAnd(r.lessEqual(q.scalar(n))),q.zerosLike(t))}}};return D.ENV.engine.runKernel(function(t){return t.clip(r,e,n)},{$x:r},i)}function v(t){var e=L.convertToTensor(t,"x","sigmoid"),n=function(t,e){var n=e[0];return{$x:function(){return t.mulStrict(n.mul(q.scalar(1).sub(n)))}}};return D.ENV.engine.runKernel(function(t,n){return n(t.sigmoid(e))},{$x:e},n)}function b(t){var e=L.convertToTensor(t,"x","logSigmoid"),n=function(t){return{$x:function(){return t.mulStrict(e.neg().sigmoid())}}};return D.ENV.engine.runKernel(function(t){return t.softplus(e.neg()).neg()},{$x:e},n)}function _(t){var e=L.convertToTensor(t,"x","softplus"),n=function(t){return{$x:function(){return t.mulStrict(e.sigmoid())}}};return D.ENV.engine.runKernel(function(t){return t.softplus(e)},{$x:e},n)}function w(t){var e=L.convertToTensor(t,"x","sin"),n=function(t){return{$x:function(){return e.toFloat().cos().mulStrict(t)}}};return D.ENV.engine.runKernel(function(t){return t.sin(e)},{$x:e},n)}function S(t){var e=L.convertToTensor(t,"x","cos"),n=function(t){return{$x:function(){return e.toFloat().sin().neg().mulStrict(t)}}};return D.ENV.engine.runKernel(function(t){return t.cos(e)},{$x:e},n)}function x(t){var e=L.convertToTensor(t,"x","tan"),n=function(t){return{$x:function(){return t.divStrict(e.cos().square())}}};return D.ENV.engine.runKernel(function(t){return t.tan(e)},{$x:e},n)}function T(t){var e=L.convertToTensor(t,"x","asin"),n=function(t){return{$x:function(){return t.divStrict(q.scalar(1).sub(e.toFloat().square()).sqrt())}}};return D.ENV.engine.runKernel(function(t){return t.asin(e)},{$x:e},n)}function P(t){var e=L.convertToTensor(t,"x","acos"),n=function(t){return{$x:function(){return t.divStrict(q.scalar(1).sub(e.toFloat().square()).sqrt()).neg()}}};return D.ENV.engine.runKernel(function(t){return t.acos(e)},{$x:e},n)}function E(t){var e=L.convertToTensor(t,"x","atan"),n=function(t){return{$x:function(){return t.divStrict(q.scalar(1).add(e.toFloat().square()))}}};return D.ENV.engine.runKernel(function(t){return t.atan(e)},{$x:e},n)}function A(t){var e=L.convertToTensor(t,"x","sinh"),n=function(t){return{$x:function(){return e.toFloat().cosh().mulStrict(t)}}};return D.ENV.engine.runKernel(function(t){return t.sinh(e)},{$x:e},n)}function N(t){var e=L.convertToTensor(t,"x","cosh"),n=function(t){return{$x:function(){return e.toFloat().sinh().mulStrict(t)}}};return D.ENV.engine.runKernel(function(t){return t.cosh(e)},{$x:e},n)}function O(t){var e=L.convertToTensor(t,"x","tanh"),n=function(t,e){var n=e[0];return{$x:function(){return q.scalar(1).sub(n.square()).mulStrict(t)}}};return D.ENV.engine.runKernel(function(t,n){return n(t.tanh(e))},{$x:e},n)}function k(t){var e=L.convertToTensor(t,"x","asinh"),n=function(t){return{$x:function(){return t.divStrict(q.scalar(1).add(e.toFloat().square()).sqrt())}}};return D.ENV.engine.runKernel(function(t){return t.asinh(e)},{$x:e},n)}function I(t){var e=L.convertToTensor(t,"x","acosh"),n=function(t){return{$x:function(){return t.divStrict(e.toFloat().square().sub(q.scalar(1)).sqrt())}}};return D.ENV.engine.runKernel(function(t){return t.acosh(e)},{$x:e},n)}function C(t){var e=L.convertToTensor(t,"x","atanh"),n=function(t){return{$x:function(){return t.divStrict(q.scalar(1).sub(e.toFloat().square()))}}};return D.ENV.engine.runKernel(function(t){return t.atanh(e)},{$x:e},n)}function M(t){var e=L.convertToTensor(t,"x","erf");F.assert("int32"===e.dtype||"float32"===e.dtype,"Input dtype must be `int32` or `float32`."),"int32"===e.dtype&&(e=e.toFloat());var n=function(t){return{$x:function(){return t.mulStrict(q.scalar(2/Math.sqrt(Math.PI)).mul(e.square().neg().exp()))}}};return D.ENV.engine.runKernel(function(t){return t.erf(e)},{$x:e},n)}function R(t,e){void 0===e&&(e=0);var n=L.convertToTensor(t,"x","step"),r=function(t){return{$x:function(){return q.zerosLike(t)}}};return D.ENV.engine.runKernel(function(t){return t.step(n,e)},{$x:n},r)}Object.defineProperty(e,"__esModule",{value:!0});var D=n(3),L=n(6),F=n(2),z=n(5),q=n(9);e.abs=z.op({abs_:y}),e.acos=z.op({acos_:P}),e.acosh=z.op({acosh_:I}),e.asin=z.op({asin_:T}),e.asinh=z.op({asinh_:k}),e.atan=z.op({atan_:E}),e.atanh=z.op({atanh_:C}),e.ceil=z.op({ceil_:i}),e.clipByValue=z.op({clipByValue_:g}),e.cos=z.op({cos_:S}),e.cosh=z.op({cosh_:N}),e.erf=z.op({erf_:M}),e.exp=z.op({exp_:u}),e.expm1=z.op({expm1_:l}),e.floor=z.op({floor_:o}),e.log=z.op({log_:c}),e.log1p=z.op({log1p_:p}),e.logSigmoid=z.op({logSigmoid_:b}),e.neg=z.op({neg_:r}),e.reciprocal=z.op({reciprocal_:m}),e.round=z.op({round_:s}),e.rsqrt=z.op({rsqrt_:f}),e.sigmoid=z.op({sigmoid_:v}),e.sign=z.op({sign_:a}),e.sin=z.op({sin_:w}),e.sinh=z.op({sinh_:A}),e.softplus=z.op({softplus_:_}),e.sqrt=z.op({sqrt_:h}),e.square=z.op({square_:d}),e.step=z.op({step_:R}),e.tan=z.op({tan_:x}),e.tanh=z.op({tanh_:O})},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{
__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e,n,r){void 0===r&&(r=null);var s=t.call(this)||this;return s.learningRate=e,s.rho=n,s.epsilon=r,s.accumulatedGrads={},s.accumulatedUpdates={},s.c=o.keep(a.scalar(-e)),s.rhoScalar=o.keep(a.scalar(n)),s.oneMinusRho=o.keep(a.scalar(1-n)),null===r&&(r=i.ENV.get("EPSILON")),s.epsilonScalar=o.keep(a.scalar(r)),s}return r(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var s=i.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){var u=!1;o.tidy(function(){e.accumulatedGrads[n]=a.zerosLike(s).variable(u)})}if(null==r.accumulatedUpdates[n]){var l=!1;o.tidy(function(){e.accumulatedUpdates[n]=a.zerosLike(s).variable(l)})}var c=t[n],p=r.accumulatedGrads[n],h=r.accumulatedUpdates[n];o.tidy(function(){var t=e.rhoScalar.mul(p).add(e.oneMinusRho.mul(c.square())),r=h.add(e.epsilonScalar).sqrt().div(p.add(e.epsilonScalar).sqrt()).mul(c),i=e.rhoScalar.mul(h).add(e.oneMinusRho.mul(r.square()));e.accumulatedGrads[n].assign(t),e.accumulatedUpdates[n].assign(i);var o=e.c.mul(r).add(s);s.assign(o)})},r=this;for(var s in t)n(s)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.rhoScalar.dispose(),this.oneMinusRho.dispose(),null!=this.accumulatedUpdates&&(Object.keys(this.accumulatedUpdates).forEach(function(e){return t.accumulatedUpdates[e].dispose()}),Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="AdadeltaOptimizer",e}(u.Optimizer);e.AdadeltaOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads={},r.c=o.keep(a.scalar(-e)),r.epsilon=o.keep(a.scalar(i.ENV.get("EPSILON"))),r}return r(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var s=i.ENV.engine.registeredVariables[n];if(null==r.accumulatedGrads[n]){var u=!1;o.tidy(function(){e.accumulatedGrads[n]=a.fill(s.shape,e.initialAccumulatorValue).variable(u)})}var l=t[n],c=r.accumulatedGrads[n];o.tidy(function(){var t=c.add(l.square());e.accumulatedGrads[n].assign(t);var r=e.c.mul(l.div(t.add(e.epsilon).sqrt())).add(s);s.assign(r)})},r=this;for(var s in t)n(s)},e.prototype.dispose=function(){var t=this;this.epsilon.dispose(),this.c.dispose(),null!=this.accumulatedGrads&&Object.keys(this.accumulatedGrads).forEach(function(e){return t.accumulatedGrads[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="AdagradOptimizer",e}(u.Optimizer);e.AdagradOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e,n,r,s){void 0===s&&(s=null);var u=t.call(this)||this;return u.learningRate=e,u.beta1=n,u.beta2=r,u.epsilon=s,u.accumulatedFirstMoment={},u.accumulatedSecondMoment={},u.c=o.keep(a.scalar(-e)),u.beta1Scalar=o.keep(a.scalar(n)),u.beta2Scalar=o.keep(a.scalar(r)),o.tidy(function(){u.accBeta1=a.scalar(n).variable(),u.accBeta2=a.scalar(r).variable()}),u.oneMinusBeta1=o.keep(a.scalar(1-n)),u.oneMinusBeta2=o.keep(a.scalar(1-r)),u.one=o.keep(a.scalar(1)),null===s&&(s=i.ENV.get("EPSILON")),u.epsScalar=o.keep(a.scalar(s)),u}return r(e,t),e.prototype.applyGradients=function(t){var e=this;o.tidy(function(){var n=e.one.sub(e.accBeta1),r=e.one.sub(e.accBeta2);for(var o in t){var s=i.ENV.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var u=!1;e.accumulatedFirstMoment[o]=a.zerosLike(s).variable(u)}if(null==e.accumulatedSecondMoment[o]){var u=!1;e.accumulatedSecondMoment[o]=a.zerosLike(s).variable(u)}var l=t[o],c=e.accumulatedFirstMoment[o],p=e.accumulatedSecondMoment[o],h=e.beta1Scalar.mul(c).add(e.oneMinusBeta1.mul(l)),f=e.beta2Scalar.mul(p).add(e.oneMinusBeta2.mul(l.square())),d=h.div(n),m=f.div(r);e.accumulatedFirstMoment[o].assign(h),e.accumulatedSecondMoment[o].assign(f);var y=e.c.mul(d.div(e.epsScalar.add(m.sqrt()))).add(s);s.assign(y)}e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar)),e.accBeta2.assign(e.accBeta2.mul(e.beta2Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.accBeta1.dispose(),this.accBeta2.dispose(),this.oneMinusBeta1.dispose(),this.oneMinusBeta2.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedSecondMoment&&Object.keys(this.accumulatedSecondMoment).forEach(function(e){return t.accumulatedSecondMoment[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="AdamOptimizer",e}(u.Optimizer);e.AdamOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e,n,r,s,u){void 0===s&&(s=null),void 0===u&&(u=0);var l=t.call(this)||this;return l.learningRate=e,l.beta1=n,l.beta2=r,l.epsilon=s,l.decay=u,l.accumulatedFirstMoment={},l.accumulatedWeightedInfNorm={},l.c=o.keep(a.scalar(-e)),l.beta1Scalar=o.keep(a.scalar(n)),l.beta2Scalar=o.keep(a.scalar(r)),l.decayScalar=o.keep(a.scalar(u)),o.tidy(function(){l.iteration=a.scalar(0).variable(),l.accBeta1=a.scalar(n).variable()}),l.oneMinusBeta1=o.keep(a.scalar(1-n)),l.one=o.keep(a.scalar(1)),null===s&&(s=i.ENV.get("EPSILON")),l.epsScalar=o.keep(a.scalar(s)),l}return r(e,t),e.prototype.applyGradients=function(t){var e=this;o.tidy(function(){var n=e.one.sub(e.accBeta1),r=e.c.div(e.one.add(e.decayScalar.mul(e.iteration)));for(var o in t){var s=i.ENV.engine.registeredVariables[o];if(null==e.accumulatedFirstMoment[o]){var u=!1;e.accumulatedFirstMoment[o]=a.zerosLike(s).variable(u)}if(null==e.accumulatedWeightedInfNorm[o]){var u=!1;e.accumulatedWeightedInfNorm[o]=a.zerosLike(s).variable(u)}var l=t[o],c=e.accumulatedFirstMoment[o],p=e.accumulatedWeightedInfNorm[o],h=e.beta1Scalar.mul(c).add(e.oneMinusBeta1.mul(l)),f=e.beta2Scalar.mul(p),d=l.abs(),m=f.maximum(d);e.accumulatedFirstMoment[o].assign(h),e.accumulatedWeightedInfNorm[o].assign(m);var y=r.div(n).mul(h.div(e.epsScalar.add(m))).add(s);s.assign(y)}e.iteration.assign(e.iteration.add(e.one)),e.accBeta1.assign(e.accBeta1.mul(e.beta1Scalar))})},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsScalar.dispose(),this.accBeta1.dispose(),this.beta1Scalar.dispose(),this.beta2Scalar.dispose(),this.oneMinusBeta1.dispose(),this.decayScalar.dispose(),this.iteration.dispose(),this.one.dispose(),null!=this.accumulatedFirstMoment&&Object.keys(this.accumulatedFirstMoment).forEach(function(e){return t.accumulatedFirstMoment[e].dispose()}),null!=this.accumulatedWeightedInfNorm&&Object.keys(this.accumulatedWeightedInfNorm).forEach(function(e){return t.accumulatedWeightedInfNorm[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="AdamaxOptimizer",e}(u.Optimizer);e.AdamaxOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(59),l=function(t){function e(e,n,r){void 0===r&&(r=!1);var i=t.call(this,e)||this;return i.learningRate=e,i.momentum=n,i.useNesterov=r,i.m=a.scalar(i.momentum),i.accumulations={},i}return r(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var s=i.ENV.engine.registeredVariables[n];if(null==r.accumulations[n]){var u=!1;o.tidy(function(){e.accumulations[n]=a.zerosLike(s).variable(u)})}var l=r.accumulations[n],c=t[n];o.tidy(function(){var t,r=e.m.mul(l).add(c);t=e.useNesterov?e.c.mul(c.add(r.mul(e.m))).add(s):e.c.mul(r).add(s),e.accumulations[n].assign(r),s.assign(t)})},r=this;for(var s in t)n(s)},e.prototype.dispose=function(){if(t.prototype.dispose.call(this),this.m.dispose(),null!=this.accumulations)for(var e in this.accumulations)this.accumulations[e].dispose()},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="MomentumOptimizer",e}(u.SGDOptimizer);e.MomentumOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(17),a=n(22),s=n(26),u=n(34),l=function(t){function e(e,n,r,s,u){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===s&&(s=null),void 0===u&&(u=!1);var l=t.call(this)||this;return l.learningRate=e,l.decay=n,l.momentum=r,l.epsilon=s,l.accumulatedMeanSquares={},l.accumulatedMeanGrads={},l.accumulatedMoments={},l.c=o.keep(a.scalar(e)),l.decayScalar=o.keep(a.scalar(n)),l.momentumScalar=o.keep(a.scalar(r)),l.oneMinusDecay=o.keep(a.scalar(1-n)),l.centered=u,null===s&&(s=i.ENV.get("EPSILON")),l.epsilonScalar=o.keep(a.scalar(s)),l}return r(e,t),e.prototype.applyGradients=function(t){var e=this,n=function(n){var s=i.ENV.engine.registeredVariables[n];if(null==r.accumulatedMeanSquares[n]){var u=!1;o.tidy(function(){e.accumulatedMeanSquares[n]=a.zerosLike(s).variable(u)})}if(null==r.accumulatedMeanGrads[n]&&r.centered){var l=!1;o.tidy(function(){e.accumulatedMeanGrads[n]=a.zerosLike(s).variable(l)})}if(null==r.accumulatedMoments[n]){var c=!1;o.tidy(function(){e.accumulatedMoments[n]=a.zerosLike(s).variable(c)})}var p=r.accumulatedMeanSquares[n],h=r.accumulatedMeanGrads[n],f=r.accumulatedMoments[n],d=t[n];o.tidy(function(){var t=e.decayScalar.mul(p).add(e.oneMinusDecay.mul(d.square()));if(e.centered){var r=e.decayScalar.mul(h).add(e.oneMinusDecay.mul(d)),i=e.momentumScalar.mul(f).add(e.c.mul(d).div(t.sub(r.square().add(e.epsilonScalar)).sqrt()));e.accumulatedMeanSquares[n].assign(t),e.accumulatedMeanGrads[n].assign(r),e.accumulatedMoments[n].assign(i);var o=s.sub(i);s.assign(o)}else{var a=e.decayScalar.mul(p).add(e.oneMinusDecay.mul(d.square())),i=e.momentumScalar.mul(f).add(e.c.mul(d).div(a.add(e.epsilonScalar).sqrt()));e.accumulatedMeanSquares[n].assign(a),e.accumulatedMoments[n].assign(i);var o=s.sub(i);s.assign(o)}})},r=this;for(var s in t)n(s)},e.prototype.dispose=function(){var t=this;this.c.dispose(),this.epsilonScalar.dispose(),this.decayScalar.dispose(),this.momentumScalar.dispose(),this.oneMinusDecay.dispose(),null!=this.accumulatedMeanSquares&&Object.keys(this.accumulatedMeanSquares).forEach(function(e){return t.accumulatedMeanSquares[e].dispose()}),null!=this.accumulatedMeanGrads&&this.centered&&Object.keys(this.accumulatedMeanGrads).forEach(function(e){return t.accumulatedMeanGrads[e].dispose()}),null!=this.accumulatedMoments&&Object.keys(this.accumulatedMoments).forEach(function(e){return t.accumulatedMoments[e].dispose()})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSPropOptimizer",e}(u.Optimizer);e.RMSPropOptimizer=l,s.registerClass(l)},function(t,e,n){"use strict";function r(t,e){return c.tidy(function(){return d.checkDataFormat(e),"channelsFirst"===e?l.transpose(t,[0,2,3,1]):t})}function i(t,e,n,r,i,o,a){return void 0===r&&(r=1),void 0===i&&(i="valid"),void 0===a&&(a=1),c.tidy(function(){if(null==o&&(o=h.imageDataFormat()),d.checkDataFormat(o),3!==t.shape.length)throw new g.ValueError("The input of a conv1dWithBias operation should be 3, but is "+(t.shape.length+" instead."));if(3!==e.shape.length)throw new g.ValueError("The kernel for a conv1dWithBias operation should be 3, but is "+(e.shape.length+" instead"));if(null!=n&&1!==n.shape.length)throw new g.ValueError("The bias for a conv1dWithBias operation should be 1, but is "+(e.shape.length+" instead"));if("channelsFirst"===o&&(t=l.transpose(t,[0,2,1])),"causal"===i)throw new g.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=l.conv1d(t,e,r,"same"===i?"same":"valid","NWC",a);return null!=n&&(s=f.biasAdd(s,n)),s})}function o(t,e,n,r,o,a){return void 0===n&&(n=1),void 0===r&&(r="valid"),void 0===a&&(a=1),c.tidy(function(){return d.checkDataFormat(o),i(t,e,null,n,r,o,a)})}function a(t,e,n,r,i,o){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),c.tidy(function(){return d.checkDataFormat(i),s(t,e,null,n,r,i,o)})}function s(t,e,n,i,o,a,s){return void 0===i&&(i=[1,1]),void 0===o&&(o="valid"),c.tidy(function(){if(null==a&&(a=h.imageDataFormat()),d.checkDataFormat(a),3!==t.rank&&4!==t.rank)throw new g.ValueError("conv2dWithBias expects input to be of rank 3 or 4, but received "+(t.rank+"."));if(3!==e.rank&&4!==e.rank)throw new g.ValueError("conv2dWithBias expects kernel to be of rank 3 or 4, but received "+(t.rank+"."));var u=r(t,a);if("causal"===o)throw new g.NotImplementedError("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=l.conv2d(u,e,i,"same"===o?"same":"valid","NHWC",s),null!=n&&(u=f.biasAdd(u,n)),"channelsFirst"===a&&(u=l.transpose(u,[0,3,1,2])),u})}var u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var l=n(1),c=n(1),p=n(61),h=n(29),f=n(13),d=n(27),m=n(35),y=n(12),g=n(7),v=n(36),b=n(30),_=n(96),w=n(10),S=n(16);e.preprocessConv2DInput=r,e.conv1dWithBias=i,e.conv1d=o,e.conv2d=a,e.conv2dWithBias=s;var x=function(t){function e(n,r){var i=t.call(this,r)||this;if(i.bias=null,i.DEFAULT_KERNEL_INITIALIZER="glorotNormal",i.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyConfig(r),i.rank=n,1!==i.rank&&2!==i.rank)throw new g.NotImplementedError("Convolution layer for rank other than 1 or 2 ("+i.rank+") is not implemented yet.");if(i.kernelSize=_.normalizeArray(r.kernelSize,n,"kernelSize"),i.strides=_.normalizeArray(null==r.strides?1:r.strides,n,"strides"),i.padding=null==r.padding?"valid":r.padding,d.checkPaddingMode(i.padding),i.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,d.checkDataFormat(i.dataFormat),i.activation=p.getActivation(r.activation),i.useBias=null==r.useBias||r.useBias,i.biasInitializer=v.getInitializer(r.biasInitializer||i.DEFAULT_BIAS_INITIALIZER),i.biasConstraint=m.getConstraint(r.biasConstraint),i.biasRegularizer=b.getRegularizer(r.biasRegularizer),i.activityRegularizer=b.getRegularizer(r.activityRegularizer),i.dilationRate=_.normalizeArray(null==r.dilationRate?1:r.dilationRate,n,"dilationRate"),1===i.rank&&Array.isArray(i.dilationRate)&&1!==i.dilationRate.length)throw new g.ValueError("dilationRate must be a number or an array of a single number for 1D convolution, but received "+JSON.stringify(i.dilationRate));if(2===i.rank)if("number"==typeof i.dilationRate)i.dilationRate=[i.dilationRate,i.dilationRate];else if(2!==i.dilationRate.length)throw new g.ValueError("dilationRate must be a number or array of two numbers for 2D convolution, but received "+JSON.stringify(i.dilationRate));return i}return u(e,t),e.verifyConfig=function(t){if(w.assert("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!=typeof t.kernelSize&&!w.checkArrayTypeAndLength(t.kernelSize,"number",1,2))throw new g.ValueError("BaseConv expects config.kernelSize to be number or number[] with "+("length 1 or 2, but received "+JSON.stringify(t.kernelSize)+"."))},e.prototype.getConfig=function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:p.serializeActivation(this.activation),useBias:this.useBias,biasInitializer:v.serializeInitializer(this.biasInitializer),biasRegularizer:b.serializeRegularizer(this.biasRegularizer),activityRegularizer:b.serializeRegularizer(this.activityRegularizer),biasConstraint:m.serializeConstraint(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(y.Layer);e.BaseConv=x;var T=function(t){function e(n,r){var i=t.call(this,n,r)||this;return i.kernel=null,e.verifyConfig(r),i.filters=r.filters,i.kernelInitializer=v.getInitializer(r.kernelInitializer||i.DEFAULT_KERNEL_INITIALIZER),i.kernelConstraint=m.getConstraint(r.kernelConstraint),i.kernelRegularizer=b.getRegularizer(r.kernelRegularizer),i}return u(e,t),e.prototype.build=function(t){t=S.getExactlyOneShape(t);var e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new g.ValueError("The channel dimension of the input should be defined. Found "+t[e]);var n=t[e],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(i={},i[e]=n,i)}],this.built=!0;var i},e.prototype.call=function(t,e){var n=this;return c.tidy(function(){t=S.getExactlyOneTensor(t);var e,r=null==n.bias?null:n.bias.read();if(1===n.rank)e=i(t,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)e=s(t,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else if(3===n.rank)throw new g.NotImplementedError("3D convolution is not implemented yet.");return null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=S.getExactlyOneShape(t);for(var e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2),r=0;r<n.length;++r){var i=_.convOutputLength(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);e.push(i)}var o=[t[0]];return"channelsLast"===this.dataFormat?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o},e.prototype.getConfig=function(){var e={filters:this.filters,kernelInitializer:v.serializeInitializer(this.kernelInitializer),kernelRegularizer:b.serializeRegularizer(this.kernelRegularizer),kernelConstraint:m.serializeConstraint(this.kernelConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.verifyConfig=function(t){if(!("filters"in t)||"number"!=typeof t.filters||t.filters<1)throw new g.ValueError("Convolution layer expected config.filters to be a 'number' > 0 but got "+JSON.stringify(t.filters))},e}(x);e.Conv=T;var P=function(t){function e(n){var r=t.call(this,2,n)||this;return e.verifyConfig(n),r}return u(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,e},e.verifyConfig=function(t){if("number"!=typeof t.kernelSize&&!w.checkArrayTypeAndLength(t.kernelSize,"number",1,2))throw new g.ValueError("Conv2D expects config.kernelSize to be number or number[] with "+("length 1 or 2, but received "+JSON.stringify(t.kernelSize)+"."))},e.className="Conv2D",e}(T);e.Conv2D=P,c.serialization.registerClass(P);var E=function(t){function e(e){var n=t.call(this,e)||this;if(n.inputSpec=[new y.InputSpec({ndim:4})],"same"!==n.padding&&"valid"!==n.padding)throw new g.ValueError("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode "+n.padding);return n}return u(e,t),e.prototype.build=function(t){if(t=S.getExactlyOneShape(t),4!==t.length)throw new g.ValueError("Input should have rank 4; Received input shape: "+JSON.stringify(t));var e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new g.ValueError("The channel dimension of the inputs should be defined. Found `None`.");var n=t[e],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new y.InputSpec({ndim:4,axes:(i={},i[e]=n,i)})],this.built=!0;var i},e.prototype.call=function(t,e){var n=this;return l.tidy(function(){var e=S.getExactlyOneTensor(t);if(4!==e.shape.length)throw new g.ValueError("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-"+e.shape.length);var r,i,o=e.shape,a=o[0];"channelsFirst"===n.dataFormat?(r=2,i=3):(r=1,i=2);var s=o[r],u=o[i],c=n.kernelSize[0],p=n.kernelSize[1],h=n.strides[0],d=n.strides[1],m=_.deconvLength(s,h,c,n.padding),y=_.deconvLength(u,d,p,n.padding),v=[a,m,y,n.filters];"channelsLast"!==n.dataFormat&&(e=l.transpose(e,[0,2,3,1]));var b=l.conv2dTranspose(e,n.kernel.read(),v,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(b=l.transpose(b,[0,3,1,2])),null!=n.bias&&(b=f.biasAdd(b,n.bias.read(),n.dataFormat)),null!=n.activation&&(b=n.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=S.getExactlyOneShape(t);var e,n,r,i=t.slice();"channelsFirst"===this.dataFormat?(e=1,n=2,r=3):(e=3,n=1,r=2);var o=this.kernelSize[0],a=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return i[e]=this.filters,i[n]=_.deconvLength(i[n],s,o,this.padding),i[r]=_.deconvLength(i[r],u,a,this.padding),i},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.dilationRate,e},e.className="Conv2DTranspose",e}(P);e.Conv2DTranspose=E,c.serialization.registerClass(E);var A=function(t){function e(e,n){var r=t.call(this,e,n)||this;if(r.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",r.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",r.depthwiseKernel=null,r.pointwiseKernel=null,null==n.filters)throw new g.ValueError("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=n.kernelInitializer||null!=n.kernelRegularizer||null!=n.kernelConstraint)throw new g.ValueError("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=n.padding&&"same"!==n.padding&&"valid"!==n.padding)throw new g.ValueError("SeparableConv"+r.rank+"D supports only padding modes: 'same' and 'valid', but received "+JSON.stringify(n.padding));return r.depthMultiplier=null==n.depthMultiplier?1:n.depthMultiplier,r.depthwiseInitializer=v.getInitializer(n.depthwiseInitializer||r.DEFAULT_DEPTHWISE_INITIALIZER),r.depthwiseRegularizer=b.getRegularizer(n.depthwiseRegularizer),r.depthwiseConstraint=m.getConstraint(n.depthwiseConstraint),r.pointwiseInitializer=v.getInitializer(n.depthwiseInitializer||r.DEFAULT_POINTWISE_INITIALIZER),r.pointwiseRegularizer=b.getRegularizer(n.pointwiseRegularizer),r.pointwiseConstraint=m.getConstraint(n.pointwiseConstraint),r}return u(e,t),e.prototype.build=function(t){if(t=S.getExactlyOneShape(t),t.length<this.rank+2)throw new g.ValueError("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2+", but received input shape: ")+(""+JSON.stringify(t)));var e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new g.ValueError("The channel dimension of the inputs should be defined, but found "+JSON.stringify(t[e]));for(var n=t[e],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[],o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);var a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new y.InputSpec({ndim:this.rank+2,axes:(s={},s[e]=n,s)})],this.built=!0;var s},e.prototype.call=function(t,e){var n=this;return c.tidy(function(){t=S.getExactlyOneTensor(t);var e;if(1===n.rank)throw new g.NotImplementedError("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(t=l.transpose(t,[0,2,3,1])),e=l.separableConv2d(t,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(e=f.biasAdd(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),"channelsFirst"===n.dataFormat&&(e=l.transpose(e,[0,3,1,2])),e})},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=v.serializeInitializer(this.depthwiseInitializer),e.pointwiseInitializer=v.serializeInitializer(this.pointwiseInitializer),e.depthwiseRegularizer=b.serializeRegularizer(this.depthwiseRegularizer),e.pointwiseRegularizer=b.serializeRegularizer(this.pointwiseRegularizer),e.depthwiseConstraint=m.serializeConstraint(this.depthwiseConstraint),e.pointwiseConstraint=m.serializeConstraint(this.pointwiseConstraint),e},e.className="SeparableConv",e}(T);e.SeparableConv=A;var N=function(t){function e(e){return t.call(this,2,e)||this}return u(e,t),e.className="SeparableConv2D",e}(A);e.SeparableConv2D=N,c.serialization.registerClass(N);var O=function(t){function e(n){var r=t.call(this,1,n)||this;return e.verifyConfig(n),r.inputSpec=[{ndim:3}],r}return u(e,t),e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return delete e.rank,delete e.dataFormat,e},e.verifyConfig=function(t){if("number"!=typeof t.kernelSize&&!w.checkArrayTypeAndLength(t.kernelSize,"number",1,1))throw new g.ValueError("Conv1D expects config.kernelSize to be number or number[] with "+("length 1, but received "+JSON.stringify(t.kernelSize)+"."))},e.className="Conv1D",e}(T);e.Conv1D=O,c.serialization.registerClass(O);var k=function(t){function e(e){var n=t.call(this,e)||this;return"number"==typeof e.cropping?n.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?n.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:n.cropping=e.cropping,n.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,n.inputSpec=[{ndim:4}],n}return u(e,t),e.prototype.computeOutputShape=function(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,e){var n=this;return c.tidy(function(){if(t=S.getExactlyOneTensor(t),"channelsLast"===n.dataFormat){var e=f.sliceAlongAxis(t,n.cropping[0][0],t.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return f.sliceAlongAxis(e,n.cropping[1][0],t.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var e=f.sliceAlongAxis(t,n.cropping[0][0],t.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return f.sliceAlongAxis(e,n.cropping[1][0],t.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)})},e.prototype.getConfig=function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Cropping2D",e}(y.Layer);e.Cropping2D=k,c.serialization.registerClass(k);var I=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=null==e.size?n.DEFAULT_SIZE:e.size,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,n}return u(e,t),e.prototype.computeOutputShape=function(t){if("channelsFirst"===this.dataFormat){var e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}var e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return l.tidy(function(){var e=S.getExactlyOneTensor(t),r=e.shape;if("channelsFirst"===n.dataFormat){e=l.transpose(e,[0,2,3,1]);var i=n.size[0]*r[2],o=n.size[1]*r[3],a=e.resizeNearestNeighbor([i,o]);return l.transpose(a,[0,3,1,2])}var i=n.size[0]*r[1],o=n.size[1]*r[2];return e.resizeNearestNeighbor([i,o])})},e.prototype.getConfig=function(){var e={size:this.size,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="UpSampling2D",e}(y.Layer);e.UpSampling2D=I,c.serialization.registerClass(I)},function(t,e,n){"use strict";function r(t,e,n,r){function i(t){return null==t||Array.isArray(t)?t:[t]}if(Array.isArray(t)){if(null!=e||null!=n)throw new m.ValueError("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}return e=i(e),n=i(n),{inputs:t,initialState:e,constants:n}}function i(t,e,n,r,i,o,a,u){void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===u&&(u=!1);var l=e.shape.length;if(l<3)throw new m.ValueError("Input should be at least 3D, but is "+l+"D.");var c=[1,0].concat(v.range(2,l));if(e=s.transpose(e,c),null!=i)throw new m.NotImplementedError("The rnn() function of the deeplearn.js backend does not support masking yet.");if(null!=o)throw new m.NotImplementedError("The rnn() functoin of the deeplearn.js backend does not support constants yet.");
a&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r&&(e=s.reverse(e,0));for(var h,f,d=n,y=e.shape[0],g=function(n){var r=p.sliceAlongFirstAxis(e,n,1);r=r.reshape(r.shape.slice(1));var i=s.tidy(function(){return t(r,d)});if(f=i[0],u)if(0===n)h=f.expandDims(1);else{var o=s.concat([h,f.expandDims(1)],1);h.dispose(),h=o}d=i[1]},b=0;b<y;++b)g(b);return[f,h,d]}function o(t,e,n,r){function i(){return p.dropout(t(),c.getScalar(e))}if(void 0===n&&(n=null),void 0===r&&(r=1),r>1){for(var o=[],a=0;a<r;a++)o.push(p.inTrainPhase(i,t,n));return o.forEach(function(t){return s.keep(t)}),o}return s.keep(p.inTrainPhase(i,t,n))}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(1),l=n(61),c=n(8),p=n(13),h=n(35),f=n(12),d=n(12),m=n(7),y=n(36),g=n(30),v=n(28),b=n(16),_=n(64),w=n(63);e.standardizeArgs=r,e.rnn=i;var S=function(t){function e(e){var n,r=t.call(this,e)||this;if(null==e.cell)throw new m.ValueError("cell property is missing for the constructor of RNN.");if(n=Array.isArray(e.cell)?new k({cells:e.cell}):e.cell,null==n.stateSize)throw new m.ValueError("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=n,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new f.InputSpec({ndim:3})],r.stateSpec=null,r.states=null,r.numConstants=null,r.keptStates=[],r}return a(e,t),e.prototype.getStates=function(){if(null==this.states){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return v.range(0,t).map(function(t){return null})}return this.states},e.prototype.setStates=function(t){this.states=t},e.prototype.computeOutputShape=function(t){b.isArrayOfShapes(t)&&(t=t[0]),t=t;var e=this.cell.stateSize;Array.isArray(e)||(e=[e]);var n,r=e[0];if(n=this.returnSequences?[t[0],t[1],r]:[t[0],r],this.returnState){for(var i=[],o=0,a=e;o<a.length;o++){var s=a[o];i.push([t[0],s])}return[n].concat(i)}return n},e.prototype.computeMask=function(t,e){throw new m.NotImplementedError("computeMask has not been implemented for RNN yet")},e.prototype.build=function(t){var e=null;if(null!=this.numConstants)throw new m.NotImplementedError("Constants support is not implemented in RNN yet.");b.isArrayOfShapes(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,r=t[t.length-1];this.inputSpec[0]=new f.InputSpec({shape:[n,null,r]});var i=[t[0]].concat(t.slice(2));if(null!=e)throw new m.NotImplementedError("Constants support is not implemented in RNN yet.");this.cell.build(i);var o;if(o=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!u.util.arraysEqual(this.stateSpec.map(function(t){return t.shape[t.shape.length-1]}),o))throw new m.ValueError("An initialState was passed that is not compatible with "+("cell.stateSize. Received stateSpec="+this.stateSpec+"; ")+("However cell.stateSize is "+this.cell.stateSize))}else this.stateSpec=o.map(function(t){return new f.InputSpec({shape:[null,t]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,e){var n=this;void 0===e&&(e=!1),u.tidy(function(){if(!n.stateful)throw new m.AttributeError("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=n.inputSpec[0].shape[0];if(null==r)throw new m.ValueError("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==n.states)Array.isArray(n.cell.stateSize)?n.states=n.cell.stateSize.map(function(t){return s.zeros([r,t])}):n.states=[s.zeros([r,n.cell.stateSize])];else if(null==t)s.dispose(n.states),null!=n.keptStates&&(s.dispose(n.keptStates),n.keptStates=[]),Array.isArray(n.cell.stateSize)?n.states=n.cell.stateSize.map(function(t){return s.zeros([r,t])}):n.states[0]=s.zeros([r,n.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==n.states.length)throw new m.ValueError("Layer "+n.name+" expects "+n.states.length+" state(s), "+("but it received "+t.length+" state value(s). Input ")+("received: "+t));e===!0?n.keptStates.push(n.states.slice()):s.dispose(n.states);for(var i=0;i<n.states.length;++i){var o=t[i],a=Array.isArray(n.cell.stateSize)?n.cell.stateSize[i]:n.cell.stateSize,l=[r,a];if(!u.util.arraysEqual(o.shape,l))throw new m.ValueError("State "+i+" is incompatible with layer "+n.name+": "+("expected shape="+l+", received shape="+o.shape));n.states[i]=o}}n.states.forEach(function(t){return s.keep(t)})})},e.prototype.apply=function(e,n){var i=null==n?null:n.initialState,o=null==n?null:n.constants;null==n&&(n={});var a=r(e,i,o,this.numConstants);e=a.inputs,i=a.initialState,o=a.constants;var s=[],u=[];if(null!=i){n.initialState=i,s=s.concat(i),this.stateSpec=[];for(var l=0,c=i;l<c.length;l++){var p=c[l];this.stateSpec.push(new f.InputSpec({shape:p.shape}))}u=u.concat(this.stateSpec)}null!=o&&(n.constants=o,s=s.concat(o),this.numConstants=o.length);var h=s[0]instanceof f.SymbolicTensor;if(h){var d=[e].concat(s),m=this.inputSpec.concat(u),y=this.inputSpec;this.inputSpec=m;var g=t.prototype.apply.call(this,d,n);return this.inputSpec=y,g}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){var r=null==e?null:e.mask,o=null==e?null:e.training,a=null==e?null:e.initialState;if(t=b.getExactlyOneTensor(t),null==a&&(a=n.stateful?n.states:n.getInitialState(t)),null!=r)throw new m.NotImplementedError("Masking is not implemented for RNN yet");var s=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(a.length!==s)throw new m.ValueError("RNN Layer has "+s+" state(s) but was passed "+(a.length+" initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var u={training:o},l=function(t,e){var r=n.cell.call([t].concat(e),u);return[r[0],r.slice(1)]},c=i(l,t,a,n.goBackwards,null,null,n.unroll,n.returnSequences),p=c[0],h=c[1],f=c[2];n.stateful&&n.resetStates(f,o);var d=n.returnSequences?h:p;return n.returnState?[d].concat(f):d})},e.prototype.getInitialState=function(t){var e=this;return u.tidy(function(){var n=s.zeros(t.shape);return n=s.sum(n,[1,2]),n=p.expandDims(n),Array.isArray(e.cell.stateSize)?e.cell.stateSize.map(function(t){return t>1?p.tile(n,[1,t]):n}):e.cell.stateSize>1?[p.tile(n,[1,e.cell.stateSize])]:[n]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e.numConstants=this.numConstants);var n=this.cell.getConfig();e.cell={className:this.cell.getClassName(),config:n};var r=t.prototype.getConfig.call(this);return Object.assign(e,r),e},e.className="RNN",e}(d.Layer);e.RNN=S,u.serialization.registerClass(S);var x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e}(d.Layer);e.RNNCell=x;var T=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=l.getActivation(null==e.activation?n.DEFAULT_ACTIVATION:e.activation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=y.getInitializer(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=y.getInitializer(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=y.getInitializer(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=g.getRegularizer(e.kernelRegularizer),n.recurrentRegularizer=g.getRegularizer(e.recurrentRegularizer),n.biasRegularizer=g.getRegularizer(e.biasRegularizer),n.kernelConstraint=h.getConstraint(e.kernelConstraint),n.recurrentConstraint=h.getConstraint(e.recurrentConstraint),n.biasConstraint=h.getConstraint(e.biasConstraint),n.dropout=v.min([1,v.max([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=v.min([1,v.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(e,t),e.prototype.build=function(t){t=b.getExactlyOneShape(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){if(t=t,2!==t.length)throw new m.ValueError("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var r=t[1];t=t[0];var i=null!=e.training&&e.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=o(function(){return s.onesLike(t)},n.dropout,i)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=o(function(){return s.onesLike(r)},n.recurrentDropout,i));var a,u=n.dropoutMask,l=n.recurrentDropoutMask;a=null!=u?p.dot(s.mul(t,u),n.kernel.read()):p.dot(t,n.kernel.read()),null!=n.bias&&(a=p.biasAdd(a,n.bias.read())),null!=l&&(r=s.mul(r,l));var c=s.add(a,p.dot(r,n.recurrentKernel.read()));return null!=n.activation&&(c=n.activation.apply(c)),[c,c]})},e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="SimpleRNNCell",e}(x);e.SimpleRNNCell=T,u.serialization.registerClass(T);var P=function(t){function e(e){var n=this;return e.cell=new T(e),n=t.call(this,e)||this}return a(e,t),e.prototype.call=function(e,n){var r=this;return u.tidy(function(){null!=r.cell.dropoutMask&&(s.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(s.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.className="SimpleRNN",e}(S);e.SimpleRNN=P,u.serialization.registerClass(P);var E=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=l.getActivation(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=l.getActivation(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=y.getInitializer(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=y.getInitializer(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=y.getInitializer(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=g.getRegularizer(e.kernelRegularizer),n.recurrentRegularizer=g.getRegularizer(e.recurrentRegularizer),n.biasRegularizer=g.getRegularizer(e.biasRegularizer),n.kernelConstraint=h.getConstraint(e.kernelConstraint),n.recurrentConstraint=h.getConstraint(e.recurrentConstraint),n.biasConstraint=h.getConstraint(e.biasConstraint),n.dropout=v.min([1,v.max([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=v.min([1,v.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(e,t),e.prototype.build=function(t){t=b.getExactlyOneShape(t);var e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){if(t=t,2!==t.length)throw new m.ValueError("GRUCell expects 2 input Tensors (inputs, h, c), got "+(t.length+"."));var r=null!=e.training&&e.training,i=t[1];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=o(function(){return s.onesLike(t)},n.dropout,r,3)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=o(function(){return s.onesLike(i)},n.recurrentDropout,r,3));var a,u,l,h=n.dropoutMask,f=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=s.mul(t,h[0]));var d=p.dot(t,n.kernel.read());n.useBias&&(d=p.biasAdd(d,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(i=s.mul(i,f[0]));var y=n.recurrentKernel.read(),g=s.split(y,[2*n.units,n.units],y.rank-1),v=g[0],b=g[1],_=p.dot(i,v),w=s.split(d,3,d.rank-1),S=w[0],x=w[1],T=w[2],P=s.split(_,2,_.rank-1),E=P[0],A=P[1];a=n.recurrentActivation.apply(s.add(S,E)),u=n.recurrentActivation.apply(s.add(x,A));var N=p.dot(s.mul(u,i),b);l=n.activation.apply(s.add(T,N));var O=s.add(s.mul(a,i),s.mul(s.add(c.getScalar(1),s.neg(a)),l));return[O,O]})},e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),recurrentActivation:l.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="GRUCell",e}(x);e.GRUCell=E,u.serialization.registerClass(E);var A=function(t){function e(e){var n=this;return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new E(e),n=t.call(this,e)||this}return a(e,t),e.prototype.call=function(e,n){var r=this;return u.tidy(function(){null!=r.cell.dropoutMask&&(s.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(s.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),recurrentActivation:l.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="GRU",e}(S);e.GRU=A,u.serialization.registerClass(A);var N=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=e.units,n.activation=l.getActivation(void 0===e.activation?n.DEFAULT_ACTIVATION:e.activation),n.recurrentActivation=l.getActivation(void 0===e.recurrentActivation?n.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),n.useBias=null==e.useBias||e.useBias,n.kernelInitializer=y.getInitializer(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=y.getInitializer(e.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=y.getInitializer(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=e.unitForgetBias,n.kernelRegularizer=g.getRegularizer(e.kernelRegularizer),n.recurrentRegularizer=g.getRegularizer(e.recurrentRegularizer),n.biasRegularizer=g.getRegularizer(e.biasRegularizer),n.kernelConstraint=h.getConstraint(e.kernelConstraint),n.recurrentConstraint=h.getConstraint(e.recurrentConstraint),n.biasConstraint=h.getConstraint(e.biasConstraint),n.dropout=v.min([1,v.max([0,null==e.dropout?0:e.dropout])]),n.recurrentDropout=v.min([1,v.max([0,null==e.recurrentDropout?0:e.recurrentDropout])]),n.implementation=e.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return a(e,t),e.prototype.build=function(t){t=b.getExactlyOneShape(t);var e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var n;if(this.useBias){if(this.unitForgetBias){var r=this.biasInitializer,i=this.units;n=new(o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.apply=function(t,e){var n=r.apply([i]),o=(new y.Ones).apply([i]),a=r.apply([2*i]);return p.concatAlongFirstAxis(p.concatAlongFirstAxis(n,o),a)},e}(y.Initializer),o.className="CustomInit",o)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0;var o},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){var r=null!=e.training&&e.training;if(t=t,3!==t.length)throw new m.ValueError("LSTMCell expects 3 input Tensors (inputs, h, c), got "+(t.length+"."));var i=t[1],a=t[2];t=t[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=o(function(){return s.onesLike(t)},n.dropout,r,4)),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=o(function(){return s.onesLike(i)},n.recurrentDropout,r,4));var u,l,c,h,f=n.dropoutMask,d=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(t=s.mul(t,f[0]));var y=p.dot(t,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(i=s.mul(i,d[0])),y=s.add(y,p.dot(i,n.recurrentKernel.read())),n.useBias&&(y=p.biasAdd(y,n.bias.read()));var g=s.split(y,4,y.rank-1),v=g[0],b=g[1],_=g[2],w=g[3];u=n.recurrentActivation.apply(v),l=n.recurrentActivation.apply(b),c=s.add(s.mul(l,a),s.mul(u,n.activation.apply(_))),h=n.recurrentActivation.apply(w);var S=s.mul(h,n.activation.apply(c));return[S,S,c]})},e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),recurrentActivation:l.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LSTMCell",e}(x);e.LSTMCell=N,u.serialization.registerClass(N);var O=function(t){function e(e){var n=this;return 0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new N(e),n=t.call(this,e)||this}return a(e,t),e.prototype.call=function(e,n){var r=this;return u.tidy(function(){null!=r.cell.dropoutMask&&(s.dispose(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(s.dispose(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var i=null==n?null:n.mask,o=null==n?null:n.training,a=null==n?null:n.initialState;return t.prototype.call.call(r,e,{mask:i,training:o,initialState:a})})},Object.defineProperty(e.prototype,"units",{get:function(){return this.cell.units},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activation",{get:function(){return this.cell.activation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentActivation",{get:function(){return this.cell.recurrentActivation},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useBias",{get:function(){return this.cell.useBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelInitializer",{get:function(){return this.cell.kernelInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentInitializer",{get:function(){return this.cell.recurrentInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasInitializer",{get:function(){return this.cell.biasInitializer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unitForgetBias",{get:function(){return this.cell.unitForgetBias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelRegularizer",{get:function(){return this.cell.kernelRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentRegularizer",{get:function(){return this.cell.recurrentRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasRegularizer",{get:function(){return this.cell.biasRegularizer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"kernelConstraint",{get:function(){return this.cell.kernelConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentConstraint",{get:function(){return this.cell.recurrentConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"biasConstraint",{get:function(){return this.cell.biasConstraint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropout",{get:function(){return this.cell.dropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"recurrentDropout",{get:function(){return this.cell.recurrentDropout},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"implementation",{get:function(){return this.cell.implementation},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={units:this.units,activation:l.serializeActivation(this.activation),recurrentActivation:l.serializeActivation(this.recurrentActivation),useBias:this.useBias,kernelInitializer:y.serializeInitializer(this.kernelInitializer),recurrentInitializer:y.serializeInitializer(this.recurrentInitializer),biasInitializer:y.serializeInitializer(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:g.serializeRegularizer(this.kernelRegularizer),recurrentRegularizer:g.serializeRegularizer(this.recurrentRegularizer),biasRegularizer:g.serializeRegularizer(this.biasRegularizer),activityRegularizer:g.serializeRegularizer(this.activityRegularizer),kernelConstraint:h.serializeConstraint(this.kernelConstraint),recurrentConstraint:h.serializeConstraint(this.recurrentConstraint),biasConstraint:h.serializeConstraint(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation},n=t.prototype.getConfig.call(this);return delete n.cell,Object.assign(e,n),e},e.fromConfig=function(t,e){return 0===e.implmentation&&(e.implementation=1),new t(e)},e.className="LSTM",e}(S);e.LSTM=O,u.serialization.registerClass(O);var k=function(t){function e(e){var n=t.call(this,e)||this;return n.cells=e.cells,n}return a(e,t),Object.defineProperty(e.prototype,"stateSize",{get:function(){for(var t=[],e=0,n=this.cells.slice().reverse();e<n.length;e++){var r=n[e];Array.isArray(r.stateSize)?t.push.apply(t,r.stateSize):t.push(r.stateSize)}return t},enumerable:!0,configurable:!0}),e.prototype.call=function(t,e){var n=this;return u.tidy(function(){t=t;for(var r=t.slice(1),i=[],o=0,a=n.cells.slice().reverse();o<a.length;o++){
var s=a[o];Array.isArray(s.stateSize)?i.push(r.splice(0,s.stateSize.length)):i.push(r.splice(0,1))}i.reverse();for(var u,l=[],c=0;c<n.cells.length;++c){var s=n.cells[c];r=i[c],u=0===c?[t[0]].concat(r):[u[0]].concat(r),u=s.call(u,e),l.push(u.slice(1))}r=[];for(var p=0,h=l.slice().reverse();p<h.length;p++){var f=h[p];r.push.apply(r,f)}return[u[0]].concat(r)})},e.prototype.build=function(t){b.isArrayOfShapes(t)&&(t=t[0]),t=t;for(var e,n=0,r=this.cells;n<r.length;n++){var i=r[n];i.build(t),e=Array.isArray(i.stateSize)?i.stateSize[0]:i.stateSize,t=[t[0],e]}this.built=!0},e.prototype.getConfig=function(){for(var e=[],n=0,r=this.cells;n<r.length;n++){var i=r[n];e.push({className:this.getClassName(),config:i.getConfig()})}var o={cells:e},a=t.prototype.getConfig.call(this);return Object.assign(o,a),o},e.fromConfig=function(t,e,n){void 0===n&&(n={});for(var r=[],i=0,o=e.cells;i<o.length;i++){var a=o[i];r.push(w.deserialize(a,n))}return new t({cells:r})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(!this.trainable)return[];for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.cells;o<a.length;o++){var r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(t)}return t},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){for(var t=[],e=0,n=this.cells;e<n.length;e++){var r=n[e];t.push.apply(t,r.weights)}return _.batchGetValue(t)},e.prototype.setWeights=function(t){for(var e=[],n=0,r=this.cells;n<r.length;n++)for(var i=r[n],o=i.weights.length,a=t.splice(o),s=0;s<i.weights.length;++s)e.push([i.weights[s],a[s]]);_.batchSetValue(e)},e.className="StackedRNNCells",e}(x);e.StackedRNNCells=k,u.serialization.registerClass(k)},function(t,e,n){"use strict";function r(t){return o(this,void 0,void 0,function(){var e,n,r,i,o,u,l,c;return a(this,function(a){switch(a.label){case 0:if(null==t)return[2];e=[],n=[],r=[];for(i in t)o=t[i],"number"!=typeof o&&(u=o,e.push(u.data()),n.push(i),r.push(u));return[4,Promise.all(e)];case 1:for(l=a.sent(),c=0;c<l.length;++c)t[n[c]]=l[c][0];return s.dispose(r),[2]}})})}function i(t){if(null!=t)for(var e in t){var n=t[e];"number"!=typeof n&&n.dispose()}}var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(1);e.resolveScalarsInLogs=r,e.disposeTensorsInLogs=i},function(t,e,n){"use strict";function r(t,e){return s(this,void 0,void 0,function(){var n,r,i,o,a,s,c,p,h,f;return u(this,function(u){switch(u.label){case 0:return"modelTopology"in t||(t={modelTopology:t}),t=t,n=t.modelTopology,null!=n.model_config&&(n=n.model_config),r=g.convertPythonicToTs(n),i=m.deserialize(r,e),null==t.weightsManifest?[3,2]:[4,l.io.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map(function(t){return t.originalName}))];case 1:for(o=u.sent(),a={},s=0,c=i.weights;s<c.length;s++)p=c[s],a[p.originalName]=o[p.originalName];h=null,f=!0,i.loadWeights(a,h,f),u.label=2;case 2:return[2,i]}})})}function i(t,e){return void 0===e&&(e=!0),s(this,void 0,void 0,function(){var n;return u(this,function(r){if("string"==typeof t){if(n=l.io.getLoadHandlers(t),0===n.length)n.push(l.io.browserHTTPRequest(t));else if(n.length>1)throw new d.ValueError("Found more than one ("+n.length+") load handlers for "+("URL '"+t+"'"));t=n[0]}return[2,o(t,void 0,e)]})})}function o(t,e,n){return void 0===n&&(n=!0),s(this,void 0,void 0,function(){var r,i,o,a,s;return u(this,function(u){switch(u.label){case 0:if(null==t.load)throw new d.ValueError("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,t.load()];case 1:if(r=u.sent(),i=r.modelTopology,null!=i.model_config&&(i=i.model_config),o=m.deserialize(g.convertPythonicToTs(i),e),null!=r.weightData){if(null==r.weightSpecs)throw new d.ValueError("Model artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");a=!1,s=!0,o.loadWeights(l.io.decodeWeights(r.weightData,r.weightSpecs),a,s,n)}return[2,o]}})})}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},u=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var l=n(1),c=n(8),p=n(51),h=n(12),f=n(62),d=n(7),m=n(63),y=n(10),g=n(145),v=n(16);e.modelFromJSON=r,e.loadModelInternal=i,e.loadModelFromIOHandler=o;var b=function(t){function e(e){var n=t.call(this,{inputs:[],outputs:[]})||this;if(e=e||{},n.trainable=!0,n._updatable=!0,n.built=!1,n.name=null!=e.name?e.name:c.getUid("sequential_"),null!=e.layers)for(var r=0,i=e.layers;r<i.length;r++){var o=i[r];n.add(o)}return n}return a(e,t),e.prototype.checkShape=function(t){var e=t.inboundNodes[0].outputTensors[0].shape;if(e.some(function(t){return t<0}))throw new d.ValueError("Negative dimension size caused by adding layer "+(t.name+" with input shape [")+(t.inboundNodes[0].inputTensors[0].shape+"]"))},e.prototype.add=function(t){var n,r=t instanceof e||t instanceof f.Model;if(r){if(n=t,1!==n.outputs.length)throw new d.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new d.ValueError("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new d.ValueError("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=p.Input({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new d.ValueError("A layer added to a Sequential model must not already be "+("connected somewhere else. Model received layer "+t.name+" ")+("which has "+t.inboundNodes.length+" pre-existing inbound ")+"connections.");if(1!==t.inboundNodes[0].outputTensors.length)throw new d.ValueError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=h.getSourceInputs(this.outputs[0])}this.inboundNodes=[],new h.Node({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:y.pyListRepeat(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(t){return t.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,e){return null==this.model&&this.build(),this.model.call(t,e)},e.prototype.build=function(t){if(v.getExactlyOneShape(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new f.Model({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.model.updatable=this.updatable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),t.prototype.countParams.call(this)},e.prototype.summary=function(e,n,r){void 0===r&&(r=console.log),this.built||this.build(),t.prototype.summary.call(this,e,n,r)},e.prototype.setWeights=function(t){null==this.model&&this.build(),this.model.setWeights(t)},Object.defineProperty(e.prototype,"updatable",{get:function(){return this._updatable},set:function(t){this.built&&(this.model.updatable=t),this._updatable=t},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(t,e,n){if(void 0===n&&(n={}),!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)},e.prototype.evaluateDataset=function(t,e){return s(this,void 0,void 0,function(){return u(this,function(n){if(!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,e)]})})},e.prototype.predict=function(t,e){return void 0===e&&(e={}),null==this.model&&this.build(),this.model.predict(t,e)},e.prototype.predictOnBatch=function(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer=this.model.optimizer,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},e.prototype.fit=function(t,e,n){return void 0===n&&(n={}),s(this,void 0,void 0,function(){return u(this,function(r){if(!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fit(t,e,n)]})})},e.prototype.fitDataset=function(t,e){return s(this,void 0,void 0,function(){return u(this,function(n){if(!this.built)throw new d.RuntimeError("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,e)]})})},e.fromConfig=function(t,n){var r,i={};if(n instanceof Array){if(null==n[0].className||"Merge"===n[0].className)throw new d.ValueError("Legacy serialization format not supported yet.");r=n}else l.util.assert(null!=n.layers,"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),r=n.layers,delete n.layers,i=n;var o=new t(i);if(!(o instanceof e))throw new d.NotImplementedError("Sequential.fromConfig called on non-Sequential input: "+o);for(var a=0,s=r;a<s.length;a++){var u=s[a],c=m.deserialize(u);o.add(c)}return o},Object.defineProperty(e.prototype,"stopTraining",{set:function(t){this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push({className:r.getClassName(),config:r.getConfig()})}return t},e.className="Sequential",e}(f.Model);e.Sequential=b,l.serialization.registerClass(b)},function(t,e,n){"use strict";function r(t,e,n){if("number"==typeof t)return s.pyListRepeat(t,e);if(t.length!==e)throw new a.ValueError("The "+n+" argument must be a tuple of "+e+" integers. Received: "+(t.length+" elements."));for(var r=0;r<e;++r){var i=t[r];if(!u.isInteger(i))throw new a.ValueError("The "+n+" argument must be a tuple of "+e+" integers. Received: "+(JSON.stringify(t)+" including a non-integer number ")+(""+i))}return t}function i(t,e,n,r,i){if(void 0===i&&(i=1),null==t)return t;var o,a=e+(e-1)*(i-1);return o="same"===n?t:t-a+1,Math.floor((o+r-1)/r)}function o(t,e,n,r){if(null==t)return null;if("valid"===r)t=t*e+u.max([n-e,0]);else{if("same"!==r)throw new a.ValueError("Unsupport padding mode: "+r+".");t*=e}return t}Object.defineProperty(e,"__esModule",{value:!0});var a=n(7),s=n(10),u=n(28);e.normalizeArray=r,e.convOutputLength=i,e.deconvLength=o},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),r(n(1)),r(n(143)),r(n(112));var i=n(1),o=n(143),a=n(112),s=n(344);e.version={"tfjs-core":i.version_core,"tfjs-layers":o.version_layers,"tfjs-converter":a.version_converter,tfjs:s.version}},function(t,e,n){"use strict";function r(t){if(!t)return s;for(var e=0;e<t.args.length;++e){var n=t.args[e];0===e?t.args[e]={name:n,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:t.args[e]={name:n,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function i(t){return a({args:t.args,pre:r(t.pre),body:r(t.body),post:r(t.proc),funcName:t.funcName})}function o(t){for(var e=[],n=0;n<t.args.length;++n)e.push("a"+n);var r=new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""));return r(i(t))}var a=n(150),s={body:"",args:[],thisVars:[],localVars:[]},u={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in u){var n=u[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:t}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:t+"s"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:t+"seq"})}}();var l={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in l){var n=l[t];e[t]=o({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:t}),e[t+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in c){var n=c[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:t}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:t+"s"}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var p=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<p.length;++t){var n=p[t];e[n]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),e[n+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var t=0;t<h.length;++t){var n=h[t];e[n]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),e[n+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),e[n+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),e[n+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var f=["atan2","pow"];!function(){for(var t=0;t<f.length;++t){var n=f[t];e[n+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),e[n+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),e[n+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),e[n+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),e.any=a({args:["array"],pre:s,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=a({args:["array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=a({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=a({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=a({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=a({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=a({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=a({args:["array","array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},function(t,e,n){function r(t,e){return t[0]-e[0]}function i(){var t,e=this.stride,n=new Array(e.length);for(t=0;t<n.length;++t)n[t]=[Math.abs(e[t]),t];n.sort(r);var i=new Array(n.length);for(t=0;t<i.length;++t)i[t]=n[t][1];return i}function o(t,e){var n=["View",e,"d",t].join("");e<0&&(n="View_Nil"+t);var r="generic"===t;if(e===-1){var o="function "+n+"(a){this.data=a;};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return -1};\tproto.size=0;\tproto.dimension=-1;\tproto.shape=proto.stride=proto.order=[];\tproto.lo=proto.hi=proto.transpose=proto.step=\tfunction(){return new "+n+"(this.data);};\tproto.get=proto.set=function(){};\tproto.pick=function(){return null};\treturn function construct_"+n+"(a){return new "+n+"(a);}",a=new Function(o);return a()}if(0===e){var o="function "+n+"(a,d) {\tthis.data = a;\tthis.offset = d\t};\tvar proto="+n+".prototype;\tproto.dtype='"+t+"';\tproto.index=function(){return this.offset};\tproto.dimension=0;\tproto.size=1;\tproto.shape=\tproto.stride=\tproto.order=[];\tproto.lo=\tproto.hi=\tproto.transpose=\tproto.step=function "+n+"_copy() {\treturn new "+n+"(this.data,this.offset)\t};\tproto.pick=function "+n+"_pick(){\treturn TrivialArray(this.data);\t};\tproto.valueOf=proto.get=function "+n+"_get(){\treturn "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};\tproto.set=function "+n+"_set(v){\treturn "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"\t};\treturn function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}",a=new Function("TrivialArray",o);return a(p[t][0])}var o=["'use strict'"],s=u(e),l=s.map(function(t){return"i"+t}),c="this.offset+"+s.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),h=s.map(function(t){return"b"+t}).join(","),f=s.map(function(t){return"c"+t}).join(",");o.push("function "+n+"(a,"+h+","+f+",d){this.data=a","this.shape=["+h+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),o.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){\treturn "+s.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),e<4?(o.push("function "+n+"_order(){"),2===e?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);\tif(s0>s1){\tif(s1>s2){\treturn [2,1,0];\t}else if(s0>s2){\treturn [1,2,0];\t}else{\treturn [1,0,2];\t}\t}else if(s0>s2){\treturn [2,0,1];\t}else if(s2>s1){\treturn [0,1,2];\t}else{\treturn [0,2,1];\t}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+l.join(",")+",v){"),r?o.push("return this.data.set("+c+",v)}"):o.push("return this.data["+c+"]=v}"),o.push("proto.get=function "+n+"_get("+l.join(",")+"){"),r?o.push("return this.data.get("+c+")}"):o.push("return this.data["+c+"]}"),o.push("proto.index=function "+n+"_index(",l.join(),"){return "+c+"}"),o.push("proto.hi=function "+n+"_hi("+l.join(",")+"){return new "+n+"(this.data,"+s.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+s.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var d=s.map(function(t){return"a"+t+"=this.shape["+t+"]"}),m=s.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+n+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+m.join(","));for(var y=0;y<e;++y)o.push("if(typeof i"+y+"==='number'&&i"+y+">=0){\td=i"+y+"|0;\tb+=c"+y+"*d;\ta"+y+"-=d}");o.push("return new "+n+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+l.join(",")+"){var "+s.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+s.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var y=0;y<e;++y)o.push("if(typeof i"+y+"==='number'){\td=i"+y+"|0;\tif(d<0){\tc+=b"+y+"*(a"+y+"-1);\ta"+y+"=ceil(-a"+y+"/d)\t}else{\ta"+y+"=ceil(a"+y+"/d)\t}\tb"+y+"*=d\t}");o.push("return new "+n+"(this.data,"+s.map(function(t){return"a"+t}).join(",")+","+s.map(function(t){return"b"+t}).join(",")+",c)}");for(var g=new Array(e),v=new Array(e),y=0;y<e;++y)g[y]="a[i"+y+"]",v[y]="b[i"+y+"]";o.push("proto.transpose=function "+n+"_transpose("+l+"){"+l.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+g.join(",")+","+v.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+l+"){var a=[],b=[],c=this.offset");for(var y=0;y<e;++y)o.push("if(typeof i"+y+"==='number'&&i"+y+">=0){c=(c+this.stride["+y+"]*i"+y+")|0}else{a.push(this.shape["+y+"]);b.push(this.stride["+y+"])}");o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+s.map(function(t){return"shape["+t+"]"}).join(",")+","+s.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}");var a=new Function("CTOR_LIST","ORDER",o.join("\n"));return a(p[t],i)}function a(t){if(l(t))return"buffer";if(c)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}function s(t,e,n,r){if(void 0===t){var i=p.array[0];return i([])}"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var s=e.length;if(void 0===n){n=new Array(s);for(var u=s-1,l=1;u>=0;--u)n[u]=l,l*=e[u]}if(void 0===r){r=0;for(var u=0;u<s;++u)n[u]<0&&(r-=(e[u]-1)*n[u])}for(var c=a(t),h=p[c];h.length<=s+1;)h.push(o(c,h.length-1));var i=h[s+1];return i(t,e,n,r)}var u=n(359),l=n(360),c="undefined"!=typeof Float64Array,p={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};t.exports=s},function(t,e,n){"use strict";function r(t,e){for(var n=[];e--;n[e]=e+t);return n}function i(t,e){for(var n=[];e--;n[e]=t-e);return n}function o(t,e){return null===t||null===e?[]:t<e?r(t,e-t+1):i(t,t-e+1)}function a(t,e){var n=e.length,r=(t%n+n)%n;return e.slice(r,n).concat(e.slice(0,r))}function s(t){return c(t.map(l.name)).sort(function(t,e){return p(t)>p(e)})}function u(t){return s(t).filter(function(t,e,n){return 0===e||t!==n[e-1]})}Object.defineProperty(e,"__esModule",{value:!0});var l=n(42),c=function(t){return t.filter(function(t){return 0===t||t})},p=function(t){var e=l.props(t).midi;return null!==e?e:l.props(t+"-100").midi},h=function(t,e){void 0===e&&(e=Math.random);for(var n,r,i=t.length;i;)n=e()*i--|0,r=t[i],t[i]=t[n],t[n]=r;return t},f=function(t){return 0===t.length?[[]]:f(t.slice(1)).reduce(function(e,n){return e.concat(t.map(function(e,r){var i=n.slice();return i.splice(r,0,t[0]),i}))},[])};e.range=o,e.rotate=a,e.compact=c,e.sort=s,e.unique=u,e.shuffle=h,e.permutations=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(68),i=["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],o=["1P 2M 3M 4A 5P 6M 7M"],a=["1P 2M 3M 4P 5P 6M 7M",["ionian"]],s=["1P 2M 3M 4P 5P 6M 7m",["dominant"]],u=["1P 2M 3m 4P 5P 6M 7m"],l=["1P 2M 3m 4P 5P 6m 7m",["minor"]],c=["1P 2m 3m 4P 5P 6m 7m"],p=["1P 2m 3m 4P 5d 6m 7m"],h=["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],f=["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],d=["1P 2m 4P 5d 7m"],m=["1P 2M 3m 5P 6m"],y=["1P 2m 4P 5P 6m"],g=["1P 2m 3m 5P 6m"],v=["1P 2M 3M 4A 6M 7m"],b=["1P 2M 4P 5P 6M"],_=["1P 2m 3M 5P 6M"],w=["1P 2M 4P 5P 6M 7m"],S=["1P 2A 3M 5P 5A 7M"],x=["1P 2m 3m 4P 5P 6m 7M"],T=["1P 2M 4P 5P 7m"],P=["1P 2m 3M 4P 5d 6M 7m"],E=["1P 2m 3m 3M 4A 5P 7m"],A=["1P 2m 3m 4P 5P 6m 7M"],N=["1P 2m 3M 4P 5d 6m 7M"],O=["1P 2M 3M 4P 5P 6M 7m 7M"],k=["1P 2m 3M 5d 6m 7m 7M"],I=["1P 2M 3M 4P 5d 5P 6M 7M"],C={
chromatic:i,lydian:o,major:a,mixolydian:s,dorian:u,aeolian:l,phrygian:c,locrian:p,"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],altered:h,"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],diminished:f,"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],iwato:d,hirajoshi:m,kumoijoshi:y,pelog:g,"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],prometheus:v,"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],ritusen:b,scriabin:_,piongio:w,"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],augmented:S,"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],neopolitan:x,"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],egyptian:T,"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],oriental:P,"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],flamenco:E,balinese:A,"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],persian:N,bebop:O,"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],enigmatic:k,"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],ichikosucho:I,"six tone symmetric":["1P 2m 3M 4P 5A 6M"]},M=["1P 3M 5P",["Major",""]],R=["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],D=["1P 3M 5P 13M",["6"]],L=["1P 3M 5P 6M 9M",["69"]],F=["1P 3M 5P 6M 7M 9M"],z=["1P 3M 5d 7M"],q=["1P 3M 6m 7M"],V=["1P 3M 5P 7M 9m"],B=["1P 4P 5P 7M"],j=["1P 3M 5P 7M 9M",["maj9","Maj9"]],U=["1P 3M 5d 7M 9M"],G=["1P 4P 5P 7M 9M"],W=["1P 3M 5P 9M",["2","add9","add2"]],H=["1P 3M 5P 7M",["maj7","M7"]],Q=["1P 3M 5d"],K=["1P 3M 13m"],Y=["1P 2M 5P",["add9no3","sus2"]],X=["1P 4P 5P",["sus","sus4"]],$=["1P 3M 5P 9m"],J=["1P 3m 5P"],Z=["1P 3m 5P 7m 9M 11P",["_11"]],tt=["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],et=["1P 3m 5P 7m 9M 11P 13M",["_13"]],nt=["1P 3m 4P 5P 13M",["_6"]],rt=["1P 3m 5P 6M 9M",["_69"]],it=["1P 3m 5P 7m",["minor7","_","_7"]],ot=["1P 3m 5P 7m 11P",["m7add4"]],at=["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],st=["1P 3m 5P 7m 9M",["_9"]],ut=["1P 3m 7m 12d 2M",["h9","-9b5"]],lt=["1P 3m 5P 7M",["mM7","_M7"]],ct=["1P 3m 5P 6m 7M",["mM7b6"]],pt=["1P 3m 5P 7M 9M",["mMaj9","-M9"]],ht=["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],ft=["1P 3m 6m 7M"],dt=["1P 3m 6m 9m"],mt=["1P 3m 5d",["mb5","dim"]],yt=["1P 3m 5d 13M",["diminished","m6b5","dim7"]],gt=["1P 3m 5d 6M 7M"],vt=["1P 3m 5d 7M"],bt=["1P 2M 4P 5P",["sus4add9"]],_t=["1P 3m 4P 5P"],wt=["1P 3m 5P 9M"],St={4:["1P 4P 7m 10m",["quartal"]],5:["1P 5P"],7:["1P 3M 5P 7m",["Dominant","Dom"]],9:["1P 3M 5P 7m 9M",["79"]],11:["1P 5P 7m 9M 11P"],13:["1P 3M 5P 7m 9M 13M",["13_"]],64:["5P 8P 10M"],M:M,"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],M13:R,"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],M6:D,"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],M69:L,"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],M7add13:F,M7b5:z,M7b6:q,M7b9:V,M7sus4:B,M9:j,"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],M9b5:U,M9sus4:G,Madd9:W,Maj7:H,Mb5:Q,Mb6:K,Msus2:Y,Msus4:X,Maddb9:$,"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],m:J,"m#5":["1P 3m 5A",["m+","mb6"]],m11:Z,"m11A 5":["1P 3m 6m 7m 9M 11P"],m11b5:tt,m13:et,m6:nt,m69:rt,m7:it,"m7#5":["1P 3m 6m 7m"],m7add11:ot,m7b5:at,m9:st,"m9#5":["1P 3m 6m 7m 9M"],m9b5:ut,mMaj7:lt,mMaj7b6:ct,mM9:pt,mM9b6:ht,mb6M7:ft,mb6b9:dt,o:mt,o7:yt,o7M7:gt,oM7:vt,sus24:bt,"+add#9":["1P 3M 5A 9A"],madd4:_t,madd9:wt},xt=function(t){var e=Object.keys(t).sort(),n=[],i=[],o=function(t,e,r){n[t]=e,i[r]=i[r]||[],i[r].push(t)};e.forEach(function(e){var n=t[e][0].split(" "),i=t[e][1],a=r.chroma(n);o(e,n,a),i&&i.forEach(function(t){return o(t,n,a)})});var a=Object.keys(n).sort(),s=function(t){return n[t]};return s.names=function(t){return"string"==typeof t?(i[t]||[]).slice():(t===!0?a:e).slice()},s},Tt=function(t,e){var n=function(n){return t(n)||e(n)};return n.names=function(n){return t.names(n).concat(e.names(n))},n},Pt=xt(C),Et=xt(St),At=Tt(Pt,Et);e.dictionary=xt,e.combine=Tt,e.scale=Pt,e.chord=Et,e.pcset=At},function(t,e,n){"use strict";function r(t){var e=(t+1)%7;return e<0?7+e:e}function i(t,e){if(1===arguments.length)return function(e){return i(t,e)};var n=x(t),r=T(e);if(null===n||null===r)return null;var o=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return f.build(_(o[0],o[1]))}function o(t,e){if(1===arguments.length)return function(e){return o(t,e)};var n=x(t);return null===n?null:f.build(_(n[0]+e))}function a(t,e){if(1===arguments.length)return function(e){return a(t,e)};var n=x(t),r=x(e);return null===r||null===n?null:r[0]-n[0]}function s(t,e){return 1===arguments.length?function(e){return i(e,t)}:i(e,t)}function u(t,e,n){var r=T(t),i=T(e);if(null===r||null===i)return null;var o=[r[0]+n*i[0],r[1]+n*i[1]];return d.build(E(o))}function l(t,e){return 1===arguments.length?function(e){return l(t,e)}:u(t,e,1)}function c(t,e){return 1===arguments.length?function(e){return l(t,e)}:u(t,e,-1)}function p(t,e){if(1===arguments.length)return function(e){return p(t,e)};var n=x(t),r=x(e);if(null===n||null===r||n.length!==r.length)return null;var i=1===n.length?[r[0]-n[0],-Math.floor(7*(r[0]-n[0])/12)]:[r[0]-n[0],r[1]-n[1]];return d.build(E(i))}function h(t,e){if(1===arguments.length)return function(e){return h(t,e)};var n=f.props(t),r=f.props(e);return null!==n.midi&&null!==r.midi?r.midi-n.midi:null!==n.chroma&&null!==r.chroma?(r.chroma-n.chroma+12)%12:null}Object.defineProperty(e,"__esModule",{value:!0});var f=n(42),d=n(103),m=[0,2,4,-1,1,3,5],y=function(t){return Math.floor(7*t/12)},g=m.map(y),v=function(t){var e=t.step,n=t.alt,r=t.oct,i=t.dir;void 0===i&&(i=1);var o=m[e]+7*n;if(null===r)return[i*o];var a=r-g[e]-4*n;return[i*o,i*a]},b=[3,0,4,1,5,2,6],_=function(t,e,n){var i=b[r(t)],o=Math.floor((t+1)/7);if(void 0===e)return{step:i,alt:o,dir:n};var a=e+4*o+g[i];return{step:i,alt:o,oct:a,dir:n}},w=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}},S=function(t){return w(function(e){var n=t(e);return null===n.name?null:v(n)})},x=S(f.props),T=S(d.props),P=function(t){return 7*t[0]+12*t[1]<0},E=function(t){return P(t)?_(-t[0],-t[1],-1):_(t[0],t[1],1)};e.transpose=i,e.trFifths=o,e.fifths=a,e.transposeBy=s,e.addIntervals=u,e.add=l,e.subtract=c,e.interval=p,e.semitones=h},function(t,e){"use strict";function n(t){return"string"!=typeof t?h:v[t]||(v[t]=g(t))}Object.defineProperty(e,"__esModule",{value:!0});var r="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",i="(AA|A|P|M|m|d|dd)([-+]?\\d+)",o=new RegExp("^"+r+"|"+i+"$"),a=[0,2,4,5,7,9,11],s="PMMPPMM",u=[0,1,2,3,4,5,6,5,4,3,2,1],l="1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),c=function(t){return"string"!=typeof t?l.slice():l.filter(function(e){return t.indexOf(e[1])!==-1})},p=function(t){var e=o.exec(""+t);return null===e?null:e[1]?[e[1],e[2]]:[e[4],e[3]]},h=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null}),f=function(t,e){return Array(Math.abs(e)+1).join(t)},d=function(t,e){return"M"===e&&"M"===t?0:"P"===e&&"P"===t?0:"m"===e&&"M"===t?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?"P"===t?-e.length:-e.length-1:null},m=function(t,e){return 0===e?"M"===t?"M":"P":e===-1&&"M"===t?"m":e>0?f("A",e):e<0?f("d","P"===t?e:e+1):null},y=function(t){return(Math.abs(t)-1)%7},g=function(t){var e=p(t);if(null===e)return h;var n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return n.num=+e[0],n.q=e[1],n.step=y(n.num),n.type=s[n.step],"M"===n.type&&"P"===n.q?h:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||n.num===-8?n.num:n.dir*(n.step+1),n.alt=d(n.type,n.q),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(a[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(a[n.step]+n.alt)%12+12)%12,Object.freeze(n))},v={},b=function(t){return n(t).num},_=function(t){return n(t).name},w=function(t){return n(t).semitones},S=function(t){return n(t).chroma},x=function(t){return"string"==typeof t&&(t=n(t).chroma),"number"==typeof t?u[t%12]:null},T=function(t){var e=void 0===t?{}:t,n=e.num,r=e.step,i=e.alt,o=e.oct,a=void 0===o?1:o,u=e.dir;if(void 0!==r&&(n=r+1+7*a),void 0===n)return null;if("number"!=typeof i)return null;var l="number"!=typeof u?"":u<0?"-":"",c=s[y(n)];return l+n+m(c,i)},P=function(t){var e=n(t);if(e===h)return null;var r=e;return r.simple+r.q},E=function(t){var e=n(t);if(e===h)return null;var r=e,i=(7-r.step)%7,o="P"===r.type?-r.alt:-(r.alt+1);return T({step:i,alt:o,oct:r.oct,dir:r.dir})},A=[1,2,2,3,3,4,5,5,6,6,7,7],N="P m M m M P d P m M m M".split(" "),O=function(t){var e=t<0?-1:1,n=Math.abs(t),r=n%12,i=Math.floor(n/12);return e*(A[r]+7*i)+N[r]};e.names=c,e.tokenize=p,e.qToAlt=d,e.altToQ=m,e.props=n,e.num=b,e.name=_,e.semitones=w,e.chroma=S,e.ic=x,e.build=T,e.simplify=P,e.invert=E,e.fromSemitones=O},function(t,e,n){var r;!function(i,o){r=function(){return o()}.call(e,n,e,t),!(void 0!==r&&(t.exports=r))}(this,function(){"use strict";function t(t){n=t()}function e(t){t(n)}var n;/**
		 *  Tone.js
		 *  @author Yotam Mann
		 *  @license http://opensource.org/licenses/MIT MIT License
		 *  @copyright 2014-2018 Yotam Mann
		 */
return t(function(){var t=function(){if(!(this instanceof t))throw new Error("constructor needs to be called with the 'new' keyword")};t.prototype.toString=function(){for(var e in t){var n=e[0].match(/^[A-Z]$/),r=t[e]===this.constructor;if(t.isFunction(t[e])&&n&&r)return e}return"Tone"},t.prototype.dispose=function(){return this},t.prototype.set=function(e,n,r){if(t.isObject(e))r=n;else if(t.isString(e)){var i={};i[e]=n,e=i}t:for(var o in e){n=e[o];var a=this;if(o.indexOf(".")!==-1){for(var s=o.split("."),u=0;u<s.length-1;u++)if(a=a[s[u]],a instanceof t){s.splice(0,u+1);var l=s.join(".");a.set(l,n);continue t}o=s[s.length-1]}var c=a[o];t.isUndef(c)||(t.Signal&&c instanceof t.Signal||t.Param&&c instanceof t.Param?c.value!==n&&(t.isUndef(r)?c.value=n:c.rampTo(n,r)):c instanceof AudioParam?c.value!==n&&(c.value=n):t.TimeBase&&c instanceof t.TimeBase?a[o]=n:c instanceof t?c.set(n):c!==n&&(a[o]=n))}return this},t.prototype.get=function(e){t.isUndef(e)?e=this._collectDefaults(this.constructor):t.isString(e)&&(e=[e]);for(var n={},r=0;r<e.length;r++){var i=e[r],o=this,a=n;if(i.indexOf(".")!==-1){for(var s=i.split("."),u=0;u<s.length-1;u++){var l=s[u];a[l]=a[l]||{},a=a[l],o=o[l]}i=s[s.length-1]}var c=o[i];t.isObject(e[i])?a[i]=c.get():t.Signal&&c instanceof t.Signal?a[i]=c.value:t.Param&&c instanceof t.Param?a[i]=c.value:c instanceof AudioParam?a[i]=c.value:c instanceof t?a[i]=c.get():!t.isFunction(c)&&t.isDefined(c)&&(a[i]=c)}return n},t.prototype._collectDefaults=function(e){var n=[];if(t.isDefined(e.defaults)&&(n=Object.keys(e.defaults)),t.isDefined(e._super))for(var r=this._collectDefaults(e._super),i=0;i<r.length;i++)n.indexOf(r[i])===-1&&n.push(r[i]);return n},t.defaults=function(e,n,r){var i={};if(1===e.length&&t.isObject(e[0]))i=e[0];else for(var o=0;o<n.length;o++)i[n[o]]=e[o];return t.isDefined(r.defaults)?t.defaultArg(i,r.defaults):t.isObject(r)?t.defaultArg(i,r):i},t.defaultArg=function(e,n){if(t.isObject(e)&&t.isObject(n)){var r={};for(var i in e)r[i]=t.defaultArg(n[i],e[i]);for(var o in n)r[o]=t.defaultArg(e[o],n[o]);return r}return t.isUndef(e)?n:e},t.connectSeries=function(){for(var e=arguments[0],n=1;n<arguments.length;n++){var r=arguments[n];e.connect(r),e=r}return t},t.isUndef=function(t){return"undefined"==typeof t},t.isDefined=function(e){return!t.isUndef(e)},t.isFunction=function(t){return"function"==typeof t},t.isNumber=function(t){return"number"==typeof t},t.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object},t.isBoolean=function(t){return"boolean"==typeof t},t.isArray=function(t){return Array.isArray(t)},t.isString=function(t){return"string"==typeof t},t.isNote=function(e){return t.isString(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)},t.noOp=function(){},t.prototype._readOnly=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._readOnly(t[e]);else Object.defineProperty(this,t,{writable:!1,enumerable:!0})},t.prototype._writable=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this._writable(t[e]);else Object.defineProperty(this,t,{writable:!0})},t.State={Started:"started",Stopped:"stopped",Paused:"paused"},t.equalPowerScale=function(t){var e=.5*Math.PI;return Math.sin(t*e)},t.dbToGain=function(t){return Math.pow(10,t/20)},t.gainToDb=function(t){return 20*(Math.log(t)/Math.LN10)},t.intervalToFrequencyRatio=function(t){return Math.pow(2,t/12)},t.prototype.now=function(){return t.context.now()},t.now=function(){return t.context.now()},t.extend=function(e,n){function r(){}t.isUndef(n)&&(n=t),r.prototype=n.prototype,e.prototype=new r,e.prototype.constructor=e,e._super=n};var e=null;return Object.defineProperty(t,"context",{get:function(){return e},set:function(n){e=t.Context&&n instanceof t.Context?n:new t.Context(n),t.Context.emit("init",e)}}),Object.defineProperty(t.prototype,"context",{get:function(){return t.context}}),t.setContext=function(e){t.context=e},Object.defineProperty(t.prototype,"blockTime",{get:function(){return 128/this.context.sampleRate}}),Object.defineProperty(t.prototype,"sampleTime",{get:function(){return 1/this.context.sampleRate}}),Object.defineProperty(t,"supported",{get:function(){var t=window.hasOwnProperty("AudioContext")||window.hasOwnProperty("webkitAudioContext"),e=window.hasOwnProperty("Promise"),n=window.hasOwnProperty("Worker");return t&&e&&n}}),Object.defineProperty(t,"initialized",{get:function(){return null!==e}}),t.getContext=function(e){if(t.initialized)e(t.context);else{var n=function(){e(t.context),t.Context.off("init",n)};t.Context.on("init",n)}return t},t.version="r12",t}),e(function(t){return t.Emitter=function(){t.call(this),this._events={}},t.extend(t.Emitter),t.Emitter.prototype.on=function(t,e){for(var n=t.split(/\W+/),r=0;r<n.length;r++){var i=n[r];this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(e)}return this},t.Emitter.prototype.once=function(t,e){var n=function(){e.apply(this,arguments),this.off(t,n)}.bind(this);return this.on(t,n),this},t.Emitter.prototype.off=function(e,n){for(var r=e.split(/\W+/),i=0;i<r.length;i++)if(e=r[i],this._events.hasOwnProperty(e))if(t.isUndef(n))this._events[e]=[];else for(var o=this._events[e],a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);return this},t.Emitter.prototype.emit=function(t){if(this._events){var e=Array.apply(null,arguments).slice(1);if(this._events.hasOwnProperty(t))for(var n=this._events[t].slice(0),r=0,i=n.length;r<i;r++)n[r].apply(this,e)}return this},t.Emitter.mixin=function(e){var n=["on","once","off","emit"];e._events={};for(var r=0;r<n.length;r++){var i=n[r],o=t.Emitter.prototype[i];e[i]=o}return t.Emitter},t.Emitter.prototype.dispose=function(){return t.prototype.dispose.call(this),this._events=null,this},t.Emitter}),e(function(t){return t.Timeline=function(){var e=t.defaults(arguments,["memory"],t.Timeline);t.call(this),this._timeline=[],this.memory=e.memory},t.extend(t.Timeline),t.Timeline.defaults={memory:1/0},Object.defineProperty(t.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),t.Timeline.prototype.add=function(e){if(t.isUndef(e.time))throw new Error("Tone.Timeline: events must have a time attribute");e.time=e.time.valueOf();var n=this._search(e.time);if(this._timeline.splice(n+1,0,e),this.length>this.memory){var r=this.length-this.memory;this._timeline.splice(0,r)}return this},t.Timeline.prototype.remove=function(t){var e=this._timeline.indexOf(t);return e!==-1&&this._timeline.splice(e,1),this},t.Timeline.prototype.get=function(e,n){n=t.defaultArg(n,"time");var r=this._search(e,n);return r!==-1?this._timeline[r]:null},t.Timeline.prototype.peek=function(){return this._timeline[0]},t.Timeline.prototype.shift=function(){return this._timeline.shift()},t.Timeline.prototype.getAfter=function(e,n){n=t.defaultArg(n,"time");var r=this._search(e,n);return r+1<this._timeline.length?this._timeline[r+1]:null},t.Timeline.prototype.getBefore=function(e,n){n=t.defaultArg(n,"time");var r=this._timeline.length;if(r>0&&this._timeline[r-1][n]<e)return this._timeline[r-1];var i=this._search(e,n);return i-1>=0?this._timeline[i-1]:null},t.Timeline.prototype.cancel=function(t){if(this._timeline.length>1){var e=this._search(t);if(e>=0)if(this._timeline[e].time===t){for(var n=e;n>=0&&this._timeline[n].time===t;n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=t&&(this._timeline=[]);return this},t.Timeline.prototype.cancelBefore=function(t){var e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this},t.Timeline.prototype.previousEvent=function(t){var e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null},t.Timeline.prototype._search=function(e,n){if(0===this._timeline.length)return-1;n=t.defaultArg(n,"time");var r=0,i=this._timeline.length,o=i;if(i>0&&this._timeline[i-1][n]<=e)return i-1;for(;r<o;){var a=Math.floor(r+(o-r)/2),s=this._timeline[a],u=this._timeline[a+1];if(s[n]===e){for(var l=a;l<this._timeline.length;l++){var c=this._timeline[l];c[n]===e&&(a=l)}return a}if(s[n]<e&&u[n]>e)return a;s[n]>e?o=a:r=a+1}return-1},t.Timeline.prototype._iterate=function(e,n,r){n=t.defaultArg(n,0),r=t.defaultArg(r,this._timeline.length-1),this._timeline.slice(n,r+1).forEach(function(t){e.call(this,t)}.bind(this))},t.Timeline.prototype.forEach=function(t){return this._iterate(t),this},t.Timeline.prototype.forEachBefore=function(t,e){var n=this._search(t);return n!==-1&&this._iterate(e,0,n),this},t.Timeline.prototype.forEachAfter=function(t,e){var n=this._search(t);return this._iterate(e,n+1),this},t.Timeline.prototype.forEachBetween=function(t,e,n){var r=this._search(t),i=this._search(e);return r!==-1&&i!==-1?(this._timeline[r].time!==t&&(r+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,r,i)):r===-1&&this._iterate(n,0,i),this},t.Timeline.prototype.forEachFrom=function(t,e){for(var n=this._search(t);n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this},t.Timeline.prototype.forEachAtTime=function(t,e){var n=this._search(t);return n!==-1&&this._iterate(function(n){n.time===t&&e.call(this,n)},0,n),this},t.Timeline.prototype.dispose=function(){return t.prototype.dispose.call(this),this._timeline=null,this},t.Timeline}),e(function(t){if(t.supported){!window.hasOwnProperty("OfflineAudioContext")&&window.hasOwnProperty("webkitOfflineAudioContext")&&(window.OfflineAudioContext=window.webkitOfflineAudioContext);var e=new OfflineAudioContext(1,1,44100),n=e.startRendering();n instanceof Promise||(OfflineAudioContext.prototype._native_startRendering=OfflineAudioContext.prototype.startRendering,OfflineAudioContext.prototype.startRendering=function(){return new Promise(function(t){this.oncomplete=function(e){t(e.renderedBuffer)},this._native_startRendering()}.bind(this))})}}),e(function(t){if(t.supported){!window.hasOwnProperty("AudioContext")&&window.hasOwnProperty("webkitAudioContext")&&(window.AudioContext=window.webkitAudioContext),AudioContext.prototype.close||(AudioContext.prototype.close=function(){return t.isFunction(this.suspend)&&this.suspend(),Promise.resolve()}),AudioContext.prototype.resume||(AudioContext.prototype.resume=function(){return Promise.resolve()}),!AudioContext.prototype.createGain&&AudioContext.prototype.createGainNode&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),!AudioContext.prototype.createDelay&&AudioContext.prototype.createDelayNode&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode);var e=!1,n=new OfflineAudioContext(1,1,44100),r=new Uint32Array([1179011410,48,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,8,0,0,0,0]).buffer;try{var i=n.decodeAudioData(r);i instanceof Promise&&(e=!0)}catch(t){e=!1}e||(AudioContext.prototype._native_decodeAudioData=AudioContext.prototype.decodeAudioData,AudioContext.prototype.decodeAudioData=function(t){return new Promise(function(e,n){this._native_decodeAudioData(t,e,n)}.bind(this))})}}),e(function(t){t.Context=function(){t.Emitter.call(this);var n=t.defaults(arguments,["context"],t.Context);if(!n.context&&(n.context=new window.AudioContext,!n.context))throw new Error("could not create AudioContext. Possibly too many AudioContexts running already.");this._context=n.context;for(var r in this._context)this._defineProperty(this._context,r);this._latencyHint=n.latencyHint,this._constants={},this.lookAhead=n.lookAhead,this._computedUpdateInterval=0,this._ticker=new e(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval),this._timeouts=new t.Timeline,this._timeoutIds=0,this.on("tick",this._timeoutLoop.bind(this))},t.extend(t.Context,t.Emitter),t.Emitter.mixin(t.Context),t.Context.defaults={clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.03},t.Context.prototype._defineProperty=function(e,n){t.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof e[n]?e[n].bind(e):e[n]},set:function(t){e[n]=t}})},t.Context.prototype.now=function(){return this._context.currentTime+this.lookAhead},t.Context.prototype.ready=function(){return new Promise(function(t){"running"===this._context.state?t():this._context.resume().then(function(){t()})}.bind(this))},t.Context.prototype.close=function(){return this._context.close().then(function(){t.Context.emit("close",this)}.bind(this))},t.Context.prototype.getConstant=function(t){if(this._constants[t])return this._constants[t];for(var e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=t;var i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants[t]=i,i},t.Context.prototype._timeoutLoop=function(){for(var t=this.now();this._timeouts&&this._timeouts.length&&this._timeouts.peek().time<=t;)this._timeouts.shift().callback()},t.Context.prototype.setTimeout=function(t,e){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:t,time:n+e,id:this._timeoutIds}),this._timeoutIds},t.Context.prototype.clearTimeout=function(t){return this._timeouts.forEach(function(e){e.id===t&&this.remove(e)}),this},Object.defineProperty(t.Context.prototype,"updateInterval",{get:function(){return this._ticker.updateInterval},set:function(t){this._ticker.updateInterval=t}}),Object.defineProperty(t.Context.prototype,"clockSource",{get:function(){return this._ticker.type},set:function(t){this._ticker.type=t}}),Object.defineProperty(t.Context.prototype,"latencyHint",{get:function(){return this._latencyHint},set:function(e){var n=e;if(this._latencyHint=e,t.isString(e))switch(e){case"interactive":n=.1,this._context.latencyHint=e;break;case"playback":n=.8,this._context.latencyHint=e;break;case"balanced":n=.25,this._context.latencyHint=e;break;case"fastest":this._context.latencyHint="interactive",n=.01}this.lookAhead=n,this.updateInterval=n/3}}),t.Context.prototype.dispose=function(){return this.close().then(function(){t.Emitter.prototype.dispose.call(this),this._ticker.dispose(),this._ticker=null,this._timeouts.dispose(),this._timeouts=null;for(var e in this._constants)this._constants[e].disconnect();this._constants=null}.bind(this))};var e=function(e,n,r){this._type=n,this._updateInterval=r,this._callback=t.defaultArg(e,t.noOp),this._createClock()};return e.Type={Worker:"worker",Timeout:"timeout",Offline:"offline"},e.prototype._createWorker=function(){window.URL=window.URL||window.webkitURL;var t=new Blob(["var timeoutTime = "+(1e3*this._updateInterval).toFixed(1)+";self.onmessage = function(msg){\ttimeoutTime = parseInt(msg.data);};function tick(){\tsetTimeout(tick, timeoutTime);\tself.postMessage('tick');}tick();"]),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n},e.prototype._createTimeout=function(){this._timeout=setTimeout(function(){this._createTimeout(),this._callback()}.bind(this),1e3*this._updateInterval)},e.prototype._createClock=function(){if(this._type===e.Type.Worker)try{this._createWorker()}catch(t){this._type=e.Type.Timeout,this._createClock()}else this._type===e.Type.Timeout&&this._createTimeout()},Object.defineProperty(e.prototype,"updateInterval",{get:function(){return this._updateInterval},set:function(t){this._updateInterval=Math.max(t,128/44100),this._type===e.Type.Worker&&this._worker.postMessage(Math.max(1e3*t,1))}}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},set:function(t){this._disposeClock(),this._type=t,this._createClock()}}),e.prototype._disposeClock=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._worker&&(this._worker.terminate(),this._worker.onmessage=null,this._worker=null)},e.prototype.dispose=function(){this._disposeClock(),this._callback=null},t.getContext(function(){function e(e,n,i){if(e.input)return i=t.defaultArg(i,0),t.isArray(e.input)?this.connect(e.input[i]):this.connect(e.input,n,i);try{return e instanceof AudioNode?(r.call(this,e,n,i),e):(r.call(this,e,n),e)}catch(t){throw new Error("error connecting to node: "+e+"\n"+t)}}function n(e,n,r){if(e&&e.input&&t.isArray(e.input))r=t.defaultArg(r,0),this.disconnect(e.input[r],n,0);else if(e&&e.input)this.disconnect(e.input,n,r);else try{i.apply(this,arguments)}catch(t){throw new Error("error disconnecting node: "+e+"\n"+t)}}var r=AudioNode.prototype.connect,i=AudioNode.prototype.disconnect;AudioNode.prototype.connect!==e&&(AudioNode.prototype.connect=e,AudioNode.prototype.disconnect=n)}),t.supported&&!t.initialized?(t.context=new t.Context,window.TONE_SILENCE_VERSION_LOGGING||console.log("%c * Tone.js "+t.version+" * ","background: #000; color: #fff")):t.supported||console.warn("This browser does not support Tone.js"),t.Context}),e(function(t){return t.AudioNode=function(){t.call(this);var e=t.defaults(arguments,["context"],{context:t.context});this._context=e.context},t.extend(t.AudioNode),Object.defineProperty(t.AudioNode.prototype,"context",{get:function(){return this._context}}),t.AudioNode.prototype.createInsOuts=function(t,e){1===t?this.input=this.context.createGain():t>1&&(this.input=new Array(t)),1===e?this.output=this.context.createGain():e>1&&(this.output=new Array(e))},Object.defineProperty(t.AudioNode.prototype,"channelCount",{get:function(){return this.output.channelCount},set:function(t){return this.output.channelCount=t}}),Object.defineProperty(t.AudioNode.prototype,"channelCountMode",{get:function(){return this.output.channelCountMode},set:function(t){return this.output.channelCountMode=t}}),Object.defineProperty(t.AudioNode.prototype,"channelInterpretation",{get:function(){return this.output.channelInterpretation},set:function(t){return this.output.channelInterpretation=t}}),Object.defineProperty(t.AudioNode.prototype,"numberOfInputs",{get:function(){return this.input?t.isArray(this.input)?this.input.length:1:0}}),Object.defineProperty(t.AudioNode.prototype,"numberOfOutputs",{get:function(){return this.output?t.isArray(this.output)?this.output.length:1:0}}),t.AudioNode.prototype._onConnect=function(){},t.AudioNode.prototype.connect=function(e,n,r){return e._onConnect&&e._onConnect(this),t.isArray(this.output)?(n=t.defaultArg(n,0),this.output[n].connect(e,0,r)):this.output.connect(e,n,r),this},t.AudioNode.prototype.disconnect=function(e,n,r){t.isArray(this.output)?t.isNumber(e)?this.output[e].disconnect():(n=t.defaultArg(n,0),this.output[n].disconnect(e,0,r)):this.output.disconnect.apply(this.output,arguments)},t.AudioNode.prototype.chain=function(){for(var t=this,e=0;e<arguments.length;e++){var n=arguments[e];t.connect(n),t=n}return this},t.AudioNode.prototype.fan=function(){for(var t=0;t<arguments.length;t++)this.connect(arguments[t]);return this},window.AudioNode&&(AudioNode.prototype.chain=t.AudioNode.prototype.chain,AudioNode.prototype.fan=t.AudioNode.prototype.fan),t.AudioNode.prototype.dispose=function(){return t.isDefined(this.input)&&(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),t.isDefined(this.output)&&(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this._context=null,this},t.AudioNode}),e(function(t){return t.SignalBase=function(){t.AudioNode.call(this)},t.extend(t.SignalBase,t.AudioNode),t.SignalBase.prototype.connect=function(e,n,r){return t.Signal&&t.Signal===e.constructor||t.Param&&t.Param===e.constructor?(e._param.cancelScheduledValues(0),e._param.value=0,e.overridden=!0):e instanceof AudioParam&&(e.cancelScheduledValues(0),e.value=0),t.AudioNode.prototype.connect.call(this,e,n,r),this},t.SignalBase}),e(function(t){if(t.supported){var e=navigator.userAgent.toLowerCase(),n=e.includes("safari")&&!e.includes("chrome");if(n){var r=function(t){this._internalNode=this.input=this.output=t._native_createWaveShaper(),this._curve=null;for(var e in this._internalNode)this._defineProperty(this._internalNode,e)};Object.defineProperty(r.prototype,"curve",{get:function(){return this._curve},set:function(t){this._curve=t;var e=new Float32Array(t.length+1);e.set(t,1),e[0]=t[0],this._internalNode.curve=e}}),r.prototype._defineProperty=function(e,n){t.isUndef(this[n])&&Object.defineProperty(this,n,{get:function(){return"function"==typeof e[n]?e[n].bind(e):e[n]},set:function(t){e[n]=t}})},AudioContext.prototype._native_createWaveShaper=AudioContext.prototype.createWaveShaper,AudioContext.prototype.createWaveShaper=function(){return new r(this)}}}}),e(function(t){return t.WaveShaper=function(e,n){t.SignalBase.call(this),this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(e)?this.curve=e:isFinite(e)||t.isUndef(e)?this._curve=new Float32Array(t.defaultArg(e,1024)):t.isFunction(e)&&(this._curve=new Float32Array(t.defaultArg(n,1024)),this.setMap(e))},t.extend(t.WaveShaper,t.SignalBase),t.WaveShaper.prototype.setMap=function(t){for(var e=new Array(this._curve.length),n=0,r=this._curve.length;n<r;n++){var i=n/(r-1)*2-1;e[n]=t(i,n)}return this.curve=e,this},Object.defineProperty(t.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(t){this._curve=new Float32Array(t),this._shaper.curve=this._curve}}),Object.defineProperty(t.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){if(!["none","2x","4x"].includes(t))throw new RangeError("Tone.WaveShaper: oversampling must be either 'none', '2x', or '4x'");this._shaper.oversample=t}}),t.WaveShaper.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},t.WaveShaper}),e(function(t){return t.TimeBase=function(e,n){if(!(this instanceof t.TimeBase))return new t.TimeBase(e,n);if(this._val=e,this._units=n,t.isUndef(this._units)&&t.isString(this._val)&&parseFloat(this._val)==this._val&&"+"!==this._val.charAt(0))this._val=parseFloat(this._val),this._units=this._defaultUnits;else if(e&&e.constructor===this.constructor)this._val=e._val,this._units=e._units;else if(e instanceof t.TimeBase)switch(this._defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break;default:throw new Error("Unrecognized default units "+this._defaultUnits)}},t.extend(t.TimeBase),t.TimeBase.prototype._expressions={n:{regexp:/^(\d+)n(\.?)$/i,method:function(t,e){t=parseInt(t);var n="."===e?1.5:1;return 1===t?this._beatsToUnits(this._getTimeSignature())*n:this._beatsToUnits(4/t)*n}},t:{regexp:/^(\d+)t$/i,method:function(t){return t=parseInt(t),this._beatsToUnits(8/(3*parseInt(t)))}},m:{regexp:/^(\d+)m$/i,method:function(t){return this._beatsToUnits(parseInt(t)*this._getTimeSignature())}},i:{regexp:/^(\d+)i$/i,method:function(t){return this._ticksToUnits(parseInt(t))}},hz:{regexp:/^(\d+(?:\.\d+)?)hz$/i,method:function(t){return this._frequencyToUnits(parseFloat(t))}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/,method:function(t,e,n){var r=0;return t&&"0"!==t&&(r+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r+=this._beatsToUnits(parseFloat(n)/4)),r}},s:{regexp:/^(\d+(?:\.\d+)?)s$/,method:function(t){return this._secondsToUnits(parseFloat(t))}},samples:{regexp:/^(\d+)samples$/,method:function(t){return parseInt(t)/this.context.sampleRate}},default:{regexp:/^(\d+(?:\.\d+)?)$/,method:function(t){return this._expressions[this._defaultUnits].method.call(this,t)}}},t.TimeBase.prototype._defaultUnits="s",t.TimeBase.prototype._getBpm=function(){return t.Transport?t.Transport.bpm.value:120},t.TimeBase.prototype._getTimeSignature=function(){return t.Transport?t.Transport.timeSignature:4},t.TimeBase.prototype._getPPQ=function(){return t.Transport?t.Transport.PPQ:192},t.TimeBase.prototype._now=function(){return this.now()},t.TimeBase.prototype._frequencyToUnits=function(t){return 1/t},t.TimeBase.prototype._beatsToUnits=function(t){return 60/this._getBpm()*t},t.TimeBase.prototype._secondsToUnits=function(t){return t},t.TimeBase.prototype._ticksToUnits=function(t){return t*(this._beatsToUnits(1)/this._getPPQ())},t.TimeBase.prototype._noArg=function(){return this._now()},t.TimeBase.prototype.valueOf=function(){if(t.isUndef(this._val))return this._noArg();if(t.isString(this._val)&&t.isUndef(this._units))for(var e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}if(t.isDefined(this._units)){var n=this._expressions[this._units],r=this._val.toString().trim().match(n.regexp);return r?n.method.apply(this,r.slice(1)):n.method.call(this,parseFloat(this._val))}return this._val},t.TimeBase.prototype.toSeconds=function(){return this.valueOf()},t.TimeBase.prototype.toFrequency=function(){return 1/this.toSeconds()},t.TimeBase.prototype.toSamples=function(){return this.toSeconds()*this.context.sampleRate},t.TimeBase.prototype.toMilliseconds=function(){return 1e3*this.toSeconds()},t.TimeBase.prototype.dispose=function(){this._val=null,this._units=null},t.TimeBase}),e(function(t){t.Frequency=function(e,n){return this instanceof t.Frequency?void t.TimeBase.call(this,e,n):new t.Frequency(e,n)},t.extend(t.Frequency,t.TimeBase),t.Frequency.prototype._expressions=Object.assign({},t.TimeBase.prototype._expressions,{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(e){return"midi"===this._defaultUnits?e:t.Frequency.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(n,r){var i=e[n.toLowerCase()],o=i+12*(parseInt(r)+1);return"midi"===this._defaultUnits?o:t.Frequency.mtof(o)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(t,e,n){var r=1;return t&&"0"!==t&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(r*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}}),t.Frequency.prototype.transpose=function(e){return new this.constructor(this.valueOf()*t.intervalToFrequencyRatio(e))},t.Frequency.prototype.harmonize=function(t){return t.map(function(t){return this.transpose(t)}.bind(this))},t.Frequency.prototype.toMidi=function(){return t.Frequency.ftom(this.valueOf())},t.Frequency.prototype.toNote=function(){var e=this.toFrequency(),r=Math.log2(e/t.Frequency.A4),i=Math.round(12*r)+57,o=Math.floor(i/12);o<0&&(i+=-12*o);var a=n[i%12];return a+o.toString()},t.Frequency.prototype.toSeconds=function(){return 1/t.TimeBase.prototype.toSeconds.call(this)},t.Frequency.prototype.toFrequency=function(){return t.TimeBase.prototype.toFrequency.call(this)},t.Frequency.prototype.toTicks=function(){var e=this._beatsToUnits(1),n=this.valueOf()/e;return Math.floor(n*t.Transport.PPQ)},t.Frequency.prototype._noArg=function(){return 0},t.Frequency.prototype._frequencyToUnits=function(t){return t},t.Frequency.prototype._ticksToUnits=function(e){return 1/(60*e/(t.Transport.bpm.value*t.Transport.PPQ))},t.Frequency.prototype._beatsToUnits=function(e){return 1/t.TimeBase.prototype._beatsToUnits.call(this,e)},t.Frequency.prototype._secondsToUnits=function(t){return 1/t},t.Frequency.prototype._defaultUnits="hz";var e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},n=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return t.Frequency.A4=440,t.Frequency.mtof=function(e){return t.Frequency.A4*Math.pow(2,(e-69)/12)},t.Frequency.ftom=function(e){return 69+Math.round(12*Math.log2(e/t.Frequency.A4))},t.Frequency}),e(function(t){return t.Time=function(e,n){return this instanceof t.Time?void t.TimeBase.call(this,e,n):new t.Time(e,n)},t.extend(t.Time,t.TimeBase),t.Time.prototype._expressions=Object.assign({},t.TimeBase.prototype._expressions,{quantize:{regexp:/^@(.+)/,method:function(e){if(t.Transport){var n=new this.constructor(e);return t.Transport.nextSubdivision(n)}return 0}},now:{regexp:/^\+(.+)/,method:function(t){return this._now()+new this.constructor(t)}}}),t.Time.prototype.quantize=function(e,n){n=t.defaultArg(n,1);var r=new this.constructor(e),i=this.valueOf(),o=Math.round(i/r),a=o*r,s=a-i;return i+s*n},t.Time.prototype.toNotation=function(){for(var e=this.toSeconds(),n=["1m"],r=1;r<8;r++){var i=Math.pow(2,r);n.push(i+"n."),n.push(i+"n"),n.push(i+"t")}n.push("0");var o=n[0],a=t.Time(n[0]).toSeconds();return n.forEach(function(n){var r=t.Time(n).toSeconds();Math.abs(r-e)<Math.abs(a-e)&&(o=n,a=r)}),o},t.Time.prototype.toBarsBeatsSixteenths=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t,n=Math.floor(e/this._getTimeSignature()),r=e%1*4;e=Math.floor(e)%this._getTimeSignature(),r=r.toString(),r.length>3&&(r=parseFloat(parseFloat(r).toFixed(3)));var i=[n,e,r];return i.join(":")},t.Time.prototype.toTicks=function(){var t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())},t.Time.prototype.toSeconds=function(){return this.valueOf()},t.Time.prototype.toMidi=function(){return t.Frequency.ftom(this.toFrequency())},t.Time}),e(function(t){return t.TransportTime=function(e,n){return this instanceof t.TransportTime?void t.Time.call(this,e,n):new t.TransportTime(e,n)},t.extend(t.TransportTime,t.Time),t.TransportTime.prototype._now=function(){return t.Transport.seconds},t.TransportTime}),e(function(t){return t.Type={Default:"number",Time:"time",Frequency:"frequency",TransportTime:"transportTime",Ticks:"ticks",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Gain:"gain",Cents:"cents",Degrees:"degrees",MIDI:"midi",BarsBeatsSixteenths:"barsBeatsSixteenths",Samples:"samples",Hertz:"hertz",Note:"note",Milliseconds:"milliseconds",Seconds:"seconds",Notation:"notation"},t.prototype.toSeconds=function(e){return t.isNumber(e)?e:t.isUndef(e)?this.now():t.isString(e)?new t.Time(e).toSeconds():e instanceof t.TimeBase?e.toSeconds():void 0},t.prototype.toFrequency=function(e){return t.isNumber(e)?e:t.isString(e)||t.isUndef(e)?new t.Frequency(e).valueOf():e instanceof t.TimeBase?e.toFrequency():void 0},t.prototype.toTicks=function(e){return t.isNumber(e)||t.isString(e)?new t.TransportTime(e).toTicks():t.isUndef(e)?t.Transport.ticks:e instanceof t.TimeBase?e.toTicks():void 0},t}),e(function(t){return t.Param=function(){var e=t.defaults(arguments,["param","units","convert"],t.Param);t.AudioNode.call(this),this._param=this.input=e.param,this.units=e.units,this.convert=e.convert,this.overridden=!1,this._events=new t.Timeline(1e3),t.isDefined(e.value)&&this._param&&(this.value=e.value)},t.extend(t.Param,t.AudioNode),t.Param.defaults={units:t.Type.Default,convert:!0,param:void 0},Object.defineProperty(t.Param.prototype,"value",{get:function(){var t=this.now();return this._toUnits(this.getValueAtTime(t))},set:function(t){this._initialValue=this._fromUnits(t),this.cancelScheduledValues(this.context.currentTime),this.setValueAtTime(t,this.context.currentTime)}}),Object.defineProperty(t.Param.prototype,"minValue",{get:function(){return this.units===t.Type.Time||this.units===t.Type.Frequency||this.units===t.Type.NormalRange||this.units===t.Type.Positive||this.units===t.Type.BPM?0:this.units===t.Type.AudioRange?-1:this.units===t.Type.Decibels?-(1/0):this._param.minValue}}),Object.defineProperty(t.Param.prototype,"maxValue",{get:function(){return this.units===t.Type.NormalRange||this.units===t.Type.AudioRange?1:this._param.maxValue}}),t.Param.prototype._fromUnits=function(e){if(!this.convert&&!t.isUndef(this.convert)||this.overridden)return e;switch(this.units){case t.Type.Time:return this.toSeconds(e);case t.Type.Frequency:return this.toFrequency(e);case t.Type.Decibels:return t.dbToGain(e);case t.Type.NormalRange:return Math.min(Math.max(e,0),1);case t.Type.AudioRange:return Math.min(Math.max(e,-1),1);case t.Type.Positive:return Math.max(e,0);default:return e}},t.Param.prototype._toUnits=function(e){if(!this.convert&&!t.isUndef(this.convert))return e;switch(this.units){case t.Type.Decibels:
return t.gainToDb(e);default:return e}},t.Param.prototype._minOutput=1e-5,t.Param.AutomationType={Linear:"linearRampToValueAtTime",Exponential:"exponentialRampToValueAtTime",Target:"setTargetAtTime",SetValue:"setValueAtTime"},t.Param.prototype.setValueAtTime=function(e,n){return n=this.toSeconds(n),e=this._fromUnits(e),this._events.add({type:t.Param.AutomationType.SetValue,value:e,time:n}),this._param.setValueAtTime(e,n),this},t.Param.prototype.getValueAtTime=function(e){e=this.toSeconds(e);var n=this._events.getAfter(e),r=this._events.get(e),i=t.defaultArg(this._initialValue,this._param.defaultValue),o=i;if(null===r)o=i;else if(r.type===t.Param.AutomationType.Target){var a,s=this._events.getBefore(r.time);a=null===s?i:s.value,o=this._exponentialApproach(r.time,a,r.value,r.constant,e)}else o=null===n?r.value:n.type===t.Param.AutomationType.Linear?this._linearInterpolate(r.time,r.value,n.time,n.value,e):n.type===t.Param.AutomationType.Exponential?this._exponentialInterpolate(r.time,r.value,n.time,n.value,e):r.value;return o},t.Param.prototype.setRampPoint=function(t){t=this.toSeconds(t);var e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===e&&(e=this._minOutput),this.setValueAtTime(this._toUnits(e),t),this},t.Param.prototype.linearRampToValueAtTime=function(e,n){return e=this._fromUnits(e),n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Linear,value:e,time:n}),this._param.linearRampToValueAtTime(e,n),this},t.Param.prototype.exponentialRampToValueAtTime=function(e,n){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Exponential,time:n,value:e}),this._param.exponentialRampToValueAtTime(e,n),this},t.Param.prototype.exponentialRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.linearRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.targetRampTo=function(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this},t.Param.prototype.exponentialApproachValueAtTime=function(t,e,n){var r=Math.log(this.toSeconds(n)+1)/Math.log(200);return e=this.toSeconds(e),this.setTargetAtTime(t,e,r)},t.Param.prototype.setTargetAtTime=function(e,n,r){if(e=this._fromUnits(e),r<=0)throw new Error("timeConstant must be greater than 0");return n=this.toSeconds(n),this._events.add({type:t.Param.AutomationType.Target,value:e,time:n,constant:r}),this._param.setTargetAtTime(e,n,r),this},t.Param.prototype.setValueCurveAtTime=function(e,n,r,i){i=t.defaultArg(i,1),r=this.toSeconds(r),n=this.toSeconds(n),this.setValueAtTime(e[0]*i,n);for(var o=r/(e.length-1),a=1;a<e.length;a++)this.linearRampToValueAtTime(e[a]*i,n+a*o);return this},t.Param.prototype.cancelScheduledValues=function(t){return t=this.toSeconds(t),this._events.cancel(t),this._param.cancelScheduledValues(t),this},t.Param.prototype.cancelAndHoldAtTime=function(e){var n=this.getValueAtTime(e),r=this._events.get(e),i=this._events.getAfter(e);return r&&r.time===e?i?this._events.cancel(i.time):this._events.cancel(e+1e-6):i&&(this._events.cancel(i.time),this._param.cancelAndHoldAtTime||this._param.cancelScheduledValues(e),i.type===t.Param.AutomationType.Linear?this._param.cancelAndHoldAtTime?this._events.add({type:t.Param.AutomationType.Linear,value:n,time:e}):this.linearRampToValueAtTime(n,e):i.type===t.Param.AutomationType.Exponential&&(this._param.cancelAndHoldAtTime?this._events.add({type:t.Param.AutomationType.Exponential,value:n,time:e}):this.exponentialRampToValueAtTime(n,e))),this._events.add({type:t.Param.AutomationType.SetValue,value:n,time:e}),this._param.cancelAndHoldAtTime?this._param.cancelAndHoldAtTime(e):this._param.setValueAtTime(n,e),this},t.Param.prototype.rampTo=function(e,n,r){return n=t.defaultArg(n,.1),this.units===t.Type.Frequency||this.units===t.Type.BPM||this.units===t.Type.Decibels?this.exponentialRampTo(e,n,r):this.linearRampTo(e,n,r),this},t.Param.prototype._exponentialApproach=function(t,e,n,r,i){return n+(e-n)*Math.exp(-(i-t)/r)},t.Param.prototype._linearInterpolate=function(t,e,n,r,i){return e+(r-e)*((i-t)/(n-t))},t.Param.prototype._exponentialInterpolate=function(t,e,n,r,i){return e*Math.pow(r/e,(i-t)/(n-t))},t.Param.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._param=null,this._events=null,this},t.Param}),e(function(t){return t.OfflineContext=function(e,n,r){var i=new OfflineAudioContext(e,n*r,r);t.Context.call(this,{context:i,clockSource:"offline",lookAhead:0,updateInterval:128/r}),this._duration=n,this._currentTime=0},t.extend(t.OfflineContext,t.Context),t.OfflineContext.prototype.now=function(){return this._currentTime},t.OfflineContext.prototype.render=function(){for(;this._duration-this._currentTime>=0;)this.emit("tick"),this._currentTime+=this.blockTime;return this._context.startRendering()},t.OfflineContext.prototype.close=function(){return this._context=null,Promise.resolve()},t.OfflineContext}),e(function(t){if(t.supported){var e=navigator.userAgent.toLowerCase(),n=e.includes("safari")&&!e.includes("chrome")&&e.includes("mobile");n&&(t.OfflineContext.prototype.createBufferSource=function(){var t=this._context.createBufferSource(),e=t.start;return t.start=function(n){this.setTimeout(function(){e.call(t,n)}.bind(this),0)}.bind(this),t})}}),e(function(t){return t.Gain=function(){var e=t.defaults(arguments,["gain","units"],t.Gain);t.AudioNode.call(this),this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new t.Param({param:this._gainNode.gain,units:e.units,value:e.gain,convert:e.convert}),this._readOnly("gain")},t.extend(t.Gain,t.AudioNode),t.Gain.defaults={gain:1,convert:!0},t.Gain.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},t.Gain}),e(function(t){if(t.supported&&!AudioContext.prototype.createConstantSource){var e=function(t){this.context=t;for(var e=t.createBuffer(1,128,t.sampleRate),n=e.getChannelData(0),r=0;r<n.length;r++)n[r]=1;this._bufferSource=t.createBufferSource(),this._bufferSource.channelCount=1,this._bufferSource.channelCountMode="explicit",this._bufferSource.buffer=e,this._bufferSource.loop=!0;var i=this._output=t.createGain();this.offset=i.gain,this._bufferSource.connect(i)};e.prototype.start=function(t){return this._bufferSource.start(t),this},e.prototype.stop=function(t){return this._bufferSource.stop(t),this},e.prototype.connect=function(){return this._output.connect.apply(this._output,arguments),this},e.prototype.disconnect=function(){return this._output.disconnect.apply(this._output,arguments),this},AudioContext.prototype.createConstantSource=function(){return new e(this)},t.Context.prototype.createConstantSource=function(){return new e(this)}}}),e(function(t){return t.Signal=function(){var e=t.defaults(arguments,["value","units"],t.Signal);t.Param.call(this,e),this._proxies=[],this._sourceStarted=!1,this._constantSource=this.context.createConstantSource(),this._param=this._constantSource.offset,this.value=e.value,this.output=this._constantSource,this.input=this._param=this.output.offset},t.extend(t.Signal,t.Param),t.Signal.defaults={value:0,units:t.Type.Default,convert:!0},t.Signal.prototype.connect=function(e){return this._isParam(e)&&!this._sourceStarted?(this._proxies.push(e),e.overridden=!0,this._applyAutomations(e)):(t.SignalBase.prototype.connect.apply(this,arguments),this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0))),this},t.Signal.prototype._isParam=function(e){return t.Param&&t.Param===e.constructor||e instanceof AudioParam},t.Signal.prototype._connectProxies=function(){this._sourceStarted||(this._sourceStarted=!0,this._constantSource.start(0)),this._proxies.forEach(function(e){t.SignalBase.prototype.connect.call(this,e),e._proxies&&e._connectProxies()}.bind(this))},t.Signal.prototype._onConnect=function(t){this._isParam(t)||this._connectProxies()},t.Signal.prototype._applyAutomations=function(t){var e=this.context.currentTime;t.cancelScheduledValues(e);var n=this.getValueAtTime(e);t.setValueAtTime(n,e),this._events.forEachFrom(e,function(e){t[e.type](e.value,e.time,e.constant)})},t.Signal.prototype.disconnect=function(e){if(this._proxies.includes(e)){var n=this._proxies.indexOf(e);this._proxies.splice(n,1)}else e||(this._proxies=[]);return t.SignalBase.prototype.disconnect.apply(this,arguments)},t.Signal.prototype.getValueAtTime=function(e){return this._param.getValueAtTime?this._param.getValueAtTime(e):t.Param.prototype.getValueAtTime.call(this,e)},["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime","setTargetAtTime"].forEach(function(e){var n=t.Signal.prototype[e];t.Signal.prototype[e]=function(){var t=arguments;n.apply(this,arguments),t[0]=this._fromUnits(t[0]),t[1]=this.toSeconds(t[1]),this._proxies.forEach(function(n){n[e].apply(n,t)})}}),["cancelScheduledValues","cancelAndHoldAtTime"].forEach(function(e){var n=t.Signal.prototype[e];t.Signal.prototype[e]=function(){var t=arguments;n.apply(this,arguments),t[0]=this.toSeconds(t[0]),this._proxies.forEach(function(n){n[e].apply(n,t)})}}),t.Signal.prototype.dispose=function(){return t.Param.prototype.dispose.call(this),this._constantSource.disconnect(),this._constantSource=null,this._proxies=null,this},t.Signal}),e(function(t){return t.Pow=function(e){t.SignalBase.call(this),this._exp=t.defaultArg(e,1),this._expScaler=this.input=this.output=new t.WaveShaper(this._expFunc(this._exp),8192)},t.extend(t.Pow,t.SignalBase),Object.defineProperty(t.Pow.prototype,"value",{get:function(){return this._exp},set:function(t){this._exp=t,this._expScaler.setMap(this._expFunc(this._exp))}}),t.Pow.prototype._expFunc=function(t){return function(e){return Math.pow(Math.abs(e),t)}},t.Pow.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},t.Pow}),e(function(t){return t.Envelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.AudioNode.call(this),this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this._attackCurve="linear",this._releaseCurve="exponential",this._sig=this.output=new t.Signal(0),this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve},t.extend(t.Envelope,t.AudioNode),t.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(t.Envelope.prototype,"value",{get:function(){return this.getValueAtTime(this.now())}}),Object.defineProperty(t.Envelope.prototype,"attackCurve",{get:function(){if(t.isString(this._attackCurve))return this._attackCurve;if(t.isArray(this._attackCurve)){for(var e in t.Envelope.Type)if(t.Envelope.Type[e].In===this._attackCurve)return e;return this._attackCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var n=t.Envelope.Type[e];t.isObject(n)?this._attackCurve=n.In:this._attackCurve=n}else{if(!t.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._attackCurve=e}}}),Object.defineProperty(t.Envelope.prototype,"releaseCurve",{get:function(){if(t.isString(this._releaseCurve))return this._releaseCurve;if(t.isArray(this._releaseCurve)){for(var e in t.Envelope.Type)if(t.Envelope.Type[e].Out===this._releaseCurve)return e;return this._releaseCurve}},set:function(e){if(t.Envelope.Type.hasOwnProperty(e)){var n=t.Envelope.Type[e];t.isObject(n)?this._releaseCurve=n.Out:this._releaseCurve=n}else{if(!t.isArray(e))throw new Error("Tone.Envelope: invalid curve: "+e);this._releaseCurve=e}}}),t.Envelope.prototype.triggerAttack=function(e,n){e=this.toSeconds(e);var r=this.toSeconds(this.attack),i=r,o=this.toSeconds(this.decay);n=t.defaultArg(n,1);var a=this.getValueAtTime(e);if(a>0){var s=1/i,u=1-a;i=u/s}if("linear"===this._attackCurve)this._sig.linearRampTo(n,i,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(n,i,e);else if(i>0){this._sig.cancelAndHoldAtTime(e);var l=this._attackCurve;if(i<r){var c=1-i/r,p=Math.floor(c*this._attackCurve.length);l=this._attackCurve.slice(p),l[0]=a}this._sig.setValueCurveAtTime(l,e,i,n)}return o&&this._sig.targetRampTo(n*this.sustain,o,i+e),this},t.Envelope.prototype.triggerRelease=function(e){e=this.toSeconds(e);var n=this.getValueAtTime(e);if(n>0){var r=this.toSeconds(this.release);if("linear"===this._releaseCurve)this._sig.linearRampTo(0,r,e);else if("exponential"===this._releaseCurve)this._sig.targetRampTo(0,r,e);else{var i=this._releaseCurve;t.isArray(i)&&(this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(i,e,r,n))}}return this},t.Envelope.prototype.getValueAtTime=function(t){return this._sig.getValueAtTime(t)},t.Envelope.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this},t.Envelope.prototype.cancel=function(t){return this._sig.cancelScheduledValues(t),this},t.Envelope.prototype.connect=t.SignalBase.prototype.connect,function(){function e(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=1-t[n];return e}function n(t){return t.slice(0).reverse()}var r,i,o=128,a=[];for(r=0;r<o;r++)a[r]=Math.sin(r/(o-1)*(Math.PI/2));var s=[],u=6.4;for(r=0;r<o-1;r++){i=r/(o-1);var l=Math.sin(i*(2*Math.PI)*u-Math.PI/2)+1;s[r]=l/10+.83*i}s[o-1]=1;var c=[],p=5;for(r=0;r<o;r++)c[r]=Math.ceil(r/(o-1)*p)/p;var h=[];for(r=0;r<o;r++)i=r/(o-1),h[r]=.5*(1-Math.cos(Math.PI*i));var f=[];for(r=0;r<o;r++){i=r/(o-1);var d=4*Math.pow(i,3)+.2,m=Math.cos(d*Math.PI*2*i);f[r]=Math.abs(m*(1-i))}t.Envelope.Type={linear:"linear",exponential:"exponential",bounce:{In:e(f),Out:f},cosine:{In:a,Out:n(a)},step:{In:c,Out:e(c)},ripple:{In:s,Out:e(s)},sine:{In:h,Out:e(h)}}}(),t.Envelope.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this._attackCurve=null,this._releaseCurve=null,this},t.Envelope}),e(function(t){return t.AmplitudeEnvelope=function(){t.Envelope.apply(this,arguments),this.input=this.output=new t.Gain,this._sig.connect(this.output.gain)},t.extend(t.AmplitudeEnvelope,t.Envelope),t.AmplitudeEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this},t.AmplitudeEnvelope}),e(function(t){t.supported&&(AnalyserNode.prototype.getFloatTimeDomainData||(AnalyserNode.prototype.getFloatTimeDomainData=function(t){var e=new Uint8Array(t.length);this.getByteTimeDomainData(e);for(var n=0;n<e.length;n++)t[n]=(e[n]-128)/128}))}),e(function(t){return t.Analyser=function(){var e=t.defaults(arguments,["type","size"],t.Analyser);t.AudioNode.call(this),this._analyser=this.input=this.output=this.context.createAnalyser(),this._type=e.type,this._buffer=null,this.size=e.size,this.type=e.type},t.extend(t.Analyser,t.AudioNode),t.Analyser.defaults={size:1024,type:"fft",smoothing:.8},t.Analyser.Type={Waveform:"waveform",FFT:"fft"},t.Analyser.prototype.getValue=function(){return this._type===t.Analyser.Type.FFT?this._analyser.getFloatFrequencyData(this._buffer):this._type===t.Analyser.Type.Waveform&&this._analyser.getFloatTimeDomainData(this._buffer),this._buffer},Object.defineProperty(t.Analyser.prototype,"size",{get:function(){return this._analyser.frequencyBinCount},set:function(t){this._analyser.fftSize=2*t,this._buffer=new Float32Array(t)}}),Object.defineProperty(t.Analyser.prototype,"type",{get:function(){return this._type},set:function(e){if(e!==t.Analyser.Type.Waveform&&e!==t.Analyser.Type.FFT)throw new TypeError("Tone.Analyser: invalid type: "+e);this._type=e}}),Object.defineProperty(t.Analyser.prototype,"smoothing",{get:function(){return this._analyser.smoothingTimeConstant},set:function(t){this._analyser.smoothingTimeConstant=t}}),t.Analyser.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.disconnect(),this._analyser=null,this._buffer=null},t.Analyser}),e(function(t){return t.Compressor=function(){var e=t.defaults(arguments,["threshold","ratio"],t.Compressor);t.AudioNode.call(this),this._compressor=this.input=this.output=this.context.createDynamicsCompressor(),this.threshold=new t.Param({param:this._compressor.threshold,units:t.Type.Decibels,convert:!1}),this.attack=new t.Param(this._compressor.attack,t.Type.Time),this.release=new t.Param(this._compressor.release,t.Type.Time),this.knee=new t.Param({param:this._compressor.knee,units:t.Type.Decibels,convert:!1}),this.ratio=new t.Param({param:this._compressor.ratio,convert:!1}),this._readOnly(["knee","release","attack","ratio","threshold"]),this.set(e)},t.extend(t.Compressor,t.AudioNode),t.Compressor.defaults={ratio:12,threshold:-24,release:.25,attack:.003,knee:30},t.Compressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["knee","release","attack","ratio","threshold"]),this._compressor.disconnect(),this._compressor=null,this.attack.dispose(),this.attack=null,this.release.dispose(),this.release=null,this.threshold.dispose(),this.threshold=null,this.ratio.dispose(),this.ratio=null,this.knee.dispose(),this.knee=null,this},t.Compressor}),e(function(t){return t.Add=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.input[1]=this.output=new t.Gain,this._param=this.input[1]=new t.Signal(e),this._param.connect(this._sum)},t.extend(t.Add,t.Signal),t.Add.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._sum.dispose(),this._sum=null,this},t.Add}),e(function(t){return t.Multiply=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._mult=this.input[0]=this.output=new t.Gain,this._param=this.input[1]=this.output.gain,this.value=t.defaultArg(e,0)},t.extend(t.Multiply,t.Signal),t.Multiply.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._mult.dispose(),this._mult=null,this._param=null,this},t.Multiply}),e(function(t){return t.Negate=function(){t.SignalBase.call(this),this._multiply=this.input=this.output=new t.Multiply(-1)},t.extend(t.Negate,t.SignalBase),t.Negate.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._multiply.dispose(),this._multiply=null,this},t.Negate}),e(function(t){return t.Subtract=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._sum=this.input[0]=this.output=new t.Gain,this._neg=new t.Negate,this._param=this.input[1]=new t.Signal(e),this._param.chain(this._neg,this._sum)},t.extend(t.Subtract,t.Signal),t.Subtract.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._neg.dispose(),this._neg=null,this._sum.disconnect(),this._sum=null,this},t.Subtract}),e(function(t){return t.EqualPowerGain=function(){t.SignalBase.call(this),this._eqPower=this.input=this.output=new t.WaveShaper(function(e){return Math.abs(e)<.001?0:t.equalPowerScale(e)}.bind(this),4096)},t.extend(t.EqualPowerGain,t.SignalBase),t.EqualPowerGain.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._eqPower.dispose(),this._eqPower=null,this},t.EqualPowerGain}),e(function(t){return t.CrossFade=function(e){t.AudioNode.call(this),this.createInsOuts(2,1),this.a=this.input[0]=new t.Gain,this.b=this.input[1]=new t.Gain,this.fade=new t.Signal(t.defaultArg(e,.5),t.Type.NormalRange),this._equalPowerA=new t.EqualPowerGain,this._equalPowerB=new t.EqualPowerGain,this._one=this.context.getConstant(1),this._invert=new t.Subtract,this.a.connect(this.output),this.b.connect(this.output),this.fade.chain(this._equalPowerB,this.b.gain),this._one.connect(this._invert,0,0),this.fade.connect(this._invert,0,1),this._invert.chain(this._equalPowerA,this.a.gain),this._readOnly("fade")},t.extend(t.CrossFade,t.AudioNode),t.CrossFade.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("fade"),this._equalPowerA.dispose(),this._equalPowerA=null,this._equalPowerB.dispose(),this._equalPowerB=null,this.fade.dispose(),this.fade=null,this._invert.dispose(),this._invert=null,this._one=null,this.a.dispose(),this.a=null,this.b.dispose(),this.b=null,this},t.CrossFade}),e(function(t){return t.Filter=function(){var e=t.defaults(arguments,["frequency","type","rolloff"],t.Filter);t.AudioNode.call(this),this.createInsOuts(1,1),this._filters=[],this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(0,t.Type.Cents),this.gain=new t.Signal({value:e.gain,convert:!1}),this.Q=new t.Signal(e.Q),this._type=e.type,this._rolloff=e.rolloff,this.rolloff=e.rolloff,this._readOnly(["detune","frequency","gain","Q"])},t.extend(t.Filter,t.AudioNode),t.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(t.Filter.prototype,"type",{get:function(){return this._type},set:function(t){var e=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(e.indexOf(t)===-1)throw new TypeError("Tone.Filter: invalid type "+t);this._type=t;for(var n=0;n<this._filters.length;n++)this._filters[n].type=t}}),Object.defineProperty(t.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(e){e=parseInt(e,10);var n=[-12,-24,-48,-96],r=n.indexOf(e);if(r===-1)throw new RangeError("Tone.Filter: rolloff can only be -12, -24, -48 or -96");r+=1,this._rolloff=e,this.input.disconnect();for(var i=0;i<this._filters.length;i++)this._filters[i].disconnect(),this._filters[i]=null;this._filters=new Array(r);for(var o=0;o<r;o++){var a=this.context.createBiquadFilter();a.type=this._type,this.frequency.connect(a.frequency),this.detune.connect(a.detune),this.Q.connect(a.Q),this.gain.connect(a.gain),this._filters[o]=a}var s=[this.input].concat(this._filters).concat([this.output]);t.connectSeries.apply(t,s)}}),t.Filter.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this);for(var e=0;e<this._filters.length;e++)this._filters[e].disconnect(),this._filters[e]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},t.Filter}),e(function(t){return t.MultibandSplit=function(){var e=t.defaults(arguments,["lowFrequency","highFrequency"],t.MultibandSplit);t.AudioNode.call(this),this.input=new t.Gain,this.output=new Array(3),this.low=this.output[0]=new t.Filter(0,"lowpass"),this._lowMidFilter=new t.Filter(0,"highpass"),this.mid=this.output[1]=new t.Filter(0,"lowpass"),this.high=this.output[2]=new t.Filter(0,"highpass"),this.lowFrequency=new t.Signal(e.lowFrequency,t.Type.Frequency),this.highFrequency=new t.Signal(e.highFrequency,t.Type.Frequency),this.Q=new t.Signal(e.Q),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.connect(this.low.frequency),this.lowFrequency.connect(this._lowMidFilter.frequency),this.highFrequency.connect(this.mid.frequency),this.highFrequency.connect(this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandSplit,t.AudioNode),t.MultibandSplit.defaults={lowFrequency:400,highFrequency:2500,Q:1},t.MultibandSplit.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.low=null,this._lowMidFilter.dispose(),this._lowMidFilter=null,this.mid.dispose(),this.mid=null,this.high.dispose(),this.high=null,this.lowFrequency.dispose(),this.lowFrequency=null,this.highFrequency.dispose(),this.highFrequency=null,this.Q.dispose(),this.Q=null,this},t.MultibandSplit}),e(function(t){return t.EQ3=function(){var e=t.defaults(arguments,["low","mid","high"],t.EQ3);t.AudioNode.call(this),this.output=new t.Gain,this._multibandSplit=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this._lowGain=new t.Gain(e.low,t.Type.Decibels),this._midGain=new t.Gain(e.mid,t.Type.Decibels),this._highGain=new t.Gain(e.high,t.Type.Decibels),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),this._readOnly(["low","mid","high","lowFrequency","highFrequency"])},t.extend(t.EQ3,t.AudioNode),t.EQ3.defaults={low:0,mid:0,high:0,lowFrequency:400,highFrequency:2500},t.EQ3.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this._multibandSplit=null,this.lowFrequency=null,this.highFrequency=null,this._lowGain.dispose(),this._lowGain=null,this._midGain.dispose(),this._midGain=null,this._highGain.dispose(),this._highGain=null,this.low=null,this.mid=null,this.high=null,this.Q=null,this},t.EQ3}),e(function(t){return t.Scale=function(e,n){t.SignalBase.call(this),this._outputMin=t.defaultArg(e,0),this._outputMax=t.defaultArg(n,1),this._scale=this.input=new t.Multiply(1),this._add=this.output=new t.Add(0),this._scale.connect(this._add),this._setRange()},t.extend(t.Scale,t.SignalBase),Object.defineProperty(t.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(t){this._outputMin=t,this._setRange()}}),Object.defineProperty(t.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(t){this._outputMax=t,this._setRange()}}),t.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},t.Scale.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},t.Scale}),e(function(t){return t.ScaleExp=function(e,n,r){t.SignalBase.call(this),this._scale=this.output=new t.Scale(e,n),this._exp=this.input=new t.Pow(t.defaultArg(r,2)),this._exp.connect(this._scale)},t.extend(t.ScaleExp,t.SignalBase),Object.defineProperty(t.ScaleExp.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),Object.defineProperty(t.ScaleExp.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}}),Object.defineProperty(t.ScaleExp.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}}),t.ScaleExp.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaleExp}),e(function(t){return t.Delay=function(){var e=t.defaults(arguments,["delayTime","maxDelay"],t.Delay);t.AudioNode.call(this),this._maxDelay=Math.max(this.toSeconds(e.maxDelay),this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(this._maxDelay),this.delayTime=new t.Param({param:this._delayNode.delayTime,units:t.Type.Time,value:e.delayTime}),this._readOnly("delayTime")},t.extend(t.Delay,t.AudioNode),t.Delay.defaults={maxDelay:1,delayTime:0},Object.defineProperty(t.Delay.prototype,"maxDelay",{get:function(){return this._maxDelay}}),t.Delay.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._delayNode.disconnect(),this._delayNode=null,this._writable("delayTime"),this.delayTime=null,this},t.Delay}),e(function(t){return t.FeedbackCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance"],t.FeedbackCombFilter);t.AudioNode.call(this),this._delay=this.input=this.output=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._feedback,this._delay),this._readOnly(["resonance","delayTime"])},t.extend(t.FeedbackCombFilter,t.AudioNode),t.FeedbackCombFilter.defaults={delayTime:.1,resonance:.5},t.FeedbackCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["resonance","delayTime"]),this._delay.dispose(),this._delay=null,this.delayTime=null,this._feedback.dispose(),this._feedback=null,this.resonance=null,this},t.FeedbackCombFilter}),e(function(t){return t.FFT=function(){var e=t.defaults(arguments,["size"],t.FFT);e.type=t.Analyser.Type.FFT,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.FFT,t.AudioNode),t.FFT.defaults={size:1024},t.FFT.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.FFT.prototype,"size",{get:function(){return this._analyser.size},set:function(t){this._analyser.size=t}}),t.FFT.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.FFT}),e(function(t){return t.Abs=function(){t.SignalBase.call(this),this._abs=this.input=this.output=new t.WaveShaper(function(t){return Math.abs(t)<.001?0:Math.abs(t)},1024)},t.extend(t.Abs,t.SignalBase),t.Abs.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._abs.dispose(),this._abs=null,this},t.Abs}),e(function(t){return t.Follower=function(){var e=t.defaults(arguments,["attack","release"],t.Follower);t.AudioNode.call(this),this.createInsOuts(1,1),this._abs=new t.Abs,this._filter=this.context.createBiquadFilter(),this._filter.type="lowpass",this._filter.frequency.value=0,this._filter.Q.value=-100,this._frequencyValues=new t.WaveShaper,this._sub=new t.Subtract,this._delay=new t.Delay(this.blockTime),this._mult=new t.Multiply(1e4),this._attack=e.attack,this._release=e.release,this.input.chain(this._abs,this._filter,this.output),this._abs.connect(this._sub,0,1),this._filter.chain(this._delay,this._sub),this._sub.chain(this._mult,this._frequencyValues,this._filter.frequency),this._setAttackRelease(this._attack,this._release)},t.extend(t.Follower,t.AudioNode),t.Follower.defaults={attack:.05,release:.5},t.Follower.prototype._setAttackRelease=function(e,n){var r=this.blockTime;e=t.Time(e).toFrequency(),n=t.Time(n).toFrequency(),e=Math.max(e,r),n=Math.max(n,r),this._frequencyValues.setMap(function(t){return t<=0?e:n})},Object.defineProperty(t.Follower.prototype,"attack",{get:function(){return this._attack},set:function(t){this._attack=t,this._setAttackRelease(this._attack,this._release)}}),Object.defineProperty(t.Follower.prototype,"release",{get:function(){return this._release},set:function(t){this._release=t,this._setAttackRelease(this._attack,this._release)}}),t.Follower.prototype.connect=t.SignalBase.prototype.connect,t.Follower.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._filter.disconnect(),this._filter=null,this._frequencyValues.disconnect(),this._frequencyValues=null,this._delay.dispose(),this._delay=null,this._sub.disconnect(),this._sub=null,this._abs.dispose(),this._abs=null,this._mult.dispose(),this._mult=null,this._curve=null,this},t.Follower}),e(function(t){return t.ScaledEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.Envelope.call(this,e),e=t.defaultArg(e,t.ScaledEnvelope.defaults),this._exp=this.output=new t.Pow(e.exponent),this._scale=this.output=new t.Scale(e.min,e.max),this._sig.chain(this._exp,this._scale)},t.extend(t.ScaledEnvelope,t.Envelope),t.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(t.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"exponent",{get:function(){
return this._exp.value},set:function(t){this._exp.value=t}}),t.ScaledEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaledEnvelope}),e(function(t){return t.FrequencyEnvelope=function(){var e=t.defaults(arguments,["attack","decay","sustain","release"],t.Envelope);t.ScaledEnvelope.call(this,e),e=t.defaultArg(e,t.FrequencyEnvelope.defaults),this._octaves=e.octaves,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves},t.extend(t.FrequencyEnvelope,t.Envelope),t.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(t.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(t){this._scale.min=this.toFrequency(t),this.octaves=this._octaves}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._scale.max=this.baseFrequency*Math.pow(2,t)}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),t.FrequencyEnvelope.prototype.dispose=function(){return t.ScaledEnvelope.prototype.dispose.call(this),this},t.FrequencyEnvelope}),e(function(t){return t.GreaterThanZero=function(){t.SignalBase.call(this),this._thresh=this.output=new t.WaveShaper(function(t){return t<=0?0:1},127),this._scale=this.input=new t.Multiply(1e4),this._scale.connect(this._thresh)},t.extend(t.GreaterThanZero,t.SignalBase),t.GreaterThanZero.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._thresh.dispose(),this._thresh=null,this},t.GreaterThanZero}),e(function(t){return t.GreaterThan=function(e){t.Signal.call(this),this.createInsOuts(2,0),this._param=this.input[0]=new t.Subtract(e),this.input[1]=this._param.input[1],this._gtz=this.output=new t.GreaterThanZero,this._param.connect(this._gtz)},t.extend(t.GreaterThan,t.Signal),t.GreaterThan.prototype.dispose=function(){return t.Signal.prototype.dispose.call(this),this._gtz.dispose(),this._gtz=null,this},t.GreaterThan}),e(function(t){return t.Gate=function(){var e=t.defaults(arguments,["threshold","attack","release"],t.Gate);t.AudioNode.call(this),this.createInsOuts(1,1),this._follower=new t.Follower(e.attack,e.release),this._gt=new t.GreaterThan(t.dbToGain(e.threshold)),this.input.connect(this.output),this.input.chain(this._gt,this._follower,this.output.gain)},t.extend(t.Gate,t.AudioNode),t.Gate.defaults={attack:.1,release:.1,threshold:-40},Object.defineProperty(t.Gate.prototype,"threshold",{get:function(){return t.gainToDb(this._gt.value)},set:function(e){this._gt.value=t.dbToGain(e)}}),Object.defineProperty(t.Gate.prototype,"attack",{get:function(){return this._follower.attack},set:function(t){this._follower.attack=t}}),Object.defineProperty(t.Gate.prototype,"release",{get:function(){return this._follower.release},set:function(t){this._follower.release=t}}),t.Gate.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._follower.dispose(),this._gt.dispose(),this._follower=null,this._gt=null,this},t.Gate}),e(function(t){function e(t){return function(e,n){n=this.toSeconds(n),t.apply(this,arguments);var r=this._events.get(n),i=this._events.previousEvent(r),o=this._getTicksUntilEvent(i,n);return r.ticks=Math.max(o,0),this}}return t.TickSignal=function(e){e=t.defaultArg(e,1),t.Signal.call(this,{units:t.Type.Ticks,value:e}),this._events.memory=1/0,this.cancelScheduledValues(0),this._events.add({type:t.Param.AutomationType.SetValue,time:0,value:e})},t.extend(t.TickSignal,t.Signal),t.TickSignal.prototype.setValueAtTime=e(t.Signal.prototype.setValueAtTime),t.TickSignal.prototype.linearRampToValueAtTime=e(t.Signal.prototype.linearRampToValueAtTime),t.TickSignal.prototype.setTargetAtTime=function(t,e,n){e=this.toSeconds(e),this.setRampPoint(e),t=this._fromUnits(t);for(var r=this._events.get(e),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var a=n*o+e,s=this._exponentialApproach(r.time,r.value,t,n,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},t.TickSignal.prototype.exponentialRampToValueAtTime=function(t,e){e=this.toSeconds(e),t=this._fromUnits(t);var n=this._events.get(e);null===n&&(n={value:this._initialValue,time:0});for(var r=Math.round(Math.max(10*(e-n.time),1)),i=(e-n.time)/r,o=0;o<=r;o++){var a=i*o+n.time,s=this._exponentialInterpolate(n.time,n.value,e,t,a);this.linearRampToValueAtTime(this._toUnits(s),a)}return this},t.TickSignal.prototype._getTicksUntilEvent=function(e,n){if(null===e)e={ticks:0,time:0};else if(t.isUndef(e.ticks)){var r=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(r,e.time)}var i=this.getValueAtTime(e.time),o=this.getValueAtTime(n);return this._events.get(n).time===n&&this._events.get(n).type===t.Param.AutomationType.SetValue&&(o=this.getValueAtTime(n-this.sampleTime)),.5*(n-e.time)*(i+o)+e.ticks},t.TickSignal.prototype.getTicksAtTime=function(t){t=this.toSeconds(t);var e=this._events.get(t);return Math.max(this._getTicksUntilEvent(e,t),0)},t.TickSignal.prototype.getDurationOfTicks=function(t,e){e=this.toSeconds(e);var n=this.getTicksAtTime(e);return this.getTimeOfTick(n+t)-e},t.TickSignal.prototype.getTimeOfTick=function(e){var n=this._events.get(e,"ticks"),r=this._events.getAfter(e,"ticks");if(n&&n.ticks===e)return n.time;if(n&&r&&r.type===t.Param.AutomationType.Linear&&n.value!==r.value){var i=this.getValueAtTime(n.time),o=this.getValueAtTime(r.time),a=(o-i)/(r.time-n.time),s=Math.sqrt(Math.pow(i,2)-2*a*(n.ticks-e)),u=(-i+s)/a,l=(-i-s)/a;return(u>0?u:l)+n.time}return n?0===n.value?1/0:n.time+(e-n.ticks)/n.value:e/this._initialValue},t.TickSignal.prototype.ticksToTime=function(e,n){return n=this.toSeconds(n),new t.Time(this.getDurationOfTicks(e,n))},t.TickSignal.prototype.timeToTicks=function(e,n){n=this.toSeconds(n),e=this.toSeconds(e);var r=this.getTicksAtTime(n),i=this.getTicksAtTime(n+e);return new t.Ticks(i-r)},t.TickSignal}),e(function(t){return t.TimelineState=function(e){t.Timeline.call(this),this._initial=e},t.extend(t.TimelineState,t.Timeline),t.TimelineState.prototype.getValueAtTime=function(t){var e=this.get(t);return null!==e?e.state:this._initial},t.TimelineState.prototype.setStateAtTime=function(t,e){return this.add({state:t,time:e}),this},t.TimelineState.prototype.getLastState=function(t,e){e=this.toSeconds(e);for(var n=this._search(e),r=n;r>=0;r--){var i=this._timeline[r];if(i.state===t)return i}},t.TimelineState.prototype.getNextState=function(t,e){e=this.toSeconds(e);var n=this._search(e);if(n!==-1)for(var r=n;r<this._timeline.length;r++){var i=this._timeline[r];if(i.state===t)return i}},t.TimelineState}),e(function(t){return t.TickSource=function(){var e=t.defaults(arguments,["frequency"],t.TickSource);this.frequency=new t.TickSignal(e.frequency,t.Type.Frequency),this._readOnly("frequency"),this._state=new t.TimelineState(t.State.Stopped),this._state.setStateAtTime(t.State.Stopped,0),this._tickOffset=new t.Timeline,this.setTicksAtTime(0,0)},t.extend(t.TickSource),t.TickSource.defaults={frequency:1},Object.defineProperty(t.TickSource.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),t.TickSource.prototype.start=function(e,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==t.State.Started&&(this._state.setStateAtTime(t.State.Started,e),t.isDefined(n)&&this.setTicksAtTime(n,e)),this},t.TickSource.prototype.stop=function(e){if(e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Stopped){var n=this._state.get(e);n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this.setTicksAtTime(0,e),this},t.TickSource.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started&&this._state.setStateAtTime(t.State.Paused,e),this},t.TickSource.prototype.cancel=function(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this},t.TickSource.prototype.getTicksAtTime=function(e){e=this.toSeconds(e);var n=this._state.getLastState(t.State.Stopped,e),r={state:t.State.Paused,time:e};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,e+this.sampleTime,function(e){var n=i.time,r=this._tickOffset.get(e.time);r.time>=i.time&&(o=r.ticks,n=r.time),i.state===t.State.Started&&e.state!==t.State.Started&&(o+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(n)),i=e}.bind(this)),this._state.remove(r),o},Object.defineProperty(t.TickSource.prototype,"ticks",{get:function(){return this.getTicksAtTime(this.now())},set:function(t){this.setTicksAtTime(t,this.now())}}),Object.defineProperty(t.TickSource.prototype,"seconds",{get:function(){return this.getSecondsAtTime(this.now())},set:function(t){var e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}}),t.TickSource.prototype.getSecondsAtTime=function(e){e=this.toSeconds(e);var n=this._state.getLastState(t.State.Stopped,e),r={state:t.State.Paused,time:e};this._state.add(r);var i=n,o=0;return this._state.forEachBetween(n.time,e+this.sampleTime,function(e){var n=i.time,r=this._tickOffset.get(e.time);r.time>=i.time&&(o=r.seconds,n=r.time),i.state===t.State.Started&&e.state!==t.State.Started&&(o+=e.time-n),i=e}.bind(this)),this._state.remove(r),o},t.TickSource.prototype.setTicksAtTime=function(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({time:e,ticks:t,seconds:this.frequency.getDurationOfTicks(t,e)}),this},t.TickSource.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},t.TickSource.prototype.getTimeOfTick=function(e,n){n=t.defaultArg(n,this.now());var r=this._tickOffset.get(n),i=this._state.get(n),o=Math.max(r.time,i.time),a=this.frequency.getTicksAtTime(o)+e-r.ticks;return this.frequency.getTimeOfTick(a)},t.TickSource.prototype.forEachTickBetween=function(e,n,r){var i=this._state.get(e);if(this._state.forEachBetween(e,n,function(n){i.state===t.State.Started&&n.state!==t.State.Started&&this.forEachTickBetween(Math.max(i.time,e),n.time-this.sampleTime,r),i=n}.bind(this)),e=Math.max(i.time,e),i.state===t.State.Started&&this._state){var o=this.frequency.getTicksAtTime(e),a=this.frequency.getTicksAtTime(i.time),s=o-a,u=s%1;0!==u&&(u=1-u);for(var l=this.frequency.getTimeOfTick(o+u),c=null;l<n&&this._state;){try{r(l,Math.round(this.getTicksAtTime(l)))}catch(t){c=t;break}this._state&&(l+=this.frequency.getDurationOfTicks(1,l))}}if(c)throw c;return this},t.TickSource.prototype.dispose=function(){return t.Param.prototype.dispose.call(this),this._state.dispose(),this._state=null,this._tickOffset.dispose(),this._tickOffset=null,this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this},t.TickSource}),e(function(t){return t.Clock=function(){var e=t.defaults(arguments,["callback","frequency"],t.Clock);t.Emitter.call(this),this.callback=e.callback,this._nextTick=0,this._tickSource=new t.TickSource(e.frequency),this._lastUpdate=0,this.frequency=this._tickSource.frequency,this._readOnly("frequency"),this._state=new t.TimelineState(t.State.Stopped),this._state.setStateAtTime(t.State.Stopped,0),this._boundLoop=this._loop.bind(this),this.context.on("tick",this._boundLoop)},t.extend(t.Clock,t.Emitter),t.Clock.defaults={callback:t.noOp,frequency:1},Object.defineProperty(t.Clock.prototype,"state",{get:function(){return this._state.getValueAtTime(this.now())}}),t.Clock.prototype.start=function(e,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)!==t.State.Started&&(this._state.setStateAtTime(t.State.Started,e),this._tickSource.start(e,n),e<this._lastUpdate&&this.emit("start",e,n)),this},t.Clock.prototype.stop=function(e){return e=this.toSeconds(e),this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this},t.Clock.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started&&(this._state.setStateAtTime(t.State.Paused,e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this},Object.defineProperty(t.Clock.prototype,"ticks",{get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(t){this._tickSource.ticks=t}}),Object.defineProperty(t.Clock.prototype,"seconds",{get:function(){return this._tickSource.seconds},set:function(t){this._tickSource.seconds=t}}),t.Clock.prototype.getSecondsAtTime=function(t){return this._tickSource.getSecondsAtTime(t)},t.Clock.prototype.setTicksAtTime=function(t,e){return this._tickSource.setTicksAtTime(t,e),this},t.Clock.prototype.getTicksAtTime=function(t){return this._tickSource.getTicksAtTime(t)},t.Clock.prototype.nextTickTime=function(t,e){e=this.toSeconds(e);var n=this.getTicksAtTime(e);return this._tickSource.getTimeOfTick(n+t,e)},t.Clock.prototype._loop=function(){var e=this._lastUpdate,n=this.now();this._lastUpdate=n,e!==n&&(this._state.forEachBetween(e,n,function(e){switch(e.state){case t.State.Started:var n=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,n);break;case t.State.Stopped:0!==e.time&&this.emit("stop",e.time);break;case t.State.Paused:this.emit("pause",e.time)}}.bind(this)),this._tickSource.forEachTickBetween(e,n,function(t,e){this.callback(t,e)}.bind(this)))},t.Clock.prototype.getStateAtTime=function(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)},t.Clock.prototype.dispose=function(){t.Emitter.prototype.dispose.call(this),this.context.off("tick",this._boundLoop),this._writable("frequency"),this._tickSource.dispose(),this._tickSource=null,this.frequency=null,this._boundLoop=null,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},t.Clock}),e(function(t){t.IntervalTimeline=function(){t.call(this),this._root=null,this._length=0},t.extend(t.IntervalTimeline),t.IntervalTimeline.prototype.add=function(n){if(t.isUndef(n.time)||t.isUndef(n.duration))throw new Error("Tone.IntervalTimeline: events must have time and duration parameters");n.time=n.time.valueOf();var r=new e(n.time,n.time+n.duration,n);for(null===this._root?this._root=r:this._root.insert(r),this._length++;null!==r;)r.updateHeight(),r.updateMax(),this._rebalance(r),r=r.parent;return this},t.IntervalTimeline.prototype.remove=function(t){if(null!==this._root){var e=[];this._root.search(t.time,e);for(var n=0;n<e.length;n++){var r=e[n];if(r.event===t){this._removeNode(r),this._length--;break}}}return this},Object.defineProperty(t.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),t.IntervalTimeline.prototype.cancel=function(t){return this.forEachFrom(t,function(t){this.remove(t)}.bind(this)),this},t.IntervalTimeline.prototype._setRoot=function(t){this._root=t,null!==this._root&&(this._root.parent=null)},t.IntervalTimeline.prototype._replaceNodeInParent=function(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)},t.IntervalTimeline.prototype._removeNode=function(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{var e,n,r=t.getBalance();if(r>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent=e.parent,e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),this._rebalance(n)}t.dispose()},t.IntervalTimeline.prototype._rotateLeft=function(t){var e=t.parent,n=t.isLeftChild(),r=t.right;t.right=r.left,r.left=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rotateRight=function(t){var e=t.parent,n=t.isLeftChild(),r=t.left;t.left=r.right,r.right=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rebalance=function(t){var e=t.getBalance();e>1?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))},t.IntervalTimeline.prototype.get=function(t){if(null!==this._root){var e=[];if(this._root.search(t,e),e.length>0){for(var n=e[0],r=1;r<e.length;r++)e[r].low>n.low&&(n=e[r]);return n.event}}return null},t.IntervalTimeline.prototype.forEach=function(t){if(null!==this._root){var e=[];this._root.traverse(function(t){e.push(t)});for(var n=0;n<e.length;n++){var r=e[n].event;r&&t(r)}}return this},t.IntervalTimeline.prototype.forEachAtTime=function(t,e){if(null!==this._root){var n=[];this._root.search(t,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;i&&e(i)}}return this},t.IntervalTimeline.prototype.forEachFrom=function(t,e){if(null!==this._root){var n=[];this._root.searchAfter(t,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;e(i)}}return this},t.IntervalTimeline.prototype.dispose=function(){var t=[];null!==this._root&&this._root.traverse(function(e){t.push(e)});for(var e=0;e<t.length;e++)t[e].dispose();return t=null,this._root=null,this};var e=function(t,e,n){this.event=n,this.low=t,this.high=e,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return e.prototype.insert=function(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)},e.prototype.search=function(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))},e.prototype.searchAfter=function(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)},e.prototype.traverse=function(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)},e.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},e.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},e.prototype.getBalance=function(){var t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t},e.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),e.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},t.IntervalTimeline}),e(function(t){return t.Ticks=function(e,n){return this instanceof t.Ticks?void t.TransportTime.call(this,e,n):new t.Ticks(e,n)},t.extend(t.Ticks,t.TransportTime),t.Ticks.prototype._defaultUnits="i",t.Ticks.prototype._now=function(){return t.Transport.ticks},t.Ticks.prototype._beatsToUnits=function(t){return this._getPPQ()*t},t.Ticks.prototype._secondsToUnits=function(t){return t/(60/this._getBpm())*this._getPPQ()},t.Ticks.prototype._ticksToUnits=function(t){return t},t.Ticks.prototype.toTicks=function(){return this.valueOf()},t.Ticks.prototype.toSeconds=function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())},t.Ticks}),e(function(t){return t.TransportEvent=function(e,n){n=t.defaultArg(n,t.TransportEvent.defaults),t.call(this),this.Transport=e,this.id=t.TransportEvent._eventId++,this.time=t.Ticks(n.time),this.callback=n.callback,this._once=n.once},t.extend(t.TransportEvent),t.TransportEvent.defaults={once:!1,callback:t.noOp},t.TransportEvent._eventId=0,t.TransportEvent.prototype.invoke=function(t){this.callback&&(this.callback(t),this._once&&this.Transport&&this.Transport.clear(this.id))},t.TransportEvent.prototype.dispose=function(){return t.prototype.dispose.call(this),this.Transport=null,this.callback=null,this.time=null,this},t.TransportEvent}),e(function(t){return t.TransportRepeatEvent=function(e,n){t.TransportEvent.call(this,e,n),n=t.defaultArg(n,t.TransportRepeatEvent.defaults),this.duration=t.Ticks(n.duration),this._interval=t.Ticks(n.interval),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this),this.Transport.on("start loopStart",this._boundRestart),this._restart()},t.extend(t.TransportRepeatEvent,t.TransportEvent),t.TransportRepeatEvent.defaults={duration:1/0,interval:1},t.TransportRepeatEvent.prototype.invoke=function(e){this._createEvents(e),t.TransportEvent.prototype.invoke.call(this,e)},t.TransportRepeatEvent.prototype._createEvents=function(e){var n=this.Transport.getTicksAtTime(e);n>=this.time&&n>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick)))},t.TransportRepeatEvent.prototype._restart=function(e){this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this._nextTick=this.time;var n=this.Transport.getTicksAtTime(e);n>this.time&&(this._nextTick=this.time+Math.ceil((n-this.time)/this._interval)*this._interval),this._currentId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick)),this._nextTick+=this._interval,this._nextId=this.Transport.scheduleOnce(this.invoke.bind(this),t.Ticks(this._nextTick))},t.TransportRepeatEvent.prototype.dispose=function(){return this.Transport.clear(this._currentId),this.Transport.clear(this._nextId),this.Transport.off("start loopStart",this._boundRestart),this._boundCreateEvents=null,t.TransportEvent.prototype.dispose.call(this),this.duration=null,this._interval=null,this},t.TransportRepeatEvent}),e(function(t){t.Transport=function(){t.Emitter.call(this),t.getContext(function(){this.loop=!1,this._loopStart=0,this._loopEnd=0,this._ppq=e.defaults.PPQ,this._clock=new t.Clock({callback:this._processTick.bind(this),frequency:0}),this._bindClockEvents(),this.bpm=this._clock.frequency,this.bpm._toUnits=this._toUnits.bind(this),this.bpm._fromUnits=this._fromUnits.bind(this),this.bpm.units=t.Type.BPM,this.bpm.value=e.defaults.bpm,this._readOnly("bpm"),this._timeSignature=e.defaults.timeSignature,this._scheduledEvents={},this._timeline=new t.Timeline,this._repeatedEvents=new t.IntervalTimeline,this._syncedSignals=[],this._swingTicks=e.defaults.PPQ/2,this._swingAmount=0}.bind(this))},t.extend(t.Transport,t.Emitter),t.Transport.defaults={bpm:120,swing:0,swingSubdivision:"8n",timeSignature:4,loopStart:0,loopEnd:"4m",PPQ:192},t.Transport.prototype._processTick=function(e,n){if(this._swingAmount>0&&n%this._ppq!==0&&n%(2*this._swingTicks)!==0){var r=n%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(r*Math.PI)*this._swingAmount;e+=t.Ticks(2*this._swingTicks/3).toSeconds()*i}this.loop&&n>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),n=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._timeline.forEachAtTime(n,function(t){t.invoke(e)})},t.Transport.prototype.schedule=function(e,n){var r=new t.TransportEvent(this,{time:t.TransportTime(n),callback:e});return this._addEvent(r,this._timeline)},t.Transport.prototype.scheduleRepeat=function(e,n,r,i){var o=new t.TransportRepeatEvent(this,{callback:e,interval:t.Time(n),time:t.TransportTime(r),duration:t.Time(t.defaultArg(i,1/0))});return this._addEvent(o,this._repeatedEvents)},t.Transport.prototype.scheduleOnce=function(e,n){var r=new t.TransportEvent(this,{time:t.TransportTime(n),callback:e,once:!0});return this._addEvent(r,this._timeline)},t.Transport.prototype.clear=function(t){if(this._scheduledEvents.hasOwnProperty(t)){var e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this},t.Transport.prototype._addEvent=function(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id},t.Transport.prototype.cancel=function(e){return e=t.defaultArg(e,0),e=this.toTicks(e),this._timeline.forEachFrom(e,function(t){this.clear(t.id)}.bind(this)),this._repeatedEvents.forEachFrom(e,function(t){this.clear(t.id)}.bind(this)),this},t.Transport.prototype._bindClockEvents=function(){this._clock.on("start",function(e,n){n=t.Ticks(n).toSeconds(),this.emit("start",e,n)}.bind(this)),this._clock.on("stop",function(t){this.emit("stop",t)}.bind(this)),this._clock.on("pause",function(t){this.emit("pause",t)}.bind(this))},Object.defineProperty(t.Transport.prototype,"state",{get:function(){return this._clock.getStateAtTime(this.now())}}),t.Transport.prototype.start=function(e,n){return t.isDefined(n)&&(n=this.toTicks(n)),this._clock.start(e,n),this},t.Transport.prototype.stop=function(t){return this._clock.stop(t),this},t.Transport.prototype.pause=function(t){return this._clock.pause(t),this},t.Transport.prototype.toggle=function(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!==t.State.Started?this.start(e):this.stop(e),this},Object.defineProperty(t.Transport.prototype,"timeSignature",{get:function(){return this._timeSignature},set:function(e){t.isArray(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}}),Object.defineProperty(t.Transport.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t)}}),t.Transport.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(t.Transport.prototype,"swing",{get:function(){return this._swingAmount},set:function(t){this._swingAmount=t}}),Object.defineProperty(t.Transport.prototype,"swingSubdivision",{get:function(){return t.Ticks(this._swingTicks).toNotation()},set:function(t){this._swingTicks=this.toTicks(t)}}),Object.defineProperty(t.Transport.prototype,"position",{get:function(){var e=this.now(),n=this._clock.getTicksAtTime(e);return t.Ticks(n).toBarsBeatsSixteenths()},set:function(t){var e=this.toTicks(t);this.ticks=e}}),Object.defineProperty(t.Transport.prototype,"seconds",{get:function(){return this._clock.seconds},set:function(t){var e=this.now(),n=this.bpm.timeToTicks(t,e);this.ticks=n}}),Object.defineProperty(t.Transport.prototype,"progress",{get:function(){if(this.loop){var t=this.now(),e=this._clock.getTicksAtTime(t);return(e-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}}),Object.defineProperty(t.Transport.prototype,"ticks",{get:function(){return this._clock.ticks},set:function(e){if(this._clock.ticks!==e){var n=this.now();this.state===t.State.Started?(this.emit("stop",n),this._clock.setTicksAtTime(e,n),this.emit("start",n,this.seconds)):this._clock.setTicksAtTime(e,n)}}}),t.Transport.prototype.getTicksAtTime=function(t){return Math.round(this._clock.getTicksAtTime(t))},t.Transport.prototype.getSecondsAtTime=function(t){return this._clock.getSecondsAtTime(t)},Object.defineProperty(t.Transport.prototype,"PPQ",{get:function(){return this._ppq},set:function(t){var e=this.bpm.value;this._ppq=t,this.bpm.value=e}}),t.Transport.prototype._fromUnits=function(t){return 1/(60/t/this.PPQ)},t.Transport.prototype._toUnits=function(t){return t/this.PPQ*60},t.Transport.prototype.nextSubdivision=function(e){if(e=this.toTicks(e),this.state!==t.State.Started)return 0;var n=this.now(),r=this.getTicksAtTime(n),i=e-r%e;return this._clock.nextTickTime(i,n)},t.Transport.prototype.syncSignal=function(e,n){if(!n){var r=this.now();n=0!==e.getValueAtTime(r)?e.getValueAtTime(r)/this.bpm.getValueAtTime(r):0}var i=new t.Gain(n);return this.bpm.chain(i,e._param),this._syncedSignals.push({ratio:i,signal:e,initial:e.value}),e.value=0,this},t.Transport.prototype.unsyncSignal=function(t){for(var e=this._syncedSignals.length-1;e>=0;e--){var n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this},t.Transport.prototype.dispose=function(){return t.Emitter.prototype.dispose.call(this),this._clock.dispose(),this._clock=null,this._writable("bpm"),this.bpm=null,this._timeline.dispose(),this._timeline=null,this._repeatedEvents.dispose(),this._repeatedEvents=null,this};var e=t.Transport;return t.Transport=new e,t.Context.on("init",function(n){n.Transport instanceof e?t.Transport=n.Transport:t.Transport=new e,n.Transport=t.Transport}),t.Context.on("close",function(t){t.Transport instanceof e&&t.Transport.dispose()}),t.Transport}),e(function(t){return t.Volume=function(){var e=t.defaults(arguments,["volume"],t.Volume);t.AudioNode.call(this),this.output=this.input=new t.Gain(e.volume,t.Type.Decibels),this._unmutedVolume=e.volume,this.volume=this.output.gain,this._readOnly("volume"),this.mute=e.mute},t.extend(t.Volume,t.AudioNode),t.Volume.defaults={volume:0,mute:!1},Object.defineProperty(t.Volume.prototype,"mute",{get:function(){return this.volume.value===-(1/0)},set:function(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-(1/0)):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}}),t.Volume.prototype.dispose=function(){return this.input.dispose(),t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},t.Volume}),e(function(t){t.Master=function(){t.AudioNode.call(this),t.getContext(function(){this.createInsOuts(1,0),this._volume=this.output=new t.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)}.bind(this))},t.extend(t.Master,t.AudioNode),t.Master.defaults={volume:0,mute:!1},Object.defineProperty(t.Master.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},t.Master.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},t.AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this},window.AudioNode&&(AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this});var e=t.Master;return t.Master=new e,t.Context.on("init",function(n){n.Master instanceof e?t.Master=n.Master:t.Master=new e,n.Master=t.Master}),t.Context.on("close",function(t){t.Master instanceof e&&t.Master.dispose()}),t.Master}),e(function(t){return t.Source=function(e){e=t.defaultArg(e,t.Source.defaults),t.AudioNode.call(this),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._state=new t.TimelineState(t.State.Stopped),this._state.memory=100,this._synced=!1,this._scheduled=[],this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=e.mute},t.extend(t.Source,t.AudioNode),t.Source.defaults={volume:0,mute:!1},Object.defineProperty(t.Source.prototype,"state",{get:function(){return this._synced?t.Transport.state===t.State.Started?this._state.getValueAtTime(t.Transport.seconds):t.State.Stopped:this._state.getValueAtTime(this.now())}}),Object.defineProperty(t.Source.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t;
}}),t.Source.prototype._start=t.noOp,t.Source.prototype.restart=t.noOp,t.Source.prototype._stop=t.noOp,t.Source.prototype.start=function(e,n,r){if(e=t.isUndef(e)&&this._synced?t.Transport.seconds:this.toSeconds(e),this._state.getValueAtTime(e)===t.State.Started)this._state.cancel(e),this._state.setStateAtTime(t.State.Started,e),this.restart(e,n,r);else if(this._state.setStateAtTime(t.State.Started,e),this._synced){var i=this._state.get(e);i.offset=t.defaultArg(n,0),i.duration=r;var o=t.Transport.schedule(function(t){this._start(t,n,r)}.bind(this),e);this._scheduled.push(o),t.Transport.state===t.State.Started&&this._syncedStart(this.now(),t.Transport.seconds)}else this._start.apply(this,arguments);return this},t.Source.prototype.stop=function(e){if(e=t.isUndef(e)&&this._synced?t.Transport.seconds:this.toSeconds(e),this._synced){var n=t.Transport.schedule(this._stop.bind(this),e);this._scheduled.push(n)}else this._stop.apply(this,arguments);return this._state.cancel(e),this._state.setStateAtTime(t.State.Stopped,e),this},t.Source.prototype.sync=function(){return this._synced=!0,this._syncedStart=function(e,n){if(n>0){var r=this._state.get(n);if(r&&r.state===t.State.Started&&r.time!==n){var i,o=n-this.toSeconds(r.time);r.duration&&(i=this.toSeconds(r.duration)-o),this._start(e,this.toSeconds(r.offset)+o,i)}}}.bind(this),this._syncedStop=function(e){var n=t.Transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(n)===t.State.Started&&this._stop(e)}.bind(this),t.Transport.on("start loopStart",this._syncedStart),t.Transport.on("stop pause loopEnd",this._syncedStop),this},t.Source.prototype.unsync=function(){this._synced&&(t.Transport.off("stop pause loopEnd",this._syncedStop),t.Transport.off("start loopStart",this._syncedStart)),this._synced=!1;for(var e=0;e<this._scheduled.length;e++){var n=this._scheduled[e];t.Transport.clear(n)}return this._scheduled=[],this._state.cancel(0),this},t.Source.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this.unsync(),this._scheduled=null,this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this._state.dispose(),this._state=null},t.Source}),e(function(t){t.supported&&(AudioBuffer.prototype.copyToChannel||(AudioBuffer.prototype.copyToChannel=function(t,e,n){var r=this.getChannelData(e);n=n||0;for(var i=0;i<r.length;i++)r[i+n]=t[i]},AudioBuffer.prototype.copyFromChannel=function(t,e,n){var r=this.getChannelData(e);n=n||0;for(var i=0;i<t.length;i++)t[i]=r[i+n]}))}),e(function(t){return t.Buffer=function(){var e=t.defaults(arguments,["url","onload","onerror"],t.Buffer);t.call(this),this._buffer=null,this._reversed=e.reverse,this._xhr=null,this._onload=t.noOp,e.url instanceof AudioBuffer||e.url instanceof t.Buffer?(this.set(e.url),e.onload&&(this.loaded?e.onload(this):this._onload=e.onload)):t.isString(e.url)&&this.load(e.url).then(e.onload).catch(e.onerror)},t.extend(t.Buffer),t.Buffer.defaults={url:void 0,reverse:!1,onload:t.noOp,onerror:t.noOp},t.Buffer.prototype.set=function(e){return e instanceof t.Buffer?e.loaded?this._buffer=e.get():e._onload=function(){this.set(e),this._onload(this)}.bind(this):this._buffer=e,this},t.Buffer.prototype.get=function(){return this._buffer},t.Buffer.prototype.load=function(e,n,r){var i=new Promise(function(i,o){this._xhr=t.Buffer.load(e,function(t){this._xhr=null,this.set(t),i(this),this._onload(this),n&&n(this)}.bind(this),function(t){this._xhr=null,o(t),r&&r(t)}.bind(this))}.bind(this));return i},t.Buffer.prototype.dispose=function(){return t.prototype.dispose.call(this),this._buffer=null,this._xhr&&(t.Buffer._removeFromDownloadQueue(this._xhr),this._xhr.abort(),this._xhr=null),this},Object.defineProperty(t.Buffer.prototype,"loaded",{get:function(){return this.length>0}}),Object.defineProperty(t.Buffer.prototype,"duration",{get:function(){return this._buffer?this._buffer.duration:0}}),Object.defineProperty(t.Buffer.prototype,"length",{get:function(){return this._buffer?this._buffer.length:0}}),Object.defineProperty(t.Buffer.prototype,"numberOfChannels",{get:function(){return this._buffer?this._buffer.numberOfChannels:0}}),t.Buffer.prototype.fromArray=function(t){var e=t[0].length>0,n=e?t.length:1,r=e?t[0].length:t.length,i=this.context.createBuffer(n,r,this.context.sampleRate);e||1!==n||(t=[t]);for(var o=0;o<n;o++)i.copyToChannel(t[o],o);return this._buffer=i,this},t.Buffer.prototype.toMono=function(e){if(t.isNumber(e))this.fromArray(this.toArray(e));else{for(var n=new Float32Array(this.length),r=this.numberOfChannels,i=0;i<r;i++)for(var o=this.toArray(i),a=0;a<o.length;a++)n[a]+=o[a];n=n.map(function(t){return t/r}),this.fromArray(n)}return this},t.Buffer.prototype.toArray=function(e){if(t.isNumber(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);for(var n=[],r=0;r<this.numberOfChannels;r++)n[r]=this.getChannelData(r);return n},t.Buffer.prototype.getChannelData=function(t){return this._buffer.getChannelData(t)},t.Buffer.prototype.slice=function(e,n){n=t.defaultArg(n,this.duration);for(var r=Math.floor(this.context.sampleRate*this.toSeconds(e)),i=Math.floor(this.context.sampleRate*this.toSeconds(n)),o=[],a=0;a<this.numberOfChannels;a++)o[a]=this.toArray(a).slice(r,i);var s=(new t.Buffer).fromArray(o);return s},t.Buffer.prototype._reverse=function(){if(this.loaded)for(var t=0;t<this.numberOfChannels;t++)Array.prototype.reverse.call(this.getChannelData(t));return this},Object.defineProperty(t.Buffer.prototype,"reverse",{get:function(){return this._reversed},set:function(t){this._reversed!==t&&(this._reversed=t,this._reverse())}}),t.Emitter.mixin(t.Buffer),t.Buffer._downloadQueue=[],t.Buffer.baseUrl="",t.Buffer.fromArray=function(e){return(new t.Buffer).fromArray(e)},t.Buffer.fromUrl=function(e){var n=new t.Buffer;return n.load(e).then(function(){return n})},t.Buffer._removeFromDownloadQueue=function(e){var n=t.Buffer._downloadQueue.indexOf(e);n!==-1&&t.Buffer._downloadQueue.splice(n,1)},t.Buffer.load=function(e,n,r){function i(e){if(t.Buffer._removeFromDownloadQueue(c),t.Buffer.emit("error",e),!r)throw e;r(e)}function o(){for(var e=0,n=0;n<t.Buffer._downloadQueue.length;n++)e+=t.Buffer._downloadQueue[n].progress;t.Buffer.emit("progress",e/t.Buffer._downloadQueue.length)}n=t.defaultArg(n,t.noOp);var a=e.match(/\[(.+\|?)+\]$/);if(a){for(var s=a[1].split("|"),u=s[0],l=0;l<s.length;l++)if(t.Buffer.supportsType(s[l])){u=s[l];break}e=e.replace(a[0],u)}var c=new XMLHttpRequest;return c.open("GET",t.Buffer.baseUrl+e,!0),c.responseType="arraybuffer",c.progress=0,t.Buffer._downloadQueue.push(c),c.addEventListener("load",function(){200===c.status?t.context.decodeAudioData(c.response).then(function(e){c.progress=1,o(),n(e),t.Buffer._removeFromDownloadQueue(c),0===t.Buffer._downloadQueue.length&&t.Buffer.emit("load")}).catch(function(){t.Buffer._removeFromDownloadQueue(c),i("Tone.Buffer: could not decode audio data: "+e)}):i("Tone.Buffer: could not locate file: "+e)}),c.addEventListener("error",i),c.addEventListener("progress",function(t){t.lengthComputable&&(c.progress=t.loaded/t.total*.95,o())}),c.send(),c},t.Buffer.cancelDownloads=function(){return t.Buffer._downloadQueue.slice().forEach(function(e){t.Buffer._removeFromDownloadQueue(e),e.abort()}),t.Buffer},t.Buffer.supportsType=function(t){var e=t.split(".");e=e[e.length-1];var n=document.createElement("audio").canPlayType("audio/"+e);return""!==n},t.loaded=function(){function e(){t.Buffer.off("load",n),t.Buffer.off("error",r)}var n,r;return new Promise(function(e,i){n=function(){e()},r=function(){i()},t.Buffer.on("load",n),t.Buffer.on("error",r)}).then(e).catch(function(t){throw e(),new Error(t)})},t.Buffer}),e(function(t){return t.OscillatorNode=function(){var e=t.defaults(arguments,["frequency","type"],t.OscillatorNode);t.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._stopTime=-1,this._gainNode=this.output=new t.Gain,this._gainNode.gain.setValueAtTime(0,this.context.currentTime),this._oscillator=this.context.createOscillator(),this._oscillator.connect(this._gainNode),this.type=e.type,this.frequency=new t.Param(this._oscillator.frequency,t.Type.Frequency),this.frequency.value=e.frequency,this.detune=new t.Param(this._oscillator.detune,t.Type.Cents),this.detune.value=e.detune,this._gain=1},t.extend(t.OscillatorNode,t.AudioNode),t.OscillatorNode.defaults={frequency:440,detune:0,type:"sine",onended:t.noOp},Object.defineProperty(t.OscillatorNode.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),t.OscillatorNode.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._startTime!==-1&&e>=this._startTime&&(this._stopTime===-1||e<=this._stopTime)?t.State.Started:t.State.Stopped},t.OscillatorNode.prototype.start=function(t){if(this._startTime!==-1)throw new Error("cannot call OscillatorNode.start more than once");this._startTime=this.toSeconds(t),this._oscillator.start(this._startTime);var e=this.context.currentTime;return this._gainNode.gain.cancelScheduledValues(e),this._gainNode.gain.setValueAtTime(0,e),this._gainNode.gain.setValueAtTime(1,this._startTime),this},t.OscillatorNode.prototype.setPeriodicWave=function(t){return this._oscillator.setPeriodicWave(t),this},t.OscillatorNode.prototype.stop=function(t){return this.cancelStop(),this._stopTime=this.toSeconds(t),this._gainNode.gain.setValueAtTime(0,this._stopTime),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(function(){this._oscillator.stop(this.now()),this.onended()}.bind(this),this._stopTime-this.now()),this},t.OscillatorNode.prototype.cancelStop=function(){return this._startTime!==-1&&(this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime)),this.context.clearTimeout(this._timeout),this._stopTime=-1),this},Object.defineProperty(t.OscillatorNode.prototype,"type",{get:function(){return this._oscillator.type},set:function(t){this._oscillator.type=t}}),t.OscillatorNode.prototype.dispose=function(){return this.context.clearTimeout(this._timeout),t.AudioNode.prototype.dispose.call(this),this.onended=null,this._oscillator.disconnect(),this._oscillator=null,this._gainNode.dispose(),this._gainNode=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this},t.OscillatorNode}),e(function(t){return t.Oscillator=function(){var e=t.defaults(arguments,["frequency","type"],t.Oscillator);t.Source.call(this,e),this._oscillator=null,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._wave=null,this._partials=t.defaultArg(e.partials,[1]),this._phase=e.phase,this._type=null,this.type=e.type,this.phase=this._phase,this._readOnly(["frequency","detune"])},t.extend(t.Oscillator,t.Source),t.Oscillator.defaults={type:"sine",frequency:440,detune:0,phase:0,partials:[]},t.Oscillator.Type={Sine:"sine",Triangle:"triangle",Sawtooth:"sawtooth",Square:"square",Custom:"custom"},t.Oscillator.prototype._start=function(e){this._oscillator=new t.OscillatorNode,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),e=this.toSeconds(e),this._oscillator.start(e)},t.Oscillator.prototype._stop=function(t){return this._oscillator&&(t=this.toSeconds(t),this._oscillator.stop(t)),this},t.Oscillator.prototype.restart=function(t){return this._oscillator.cancelStop(),this._state.cancel(this.toSeconds(t)),this},t.Oscillator.prototype.syncFrequency=function(){return t.Transport.syncSignal(this.frequency),this},t.Oscillator.prototype.unsyncFrequency=function(){return t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Oscillator.prototype,"type",{get:function(){return this._type},set:function(e){var n=[t.Oscillator.Type.Sine,t.Oscillator.Type.Square,t.Oscillator.Type.Triangle,t.Oscillator.Type.Sawtooth].includes(e);if(0===this._phase&&n)this._wave=null,null!==this._oscillator&&this._oscillator.type===e;else{var r=this._getRealImaginary(e,this._phase),i=this.context.createPeriodicWave(r[0],r[1]);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}this._type=e}}),t.Oscillator.prototype._getRealImaginary=function(e,n){var r=4096,i=r/2,o=new Float32Array(i),a=new Float32Array(i),s=1;if(e===t.Oscillator.Type.Custom)s=this._partials.length+1,i=s;else{var u=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);u&&(s=parseInt(u[2])+1,e=u[1],s=Math.max(s,2),i=s)}for(var l=1;l<i;++l){var c,p=2/(l*Math.PI);switch(e){case t.Oscillator.Type.Sine:c=l<=s?1:0;break;case t.Oscillator.Type.Square:c=1&l?2*p:0;break;case t.Oscillator.Type.Sawtooth:c=p*(1&l?1:-1);break;case t.Oscillator.Type.Triangle:c=1&l?2*(p*p)*(l-1>>1&1?-1:1):0;break;case t.Oscillator.Type.Custom:c=this._partials[l-1];break;default:throw new TypeError("Tone.Oscillator: invalid type: "+e)}0!==c?(o[l]=-c*Math.sin(n*l),a[l]=c*Math.cos(n*l)):(o[l]=0,a[l]=0)}return[o,a]},t.Oscillator.prototype._inverseFFT=function(t,e,n){for(var r=0,i=t.length,o=0;o<i;o++)r+=t[o]*Math.cos(o*n)+e[o]*Math.sin(o*n);return r},t.Oscillator.prototype._getInitialValue=function(){for(var t=this._getRealImaginary(this._type,0),e=t[0],n=t[1],r=0,i=2*Math.PI,o=0;o<8;o++)r=Math.max(this._inverseFFT(e,n,o/8*i),r);return-this._inverseFFT(e,n,this._phase)/r},Object.defineProperty(t.Oscillator.prototype,"partials",{get:function(){return this._type!==t.Oscillator.Type.Custom?[]:this._partials},set:function(e){this._partials=e,this.type=t.Oscillator.Type.Custom}}),Object.defineProperty(t.Oscillator.prototype,"phase",{get:function(){return this._phase*(180/Math.PI)},set:function(t){this._phase=t*Math.PI/180,this.type=this._type}}),t.Oscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),null!==this._oscillator&&(this._oscillator.dispose(),this._oscillator=null),this._wave=null,this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._partials=null,this},t.Oscillator}),e(function(t){return t.AudioToGain=function(){t.SignalBase.call(this),this._norm=this.input=this.output=new t.WaveShaper(function(t){return(t+1)/2})},t.extend(t.AudioToGain,t.SignalBase),t.AudioToGain.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.AudioToGain}),e(function(t){return t.Zero=function(){t.SignalBase.call(this),this._gain=this.input=this.output=new t.Gain,this.context.getConstant(0).connect(this._gain)},t.extend(t.Zero,t.SignalBase),t.Zero.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._gain.dispose(),this._gain=null,this},t.Zero}),e(function(t){return t.LFO=function(){var e=t.defaults(arguments,["frequency","min","max"],t.LFO);t.AudioNode.call(this),this._oscillator=new t.Oscillator({frequency:e.frequency,type:e.type}),this.frequency=this._oscillator.frequency,this.amplitude=this._oscillator.volume,this.amplitude.units=t.Type.NormalRange,this.amplitude.value=e.amplitude,this._stoppedSignal=new t.Signal(0,t.Type.AudioRange),this._zeros=new t.Zero,this._stoppedValue=0,this._a2g=new t.AudioToGain,this._scaler=this.output=new t.Scale(e.min,e.max),this._units=t.Type.Default,this.units=e.units,this._oscillator.chain(this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),this._readOnly(["amplitude","frequency"]),this.phase=e.phase},t.extend(t.LFO,t.AudioNode),t.LFO.defaults={type:"sine",min:0,max:1,phase:0,frequency:"4n",amplitude:1,units:t.Type.Default},t.LFO.prototype.start=function(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this},t.LFO.prototype.stop=function(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this},t.LFO.prototype.sync=function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this},t.LFO.prototype.unsync=function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this},Object.defineProperty(t.LFO.prototype,"min",{get:function(){return this._toUnits(this._scaler.min)},set:function(t){t=this._fromUnits(t),this._scaler.min=t}}),Object.defineProperty(t.LFO.prototype,"max",{get:function(){return this._toUnits(this._scaler.max)},set:function(t){t=this._fromUnits(t),this._scaler.max=t}}),Object.defineProperty(t.LFO.prototype,"type",{get:function(){return this._oscillator.type},set:function(t){this._oscillator.type=t,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t,this._stoppedValue=this._oscillator._getInitialValue(),this._stoppedSignal.value=this._stoppedValue}}),Object.defineProperty(t.LFO.prototype,"units",{get:function(){return this._units},set:function(t){var e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}}),Object.defineProperty(t.LFO.prototype,"mute",{get:function(){return this._oscillator.mute},set:function(t){this._oscillator.mute=t}}),Object.defineProperty(t.LFO.prototype,"state",{get:function(){return this._oscillator.state}}),t.LFO.prototype.connect=function(e){return e.constructor!==t.Signal&&e.constructor!==t.Param||(this.convert=e.convert,this.units=e.units),t.SignalBase.prototype.connect.apply(this,arguments),this},t.LFO.prototype._fromUnits=t.Param.prototype._fromUnits,t.LFO.prototype._toUnits=t.Param.prototype._toUnits,t.LFO.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["amplitude","frequency"]),this._oscillator.dispose(),this._oscillator=null,this._stoppedSignal.dispose(),this._stoppedSignal=null,this._zeros.dispose(),this._zeros=null,this._scaler.dispose(),this._scaler=null,this._a2g.dispose(),this._a2g=null,this.frequency=null,this.amplitude=null,this},t.LFO}),e(function(t){return t.Limiter=function(){var e=t.defaults(arguments,["threshold"],t.Limiter);t.AudioNode.call(this),this._compressor=this.input=this.output=new t.Compressor({attack:.001,decay:.001,threshold:e.threshold}),this.threshold=this._compressor.threshold,this._readOnly("threshold")},t.extend(t.Limiter,t.AudioNode),t.Limiter.defaults={threshold:-12},t.Limiter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._compressor.dispose(),this._compressor=null,this._writable("threshold"),this.threshold=null,this},t.Limiter}),e(function(t){return t.LowpassCombFilter=function(){var e=t.defaults(arguments,["delayTime","resonance","dampening"],t.LowpassCombFilter);t.AudioNode.call(this),this.createInsOuts(1,1),this._delay=this.input=new t.Delay(e.delayTime),this.delayTime=this._delay.delayTime,this._lowpass=this.output=this.context.createBiquadFilter(),this._lowpass.Q.value=-3.0102999566398125,this._lowpass.type="lowpass",this.dampening=new t.Param({param:this._lowpass.frequency,units:t.Type.Frequency,value:e.dampening}),this._feedback=new t.Gain(e.resonance,t.Type.NormalRange),this.resonance=this._feedback.gain,this._delay.chain(this._lowpass,this._feedback,this._delay),this._readOnly(["dampening","resonance","delayTime"])},t.extend(t.LowpassCombFilter,t.AudioNode),t.LowpassCombFilter.defaults={delayTime:.1,resonance:.5,dampening:3e3},t.LowpassCombFilter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["dampening","resonance","delayTime"]),this.dampening.dispose(),this.dampening=null,this.resonance.dispose(),this.resonance=null,this._delay.dispose(),this._delay=null,this.delayTime=null,this._lowpass.disconnect(),this._lowpass=null,this._feedback.disconnect(),this._feedback=null,this},t.LowpassCombFilter}),e(function(t){return t.Merge=function(){t.AudioNode.call(this),this.createInsOuts(2,0),this.left=this.input[0]=new t.Gain,this.right=this.input[1]=new t.Gain,this._merger=this.output=this.context.createChannelMerger(2),this.left.connect(this._merger,0,0),this.right.connect(this._merger,0,1),this.left.channelCount=1,this.right.channelCount=1,this.left.channelCountMode="explicit",this.right.channelCountMode="explicit"},t.extend(t.Merge,t.AudioNode),t.Merge.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._merger.disconnect(),this._merger=null,this},t.Merge}),e(function(t){return t.Meter=function(){var e=t.defaults(arguments,["smoothing"],t.Meter);t.AudioNode.call(this),this.input=this.output=this._analyser=new t.Analyser("waveform",1024),this.smoothing=e.smoothing},t.extend(t.Meter,t.AudioNode),t.Meter.defaults={smoothing:.8},t.Meter.prototype.getLevel=function(){this._analyser.type="fft";var t=this._analyser.getValue(),e=28;return Math.max.apply(this,t)+e},t.Meter.prototype.getValue=function(){this._analyser.type="waveform";var t=this._analyser.getValue();return t[0]},Object.defineProperty(t.Meter.prototype,"smoothing",{get:function(){return this._analyser.smoothing},set:function(t){this._analyser.smoothing=t}}),t.Meter.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null,this},t.Meter}),e(function(t){return t.Split=function(){t.AudioNode.call(this),this.createInsOuts(0,2),this._splitter=this.input=this.context.createChannelSplitter(2),this._splitter.channelCount=2,this._splitter.channelCountMode="explicit",this.left=this.output[0]=new t.Gain,this.right=this.output[1]=new t.Gain,this._splitter.connect(this.left,0,0),this._splitter.connect(this.right,1,0)},t.extend(t.Split,t.AudioNode),t.Split.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._splitter.disconnect(),this.left.dispose(),this.left=null,this.right.dispose(),this.right=null,this._splitter=null,this},t.Split}),e(function(t){return t.MidSideSplit=function(){t.AudioNode.call(this),this.createInsOuts(0,2),this._split=this.input=new t.Split,this._midAdd=new t.Add,this.mid=this.output[0]=new t.Multiply(Math.SQRT1_2),this._sideSubtract=new t.Subtract,this.side=this.output[1]=new t.Multiply(Math.SQRT1_2),this._split.connect(this._midAdd,0,0),this._split.connect(this._midAdd,1,1),this._split.connect(this._sideSubtract,0,0),this._split.connect(this._sideSubtract,1,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)},t.extend(t.MidSideSplit,t.AudioNode),t.MidSideSplit.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midAdd.dispose(),this._midAdd=null,this._sideSubtract.dispose(),this._sideSubtract=null,this._split.dispose(),this._split=null,this},t.MidSideSplit}),e(function(t){return t.MidSideMerge=function(){t.AudioNode.call(this),this.createInsOuts(2,0),this.mid=this.input[0]=new t.Gain,this._left=new t.Add,this._timesTwoLeft=new t.Multiply(Math.SQRT1_2),this.side=this.input[1]=new t.Gain,this._right=new t.Subtract,this._timesTwoRight=new t.Multiply(Math.SQRT1_2),this._merge=this.output=new t.Merge,this.mid.connect(this._left,0,0),this.side.connect(this._left,0,1),this.mid.connect(this._right,0,0),this.side.connect(this._right,0,1),this._left.connect(this._timesTwoLeft),this._right.connect(this._timesTwoRight),this._timesTwoLeft.connect(this._merge,0,0),this._timesTwoRight.connect(this._merge,0,1)},t.extend(t.MidSideMerge,t.AudioNode),t.MidSideMerge.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._left.dispose(),this._left=null,this._timesTwoLeft.dispose(),this._timesTwoLeft=null,this._right.dispose(),this._right=null,this._timesTwoRight.dispose(),this._timesTwoRight=null,this._merge.dispose(),this._merge=null,this},t.MidSideMerge}),e(function(t){return t.MidSideCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(e,t.MidSideCompressor.defaults),this._midSideSplit=this.input=new t.MidSideSplit,this._midSideMerge=this.output=new t.MidSideMerge,this.mid=new t.Compressor(e.mid),this.side=new t.Compressor(e.side),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),this._readOnly(["mid","side"])},t.extend(t.MidSideCompressor,t.AudioNode),t.MidSideCompressor.defaults={mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}},t.MidSideCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["mid","side"]),this.mid.dispose(),this.mid=null,this.side.dispose(),this.side=null,this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this},t.MidSideCompressor}),e(function(t){return t.Mono=function(){t.AudioNode.call(this),this.createInsOuts(1,0),this._merge=this.output=new t.Merge,this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)},t.extend(t.Mono,t.AudioNode),t.Mono.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._merge.dispose(),this._merge=null,this},t.Mono}),e(function(t){return t.MultibandCompressor=function(e){t.AudioNode.call(this),e=t.defaultArg(arguments,t.MultibandCompressor.defaults),this._splitter=this.input=new t.MultibandSplit({lowFrequency:e.lowFrequency,highFrequency:e.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new t.Gain,this.low=new t.Compressor(e.low),this.mid=new t.Compressor(e.mid),this.high=new t.Compressor(e.high),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),this._readOnly(["high","mid","low","highFrequency","lowFrequency"])},t.extend(t.MultibandCompressor,t.AudioNode),t.MultibandCompressor.defaults={low:t.Compressor.defaults,mid:t.Compressor.defaults,high:t.Compressor.defaults,lowFrequency:250,highFrequency:2e3},t.MultibandCompressor.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._splitter.dispose(),this._writable(["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this._splitter=null,this.low=null,this.mid=null,this.high=null,this.lowFrequency=null,this.highFrequency=null,this},t.MultibandCompressor}),e(function(t){if(t.supported&&!window.StereoPannerNode){var e=function(e){this.context=e,this.pan=new t.Signal(0,t.Type.AudioRange);var n=new t.WaveShaper(function(e){return t.equalPowerScale((e+1)/2)},4096),r=new t.WaveShaper(function(e){return t.equalPowerScale(1-(e+1)/2)},4096),i=new t.Gain,o=new t.Gain,a=this.input=new t.Split,s=new t.Zero;s.fan(n,r);var u=this.output=new t.Merge;a.left.chain(i,u.left),a.right.chain(o,u.right),this.pan.chain(r,i.gain),this.pan.chain(n,o.gain)};e.prototype.disconnect=function(){this.output.disconnect.apply(this.output,arguments)},e.prototype.connect=function(){this.output.connect.apply(this.output,arguments)},AudioContext.prototype.createStereoPanner=function(){return new e(this)},t.Context.prototype.createStereoPanner=function(){return new e(this)}}}),e(function(t){return t.Panner=function(e){t.AudioNode.call(this),this._panner=this.input=this.output=this.context.createStereoPanner(),this.pan=this._panner.pan,this.pan.value=t.defaultArg(e,0),this._readOnly("pan")},t.extend(t.Panner,t.AudioNode),t.Panner.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable("pan"),this._panner.disconnect(),this._panner=null,this.pan=null,this},t.Panner}),e(function(t){return t.Panner3D=function(){var e=t.defaults(arguments,["positionX","positionY","positionZ"],t.Panner3D);t.AudioNode.call(this),this._panner=this.input=this.output=this.context.createPanner(),this._panner.panningModel=e.panningModel,this._panner.maxDistance=e.maxDistance,this._panner.distanceModel=e.distanceModel,this._panner.coneOuterGain=e.coneOuterGain,this._panner.coneOuterAngle=e.coneOuterAngle,this._panner.coneInnerAngle=e.coneInnerAngle,this._panner.refDistance=e.refDistance,this._panner.rolloffFactor=e.rolloffFactor,this._orientation=[e.orientationX,e.orientationY,e.orientationZ],this._position=[e.positionX,e.positionY,e.positionZ],this.orientationX=e.orientationX,this.orientationY=e.orientationY,this.orientationZ=e.orientationZ,this.positionX=e.positionX,this.positionY=e.positionY,this.positionZ=e.positionZ},t.extend(t.Panner3D,t.AudioNode),t.Panner3D.defaults={positionX:0,positionY:0,positionZ:0,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",maxDistance:1e4,distanceModel:"inverse",coneOuterGain:0,coneOuterAngle:360,coneInnerAngle:360,refDistance:1,rolloffFactor:1},t.Panner3D.prototype._rampTimeConstant=.01,t.Panner3D.prototype.setPosition=function(t,e,n){if(this._panner.positionX){var r=this.now();this._panner.positionX.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.positionY.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setPosition(t,e,n);return this._position=Array.prototype.slice.call(arguments),this},t.Panner3D.prototype.setOrientation=function(t,e,n){if(this._panner.orientationX){var r=this.now();this._panner.orientationX.setTargetAtTime(t,r,this._rampTimeConstant),this._panner.orientationY.setTargetAtTime(e,r,this._rampTimeConstant),this._panner.orientationZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this._panner.setOrientation(t,e,n);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(t.Panner3D.prototype,"positionX",{set:function(t){this._position[0]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(t.Panner3D.prototype,"positionY",{set:function(t){this._position[1]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(t.Panner3D.prototype,"positionZ",{set:function(t){this._position[2]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(t.Panner3D.prototype,"orientationX",{set:function(t){this._orientation[0]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(t.Panner3D.prototype,"orientationY",{set:function(t){this._orientation[1]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(t.Panner3D.prototype,"orientationZ",{set:function(t){this._orientation[2]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),t.Panner3D._aliasProperty=function(e){Object.defineProperty(t.Panner3D.prototype,e,{set:function(t){this._panner[e]=t},get:function(){return this._panner[e]}})},t.Panner3D._aliasProperty("panningModel"),t.Panner3D._aliasProperty("refDistance"),t.Panner3D._aliasProperty("rolloffFactor"),t.Panner3D._aliasProperty("distanceModel"),t.Panner3D._aliasProperty("coneInnerAngle"),t.Panner3D._aliasProperty("coneOuterAngle"),t.Panner3D._aliasProperty("coneOuterGain"),t.Panner3D._aliasProperty("maxDistance"),t.Panner3D.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._panner.disconnect(),this._panner=null,this._orientation=null,this._position=null,this},t.Panner3D}),e(function(t){return t.PanVol=function(){var e=t.defaults(arguments,["pan","volume"],t.PanVol);t.AudioNode.call(this),this._panner=this.input=new t.Panner(e.pan),this.pan=this._panner.pan,this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,this._readOnly(["pan","volume"])},t.extend(t.PanVol,t.AudioNode),t.PanVol.defaults={pan:0,volume:0,mute:!1
},Object.defineProperty(t.PanVol.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.PanVol.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._writable(["pan","volume"]),this._panner.dispose(),this._panner=null,this.pan=null,this._volume.dispose(),this._volume=null,this.volume=null,this},t.PanVol}),e(function(t){return t.Solo=function(){var e=t.defaults(arguments,["solo"],t.Solo);t.AudioNode.call(this),this.input=this.output=new t.Gain,this._soloBind=this._soloed.bind(this),this.context.on("solo",this._soloBind),this.solo=e.solo},t.extend(t.Solo,t.AudioNode),t.Solo.defaults={solo:!1},Object.defineProperty(t.Solo.prototype,"solo",{get:function(){return this._isSoloed()},set:function(t){t?this._addSolo():this._removeSolo(),this.context.emit("solo",this)}}),Object.defineProperty(t.Solo.prototype,"muted",{get:function(){return 0===this.input.gain.value}}),t.Solo.prototype._addSolo=function(){t.isArray(this.context._currentSolo)||(this.context._currentSolo=[]),this._isSoloed()||this.context._currentSolo.push(this)},t.Solo.prototype._removeSolo=function(){if(this._isSoloed()){var t=this.context._currentSolo.indexOf(this);this.context._currentSolo.splice(t,1)}},t.Solo.prototype._isSoloed=function(){return!!t.isArray(this.context._currentSolo)&&(0!==this.context._currentSolo.length&&this.context._currentSolo.indexOf(this)!==-1)},t.Solo.prototype._noSolos=function(){return!t.isArray(this.context._currentSolo)||0===this.context._currentSolo.length},t.Solo.prototype._soloed=function(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0},t.Solo.prototype.dispose=function(){return this.context.off("solo",this._soloBind),this._removeSolo(),this._soloBind=null,t.AudioNode.prototype.dispose.call(this),this},t.Solo}),e(function(t){return t.Waveform=function(){var e=t.defaults(arguments,["size"],t.Waveform);e.type=t.Analyser.Type.Waveform,t.AudioNode.call(this),this._analyser=this.input=this.output=new t.Analyser(e)},t.extend(t.Waveform,t.AudioNode),t.Waveform.defaults={size:1024},t.Waveform.prototype.getValue=function(){return this._analyser.getValue()},Object.defineProperty(t.Waveform.prototype,"size",{get:function(){return this._analyser.size},set:function(t){this._analyser.size=t}}),t.Waveform.prototype.dispose=function(){t.AudioNode.prototype.dispose.call(this),this._analyser.dispose(),this._analyser=null},t.Waveform}),e(function(t){return t.CtrlInterpolate=function(){var e=t.defaults(arguments,["values","index"],t.CtrlInterpolate);t.call(this),this.values=e.values,this.index=e.index},t.extend(t.CtrlInterpolate),t.CtrlInterpolate.defaults={index:0,values:[]},Object.defineProperty(t.CtrlInterpolate.prototype,"value",{get:function(){var t=this.index;t=Math.min(t,this.values.length-1);var e=Math.floor(t),n=this.values[e],r=this.values[Math.ceil(t)];return this._interpolate(t-e,n,r)}}),t.CtrlInterpolate.prototype._interpolate=function(e,n,r){if(t.isArray(n)){for(var i=[],o=0;o<n.length;o++)i[o]=this._interpolate(e,n[o],r[o]);return i}if(t.isObject(n)){var a={};for(var s in n)a[s]=this._interpolate(e,n[s],r[s]);return a}return n=this._toNumber(n),r=this._toNumber(r),(1-e)*n+e*r},t.CtrlInterpolate.prototype._toNumber=function(e){return t.isNumber(e)?e:this.toSeconds(e)},t.CtrlInterpolate.prototype.dispose=function(){this.values=null},t.CtrlInterpolate}),e(function(t){return t.CtrlMarkov=function(e,n){t.call(this),this.values=t.defaultArg(e,{}),this.value=t.defaultArg(n,Object.keys(this.values)[0])},t.extend(t.CtrlMarkov),t.CtrlMarkov.prototype.next=function(){if(this.values.hasOwnProperty(this.value)){var e=this.values[this.value];if(t.isArray(e))for(var n=this._getProbDistribution(e),r=Math.random(),i=0,o=0;o<n.length;o++){var a=n[o];if(r>i&&r<i+a){var s=e[o];t.isObject(s)?this.value=s.value:this.value=s}i+=a}else this.value=e}return this.value},t.CtrlMarkov.prototype._getProbDistribution=function(e){for(var n=[],r=0,i=!1,o=0;o<e.length;o++){var a=e[o];t.isObject(a)?(i=!0,n[o]=a.probability):n[o]=1/e.length,r+=n[o]}if(i)for(var s=0;s<n.length;s++)n[s]=n[s]/r;return n},t.CtrlMarkov.prototype.dispose=function(){this.values=null},t.CtrlMarkov}),e(function(t){return t.CtrlPattern=function(){var e=t.defaults(arguments,["values","type"],t.CtrlPattern);t.call(this),this.values=e.values,this.index=0,this._type=null,this._shuffled=null,this._direction=null,this.type=e.type},t.extend(t.CtrlPattern),t.CtrlPattern.Type={Up:"up",Down:"down",UpDown:"upDown",DownUp:"downUp",AlternateUp:"alternateUp",AlternateDown:"alternateDown",Random:"random",RandomWalk:"randomWalk",RandomOnce:"randomOnce"},t.CtrlPattern.defaults={type:t.CtrlPattern.Type.Up,values:[]},Object.defineProperty(t.CtrlPattern.prototype,"value",{get:function(){if(0!==this.values.length){if(1===this.values.length)return this.values[0];this.index=Math.min(this.index,this.values.length-1);var e=this.values[this.index];return this.type===t.CtrlPattern.Type.RandomOnce&&(this.values.length!==this._shuffled.length&&this._shuffleValues(),e=this.values[this._shuffled[this.index]]),e}}}),Object.defineProperty(t.CtrlPattern.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e,this._shuffled=null,this._type===t.CtrlPattern.Type.Up||this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.RandomOnce||this._type===t.CtrlPattern.Type.AlternateUp?this.index=0:this._type!==t.CtrlPattern.Type.Down&&this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this.index=this.values.length-1),this._type===t.CtrlPattern.Type.UpDown||this._type===t.CtrlPattern.Type.AlternateUp?this._direction=t.CtrlPattern.Type.Up:this._type!==t.CtrlPattern.Type.DownUp&&this._type!==t.CtrlPattern.Type.AlternateDown||(this._direction=t.CtrlPattern.Type.Down),this._type===t.CtrlPattern.Type.RandomOnce?this._shuffleValues():this._type===t.CtrlPattern.Random&&(this.index=Math.floor(Math.random()*this.values.length))}}),t.CtrlPattern.prototype.next=function(){var e=this.type;return e===t.CtrlPattern.Type.Up?(this.index++,this.index>=this.values.length&&(this.index=0)):e===t.CtrlPattern.Type.Down?(this.index--,this.index<0&&(this.index=this.values.length-1)):e===t.CtrlPattern.Type.UpDown||e===t.CtrlPattern.Type.DownUp?(this._direction===t.CtrlPattern.Type.Up?this.index++:this.index--,this.index<0?(this.index=1,this._direction=t.CtrlPattern.Type.Up):this.index>=this.values.length&&(this.index=this.values.length-2,this._direction=t.CtrlPattern.Type.Down)):e===t.CtrlPattern.Type.Random?this.index=Math.floor(Math.random()*this.values.length):e===t.CtrlPattern.Type.RandomWalk?Math.random()<.5?(this.index--,this.index=Math.max(this.index,0)):(this.index++,this.index=Math.min(this.index,this.values.length-1)):e===t.CtrlPattern.Type.RandomOnce?(this.index++,this.index>=this.values.length&&(this.index=0,this._shuffleValues())):e===t.CtrlPattern.Type.AlternateUp?(this._direction===t.CtrlPattern.Type.Up?(this.index+=2,this._direction=t.CtrlPattern.Type.Down):(this.index-=1,this._direction=t.CtrlPattern.Type.Up),this.index>=this.values.length&&(this.index=0,this._direction=t.CtrlPattern.Type.Up)):e===t.CtrlPattern.Type.AlternateDown&&(this._direction===t.CtrlPattern.Type.Up?(this.index+=1,this._direction=t.CtrlPattern.Type.Down):(this.index-=2,this._direction=t.CtrlPattern.Type.Up),this.index<0&&(this.index=this.values.length-1,this._direction=t.CtrlPattern.Type.Down)),this.value},t.CtrlPattern.prototype._shuffleValues=function(){var t=[];this._shuffled=[];for(var e=0;e<this.values.length;e++)t[e]=e;for(;t.length>0;){var n=t.splice(Math.floor(t.length*Math.random()),1);this._shuffled.push(n[0])}},t.CtrlPattern.prototype.dispose=function(){this._shuffled=null,this.values=null},t.CtrlPattern}),e(function(t){return t.CtrlRandom=function(){var e=t.defaults(arguments,["min","max"],t.CtrlRandom);t.call(this),this.min=e.min,this.max=e.max,this.integer=e.integer},t.extend(t.CtrlRandom),t.CtrlRandom.defaults={min:0,max:1,integer:!1},Object.defineProperty(t.CtrlRandom.prototype,"value",{get:function(){var t=this.toSeconds(this.min),e=this.toSeconds(this.max),n=Math.random(),r=n*t+(1-n)*e;return this.integer&&(r=Math.floor(r)),r}}),t.CtrlRandom}),e(function(t){return t.Buffers=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload","baseUrl"],t.Buffers);t.call(this),this._buffers={},this.baseUrl=r.baseUrl,this._loadingCount=0;for(var i in e)this._loadingCount++,this.add(i,e[i],this._bufferLoaded.bind(this,r.onload))},t.extend(t.Buffers),t.Buffers.defaults={onload:t.noOp,baseUrl:""},t.Buffers.prototype.has=function(t){return this._buffers.hasOwnProperty(t)},t.Buffers.prototype.get=function(t){if(this.has(t))return this._buffers[t];throw new Error("Tone.Buffers: no buffer named "+t)},t.Buffers.prototype._bufferLoaded=function(t){this._loadingCount--,0===this._loadingCount&&t&&t(this)},Object.defineProperty(t.Buffers.prototype,"loaded",{get:function(){var t=!0;for(var e in this._buffers){var n=this.get(e);t=t&&n.loaded}return t}}),t.Buffers.prototype.add=function(e,n,r){return r=t.defaultArg(r,t.noOp),n instanceof t.Buffer?(this._buffers[e]=n,r(this)):n instanceof AudioBuffer?(this._buffers[e]=new t.Buffer(n),r(this)):t.isString(n)&&(this._buffers[e]=new t.Buffer(this.baseUrl+n,r)),this},t.Buffers.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e in this._buffers)this._buffers[e].dispose();return this._buffers=null,this},t.Buffers}),e(function(t){var e={};return t.prototype.send=function(n,r){e.hasOwnProperty(n)||(e[n]=this.context.createGain()),r=t.defaultArg(r,0);var i=new t.Gain(r,t.Type.Decibels);return this.connect(i),i.connect(e[n]),i},t.prototype.receive=function(t,n){return e.hasOwnProperty(t)||(e[t]=this.context.createGain()),e[t].connect(this,0,n),this},t.Context.on("init",function(t){t.Buses?e=t.Buses:(e={},t.Buses=e)}),t}),e(function(t){return t.Draw=function(){t.call(this),this._events=new t.Timeline,this.expiration=.25,this.anticipation=.008,this._boundDrawLoop=this._drawLoop.bind(this)},t.extend(t.Draw),t.Draw.prototype.schedule=function(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&requestAnimationFrame(this._boundDrawLoop),this},t.Draw.prototype.cancel=function(t){return this._events.cancel(this.toSeconds(t)),this},t.Draw.prototype._drawLoop=function(){for(var e=t.now();this._events.length&&this._events.peek().time-this.anticipation<=e;){var n=this._events.shift();e-n.time<=this.expiration&&n.callback()}this._events.length>0&&requestAnimationFrame(this._boundDrawLoop)},t.Draw=new t.Draw,t.Draw}),e(function(t){t.Listener=function(){t.call(this),this._orientation=[0,0,0,0,0,0],this._position=[0,0,0],t.getContext(function(){this.set(e.defaults)}.bind(this))},t.extend(t.Listener),t.Listener.defaults={positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:1,upX:0,upY:1,upZ:0},t.Listener.prototype._rampTimeConstant=.01,t.Listener.prototype.setPosition=function(t,e,n){if(this.context.listener.positionX){var r=this.now();this.context.listener.positionX.setTargetAtTime(t,r,this._rampTimeConstant),this.context.listener.positionY.setTargetAtTime(e,r,this._rampTimeConstant),this.context.listener.positionZ.setTargetAtTime(n,r,this._rampTimeConstant)}else this.context.listener.setPosition(t,e,n);return this._position=Array.prototype.slice.call(arguments),this},t.Listener.prototype.setOrientation=function(t,e,n,r,i,o){if(this.context.listener.forwardX){var a=this.now();this.context.listener.forwardX.setTargetAtTime(t,a,this._rampTimeConstant),this.context.listener.forwardY.setTargetAtTime(e,a,this._rampTimeConstant),this.context.listener.forwardZ.setTargetAtTime(n,a,this._rampTimeConstant),this.context.listener.upX.setTargetAtTime(r,a,this._rampTimeConstant),this.context.listener.upY.setTargetAtTime(i,a,this._rampTimeConstant),this.context.listener.upZ.setTargetAtTime(o,a,this._rampTimeConstant)}else this.context.listener.setOrientation(t,e,n,r,i,o);return this._orientation=Array.prototype.slice.call(arguments),this},Object.defineProperty(t.Listener.prototype,"positionX",{set:function(t){this._position[0]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[0]}}),Object.defineProperty(t.Listener.prototype,"positionY",{set:function(t){this._position[1]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[1]}}),Object.defineProperty(t.Listener.prototype,"positionZ",{set:function(t){this._position[2]=t,this.setPosition.apply(this,this._position)},get:function(){return this._position[2]}}),Object.defineProperty(t.Listener.prototype,"forwardX",{set:function(t){this._orientation[0]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[0]}}),Object.defineProperty(t.Listener.prototype,"forwardY",{set:function(t){this._orientation[1]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[1]}}),Object.defineProperty(t.Listener.prototype,"forwardZ",{set:function(t){this._orientation[2]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[2]}}),Object.defineProperty(t.Listener.prototype,"upX",{set:function(t){this._orientation[3]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[3]}}),Object.defineProperty(t.Listener.prototype,"upY",{set:function(t){this._orientation[4]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[4]}}),Object.defineProperty(t.Listener.prototype,"upZ",{set:function(t){this._orientation[5]=t,this.setOrientation.apply(this,this._orientation)},get:function(){return this._orientation[5]}}),t.Listener.prototype.dispose=function(){return this._orientation=null,this._position=null,this};var e=t.Listener;return t.Listener=new e,t.Context.on("init",function(n){n.Listener instanceof e?t.Listener=n.Listener:t.Listener=new e,n.Listener=t.Listener}),t.Listener}),e(function(t){function e(n,r,i,o){o=t.defaultArg(o,0);var a=new t.OfflineContext(2,r,i);t.context=a;var s=n(t.Transport);return a.currentTime>0&&o<1e3?e(n,r,i,++o):{response:s,context:a}}return t.Offline=function(n,r){var i,o=t.context.sampleRate,a=t.context,s=e(n,r,o),u=s.response,l=s.context;return i=u instanceof Promise?u.then(function(){return l.render()}):l.render(),t.context=a,i.then(function(e){return new t.Buffer(e)})},t.Offline}),e(function(t){return t.Effect=function(){var e=t.defaults(arguments,["wet"],t.Effect);t.AudioNode.call(this),this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this.effectSend=new t.Gain,this.effectReturn=new t.Gain,this.input.connect(this._dryWet.a),this.input.connect(this.effectSend),this.effectReturn.connect(this._dryWet.b),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.Effect,t.AudioNode),t.Effect.defaults={wet:1},t.Effect.prototype.connectEffect=function(t){return this.effectSend.chain(t,this.effectReturn),this},t.Effect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this.effectSend.dispose(),this.effectSend=null,this.effectReturn.dispose(),this.effectReturn=null,this._writable(["wet"]),this.wet=null,this},t.Effect}),e(function(t){return t.AutoFilter=function(){var e=t.defaults(arguments,["frequency","baseFrequency","octaves"],t.AutoFilter);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.filter=new t.Filter(e.filter),this._octaves=0,this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.type=e.type,this._readOnly(["frequency","depth"]),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency},t.extend(t.AutoFilter,t.Effect),t.AutoFilter.defaults={frequency:1,type:"sine",depth:1,baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}},t.AutoFilter.prototype.start=function(t){return this._lfo.start(t),this},t.AutoFilter.prototype.stop=function(t){return this._lfo.stop(t),this},t.AutoFilter.prototype.sync=function(t){return this._lfo.sync(t),this},t.AutoFilter.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoFilter.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),Object.defineProperty(t.AutoFilter.prototype,"baseFrequency",{get:function(){return this._lfo.min},set:function(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}}),Object.defineProperty(t.AutoFilter.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._lfo.max=this.baseFrequency*Math.pow(2,t)}}),t.AutoFilter.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this.filter.dispose(),this.filter=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null,this},t.AutoFilter}),e(function(t){return t.AutoPanner=function(){var e=t.defaults(arguments,["frequency"],t.AutoPanner);t.Effect.call(this,e),this._lfo=new t.LFO({frequency:e.frequency,amplitude:e.depth,min:-1,max:1}),this.depth=this._lfo.amplitude,this._panner=new t.Panner,this.frequency=this._lfo.frequency,this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this.type=e.type,this._readOnly(["depth","frequency"])},t.extend(t.AutoPanner,t.Effect),t.AutoPanner.defaults={frequency:1,type:"sine",depth:1},t.AutoPanner.prototype.start=function(t){return this._lfo.start(t),this},t.AutoPanner.prototype.stop=function(t){return this._lfo.stop(t),this},t.AutoPanner.prototype.sync=function(t){return this._lfo.sync(t),this},t.AutoPanner.prototype.unsync=function(){return this._lfo.unsync(),this},Object.defineProperty(t.AutoPanner.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),t.AutoPanner.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._lfo.dispose(),this._lfo=null,this._panner.dispose(),this._panner=null,this._writable(["depth","frequency"]),this.frequency=null,this.depth=null,this},t.AutoPanner}),e(function(t){return t.AutoWah=function(){var e=t.defaults(arguments,["baseFrequency","octaves","sensitivity"],t.AutoWah);t.Effect.call(this,e),this.follower=new t.Follower(e.follower),this._sweepRange=new t.ScaleExp(0,1,.5),this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this._inputBoost=new t.Gain,this._bandpass=new t.Filter({rolloff:-48,frequency:0,Q:e.Q}),this._peaking=new t.Filter(0,"peaking"),this._peaking.gain.value=e.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this.follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=e.sensitivity,this._readOnly(["gain","Q"])},t.extend(t.AutoWah,t.Effect),t.AutoWah.defaults={baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:{attack:.3,release:.5}},Object.defineProperty(t.AutoWah.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t,this._setSweepRange()}}),Object.defineProperty(t.AutoWah.prototype,"sensitivity",{get:function(){return t.gainToDb(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/t.dbToGain(e)}}),t.AutoWah.prototype._setSweepRange=function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)},t.AutoWah.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this.follower.dispose(),this.follower=null,this._sweepRange.dispose(),this._sweepRange=null,this._bandpass.dispose(),this._bandpass=null,this._peaking.dispose(),this._peaking=null,this._inputBoost.dispose(),this._inputBoost=null,this._writable(["gain","Q"]),this.gain=null,this.Q=null,this},t.AutoWah}),e(function(t){return t.Modulo=function(e){t.SignalBase.call(this),this.createInsOuts(1,0),this._shaper=new t.WaveShaper(Math.pow(2,16)),this._multiply=new t.Multiply,this._subtract=this.output=new t.Subtract,this._modSignal=new t.Signal(e),this.input.fan(this._shaper,this._subtract),this._modSignal.connect(this._multiply,0,0),this._shaper.connect(this._multiply,0,1),this._multiply.connect(this._subtract,0,1),this._setWaveShaper(e)},t.extend(t.Modulo,t.SignalBase),t.Modulo.prototype._setWaveShaper=function(t){this._shaper.setMap(function(e){var n=Math.floor((e+1e-4)/t);return n})},Object.defineProperty(t.Modulo.prototype,"value",{get:function(){return this._modSignal.value},set:function(t){this._modSignal.value=t,this._setWaveShaper(t)}}),t.Modulo.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this._multiply.dispose(),this._multiply=null,this._subtract.dispose(),this._subtract=null,this._modSignal.dispose(),this._modSignal=null,this},t.Modulo}),e(function(t){return t.BitCrusher=function(){var e=t.defaults(arguments,["bits"],t.BitCrusher);t.Effect.call(this,e);var n=1/Math.pow(2,e.bits-1);this._subtract=new t.Subtract,this._modulo=new t.Modulo(n),this._bits=e.bits,this.effectSend.fan(this._subtract,this._modulo),this._modulo.connect(this._subtract,0,1),this._subtract.connect(this.effectReturn)},t.extend(t.BitCrusher,t.Effect),t.BitCrusher.defaults={bits:4},Object.defineProperty(t.BitCrusher.prototype,"bits",{get:function(){return this._bits},set:function(t){this._bits=t;var e=1/Math.pow(2,t-1);this._modulo.value=e}}),t.BitCrusher.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._subtract.dispose(),this._subtract=null,this._modulo.dispose(),this._modulo=null,this},t.BitCrusher}),e(function(t){return t.Chebyshev=function(){var e=t.defaults(arguments,["order"],t.Chebyshev);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._order=e.order,this.connectEffect(this._shaper),this.order=e.order,this.oversample=e.oversample},t.extend(t.Chebyshev,t.Effect),t.Chebyshev.defaults={order:1,oversample:"none"},t.Chebyshev.prototype._getCoefficient=function(t,e,n){return n.hasOwnProperty(e)?n[e]:(0===e?n[e]=0:1===e?n[e]=t:n[e]=2*t*this._getCoefficient(t,e-1,n)-this._getCoefficient(t,e-2,n),n[e])},Object.defineProperty(t.Chebyshev.prototype,"order",{get:function(){return this._order},set:function(t){this._order=t;for(var e=new Array(4096),n=e.length,r=0;r<n;++r){var i=2*r/n-1;0===i?e[r]=0:e[r]=this._getCoefficient(i,t,{})}this._shaper.curve=e}}),Object.defineProperty(t.Chebyshev.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}}),t.Chebyshev.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Chebyshev}),e(function(t){return t.StereoEffect=function(){t.AudioNode.call(this);var e=t.defaults(arguments,["wet"],t.Effect);this.createInsOuts(1,1),this._dryWet=new t.CrossFade(e.wet),this.wet=this._dryWet.fade,this._split=new t.Split,this.effectSendL=this._split.left,this.effectSendR=this._split.right,this._merge=new t.Merge,this.effectReturnL=this._merge.left,this.effectReturnR=this._merge.right,this.input.connect(this._split),this.input.connect(this._dryWet,0,0),this._merge.connect(this._dryWet,0,1),this._dryWet.connect(this.output),this._readOnly(["wet"])},t.extend(t.StereoEffect,t.Effect),t.StereoEffect.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._dryWet.dispose(),this._dryWet=null,this._split.dispose(),this._split=null,this._merge.dispose(),this._merge=null,this.effectSendL=null,this.effectSendR=null,this.effectReturnL=null,this.effectReturnR=null,this._writable(["wet"]),this.wet=null,this},t.StereoEffect}),e(function(t){return t.Chorus=function(){var e=t.defaults(arguments,["frequency","delayTime","depth"],t.Chorus);t.StereoEffect.call(this,e),this._depth=e.depth,this._delayTime=e.delayTime/1e3,this._lfoL=new t.LFO({frequency:e.frequency,min:0,max:1}),this._lfoR=new t.LFO({frequency:e.frequency,min:0,max:1,phase:180}),this._delayNodeL=new t.Delay,this._delayNodeR=new t.Delay,this.frequency=this._lfoL.frequency,this.effectSendL.chain(this._delayNodeL,this.effectReturnL),this.effectSendR.chain(this._delayNodeR,this.effectReturnR),this.effectSendL.connect(this.effectReturnL),this.effectSendR.connect(this.effectReturnR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this._lfoL.start(),this._lfoR.start(),this._lfoL.frequency.connect(this._lfoR.frequency),this.depth=this._depth,this.frequency.value=e.frequency,this.type=e.type,this._readOnly(["frequency"]),this.spread=e.spread},t.extend(t.Chorus,t.StereoEffect),t.Chorus.defaults={frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180},Object.defineProperty(t.Chorus.prototype,"depth",{get:function(){return this._depth},set:function(t){this._depth=t;var e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}}),Object.defineProperty(t.Chorus.prototype,"delayTime",{get:function(){return 1e3*this._delayTime},set:function(t){this._delayTime=t/1e3,this.depth=this._depth}}),Object.defineProperty(t.Chorus.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t,this._lfoR.type=t}}),Object.defineProperty(t.Chorus.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}}),t.Chorus.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._delayNodeL.dispose(),this._delayNodeL=null,this._delayNodeR.dispose(),this._delayNodeR=null,this._writable("frequency"),this.frequency=null,this},t.Chorus}),e(function(t){return t.Convolver=function(){var e=t.defaults(arguments,["url","onload"],t.Convolver);t.Effect.call(this,e),this._convolver=this.context.createConvolver(),this._buffer=new t.Buffer(e.url,function(t){this._convolver.buffer=t.get(),e.onload()}.bind(this)),this.connectEffect(this._convolver)},t.extend(t.Convolver,t.Effect),t.Convolver.defaults={onload:t.noOp},Object.defineProperty(t.Convolver.prototype,"buffer",{get:function(){return this._buffer.get()},set:function(t){this._buffer.set(t),this._convolver.buffer=this._buffer.get()}}),t.Convolver.prototype.load=function(t,e){return this._buffer.load(t,function(t){this.buffer=t,e&&e()}.bind(this))},t.Convolver.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this._buffer.dispose(),this._buffer=null,this},t.Convolver}),e(function(t){return t.Distortion=function(){var e=t.defaults(arguments,["distortion"],t.Distortion);t.Effect.call(this,e),this._shaper=new t.WaveShaper(4096),this._distortion=e.distortion,this.connectEffect(this._shaper),this.distortion=e.distortion,this.oversample=e.oversample},t.extend(t.Distortion,t.Effect),t.Distortion.defaults={distortion:.4,oversample:"none"},Object.defineProperty(t.Distortion.prototype,"distortion",{get:function(){return this._distortion},set:function(t){this._distortion=t;var e=100*t,n=Math.PI/180;this._shaper.setMap(function(t){return Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))})}}),Object.defineProperty(t.Distortion.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(t){this._shaper.oversample=t}}),t.Distortion.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._shaper.dispose(),this._shaper=null,this},t.Distortion}),e(function(t){return t.FeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.Effect.call(this,e),this._feedbackGain=new t.Gain(e.feedback,t.Type.NormalRange),this.feedback=this._feedbackGain.gain,this.effectReturn.chain(this._feedbackGain,this.effectSend),this._readOnly(["feedback"])},t.extend(t.FeedbackEffect,t.Effect),t.FeedbackEffect.defaults={feedback:.125},t.FeedbackEffect.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._writable(["feedback"]),this._feedbackGain.dispose(),this._feedbackGain=null,this.feedback=null,this},t.FeedbackEffect}),e(function(t){return t.FeedbackDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.FeedbackDelay);t.FeedbackEffect.call(this,e),this._delayNode=new t.Delay(e.delayTime,e.maxDelay),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),this._readOnly(["delayTime"])},t.extend(t.FeedbackDelay,t.FeedbackEffect),t.FeedbackDelay.defaults={delayTime:.25,maxDelay:1},t.FeedbackDelay.prototype.dispose=function(){return t.FeedbackEffect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._writable(["delayTime"]),this.delayTime=null,this},t.FeedbackDelay}),e(function(t){var e=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],n=[225,556,441,341];return t.Freeverb=function(){var r=t.defaults(arguments,["roomSize","dampening"],t.Freeverb);t.StereoEffect.call(this,r),this.roomSize=new t.Signal(r.roomSize,t.Type.NormalRange),this.dampening=new t.Signal(r.dampening,t.Type.Frequency),this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];for(var i=0;i<n.length;i++){var o=this.context.createBiquadFilter();o.type="allpass",o.frequency.value=n[i],this._allpassFiltersL.push(o)}for(var a=0;a<n.length;a++){var s=this.context.createBiquadFilter();s.type="allpass",s.frequency.value=n[a],this._allpassFiltersR.push(s)}for(var u=0;u<e.length;u++){var l=new t.LowpassCombFilter(e[u]);u<e.length/2?this.effectSendL.chain(l,this._allpassFiltersL[0]):this.effectSendR.chain(l,this._allpassFiltersR[0]),this.roomSize.connect(l.resonance),this.dampening.connect(l.dampening),this._combFilters.push(l)}t.connectSeries.apply(t,this._allpassFiltersL),t.connectSeries.apply(t,this._allpassFiltersR),this._allpassFiltersL[this._allpassFiltersL.length-1].connect(this.effectReturnL),this._allpassFiltersR[this._allpassFiltersR.length-1].connect(this.effectReturnR),this._readOnly(["roomSize","dampening"])},t.extend(t.Freeverb,t.StereoEffect),t.Freeverb.defaults={roomSize:.7,dampening:3e3},t.Freeverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFiltersL.length;e++)this._allpassFiltersL[e].disconnect(),this._allpassFiltersL[e]=null;this._allpassFiltersL=null;for(var n=0;n<this._allpassFiltersR.length;n++)this._allpassFiltersR[n].disconnect(),this._allpassFiltersR[n]=null;this._allpassFiltersR=null;for(var r=0;r<this._combFilters.length;r++)this._combFilters[r].dispose(),this._combFilters[r]=null;return this._combFilters=null,this._writable(["roomSize","dampening"]),this.roomSize.dispose(),this.roomSize=null,this.dampening.dispose(),this.dampening=null,this},t.Freeverb}),e(function(t){var e=[.06748,.06404,.08212,.09004],n=[.773,.802,.753,.733],r=[347,113,37];return t.JCReverb=function(){var i=t.defaults(arguments,["roomSize"],t.JCReverb);t.StereoEffect.call(this,i),this.roomSize=new t.Signal(i.roomSize,t.Type.NormalRange),this._scaleRoomSize=new t.Scale(-.733,.197),this._allpassFilters=[],this._feedbackCombFilters=[];for(var o=0;o<r.length;o++){var a=this.context.createBiquadFilter();a.type="allpass",a.frequency.value=r[o],this._allpassFilters.push(a)}for(var s=0;s<e.length;s++){var u=new t.FeedbackCombFilter(e[s],.1);this._scaleRoomSize.connect(u.resonance),u.resonance.value=n[s],this._allpassFilters[this._allpassFilters.length-1].connect(u),s<e.length/2?u.connect(this.effectReturnL):u.connect(this.effectReturnR),
this._feedbackCombFilters.push(u)}this.roomSize.connect(this._scaleRoomSize),t.connectSeries.apply(t,this._allpassFilters),this.effectSendL.connect(this._allpassFilters[0]),this.effectSendR.connect(this._allpassFilters[0]),this._readOnly(["roomSize"])},t.extend(t.JCReverb,t.StereoEffect),t.JCReverb.defaults={roomSize:.5},t.JCReverb.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this);for(var e=0;e<this._allpassFilters.length;e++)this._allpassFilters[e].disconnect(),this._allpassFilters[e]=null;this._allpassFilters=null;for(var n=0;n<this._feedbackCombFilters.length;n++)this._feedbackCombFilters[n].dispose(),this._feedbackCombFilters[n]=null;return this._feedbackCombFilters=null,this._writable(["roomSize"]),this.roomSize.dispose(),this.roomSize=null,this._scaleRoomSize.dispose(),this._scaleRoomSize=null,this},t.JCReverb}),e(function(t){return t.MidSideEffect=function(){t.Effect.apply(this,arguments),this._midSideSplit=new t.MidSideSplit,this._midSideMerge=new t.MidSideMerge,this.midSend=this._midSideSplit.mid,this.sideSend=this._midSideSplit.side,this.midReturn=this._midSideMerge.mid,this.sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)},t.extend(t.MidSideEffect,t.Effect),t.MidSideEffect.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._midSideSplit.dispose(),this._midSideSplit=null,this._midSideMerge.dispose(),this._midSideMerge=null,this.midSend=null,this.sideSend=null,this.midReturn=null,this.sideReturn=null,this},t.MidSideEffect}),e(function(t){return t.Phaser=function(){var e=t.defaults(arguments,["frequency","octaves","baseFrequency"],t.Phaser);t.StereoEffect.call(this,e),this._lfoL=new t.LFO(e.frequency,0,1),this._lfoR=new t.LFO(e.frequency,0,1),this._lfoR.phase=180,this._baseFrequency=e.baseFrequency,this._octaves=e.octaves,this.Q=new t.Signal(e.Q,t.Type.Positive),this._filtersL=this._makeFilters(e.stages,this._lfoL,this.Q),this._filtersR=this._makeFilters(e.stages,this._lfoR,this.Q),this.frequency=this._lfoL.frequency,this.frequency.value=e.frequency,this.effectSendL.connect(this._filtersL[0]),this.effectSendR.connect(this._filtersR[0]),this._filtersL[e.stages-1].connect(this.effectReturnL),this._filtersR[e.stages-1].connect(this.effectReturnR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=e.baseFrequency,this.octaves=e.octaves,this._lfoL.start(),this._lfoR.start(),this._readOnly(["frequency","Q"])},t.extend(t.Phaser,t.StereoEffect),t.Phaser.defaults={frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350},t.Phaser.prototype._makeFilters=function(e,n,r){for(var i=new Array(e),o=0;o<e;o++){var a=this.context.createBiquadFilter();a.type="allpass",r.connect(a.Q),n.connect(a.frequency),i[o]=a}return t.connectSeries.apply(t,i),i},Object.defineProperty(t.Phaser.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t;var e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}}),Object.defineProperty(t.Phaser.prototype,"baseFrequency",{get:function(){return this._baseFrequency},set:function(t){this._baseFrequency=t,this._lfoL.min=t,this._lfoR.min=t,this.octaves=this._octaves}}),t.Phaser.prototype.dispose=function(){t.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","Q"]),this.Q.dispose(),this.Q=null,this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null;for(var e=0;e<this._filtersL.length;e++)this._filtersL[e].disconnect(),this._filtersL[e]=null;this._filtersL=null;for(var n=0;n<this._filtersR.length;n++)this._filtersR[n].disconnect(),this._filtersR[n]=null;return this._filtersR=null,this.frequency=null,this},t.Phaser}),e(function(t){return t.StereoXFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackLR=new t.Gain,this._feedbackRL=new t.Gain,this.effectReturnL.chain(this._feedbackLR,this.effectSendR),this.effectReturnR.chain(this._feedbackRL,this.effectSendL),this.feedback.fan(this._feedbackLR.gain,this._feedbackRL.gain),this._readOnly(["feedback"])},t.extend(t.StereoXFeedbackEffect,t.StereoEffect),t.StereoXFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackLR.dispose(),this._feedbackLR=null,this._feedbackRL.dispose(),this._feedbackRL=null,this},t.StereoXFeedbackEffect}),e(function(t){return t.PingPongDelay=function(){var e=t.defaults(arguments,["delayTime","feedback"],t.PingPongDelay);t.StereoXFeedbackEffect.call(this,e),this._leftDelay=new t.Delay(0,e.maxDelayTime),this._rightDelay=new t.Delay(0,e.maxDelayTime),this._rightPreDelay=new t.Delay(0,e.maxDelayTime),this.delayTime=new t.Signal(e.delayTime,t.Type.Time),this.effectSendL.chain(this._leftDelay,this.effectReturnL),this.effectSendR.chain(this._rightPreDelay,this._rightDelay,this.effectReturnR),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackLR.disconnect(),this._feedbackLR.connect(this._rightDelay),this._readOnly(["delayTime"])},t.extend(t.PingPongDelay,t.StereoXFeedbackEffect),t.PingPongDelay.defaults={delayTime:.25,maxDelayTime:1},t.PingPongDelay.prototype.dispose=function(){return t.StereoXFeedbackEffect.prototype.dispose.call(this),this._leftDelay.dispose(),this._leftDelay=null,this._rightDelay.dispose(),this._rightDelay=null,this._rightPreDelay.dispose(),this._rightPreDelay=null,this._writable(["delayTime"]),this.delayTime.dispose(),this.delayTime=null,this},t.PingPongDelay}),e(function(t){return t.PitchShift=function(){var e=t.defaults(arguments,["pitch"],t.PitchShift);t.FeedbackEffect.call(this,e),this._frequency=new t.Signal(0),this._delayA=new t.Delay(0,1),this._lfoA=new t.LFO({min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new t.Delay(0,1),this._lfoB=new t.LFO({min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new t.CrossFade,this._crossFadeLFO=new t.LFO({min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new t.Delay(e.delayTime),this.delayTime=this._feedbackDelay.delayTime,this._readOnly("delayTime"),this._pitch=e.pitch,this._windowSize=e.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);var n=this.now();this._lfoA.start(n),this._lfoB.start(n),this._crossFadeLFO.start(n),this.windowSize=this._windowSize},t.extend(t.PitchShift,t.FeedbackEffect),t.PitchShift.defaults={pitch:0,windowSize:.1,delayTime:0,feedback:0},Object.defineProperty(t.PitchShift.prototype,"pitch",{get:function(){return this._pitch},set:function(e){this._pitch=e;var n=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,n=t.intervalToFrequencyRatio(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,n=t.intervalToFrequencyRatio(e)-1),this._frequency.value=n*(1.2/this._windowSize)}}),Object.defineProperty(t.PitchShift.prototype,"windowSize",{get:function(){return this._windowSize},set:function(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}}),t.PitchShift.prototype.dispose=function(){return t.FeedbackEffect.prototype.dispose.call(this),this._frequency.dispose(),this._frequency=null,this._delayA.disconnect(),this._delayA=null,this._delayB.disconnect(),this._delayB=null,this._lfoA.dispose(),this._lfoA=null,this._lfoB.dispose(),this._lfoB=null,this._crossFade.dispose(),this._crossFade=null,this._crossFadeLFO.dispose(),this._crossFadeLFO=null,this._writable("delayTime"),this._feedbackDelay.dispose(),this._feedbackDelay=null,this.delayTime=null,this},t.PitchShift}),e(function(t){return t.BufferSource=function(){var e=t.defaults(arguments,["buffer","onload"],t.BufferSource);t.AudioNode.call(this,e),this.onended=e.onended,this._startTime=-1,this._sourceStarted=!1,this._sourceStopped=!1,this._stopTime=-1,this._gainNode=this.output=new t.Gain,this._source=this.context.createBufferSource(),this._source.connect(this._gainNode),this._source.onended=this._onended.bind(this),this._buffer=new t.Buffer(e.buffer,e.onload),this.playbackRate=new t.Param(this._source.playbackRate,t.Type.Positive),this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut,this.curve=e.curve,this._gain=1,this._onendedTimeout=-1,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.playbackRate.value=e.playbackRate},t.extend(t.BufferSource,t.AudioNode),t.BufferSource.defaults={onended:t.noOp,onload:t.noOp,loop:!1,loopStart:0,loopEnd:0,fadeIn:0,fadeOut:0,curve:"linear",playbackRate:1},Object.defineProperty(t.BufferSource.prototype,"state",{get:function(){return this.getStateAtTime(this.now())}}),t.BufferSource.prototype.getStateAtTime=function(e){return e=this.toSeconds(e),this._startTime!==-1&&e>=this._startTime&&!this._sourceStopped?t.State.Started:t.State.Stopped},t.BufferSource.prototype.start=function(e,n,r,i,o){if(this._startTime!==-1)throw new Error("Tone.BufferSource can only be started once.");if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");e=this.toSeconds(e),n=this.loop?t.defaultArg(n,this.loopStart):t.defaultArg(n,0),n=this.toSeconds(n),i=t.defaultArg(i,1),this._gain=i,o=this.toSeconds(t.defaultArg(o,this.fadeIn)),this.fadeIn=o,o>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(this._gain,e+o):this._gainNode.gain.exponentialApproachValueAtTime(this._gain,e,o)):this._gainNode.gain.setValueAtTime(i,e),this._startTime=e;var a=this.toSeconds(t.defaultArg(r,this.buffer.duration-n%this.buffer.duration));if(a=Math.max(a,0),t.isDefined(r)&&(this.loop||(a=Math.min(a,this.buffer.duration-n%this.buffer.duration)),this.stop(e+a,this.fadeOut)),this.loop){var s=this.loopEnd||this.buffer.duration,u=this.loopStart,l=s-u;n>=s&&(n=(n-u)%l+u)}return this._source.buffer=this.buffer.get(),this._source.loopEnd=this.loopEnd||this.buffer.duration,n<this.buffer.duration&&(this._sourceStarted=!0,this._source.start(e,n)),this},t.BufferSource.prototype.stop=function(e,n){if(!this.buffer.loaded)throw new Error("Tone.BufferSource: buffer is either not set or not loaded.");if(!this._sourceStopped){if(e=this.toSeconds(e),this._stopTime!==-1&&this.cancelStop(),e<=this._startTime)return this._gainNode.gain.cancelScheduledValues(e),this._gainNode.gain.value=0,this;e=Math.max(this._startTime+this.fadeIn+this.sampleTime,e),this._gainNode.gain.cancelScheduledValues(e),this._stopTime=e,n=this.toSeconds(t.defaultArg(n,this.fadeOut));var r=e-this._startTime-this.fadeIn-this.sampleTime;this.loop||(r=Math.min(r,this.buffer.duration)),n=Math.min(r,n);var i=e-n;return n>this.sampleTime?(this._gainNode.gain.setValueAtTime(this._gain,i),"linear"===this.curve?this._gainNode.gain.linearRampToValueAtTime(0,e):this._gainNode.gain.exponentialApproachValueAtTime(0,i,n)):this._gainNode.gain.setValueAtTime(0,e),t.context.clearTimeout(this._onendedTimeout),this._onendedTimeout=t.context.setTimeout(this._onended.bind(this),this._stopTime-this.now()),this}},t.BufferSource.prototype.cancelStop=function(){if(this._startTime!==-1&&!this._sourceStopped){var t=this.toSeconds(this.fadeIn);this._gainNode.gain.cancelScheduledValues(this._startTime+t+this.sampleTime),this._gainNode.gain.setValueAtTime(1,Math.max(this.now(),this._startTime+t+this.sampleTime)),this.context.clearTimeout(this._onendedTimeout),this._stopTime=-1}return this},t.BufferSource.prototype._onended=function(){if(!this._sourceStopped){this._sourceStopped=!0;var t="exponential"===this.curve?2*this.fadeOut:0;this._sourceStarted&&this._stopTime!==-1&&this._source.stop(this._stopTime+t),this.onended(this)}},Object.defineProperty(t.BufferSource.prototype,"loopStart",{get:function(){return this._source.loopStart},set:function(t){this._source.loopStart=this.toSeconds(t)}}),Object.defineProperty(t.BufferSource.prototype,"loopEnd",{get:function(){return this._source.loopEnd},set:function(t){this._source.loopEnd=this.toSeconds(t)}}),Object.defineProperty(t.BufferSource.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}}),Object.defineProperty(t.BufferSource.prototype,"loop",{get:function(){return this._source.loop},set:function(t){this._source.loop=t,this.cancelStop()}}),t.BufferSource.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.onended=null,this._source.onended=null,this._source.disconnect(),this._source=null,this._gainNode.dispose(),this._gainNode=null,this._buffer.dispose(),this._buffer=null,this._startTime=-1,this.playbackRate=null,t.context.clearTimeout(this._onendedTimeout),this},t.BufferSource}),e(function(t){function e(){for(var e in i)o[e]=(new t.Buffer).fromArray(i[e])}t.Noise=function(){var e=t.defaults(arguments,["type"],t.Noise);t.Source.call(this,e),this._source=null,this._type=e.type,this._playbackRate=e.playbackRate},t.extend(t.Noise,t.Source),t.Noise.defaults={type:"white",playbackRate:1},Object.defineProperty(t.Noise.prototype,"type",{get:function(){return this._type},set:function(e){if(this._type!==e){if(!(e in o))throw new TypeError("Tone.Noise: invalid type: "+e);if(this._type=e,this.state===t.State.Started){var n=this.now();this._stop(n),this._start(n)}}}}),Object.defineProperty(t.Noise.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}}),t.Noise.prototype._start=function(e){var n=o[this._type];this._source=new t.BufferSource(n).connect(this.output),this._source.loop=!0,this._source.playbackRate.value=this._playbackRate,this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))},t.Noise.prototype._stop=function(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)},t.Noise.prototype.restart=function(t){this._stop(t),this._start(t)},t.Noise.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),null!==this._source&&(this._source.disconnect(),this._source=null),this._buffer=null,this};var n=220500,r=2,i={pink:function(){for(var t=[],e=0;e<r;e++){var i=new Float32Array(n);t[e]=i;var o,a,s,u,l,c,p;o=a=s=u=l=c=p=0;for(var h=0;h<n;h++){var f=2*Math.random()-1;o=.99886*o+.0555179*f,a=.99332*a+.0750759*f,s=.969*s+.153852*f,u=.8665*u+.3104856*f,l=.55*l+.5329522*f,c=-.7616*c-.016898*f,i[h]=o+a+s+u+l+c+p+.5362*f,i[h]*=.11,p=.115926*f}}return t}(),brown:function(){for(var t=[],e=0;e<r;e++){var i=new Float32Array(n);t[e]=i;for(var o=0,a=0;a<n;a++){var s=2*Math.random()-1;i[a]=(o+.02*s)/1.02,o=i[a],i[a]*=3.5}}return t}(),white:function(){for(var t=[],e=0;e<r;e++){var i=new Float32Array(n);t[e]=i;for(var o=0;o<n;o++)i[o]=2*Math.random()-1}return t}()},o={};return t.getContext(e),t.Context.on("init",e),t.Noise}),e(function(t){return t.Reverb=function(){var e=t.defaults(arguments,["decay"],t.Reverb);t.Effect.call(this,e),this._convolver=this.context.createConvolver(),this.decay=e.decay,this.preDelay=e.preDelay,this.connectEffect(this._convolver)},t.extend(t.Reverb,t.Effect),t.Reverb.defaults={decay:1.5,preDelay:.01},t.Reverb.prototype.generate=function(){return t.Offline(function(){var e=new t.Noise,n=new t.Noise,r=new t.Merge;e.connect(r.left),n.connect(r.right);var i=(new t.Gain).toMaster();r.connect(i),e.start(0),n.start(0),i.gain.setValueAtTime(0,0),i.gain.linearRampToValueAtTime(1,this.preDelay),i.gain.exponentialApproachValueAtTime(0,this.preDelay,this.decay-this.preDelay)}.bind(this),this.decay).then(function(t){return this._convolver.buffer=t.get(),this}.bind(this))},t.Reverb.prototype.dispose=function(){return t.Effect.prototype.dispose.call(this),this._convolver.disconnect(),this._convolver=null,this},t.Reverb}),e(function(t){return t.StereoFeedbackEffect=function(){var e=t.defaults(arguments,["feedback"],t.FeedbackEffect);t.StereoEffect.call(this,e),this.feedback=new t.Signal(e.feedback,t.Type.NormalRange),this._feedbackL=new t.Gain,this._feedbackR=new t.Gain,this.effectReturnL.chain(this._feedbackL,this.effectSendL),this.effectReturnR.chain(this._feedbackR,this.effectSendR),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),this._readOnly(["feedback"])},t.extend(t.StereoFeedbackEffect,t.StereoEffect),t.StereoFeedbackEffect.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["feedback"]),this.feedback.dispose(),this.feedback=null,this._feedbackL.dispose(),this._feedbackL=null,this._feedbackR.dispose(),this._feedbackR=null,this},t.StereoFeedbackEffect}),e(function(t){return t.StereoWidener=function(){var e=t.defaults(arguments,["width"],t.StereoWidener);t.MidSideEffect.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._readOnly(["width"]),this._twoTimesWidthMid=new t.Multiply(2),this._twoTimesWidthSide=new t.Multiply(2),this._midMult=new t.Multiply,this._twoTimesWidthMid.connect(this._midMult,0,1),this.midSend.chain(this._midMult,this.midReturn),this._oneMinusWidth=new t.Subtract,this._oneMinusWidth.connect(this._twoTimesWidthMid),this.context.getConstant(1).connect(this._oneMinusWidth,0,0),this.width.connect(this._oneMinusWidth,0,1),this._sideMult=new t.Multiply,this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult,0,1),this.sideSend.chain(this._sideMult,this.sideReturn)},t.extend(t.StereoWidener,t.MidSideEffect),t.StereoWidener.defaults={width:.5},t.StereoWidener.prototype.dispose=function(){return t.MidSideEffect.prototype.dispose.call(this),this._writable(["width"]),this.width.dispose(),this.width=null,this._midMult.dispose(),this._midMult=null,this._sideMult.dispose(),this._sideMult=null,this._twoTimesWidthMid.dispose(),this._twoTimesWidthMid=null,this._twoTimesWidthSide.dispose(),this._twoTimesWidthSide=null,this._oneMinusWidth.dispose(),this._oneMinusWidth=null,this},t.StereoWidener}),e(function(t){return t.Tremolo=function(){var e=t.defaults(arguments,["frequency","depth"],t.Tremolo);t.StereoEffect.call(this,e),this._lfoL=new t.LFO({phase:e.spread,min:1,max:0}),this._lfoR=new t.LFO({phase:e.spread,min:1,max:0}),this._amplitudeL=new t.Gain,this._amplitudeR=new t.Gain,this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.depth=new t.Signal(e.depth,t.Type.NormalRange),this._readOnly(["frequency","depth"]),this.effectSendL.chain(this._amplitudeL,this.effectReturnL),this.effectSendR.chain(this._amplitudeR,this.effectReturnR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.type=e.type,this.spread=e.spread},t.extend(t.Tremolo,t.StereoEffect),t.Tremolo.defaults={frequency:10,type:"sine",depth:.5,spread:180},t.Tremolo.prototype.start=function(t){return this._lfoL.start(t),this._lfoR.start(t),this},t.Tremolo.prototype.stop=function(t){return this._lfoL.stop(t),this._lfoR.stop(t),this},t.Tremolo.prototype.sync=function(e){return this._lfoL.sync(e),this._lfoR.sync(e),t.Transport.syncSignal(this.frequency),this},t.Tremolo.prototype.unsync=function(){return this._lfoL.unsync(),this._lfoR.unsync(),t.Transport.unsyncSignal(this.frequency),this},Object.defineProperty(t.Tremolo.prototype,"type",{get:function(){return this._lfoL.type},set:function(t){this._lfoL.type=t,this._lfoR.type=t}}),Object.defineProperty(t.Tremolo.prototype,"spread",{get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}}),t.Tremolo.prototype.dispose=function(){return t.StereoEffect.prototype.dispose.call(this),this._writable(["frequency","depth"]),this._lfoL.dispose(),this._lfoL=null,this._lfoR.dispose(),this._lfoR=null,this._amplitudeL.dispose(),this._amplitudeL=null,this._amplitudeR.dispose(),this._amplitudeR=null,this.frequency=null,this.depth=null,this},t.Tremolo}),e(function(t){return t.Vibrato=function(){var e=t.defaults(arguments,["frequency","depth"],t.Vibrato);t.Effect.call(this,e),this._delayNode=new t.Delay(0,e.maxDelay),this._lfo=new t.LFO({type:e.type,min:0,max:e.maxDelay,frequency:e.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=e.depth,this._readOnly(["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)},t.extend(t.Vibrato,t.Effect),t.Vibrato.defaults={maxDelay:.005,frequency:5,depth:.1,type:"sine"},Object.defineProperty(t.Vibrato.prototype,"type",{get:function(){return this._lfo.type},set:function(t){this._lfo.type=t}}),t.Vibrato.prototype.dispose=function(){t.Effect.prototype.dispose.call(this),this._delayNode.dispose(),this._delayNode=null,this._lfo.dispose(),this._lfo=null,this._writable(["frequency","depth"]),this.frequency=null,this.depth=null},t.Vibrato}),e(function(t){return t.Event=function(){var e=t.defaults(arguments,["callback","value"],t.Event);t.call(this),this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._state=new t.TimelineState(t.State.Stopped),this._playbackRate=1,this._startOffset=0,this._probability=e.probability,this._humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate},t.extend(t.Event),t.Event.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},t.Event.prototype._rescheduleEvents=function(e){return e=t.defaultArg(e,-1),this._state.forEachFrom(e,function(e){var n;if(e.state===t.State.Started){t.isDefined(e.id)&&t.Transport.clear(e.id);var r=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){n=1/0,t.isNumber(this._loop)&&(n=this._loop*this._getLoopDuration());var i=this._state.getAfter(r);null!==i&&(n=Math.min(n,i.time-r)),n!==1/0&&(this._state.setStateAtTime(t.State.Stopped,r+n+1),n=t.Ticks(n));var o=t.Ticks(this._getLoopDuration());e.id=t.Transport.scheduleRepeat(this._tick.bind(this),o,t.Ticks(r),n)}else e.id=t.Transport.schedule(this._tick.bind(this),t.Ticks(r))}}.bind(this)),this},Object.defineProperty(t.Event.prototype,"state",{get:function(){return this._state.getValueAtTime(t.Transport.ticks)}}),Object.defineProperty(t.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t}}),Object.defineProperty(t.Event.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t}}),Object.defineProperty(t.Event.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t}}),t.Event.prototype.start=function(e){return e=this.toTicks(e),this._state.getValueAtTime(e)===t.State.Stopped&&(this._state.add({state:t.State.Started,time:e,id:void 0}),this._rescheduleEvents(e)),this},t.Event.prototype.stop=function(e){if(this.cancel(e),e=this.toTicks(e),this._state.getValueAtTime(e)===t.State.Started){this._state.setStateAtTime(t.State.Stopped,e);var n=this._state.getBefore(e),r=e;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this},t.Event.prototype.cancel=function(e){return e=t.defaultArg(e,-(1/0)),e=this.toTicks(e),this._state.forEachFrom(e,function(e){t.Transport.clear(e.id)}),this._state.cancel(e),this},t.Event.prototype._tick=function(e){var n=t.Transport.getTicksAtTime(e);if(!this.mute&&this._state.getValueAtTime(n)===t.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var r=.02;t.isBoolean(this.humanize)||(r=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*r}this.callback(e,this.value)}},t.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(t.Event.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"progress",{get:function(){if(this._loop){var e=t.Transport.ticks,n=this._state.get(e);if(null!==n&&n.state===t.State.Started){var r=this._getLoopDuration(),i=(e-n.time)%r;return i/r}return 0}return 0}}),t.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},t.Event}),e(function(t){return t.Loop=function(){var e=t.defaults(arguments,["callback","interval"],t.Loop);t.call(this),this._event=new t.Event({callback:this._tick.bind(this),loop:!0,loopEnd:e.interval,playbackRate:e.playbackRate,probability:e.probability}),this.callback=e.callback,this.iterations=e.iterations},t.extend(t.Loop),t.Loop.defaults={interval:"4n",callback:t.noOp,playbackRate:1,iterations:1/0,probability:!0,mute:!1},t.Loop.prototype.start=function(t){return this._event.start(t),this},t.Loop.prototype.stop=function(t){return this._event.stop(t),this},t.Loop.prototype.cancel=function(t){return this._event.cancel(t),this},t.Loop.prototype._tick=function(t){this.callback(t)},Object.defineProperty(t.Loop.prototype,"state",{get:function(){return this._event.state}}),Object.defineProperty(t.Loop.prototype,"progress",{get:function(){return this._event.progress}}),Object.defineProperty(t.Loop.prototype,"interval",{get:function(){return this._event.loopEnd},set:function(t){this._event.loopEnd=t}}),Object.defineProperty(t.Loop.prototype,"playbackRate",{get:function(){return this._event.playbackRate},set:function(t){this._event.playbackRate=t}}),Object.defineProperty(t.Loop.prototype,"humanize",{get:function(){return this._event.humanize},set:function(t){this._event.humanize=t}}),Object.defineProperty(t.Loop.prototype,"probability",{get:function(){return this._event.probability},set:function(t){this._event.probability=t}}),Object.defineProperty(t.Loop.prototype,"mute",{get:function(){return this._event.mute},set:function(t){this._event.mute=t}}),Object.defineProperty(t.Loop.prototype,"iterations",{get:function(){return this._event.loop===!0?1/0:this._event.loop},set:function(t){t===1/0?this._event.loop=!0:this._event.loop=t}}),t.Loop.prototype.dispose=function(){this._event.dispose(),this._event=null,this.callback=null},t.Loop}),e(function(t){return t.Part=function(){var e=t.defaults(arguments,["callback","events"],t.Part);t.Event.call(this,e),this._events=[];for(var n=0;n<e.events.length;n++)Array.isArray(e.events[n])?this.add(e.events[n][0],e.events[n][1]):this.add(e.events[n])},t.extend(t.Part,t.Event),t.Part.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1,events:[]},t.Part.prototype.start=function(e,n){var r=this.toTicks(e);return this._state.getValueAtTime(r)!==t.State.Started&&(n=this._loop?t.defaultArg(n,this._loopStart):t.defaultArg(n,0),n=this.toTicks(n),this._state.add({state:t.State.Started,time:r,offset:n}),this._forEach(function(t){this._startNote(t,r,n)})),this},t.Part.prototype._startNote=function(e,n,r){n-=r,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<r&&(n+=this._getLoopDuration()),e.start(t.Ticks(n))):e.startOffset<this._loopStart&&e.startOffset>=r&&(e.loop=!1,e.start(t.Ticks(n))):e.startOffset>=r&&e.start(t.Ticks(n))},Object.defineProperty(t.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t,this._forEach(function(t){t.startOffset+=this._startOffset})}}),t.Part.prototype.stop=function(e){var n=this.toTicks(e);return this._state.cancel(n),this._state.setStateAtTime(t.State.Stopped,n),this._forEach(function(t){t.stop(e)}),this},t.Part.prototype.at=function(e,n){e=t.TransportTime(e);for(var r=t.Ticks(1).toSeconds(),i=0;i<this._events.length;i++){var o=this._events[i];if(Math.abs(e.toTicks()-o.startOffset)<r)return t.isDefined(n)&&(o.value=n),o}return t.isDefined(n)?(this.add(e,n),this._events[this._events.length-1]):null},t.Part.prototype.add=function(e,n){e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e);var r;return n instanceof t.Event?(r=n,r.callback=this._tick.bind(this)):r=new t.Event({callback:this._tick.bind(this),value:n}),r.startOffset=e,r.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(r),this._restartEvent(r),this},t.Part.prototype._restartEvent=function(e){this._state.forEach(function(n){n.state===t.State.Started?this._startNote(e,n.time,n.offset):e.stop(t.Ticks(n.time))}.bind(this))},t.Part.prototype.remove=function(e,n){e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i.remove(e,n):i.startOffset===e&&(t.isUndef(n)||t.isDefined(n)&&i.value===n)&&(this._events.splice(r,1),i.dispose())}return this},t.Part.prototype.removeAll=function(){return this._forEach(function(t){t.dispose()}),this._events=[],this},t.Part.prototype.cancel=function(t){return this._forEach(function(e){e.cancel(t)}),this._state.cancel(this.toTicks(t)),this},t.Part.prototype._forEach=function(e,n){if(this._events){n=t.defaultArg(n,this);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i._forEach(e,n):e.call(n,i)}}return this},t.Part.prototype._setAll=function(t,e){this._forEach(function(n){n[t]=e})},t.Part.prototype._tick=function(t,e){this.mute||this.callback(t,e)},t.Part.prototype._testLoopBoundries=function(e){e.startOffset<this._loopStart||e.startOffset>=this._loopEnd?e.cancel(0):e.state===t.State.Stopped&&this._restartEvent(e)},Object.defineProperty(t.Part.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t,this._setAll("probability",t)}}),Object.defineProperty(t.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t,this._setAll("humanize",t)}}),Object.defineProperty(t.Part.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._forEach(function(e){e._loopStart=this._loopStart,e._loopEnd=this._loopEnd,e.loop=t,this._testLoopBoundries(e)})}}),Object.defineProperty(t.Part.prototype,"loopEnd",{get:function(){return t.Ticks(this._loopEnd).toSeconds()},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(function(e){e.loopEnd=t,this._testLoopBoundries(e)})}}),Object.defineProperty(t.Part.prototype,"loopStart",{get:function(){return t.Ticks(this._loopStart).toSeconds()},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(function(t){t.loopStart=this.loopStart,this._testLoopBoundries(t)})}}),Object.defineProperty(t.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._setAll("playbackRate",t)}}),Object.defineProperty(t.Part.prototype,"length",{get:function(){return this._events.length}}),t.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},t.Part}),e(function(t){return t.Pattern=function(){var e=t.defaults(arguments,["callback","values","pattern"],t.Pattern);t.Loop.call(this,e),this._pattern=new t.CtrlPattern({values:e.values,
type:e.pattern,index:e.index})},t.extend(t.Pattern,t.Loop),t.Pattern.defaults={pattern:t.CtrlPattern.Type.Up,callback:t.noOp,values:[]},t.Pattern.prototype._tick=function(t){this.callback(t,this._pattern.value),this._pattern.next()},Object.defineProperty(t.Pattern.prototype,"index",{get:function(){return this._pattern.index},set:function(t){this._pattern.index=t}}),Object.defineProperty(t.Pattern.prototype,"values",{get:function(){return this._pattern.values},set:function(t){this._pattern.values=t}}),Object.defineProperty(t.Pattern.prototype,"value",{get:function(){return this._pattern.value}}),Object.defineProperty(t.Pattern.prototype,"pattern",{get:function(){return this._pattern.type},set:function(t){this._pattern.type=t}}),t.Pattern.prototype.dispose=function(){t.Loop.prototype.dispose.call(this),this._pattern.dispose(),this._pattern=null},t.Pattern}),e(function(t){return t.Sequence=function(){var e=t.defaults(arguments,["callback","events","subdivision"],t.Sequence),n=e.events;if(delete e.events,t.Part.call(this,e),this._subdivision=this.toTicks(e.subdivision),t.isUndef(e.loopEnd)&&t.isDefined(n)&&(this._loopEnd=n.length*this._subdivision),this._loop=!0,t.isDefined(n))for(var r=0;r<n.length;r++)this.add(r,n[r])},t.extend(t.Sequence,t.Part),t.Sequence.defaults={subdivision:"4n"},Object.defineProperty(t.Sequence.prototype,"subdivision",{get:function(){return t.Ticks(this._subdivision).toSeconds()}}),t.Sequence.prototype.at=function(e,n){return t.isArray(n)&&this.remove(e),t.Part.prototype.at.call(this,this._indexTime(e),n)},t.Sequence.prototype.add=function(e,n){if(null===n)return this;if(t.isArray(n)){var r=Math.round(this._subdivision/n.length);n=new t.Sequence(this._tick.bind(this),n,t.Ticks(r))}return t.Part.prototype.add.call(this,this._indexTime(e),n),this},t.Sequence.prototype.remove=function(e,n){return t.Part.prototype.remove.call(this,this._indexTime(e),n),this},t.Sequence.prototype._indexTime=function(e){return e instanceof t.TransportTime?e:t.Ticks(e*this._subdivision+this.startOffset).toSeconds()},t.Sequence.prototype.dispose=function(){return t.Part.prototype.dispose.call(this),this},t.Sequence}),e(function(t){return t.PulseOscillator=function(){var e=t.defaults(arguments,["frequency","width"],t.Oscillator);t.Source.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._widthGate=new t.Gain,this._sawtooth=new t.Oscillator({frequency:e.frequency,detune:e.detune,type:"sawtooth",phase:e.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new t.WaveShaper(function(t){return t<0?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},t.extend(t.PulseOscillator,t.Source),t.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},t.PulseOscillator.prototype._start=function(t){t=this.toSeconds(t),this._sawtooth.start(t),this._widthGate.gain.setValueAtTime(1,t)},t.PulseOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._sawtooth.stop(t),this._widthGate.gain.setValueAtTime(0,t)},t.PulseOscillator.prototype.restart=function(t){this._sawtooth.restart(t)},Object.defineProperty(t.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(t){this._sawtooth.phase=t}}),Object.defineProperty(t.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(t.PulseOscillator.prototype,"partials",{get:function(){return[]}}),t.PulseOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.dispose(),this._widthGate=null,this._thresh.dispose(),this._thresh=null,this.frequency=null,this.detune=null,this},t.PulseOscillator}),e(function(t){return t.PWMOscillator=function(){var e=t.defaults(arguments,["frequency","modulationFrequency"],t.PWMOscillator);t.Source.call(this,e),this._pulse=new t.PulseOscillator(e.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new t.Oscillator({frequency:e.frequency,detune:e.detune,phase:e.phase}),this._scale=new t.Multiply(2),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},t.extend(t.PWMOscillator,t.Source),t.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},t.PWMOscillator.prototype._start=function(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)},t.PWMOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)},t.PWMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._pulse.restart(t)},Object.defineProperty(t.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(t.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(t.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(t){this._modulator.phase=t}}),t.PWMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},t.PWMOscillator}),e(function(t){return t.FMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.FMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=e.detune,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=e.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},t.extend(t.FMOscillator,t.Source),t.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},t.FMOscillator.prototype._start=function(t){this._modulator.start(t),this._carrier.start(t)},t.FMOscillator.prototype._stop=function(t){this._modulator.stop(t),this._carrier.stop(t)},t.FMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._carrier.restart(t)},Object.defineProperty(t.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.FMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},t.FMOscillator}),e(function(t){return t.AMOscillator=function(){var e=t.defaults(arguments,["frequency","type","modulationType"],t.AMOscillator);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=e.detune,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this._modulationScale=new t.AudioToGain,this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=e.phase,this._readOnly(["frequency","detune","harmonicity"])},t.extend(t.AMOscillator,t.Oscillator),t.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},t.AMOscillator.prototype._start=function(t){this._modulator.start(t),this._carrier.start(t)},t.AMOscillator.prototype._stop=function(t){this._modulator.stop(t),this._carrier.stop(t)},t.AMOscillator.prototype.restart=function(t){this._modulator.restart(t),this._carrier.restart(t)},Object.defineProperty(t.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.AMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},t.AMOscillator}),e(function(t){return t.FatOscillator=function(){var e=t.defaults(arguments,["frequency","type","spread"],t.FatOscillator);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._oscillators=[],this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=t.defaultArg(e.partials,[]),this.count=e.count,this._readOnly(["frequency","detune"])},t.extend(t.FatOscillator,t.Source),t.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},t.FatOscillator.prototype._start=function(t){t=this.toSeconds(t),this._forEach(function(e){e.start(t)})},t.FatOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._forEach(function(e){e.stop(t)})},t.FatOscillator.prototype.restart=function(t){t=this.toSeconds(t),this._forEach(function(e){e.restart(t)})},t.FatOscillator.prototype._forEach=function(t){for(var e=0;e<this._oscillators.length;e++)t.call(this,this._oscillators[e],e)},Object.defineProperty(t.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._forEach(function(e){e.type=t})}}),Object.defineProperty(t.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(t){if(this._spread=t,this._oscillators.length>1){var e=-t/2,n=t/(this._oscillators.length-1);this._forEach(function(t,r){t.detune.value=e+n*r})}}}),Object.defineProperty(t.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(e){if(e=Math.max(e,1),this._oscillators.length!==e){this._forEach(function(t){t.dispose()}),this._oscillators=[];for(var n=0;n<e;n++){var r=new t.Oscillator;this.type===t.Oscillator.Type.Custom?r.partials=this._partials:r.type=this._type,r.phase=this._phase,r.volume.value=-6-1.1*e,this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state===t.State.Started&&this._forEach(function(t){t.start()})}}}),Object.defineProperty(t.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(t){this._phase=t,this._forEach(function(e){e.phase=t})}}),Object.defineProperty(t.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(e){this._partials=e,this._type=t.Oscillator.Type.Custom,this._forEach(function(t){t.partials=e})}}),t.FatOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(t){t.dispose()}),this._oscillators=null,this._partials=null,this},t.FatOscillator}),e(function(t){t.OmniOscillator=function(){var e=t.defaults(arguments,["frequency","type"],t.OmniOscillator);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=e.type,this._readOnly(["frequency","detune"]),this.set(e)},t.extend(t.OmniOscillator,t.Source),t.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var e={Pulse:"PulseOscillator",PWM:"PWMOscillator",Osc:"Oscillator",FM:"FMOscillator",AM:"AMOscillator",Fat:"FatOscillator"};return t.OmniOscillator.prototype._start=function(t){this._oscillator.start(t)},t.OmniOscillator.prototype._stop=function(t){this._oscillator.stop(t)},t.OmniOscillator.prototype.restart=function(t){this._oscillator.restart(t)},Object.defineProperty(t.OmniOscillator.prototype,"type",{get:function(){var t="";return this._sourceType===e.FM?t="fm":this._sourceType===e.AM?t="am":this._sourceType===e.Fat&&(t="fat"),t+this._oscillator.type},set:function(t){"fm"===t.substr(0,2)?(this._createNewOscillator(e.FM),this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator(e.AM),this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator(e.Fat),this._oscillator.type=t.substr(3)):"pwm"===t?this._createNewOscillator(e.PWM):"pulse"===t?this._createNewOscillator(e.Pulse):(this._createNewOscillator(e.Osc),this._oscillator.type=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(t){this._oscillator.partials=t}}),t.OmniOscillator.prototype.set=function(e,n){return"type"===e?this.type=n:t.isObject(e)&&e.hasOwnProperty("type")&&(this.type=e.type),t.prototype.set.apply(this,arguments),this},t.OmniOscillator.prototype._createNewOscillator=function(e){if(e!==this._sourceType){this._sourceType=e;var n=t[e],r=this.now();if(null!==this._oscillator){var i=this._oscillator;i.stop(r),this.context.setTimeout(function(){i.dispose(),i=null},this.blockTime)}this._oscillator=new n,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===t.State.Started&&this._oscillator.start(r)}},Object.defineProperty(t.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t}}),Object.defineProperty(t.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===e.Pulse)return this._oscillator.width}}),Object.defineProperty(t.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===e.Fat)return this._oscillator.count},set:function(t){this._sourceType===e.Fat&&(this._oscillator.count=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===e.Fat)return this._oscillator.spread},set:function(t){this._sourceType===e.Fat&&(this._oscillator.spread=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM)return this._oscillator.modulationType},set:function(t){this._sourceType!==e.FM&&this._sourceType!==e.AM||(this._oscillator.modulationType=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===e.FM)return this._oscillator.modulationIndex}}),Object.defineProperty(t.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM)return this._oscillator.harmonicity}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===e.PWM)return this._oscillator.modulationFrequency}}),t.OmniOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},t.OmniOscillator}),e(function(t){return t.Instrument=function(e){e=t.defaultArg(e,t.Instrument.defaults),t.AudioNode.call(this),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._scheduledEvents=[]},t.extend(t.Instrument,t.AudioNode),t.Instrument.defaults={volume:0},t.Instrument.prototype.triggerAttack=t.noOp,t.Instrument.prototype.triggerRelease=t.noOp,t.Instrument.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this},t.Instrument.prototype._syncMethod=function(e,n){var r=this["_original_"+e]=this[e];this[e]=function(){var e=Array.prototype.slice.call(arguments),i=e[n],o=t.Transport.schedule(function(t){e[n]=t,r.apply(this,e)}.bind(this),i);this._scheduledEvents.push(o)}.bind(this)},t.Instrument.prototype.unsync=function(){return this._scheduledEvents.forEach(function(e){t.Transport.clear(e)}),this._scheduledEvents=[],this._original_triggerAttack&&(this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this},t.Instrument.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(t,n,r),this.triggerRelease(n+e),this},t.Instrument.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this.unsync(),this._scheduledEvents=null,this},t.Instrument}),e(function(t){return t.Monophonic=function(e){e=t.defaultArg(e,t.Monophonic.defaults),t.Instrument.call(this,e),this.portamento=e.portamento},t.extend(t.Monophonic,t.Instrument),t.Monophonic.defaults={portamento:0},t.Monophonic.prototype.triggerAttack=function(t,e,n){return e=this.toSeconds(e),this._triggerEnvelopeAttack(e,n),this.setNote(t,e),this},t.Monophonic.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this._triggerEnvelopeRelease(t),this},t.Monophonic.prototype._triggerEnvelopeAttack=function(){},t.Monophonic.prototype._triggerEnvelopeRelease=function(){},t.Monophonic.prototype.getLevelAtTime=function(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)},t.Monophonic.prototype.setNote=function(t,e){if(e=this.toSeconds(e),this.portamento>0&&this.getLevelAtTime(e)>.05){var n=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(t,n,e)}else this.frequency.setValueAtTime(t,e);return this},t.Monophonic}),e(function(t){return t.Synth=function(e){e=t.defaultArg(e,t.Synth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","frequency","detune","envelope"])},t.extend(t.Synth,t.Monophonic),t.Synth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},t.Synth.prototype._triggerEnvelopeAttack=function(t,e){return this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain&&this.oscillator.stop(t+this.envelope.attack+this.envelope.decay),this},t.Synth.prototype._triggerEnvelopeRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.Synth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},t.Synth}),e(function(t){return t.AMSynth=function(e){e=t.defaultArg(e,t.AMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth,this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth,this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationScale=new t.AudioToGain,this._modulationNode=new t.Gain,this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this._readOnly(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.AMSynth,t.Monophonic),t.AMSynth.defaults={harmonicity:3,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.AMSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t),this},t.AMSynth.prototype._triggerEnvelopeRelease=function(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this},t.AMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationScale.dispose(),this._modulationScale=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.AMSynth}),e(function(t){return t.MonoSynth=function(e){e=t.defaultArg(e,t.MonoSynth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new t.Filter(e.filter),this.filterEnvelope=new t.FrequencyEnvelope(e.filterEnvelope),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},t.extend(t.MonoSynth,t.Monophonic),t.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},t.MonoSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain&&this.oscillator.stop(t+this.envelope.attack+this.envelope.decay),this},t.MonoSynth.prototype._triggerEnvelopeRelease=function(t){return this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.MonoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},t.MonoSynth}),e(function(t){return t.DuoSynth=function(e){e=t.defaultArg(e,t.DuoSynth.defaults),t.Monophonic.call(this,e),this.voice0=new t.MonoSynth(e.voice0),this.voice0.volume.value=-10,this.voice1=new t.MonoSynth(e.voice1),this.voice1.volume.value=-10,this._vibrato=new t.LFO(e.vibratoRate,-50,50),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new t.Gain(e.vibratoAmount,t.Type.Positive),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new t.Signal(440,t.Type.Frequency),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),this._readOnly(["voice0","voice1","frequency","vibratoAmount","vibratoRate"])},t.extend(t.DuoSynth,t.Monophonic),t.DuoSynth.defaults={vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}},voice1:{volume:-10,portamento:0,oscillator:{type:"sine"},filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}},t.DuoSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e),this},t.DuoSynth.prototype._triggerEnvelopeRelease=function(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this},t.DuoSynth.prototype.getLevelAtTime=function(t){return(this.voice0.getLevelAtTime(t)+this.voice1.getLevelAtTime(t))/2},t.DuoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),this.voice0.dispose(),this.voice0=null,this.voice1.dispose(),this.voice1=null,this.frequency.dispose(),this.frequency=null,this._vibratoGain.dispose(),this._vibratoGain=null,this._vibrato=null,this.harmonicity.dispose(),this.harmonicity=null,this.vibratoAmount.dispose(),this.vibratoAmount=null,this.vibratoRate=null,this},t.DuoSynth}),e(function(t){return t.FMSynth=function(e){e=t.defaultArg(e,t.FMSynth.defaults),t.Monophonic.call(this,e),this._carrier=new t.Synth(e.carrier),this._carrier.volume.value=-10,this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope.set(e.envelope),this._modulator=new t.Synth(e.modulator),this._modulator.volume.value=-10,this.modulation=this._modulator.oscillator.set(e.modulation),this.modulationEnvelope=this._modulator.envelope.set(e.modulationEnvelope),this.frequency=new t.Signal(440,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this._readOnly(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"])},t.extend(t.FMSynth,t.Monophonic),t.FMSynth.defaults={harmonicity:3,modulationIndex:10,detune:0,oscillator:{type:"sine"},envelope:{attack:.01,decay:.01,sustain:1,release:.5},modulation:{type:"square"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}},t.FMSynth.prototype._triggerEnvelopeAttack=function(t,e){return t=this.toSeconds(t),this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t),this},t.FMSynth.prototype._triggerEnvelopeRelease=function(t){return t=this.toSeconds(t),this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this},t.FMSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["frequency","harmonicity","modulationIndex","oscillator","envelope","modulation","modulationEnvelope","detune"]),this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this.modulationIndex.dispose(),this.modulationIndex=null,this.harmonicity.dispose(),this.harmonicity=null,this._modulationNode.dispose(),this._modulationNode=null,this.oscillator=null,this.envelope=null,this.modulationEnvelope=null,this.modulation=null,this},t.FMSynth}),e(function(t){return t.MembraneSynth=function(e){e=t.defaultArg(e,t.MembraneSynth.defaults),t.Instrument.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.octaves=e.octaves,this.pitchDecay=e.pitchDecay,this.oscillator.chain(this.envelope,this.output),this._readOnly(["oscillator","envelope"])},t.extend(t.MembraneSynth,t.Instrument),t.MembraneSynth.defaults={pitchDecay:.05,octaves:10,oscillator:{type:"sine"},envelope:{attack:.001,decay:.4,sustain:.01,release:1.4,attackCurve:"exponential"}},t.MembraneSynth.prototype.triggerAttack=function(t,e,n){e=this.toSeconds(e),t=this.toFrequency(t);var r=t*this.octaves;return this.oscillator.frequency.setValueAtTime(r,e),this.oscillator.frequency.exponentialRampToValueAtTime(t,e+this.toSeconds(this.pitchDecay)),this.envelope.triggerAttack(e,n),this.oscillator.start(e),this},t.MembraneSynth.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.oscillator.stop(t+this.envelope.release),this},t.MembraneSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["oscillator","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this},t.MembraneSynth}),e(function(t){var e=[1,1.483,1.932,2.546,2.63,3.897];return t.MetalSynth=function(n){n=t.defaultArg(n,t.MetalSynth.defaults),t.Instrument.call(this,n),this.frequency=new t.Signal(n.frequency,t.Type.Frequency),this._oscillators=[],this._freqMultipliers=[],this._amplitue=new t.Gain(0).connect(this.output),this._highpass=new t.Filter({type:"highpass",Q:-3.0102999566398125}).connect(this._amplitue),this._octaves=n.octaves,this._filterFreqScaler=new t.Scale(n.resonance,7e3),this.envelope=new t.Envelope({attack:n.envelope.attack,attackCurve:"linear",decay:n.envelope.decay,sustain:0,release:n.envelope.release}).chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitue.gain);for(var r=0;r<e.length;r++){var i=new t.FMOscillator({type:"square",modulationType:"square",
harmonicity:n.harmonicity,modulationIndex:n.modulationIndex});i.connect(this._highpass),this._oscillators[r]=i;var o=new t.Multiply(e[r]);this._freqMultipliers[r]=o,this.frequency.chain(o,i.frequency)}this.octaves=n.octaves},t.extend(t.MetalSynth,t.Instrument),t.MetalSynth.defaults={frequency:200,envelope:{attack:.001,decay:1.4,release:.2},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1.5},t.MetalSynth.prototype.triggerAttack=function(e,n){return e=this.toSeconds(e),n=t.defaultArg(n,1),this.envelope.triggerAttack(e,n),this._oscillators.forEach(function(t){t.start(e)}),0===this.envelope.sustain&&this._oscillators.forEach(function(t){t.stop(e+this.envelope.attack+this.envelope.decay)}.bind(this)),this},t.MetalSynth.prototype.triggerRelease=function(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this._oscillators.forEach(function(e){e.stop(t+this.envelope.release)}.bind(this)),this},t.MetalSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},t.MetalSynth.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this},Object.defineProperty(t.MetalSynth.prototype,"modulationIndex",{get:function(){return this._oscillators[0].modulationIndex.value},set:function(t){for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].modulationIndex.value=t}}),Object.defineProperty(t.MetalSynth.prototype,"harmonicity",{get:function(){return this._oscillators[0].harmonicity.value},set:function(t){for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].harmonicity.value=t}}),Object.defineProperty(t.MetalSynth.prototype,"resonance",{get:function(){return this._filterFreqScaler.min},set:function(t){this._filterFreqScaler.min=t,this.octaves=this._octaves}}),Object.defineProperty(t.MetalSynth.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}}),t.MetalSynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this._oscillators.length;e++)this._oscillators[e].dispose(),this._freqMultipliers[e].dispose();this._oscillators=null,this._freqMultipliers=null,this.frequency.dispose(),this.frequency=null,this._filterFreqScaler.dispose(),this._filterFreqScaler=null,this._amplitue.dispose(),this._amplitue=null,this.envelope.dispose(),this.envelope=null,this._highpass.dispose(),this._highpass=null},t.MetalSynth}),e(function(t){return t.NoiseSynth=function(e){e=t.defaultArg(e,t.NoiseSynth.defaults),t.Instrument.call(this,e),this.noise=new t.Noise,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.noise.chain(this.envelope,this.output),this._readOnly(["noise","envelope"])},t.extend(t.NoiseSynth,t.Instrument),t.NoiseSynth.defaults={noise:{type:"white"},envelope:{attack:.005,decay:.1,sustain:0}},t.NoiseSynth.prototype.triggerAttack=function(t,e){return this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t=this.envelope.attack+this.envelope.decay),this},t.NoiseSynth.prototype.triggerRelease=function(t){return this.envelope.triggerRelease(t),this.noise.stop(t+this.envelope.release),this},t.NoiseSynth.prototype.sync=function(){return this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0),this},t.NoiseSynth.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this},t.NoiseSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._writable(["noise","envelope"]),this.noise.dispose(),this.noise=null,this.envelope.dispose(),this.envelope=null,this},t.NoiseSynth}),e(function(t){return t.PluckSynth=function(e){e=t.defaultArg(e,t.PluckSynth.defaults),t.Instrument.call(this,e),this._noise=new t.Noise("pink"),this.attackNoise=e.attackNoise,this._lfcf=new t.LowpassCombFilter({resonance:e.resonance,dampening:e.dampening}),this.resonance=this._lfcf.resonance,this.dampening=this._lfcf.dampening,this._noise.connect(this._lfcf),this._lfcf.connect(this.output),this._readOnly(["resonance","dampening"])},t.extend(t.PluckSynth,t.Instrument),t.PluckSynth.defaults={attackNoise:1,dampening:4e3,resonance:.7},t.PluckSynth.prototype.triggerAttack=function(t,e){t=this.toFrequency(t),e=this.toSeconds(e);var n=1/t;return this._lfcf.delayTime.setValueAtTime(n,e),this._noise.start(e),this._noise.stop(e+n*this.attackNoise),this},t.PluckSynth.prototype.dispose=function(){return t.Instrument.prototype.dispose.call(this),this._noise.dispose(),this._lfcf.dispose(),this._noise=null,this._lfcf=null,this._writable(["resonance","dampening"]),this.dampening=null,this.resonance=null,this},t.PluckSynth}),e(function(t){return t.PolySynth=function(){var e=t.defaults(arguments,["polyphony","voice"],t.PolySynth);t.Instrument.call(this,e),e=t.defaultArg(e,t.Instrument.defaults),e.polyphony=Math.min(t.PolySynth.MAX_POLYPHONY,e.polyphony),this.voices=new Array(e.polyphony),this._triggers=new Array(e.polyphony),this.detune=new t.Signal(e.detune,t.Type.Cents),this._readOnly("detune");for(var n=0;n<e.polyphony;n++){var r=new e.voice(arguments[2],arguments[3]);if(!(r instanceof t.Monophonic))throw new Error("Synth constructor must be instance of Tone.Monophonic");this.voices[n]=r,r.connect(this.output),r.hasOwnProperty("detune")&&this.detune.connect(r.detune),this._triggers[n]={release:-1,note:null,voice:r}}},t.extend(t.PolySynth,t.Instrument),t.PolySynth.defaults={polyphony:4,volume:0,detune:0,voice:t.Synth},t.PolySynth.prototype.triggerAttack=function(t,e,n){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var r=0;r<t.length;r++){for(var i=t[r],o=this._triggers[0],a=1;a<this._triggers.length;a++)this._triggers[a].release<o.release&&(o=this._triggers[a]);o.release=1/0,o.note=JSON.stringify(i),o.voice.triggerAttack(i,e,n)}return this},t.PolySynth.prototype.triggerAttackRelease=function(e,n,r,i){if(r=this.toSeconds(r),this.triggerAttack(e,r,i),t.isArray(n)&&t.isArray(e))for(var o=0;o<e.length;o++){var a=n[Math.min(o,n.length-1)];this.triggerRelease(e[o],r+this.toSeconds(a))}else this.triggerRelease(e,r+this.toSeconds(n));return this},t.PolySynth.prototype.triggerRelease=function(t,e){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var n=0;n<t.length;n++)for(var r=JSON.stringify(t[n]),i=0;i<this._triggers.length;i++){var o=this._triggers[i];o.note===r&&o.release>e&&(o.voice.triggerRelease(e),o.release=e)}return this},t.PolySynth.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},t.PolySynth.prototype.set=function(t,e,n){for(var r=0;r<this.voices.length;r++)this.voices[r].set(t,e,n);return this},t.PolySynth.prototype.get=function(t){return this.voices[0].get(t)},t.PolySynth.prototype.releaseAll=function(t){t=this.toSeconds(t);for(var e=0;e<this._triggers.length;e++){var n=this._triggers[e];n.release>t&&(n.release=t,n.voice.triggerRelease(t))}return this},t.PolySynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this.voices.length;e++)this.voices[e].dispose(),this.voices[e]=null;return this._writable("detune"),this.detune.dispose(),this.detune=null,this.voices=null,this._triggers=null,this},t.PolySynth.MAX_POLYPHONY=20,t.PolySynth}),e(function(t){return t.Sampler=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload","baseUrl"],t.Sampler);t.Instrument.call(this,r);var i={};for(var o in e)if(t.isNote(o)){var a=t.Frequency(o).toMidi();i[a]=e[o]}else{if(isNaN(parseFloat(o)))throw new Error("Tone.Sampler: url keys must be the note's pitch");i[o]=e[o]}this._buffers=new t.Buffers(i,r.onload,r.baseUrl),this._activeSources={},this.attack=r.attack,this.release=r.release},t.extend(t.Sampler,t.Instrument),t.Sampler.defaults={attack:0,release:.1,onload:t.noOp,baseUrl:""},t.Sampler.prototype._findClosest=function(t){for(var e=96,n=0;n<e;){if(this._buffers.has(t+n))return-n;if(this._buffers.has(t-n))return n;n++}return null},t.Sampler.prototype.triggerAttack=function(e,n,r){var i=t.Frequency(e).toMidi(),o=this._findClosest(i);if(null!==o){var a=i-o,s=this._buffers.get(a),u=new t.BufferSource({buffer:s,playbackRate:t.intervalToFrequencyRatio(o),fadeIn:this.attack,fadeOut:this.release,curve:"exponential"}).connect(this.output);u.start(n,0,s.duration,r),t.isArray(this._activeSources[i])||(this._activeSources[i]=[]),this._activeSources[i].push({note:i,source:u})}return this},t.Sampler.prototype.triggerRelease=function(e,n){var r=t.Frequency(e).toMidi();if(this._activeSources[r]&&this._activeSources[r].length){var i=this._activeSources[r].shift().source;n=this.toSeconds(n),i.stop(n+this.release,this.release)}return this},t.Sampler.prototype.releaseAll=function(t){t=this.toSeconds(t);for(var e in this._activeSources)for(var n=this._activeSources[e];n.length;){var r=n.shift().source;r.stop(t+this.release,this.release)}return this},t.Sampler.prototype.sync=function(){return this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this},t.Sampler.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(t,n,r),this.triggerRelease(t,n+e),this},t.Sampler.prototype.add=function(e,n,r){if(t.isNote(e)){var i=t.Frequency(e).toMidi();this._buffers.add(i,n,r)}else{if(isNaN(parseFloat(e)))throw new Error("Tone.Sampler: note must be the note's pitch. Instead got "+e);this._buffers.add(e,n,r)}},Object.defineProperty(t.Sampler.prototype,"loaded",{get:function(){return this._buffers.loaded}}),t.Sampler.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this),this._buffers.dispose(),this._buffers=null;for(var e in this._activeSources)this._activeSources[e].forEach(function(t){t.source.dispose()});return this._activeSources=null,this},t.Sampler}),e(function(t){t.supported&&(OscillatorNode.prototype.setPeriodicWave||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioContext.prototype.createPeriodicWave||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable))}),e(function(t){return t.GainToAudio=function(){t.SignalBase.call(this),this._norm=this.input=this.output=new t.WaveShaper(function(t){return 2*Math.abs(t)-1})},t.extend(t.GainToAudio,t.SignalBase),t.GainToAudio.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.GainToAudio}),e(function(t){return t.Normalize=function(e,n){t.SignalBase.call(this),this._inputMin=t.defaultArg(e,0),this._inputMax=t.defaultArg(n,1),this._sub=this.input=new t.Add(0),this._div=this.output=new t.Multiply(1),this._sub.connect(this._div),this._setRange()},t.extend(t.Normalize,t.SignalBase),Object.defineProperty(t.Normalize.prototype,"min",{get:function(){return this._inputMin},set:function(t){this._inputMin=t,this._setRange()}}),Object.defineProperty(t.Normalize.prototype,"max",{get:function(){return this._inputMax},set:function(t){this._inputMax=t,this._setRange()}}),t.Normalize.prototype._setRange=function(){this._sub.value=-this._inputMin,this._div.value=1/(this._inputMax-this._inputMin)},t.Normalize.prototype.dispose=function(){return t.SignalBase.prototype.dispose.call(this),this._sub.dispose(),this._sub=null,this._div.dispose(),this._div=null,this},t.Normalize}),e(function(t){return t.TransportTimelineSignal=function(){t.Signal.apply(this,arguments),this.output=this._outputSig=new t.Signal(this._initialValue),this._lastVal=this.value,this._synced=t.Transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._bindAnchorValue=this._anchorValue.bind(this),t.Transport.on("start stop pause",this._bindAnchorValue),this._events.memory=1/0},t.extend(t.TransportTimelineSignal,t.Signal),t.TransportTimelineSignal.prototype._onTick=function(e){var n=this.getValueAtTime(t.Transport.seconds);this._lastVal!==n&&(this._lastVal=n,this._outputSig.linearRampToValueAtTime(n,e))},t.TransportTimelineSignal.prototype._anchorValue=function(e){var n=this.getValueAtTime(t.Transport.seconds);return this._lastVal=n,this._outputSig.cancelScheduledValues(e),this._outputSig.setValueAtTime(n,e),this},t.TransportTimelineSignal.prototype.getValueAtTime=function(e){return e=t.TransportTime(e),t.Signal.prototype.getValueAtTime.call(this,e)},t.TransportTimelineSignal.prototype.setValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.setValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.linearRampToValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.linearRampToValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.exponentialRampToValueAtTime=function(e,n){return n=t.TransportTime(n),t.Signal.prototype.exponentialRampToValueAtTime.call(this,e,n),this},t.TransportTimelineSignal.prototype.setTargetAtTime=function(e,n,r){return n=t.TransportTime(n),t.Signal.prototype.setTargetAtTime.call(this,e,n,r),this},t.TransportTimelineSignal.prototype.cancelScheduledValues=function(e){return e=t.TransportTime(e),t.Signal.prototype.cancelScheduledValues.call(this,e),this},t.TransportTimelineSignal.prototype.setValueCurveAtTime=function(e,n,r,i){return n=t.TransportTime(n),r=t.TransportTime(r),t.Signal.prototype.setValueCurveAtTime.call(this,e,n,r,i),this},t.TransportTimelineSignal.prototype.cancelAndHoldAtTime=function(e){return t.Signal.prototype.cancelAndHoldAtTime.call(this,t.TransportTime(e))},t.TransportTimelineSignal.prototype.dispose=function(){t.Transport.clear(this._synced),t.Transport.off("start stop pause",this._syncedCallback),this._events.cancel(0),t.Signal.prototype.dispose.call(this),this._outputSig.dispose(),this._outputSig=null},t.TransportTimelineSignal}),e(function(t){return t.GrainPlayer=function(){var e=t.defaults(arguments,["url","onload"],t.GrainPlayer);t.Source.call(this,e),this.buffer=new t.Buffer(e.url,e.onload),this._clock=new t.Clock(this._tick.bind(this),e.grainSize),this._loopStart=0,this._loopEnd=0,this._activeSources=[],this._playbackRate=e.playbackRate,this._grainSize=e.grainSize,this._overlap=e.overlap,this.detune=e.detune,this.overlap=e.overlap,this.loop=e.loop,this.playbackRate=e.playbackRate,this.grainSize=e.grainSize,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.reverse=e.reverse,this._clock.on("stop",this._onstop.bind(this))},t.extend(t.GrainPlayer,t.Source),t.GrainPlayer.defaults={onload:t.noOp,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1},t.GrainPlayer.prototype._start=function(e,n,r){n=t.defaultArg(n,0),n=this.toSeconds(n),e=this.toSeconds(e),this._offset=n,this._clock.start(e),r&&this.stop(e+this.toSeconds(r))},t.GrainPlayer.prototype._stop=function(t){this._clock.stop(t)},t.GrainPlayer.prototype._onstop=function(t){this._activeSources.forEach(function(e){e.stop(t,0)})},t.GrainPlayer.prototype._tick=function(e){var n=this._offset<this._overlap?0:this._overlap,r=new t.BufferSource({buffer:this.buffer,fadeIn:n,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:t.intervalToFrequencyRatio(this.detune/100)}).connect(this.output);r.start(e,this._offset),this._offset+=this.grainSize,r.stop(e+this.grainSize),this._activeSources.push(r),r.onended=function(){var t=this._activeSources.indexOf(r);t!==-1&&this._activeSources.splice(t,1)}.bind(this)},t.GrainPlayer.prototype.seek=function(t,e){return this._offset=this.toSeconds(t),this._tick(this.toSeconds(e)),this},Object.defineProperty(t.GrainPlayer.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this.grainSize=this._grainSize}}),Object.defineProperty(t.GrainPlayer.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=this.toSeconds(t)}}),Object.defineProperty(t.GrainPlayer.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=this.toSeconds(t)}}),Object.defineProperty(t.GrainPlayer.prototype,"reverse",{get:function(){return this.buffer.reverse},set:function(t){this.buffer.reverse=t}}),Object.defineProperty(t.GrainPlayer.prototype,"grainSize",{get:function(){return this._grainSize},set:function(t){this._grainSize=this.toSeconds(t),this._clock.frequency.value=this._playbackRate/this._grainSize}}),Object.defineProperty(t.GrainPlayer.prototype,"overlap",{get:function(){return this._overlap},set:function(t){this._overlap=this.toSeconds(t)}}),t.GrainPlayer.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this.buffer.dispose(),this.buffer=null,this._clock.dispose(),this._clock=null,this._activeSources.forEach(function(t){t.dispose()}),this._activeSources=null,this},t.GrainPlayer}),e(function(t){return t.Player=function(e){var n;e instanceof t.Buffer&&e.loaded?(e=e.get(),n=t.Player.defaults):n=t.defaults(arguments,["url","onload"],t.Player),t.Source.call(this,n),this.autostart=n.autostart,this._buffer=new t.Buffer({url:n.url,onload:this._onload.bind(this,n.onload),reverse:n.reverse}),e instanceof AudioBuffer&&this._buffer.set(e),this._loop=n.loop,this._loopStart=n.loopStart,this._loopEnd=n.loopEnd,this._playbackRate=n.playbackRate,this._activeSources=[],this._elapsedTime=new t.TickSource(n.playbackRate),this.fadeIn=n.fadeIn,this.fadeOut=n.fadeOut},t.extend(t.Player,t.Source),t.Player.defaults={onload:t.noOp,playbackRate:1,loop:!1,autostart:!1,loopStart:0,loopEnd:0,retrigger:!1,reverse:!1,fadeIn:0,fadeOut:0},t.Player.prototype.load=function(t,e){return this._buffer.load(t,this._onload.bind(this,e))},t.Player.prototype._onload=function(e){e=t.defaultArg(e,t.noOp),e(this),this.autostart&&this.start()},t.Player.prototype._onSourceEnd=function(t){var e=this._activeSources.indexOf(t);this._activeSources.splice(e,1)},t.Player.prototype._start=function(e,n,r){n=this._loop?t.defaultArg(n,this._loopStart):t.defaultArg(n,0),n=this.toSeconds(n);var i=t.defaultArg(r,Math.max(this._buffer.duration-n,0));i=this.toSeconds(i),e=this.toSeconds(e),this._elapsedTime.start(e,n);var o=new t.BufferSource({buffer:this._buffer,loop:this._loop,loopStart:this._loopStart,loopEnd:this._loopEnd,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate,fadeIn:this.fadeIn,fadeOut:this.fadeOut}).connect(this.output);return this._loop||this._synced||this._state.setStateAtTime(t.State.Stopped,e+i/this._playbackRate),this._activeSources.push(o),this._loop&&t.isUndef(r)?o.start(e,n):o.start(e,n,i),this},t.Player.prototype._stop=function(t){return t=this.toSeconds(t),this._elapsedTime.stop(t),this._activeSources.forEach(function(e){e.stop(t)}),this},t.Player.prototype.restart=function(t,e,n){return this._stop(t),this._start(t,e,n),this},t.Player.prototype.seek=function(e,n){return n=this.toSeconds(n),this._state.getValueAtTime(n)===t.State.Started&&(e=this.toSeconds(e),this._stop(n),this._start(n,e)),this},t.Player.prototype.setLoopPoints=function(t,e){return this.loopStart=t,this.loopEnd=e,this},Object.defineProperty(t.Player.prototype,"loopStart",{get:function(){return this._loopStart},set:function(t){this._loopStart=t,this._activeSources.forEach(function(e){e.loopStart=t})}}),Object.defineProperty(t.Player.prototype,"loopEnd",{get:function(){return this._loopEnd},set:function(t){this._loopEnd=t,this._activeSources.forEach(function(e){e.loopEnd=t})}}),Object.defineProperty(t.Player.prototype,"buffer",{get:function(){return this._buffer},set:function(t){this._buffer.set(t)}}),Object.defineProperty(t.Player.prototype,"loop",{get:function(){return this._loop},set:function(e){if(this._loop!==e){this._loop=e;var n=this.now();if(e){var r=this._state.getNextState(t.State.Stopped,n);r&&(this._activeSources.forEach(function(t){t.loop=e}),this._state.cancel(r.time),this._elapsedTime.cancel(r.time))}else this._stopAtNextIteration(n)}}}),t.Player.prototype._stopAtNextIteration=function(e){if(this._state.getValueAtTime(e)===t.State.Started){var n=this._state.getNextState(t.State.Stopped,e),r=this._elapsedTime.getTicksAtTime(e),i=Math.max(Math.ceil(r/this.buffer.duration),1),o=this._elapsedTime.getTimeOfTick(i*this.buffer.duration,n?n.time-this.sampleTime:1/0);this.stop(o)}},Object.defineProperty(t.Player.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t;var e=this.now();this._elapsedTime.frequency.setValueAtTime(t,e),this._loop||this._stopAtNextIteration(e),this._activeSources.forEach(function(n){n.playbackRate.setValueAtTime(t,e)})}}),Object.defineProperty(t.Player.prototype,"position",{get:function(){var e=this.now();if(this._state.getValueAtTime(e)===t.State.Started&&this.loaded){var n=this.buffer.duration,r=this._elapsedTime.getTicksAtTime(e);return r%n}return 0}}),Object.defineProperty(t.Player.prototype,"reverse",{get:function(){return this._buffer.reverse},set:function(t){this._buffer.reverse=t}}),Object.defineProperty(t.Player.prototype,"loaded",{get:function(){return this._buffer.loaded}}),t.Player.prototype.dispose=function(){return this._activeSources.forEach(function(t){t.dispose()}),this._activeSources=null,t.Source.prototype.dispose.call(this),this._buffer.dispose(),this._buffer=null,this._elapsedTime.dispose(),this._elapsedTime=null,this},t.Player}),e(function(t){return t.Players=function(e){var n=Array.prototype.slice.call(arguments);n.shift();var r=t.defaults(n,["onload"],t.Players);t.call(this),this._volume=this.output=new t.Volume(r.volume),this.volume=this._volume.volume,this._readOnly("volume"),this._volume.output.output.channelCount=2,this._volume.output.output.channelCountMode="explicit",this.mute=r.mute,this._players={},this._loadingCount=0,this._fadeIn=r.fadeIn,this._fadeOut=r.fadeOut;for(var i in e)this._loadingCount++,this.add(i,e[i],this._bufferLoaded.bind(this,r.onload))},t.extend(t.Players,t.AudioNode),t.Players.defaults={volume:0,mute:!1,onload:t.noOp,fadeIn:0,fadeOut:0},t.Players.prototype._bufferLoaded=function(t){this._loadingCount--,0===this._loadingCount&&t&&t(this)},Object.defineProperty(t.Players.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),Object.defineProperty(t.Players.prototype,"fadeIn",{get:function(){return this._fadeIn},set:function(t){this._fadeIn=t,this._forEach(function(e){e.fadeIn=t})}}),Object.defineProperty(t.Players.prototype,"fadeOut",{get:function(){return this._fadeOut},set:function(t){this._fadeOut=t,this._forEach(function(e){e.fadeOut=t})}}),Object.defineProperty(t.Players.prototype,"state",{get:function(){var e=!1;return this._forEach(function(n){e=e||n.state===t.State.Started}),e?t.State.Started:t.State.Stopped}}),t.Players.prototype.has=function(t){return this._players.hasOwnProperty(t)},t.Players.prototype.get=function(t){if(this.has(t))return this._players[t];throw new Error("Tone.Players: no player named "+t)},t.Players.prototype._forEach=function(t){for(var e in this._players)t(this._players[e],e);return this},Object.defineProperty(t.Players.prototype,"loaded",{get:function(){var t=!0;return this._forEach(function(e){t=t&&e.loaded}),t}}),t.Players.prototype.add=function(e,n,r){return this._players[e]=new t.Player(n,r).connect(this.output),this._players[e].fadeIn=this._fadeIn,this._players[e].fadeOut=this._fadeOut,this},t.Players.prototype.stopAll=function(t){this._forEach(function(e){e.stop(t)})},t.Players.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable("volume"),this.volume=null,this.output=null,this._forEach(function(t){t.dispose()}),this._players=null,this},t.Players}),e(function(t){return t.UserMedia=function(){var e=t.defaults(arguments,["volume"],t.UserMedia);t.AudioNode.call(this),this._mediaStream=null,this._stream=null,this._device=null,this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume"),this.mute=e.mute},t.extend(t.UserMedia,t.AudioNode),t.UserMedia.defaults={volume:0,mute:!1},t.UserMedia.prototype.open=function(e){return t.UserMedia.enumerateDevices().then(function(n){var r;if(t.isNumber(e))r=n[e];else if(r=n.find(function(t){return t.label===e||t.deviceId===e}),!r&&n.length>0)r=n[0];else if(!r&&t.isDefined(e))throw new Error("Tone.UserMedia: no matching device: "+e);this._device=r;var i={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate}};return r&&(i.audio.deviceId=r.deviceId),navigator.mediaDevices.getUserMedia(i).then(function(t){return this._stream||(this._stream=t,this._mediaStream=this.context.createMediaStreamSource(t),this._mediaStream.connect(this.output)),this}.bind(this))}.bind(this))},t.UserMedia.prototype.close=function(){return this._stream&&(this._stream.getAudioTracks().forEach(function(t){t.stop()}),this._stream=null,this._mediaStream.disconnect(),this._mediaStream=null),this._device=null,this},t.UserMedia.enumerateDevices=function(){return navigator.mediaDevices.enumerateDevices().then(function(t){return t.filter(function(t){return"audioinput"===t.kind})})},Object.defineProperty(t.UserMedia.prototype,"state",{get:function(){return this._stream&&this._stream.active?t.State.Started:t.State.Stopped}}),Object.defineProperty(t.UserMedia.prototype,"deviceId",{get:function(){if(this._device)return this._device.deviceId}}),Object.defineProperty(t.UserMedia.prototype,"groupId",{get:function(){if(this._device)return this._device.groupId}}),Object.defineProperty(t.UserMedia.prototype,"label",{get:function(){if(this._device)return this._device.label}}),Object.defineProperty(t.UserMedia.prototype,"mute",{get:function(){return this._volume.mute},set:function(t){this._volume.mute=t}}),t.UserMedia.prototype.dispose=function(){return t.AudioNode.prototype.dispose.call(this),this.close(),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null,this},Object.defineProperty(t.UserMedia,"supported",{get:function(){return t.isDefined(navigator.mediaDevices)&&t.isFunction(navigator.mediaDevices.getUserMedia)}}),t.UserMedia}),e(function(t){return t.Midi=function(e,n){return this instanceof t.Midi?void t.Frequency.call(this,e,n):new t.Midi(e,n)},t.extend(t.Midi,t.Frequency),t.Midi.prototype._defaultUnits="midi",t.Midi.prototype._frequencyToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._frequencyToUnits.call(this,e))},t.Midi.prototype._ticksToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._ticksToUnits.call(this,e))},t.Midi.prototype._beatsToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._beatsToUnits.call(this,e))},t.Midi.prototype._secondsToUnits=function(e){return t.Frequency.ftom(t.Frequency.prototype._secondsToUnits.call(this,e))},t.Midi.prototype.toMidi=function(){return this.valueOf()},t.Midi.prototype.toFrequency=function(){return t.Frequency.mtof(this.toMidi())},t.Midi.prototype.transpose=function(t){return new this.constructor(this.toMidi()+t)},t.Midi}),n})},function(t,e,n){var r,i;r=[n(4),n(163),n(408),n(20)],i=function(t){"use strict";return t.Envelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this._attackCurve=t.Envelope.Type.Linear,this._releaseCurve=t.Envelope.Type.Exponential,this._minOutput=1e-5,this._sig=this.output=new t.TimelineSignal,this._sig.setValueAtTime(0,0),this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve},t.extend(t.Envelope),t.Envelope.defaults={attack:.01,decay:.1,sustain:.5,release:1,attackCurve:"linear",releaseCurve:"exponential"},Object.defineProperty(t.Envelope.prototype,"value",{get:function(){return this._sig.value}}),Object.defineProperty(t.Envelope.prototype,"attackCurve",{get:function(){return this._attackCurve},set:function(e){if(e!==t.Envelope.Type.Linear&&e!==t.Envelope.Type.Exponential)throw Error('attackCurve must be either "linear" or "exponential". Invalid type: ',e);this._attackCurve=e}}),Object.defineProperty(t.Envelope.prototype,"releaseCurve",{get:function(){return this._releaseCurve},set:function(e){if(e!==t.Envelope.Type.Linear&&e!==t.Envelope.Type.Exponential)throw Error('releaseCurve must be either "linear" or "exponential". Invalid type: ',e);this._releaseCurve=e}}),t.Envelope.prototype.triggerAttack=function(e,n){var r=this.now()+this.blockTime;e=this.toSeconds(e,r);var i=this.toSeconds(this.attack),o=this.toSeconds(this.decay);n=this.defaultArg(n,1);var a=this.getValueAtTime(e);if(a>0){var s=1/i,u=1-a;i=u/s}return i+=e,this._attackCurve===t.Envelope.Type.Linear?this._sig.linearRampToValueBetween(n,e,i):this._sig.exponentialRampToValueBetween(n,e,i),this._sig.exponentialRampToValueBetween(n*this.sustain,i+this.sampleTime,i+o),this},t.Envelope.prototype.triggerRelease=function(e){var n=this.now()+this.blockTime;if(e=this.toSeconds(e,n),this.getValueAtTime(e)>0){var r=this.toSeconds(this.release);this._releaseCurve===t.Envelope.Type.Linear?this._sig.linearRampToValueBetween(0,e,e+r):this._sig.exponentialRampToValueBetween(0,e,r+e)}return this},t.Envelope.prototype.getValueAtTime=function(t){return this._sig.getValueAtTime(t)},t.Envelope.prototype.triggerAttackRelease=function(t,e,n){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this},t.Envelope.prototype.connect=t.Signal.prototype.connect,t.Envelope.prototype.dispose=function(){return t.prototype.dispose.call(this),this._sig.dispose(),this._sig=null,this},t.Envelope.Type={Linear:"linear",Exponential:"exponential"},t.Envelope}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(20)],i=function(t){"use strict";return t.Timeline=function(){var e=this.optionsObject(arguments,["memory"],t.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=e.memory},t.extend(t.Timeline),t.Timeline.defaults={memory:1/0},Object.defineProperty(t.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),t.Timeline.prototype.addEvent=function(t){if(this.isUndef(t.time))throw new Error("events must have a time attribute");if(t.time=this.toSeconds(t.time),this._timeline.length){var e=this._search(t.time);this._timeline.splice(e+1,0,t)}else this._timeline.push(t);if(this.length>this.memory){var n=this.length-this.memory;this._timeline.splice(0,n)}return this},t.Timeline.prototype.removeEvent=function(t){if(this._iterating)this._toRemove.push(t);else{var e=this._timeline.indexOf(t);e!==-1&&this._timeline.splice(e,1)}return this},t.Timeline.prototype.getEvent=function(t){t=this.toSeconds(t);var e=this._search(t);return e!==-1?this._timeline[e]:null},t.Timeline.prototype.getEventAfter=function(t){t=this.toSeconds(t);var e=this._search(t);return e+1<this._timeline.length?this._timeline[e+1]:null},t.Timeline.prototype.getEventBefore=function(t){t=this.toSeconds(t);var e=this._search(t);return e-1>=0?this._timeline[e-1]:null},t.Timeline.prototype.cancel=function(t){if(this._timeline.length>1){t=this.toSeconds(t);var e=this._search(t);e>=0?this._timeline=this._timeline.slice(0,e):this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=t&&(this._timeline=[]);return this},t.Timeline.prototype.cancelBefore=function(t){if(this._timeline.length){t=this.toSeconds(t);var e=this._search(t);e>=0&&(this._timeline=this._timeline.slice(e+1))}return this},t.Timeline.prototype._search=function(t){for(var e=0,n=this._timeline.length,r=n;e<=r&&e<n;){var i=Math.floor(e+(r-e)/2),o=this._timeline[i];if(o.time===t){for(var a=i;a<this._timeline.length;a++){var s=this._timeline[a];s.time===t&&(i=a)}return i}o.time>t?r=i-1:o.time<t&&(e=i+1)}return e-1},t.Timeline.prototype._iterate=function(t,e,n){this._iterating=!0,e=this.defaultArg(e,0),n=this.defaultArg(n,this._timeline.length-1);for(var r=e;r<=n;r++)t(this._timeline[r]);if(this._iterating=!1,this._toRemove.length>0){for(var i=0;i<this._toRemove.length;i++){var o=this._timeline.indexOf(this._toRemove[i]);o!==-1&&this._timeline.splice(o,1);
}this._toRemove=[]}},t.Timeline.prototype.forEach=function(t){return this._iterate(t),this},t.Timeline.prototype.forEachBefore=function(t,e){t=this.toSeconds(t);var n=this._search(t);return n!==-1&&this._iterate(e,0,n),this},t.Timeline.prototype.forEachAfter=function(t,e){t=this.toSeconds(t);var n=this._search(t);return this._iterate(e,n+1),this},t.Timeline.prototype.forEachFrom=function(t,e){t=this.toSeconds(t);for(var n=this._search(t);n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this},t.Timeline.prototype.forEachAtTime=function(t,e){t=this.toSeconds(t);var n=this._search(t);return n!==-1&&this._iterate(function(n){n.time===t&&e(n)},0,n),this},t.Timeline.prototype.dispose=function(){t.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},t.Timeline}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(106),n(20)],i=function(t){"use strict";return t.TimelineState=function(e){t.Timeline.call(this),this._initial=e},t.extend(t.TimelineState,t.Timeline),t.TimelineState.prototype.getStateAtTime=function(t){var e=this.getEvent(t);return null!==e?e.state:this._initial},t.TimelineState.prototype.setStateAtTime=function(t,e){this.addEvent({state:t,time:this.toSeconds(e)})},t.TimelineState}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(54),n(39),n(23),n(179),n(70)],i=function(t,e,n,r,i){function o(t){"use strict";var e={C:0,D:2,E:4,F:5,G:7,A:9,B:11},n=t.charAt(1),r=t.charAt(0),i=24+12*(parseInt(n)-1)+e[r];return 3===t.length&&("#"==t.charAt(2)?i++:i--),i}var a=function(t){this.active=!1,this._offsetX=0,this._offsetY=0,this._currentX=0,this._currentY=0,this._tween=null,this.temperature=1,this.addTile=function(){},this.getGridState=function(){},this._initModel()};return a.prototype._initModel=function(){this.rnn=new r.MusicRNN("https://storage.googleapis.com/magentadata/js/checkpoints/music_rnn/basic_rnn"),this.rnn.initialize()},a.prototype._toNoteSequence=function(t,n){return r.sequences.quantizeNoteSequence({ticksPerQuarter:220,totalTime:n,timeSignatures:[{time:0,numerator:4,denominator:4}],tempos:[{time:0,qpm:120}],quantizationInfo:{stepsPerQuarter:e.stepsPerQuarter},notes:t.map(function(t,n){return t.melody!=-1?{pitch:o(e.pitches[t.melody]),startTime:.5*n,endTime:.5*(n+1)}:-1}).filter(function(t){return t!==-1})},1)},a.prototype.generatePattern=function(){var t,n=this,i=this.getGridState(),o=this.noteSequenceLength(i);o>0?(t=this._toNoteSequence(i,o),console.log("seed: ",t)):(console.log("SETTING TO NO SEED"),t=r.sequences.quantizeNoteSequence({quantizationInfo:{stepsPerQuarter:e.stepsPerQuarter}},1)),this.rnn.continueSequence(t,e.gridWidth-o,n.temperature).then(function(t){if(console.log("Predicted pattern",t),0!==t.notes.length)for(var e=n.fromNoteSequence(t),r=0;r<e.length;r++)e[r]!==-1&&n.addTile(o+r,e[r],!1,!0,1);else setTimeout(function(){alert("The AI likes the melody as is, and doesn't predict anything new.")},1)})},a.prototype.noteSequenceLength=function(t){if(!t)return 0;for(var e=t.length-1;e>=0;e--)if(t[e].melody!=-1)return e+1},a.prototype.midiNumberToNote=function(t){var e={0:"C",2:"D",4:"E",5:"F",7:"G",9:"A",11:"B"},n=t%12,r=(t-n)/12-1,n=e[n.toString()];return console.log("midiNumbertoNote",t,"->",n+r),n+r},a.prototype.fromNoteSequence=function(t){for(var n=[],r=t.notes,i=0,o=0;o<t.totalQuantizedSteps;o++)i<r.length-1&&o===r[i].quantizedStartStep?(n.push(e.gridHeight-(1+e.pitches.indexOf(this.midiNumberToNote(r[i].pitch)))),i++):n.push(-1);return n},a}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){"use strict";function r(t){switch(t.type){case"BinaryCounter":return new s(t.args);default:throw new Error("Unknown auxiliary input: "+t)}}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1);e.auxiliaryInputFromSpec=r;var a=function(){function t(t){this.depth=t}return t}();e.AuxiliaryInput=a;var s=function(t){function e(e){return t.call(this,e.numBits)||this}return i(e,t),e.prototype.getTensors=function(t){for(var e=o.buffer([t,this.depth]),n=0;n<t;++n)for(var r=0;r<this.depth;++r)e.set(Math.floor((n+1)/Math.pow(2,r))%2?1:-1,n,r);return e.toTensor().as2D(t,this.depth)},e}(a);e.BinaryCounter=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(32),i=n(21),o=n(47),a=function(){function t(t,e,n,r,i){this.events=t,this.maxShiftSteps=e,this.numVelocityBins=n,this.program=r,this.isDrum=i}return t.fromNoteSequence=function(e,n,r,a){o.assertIsQuantizedSequence(e);for(var s=e.notes.filter(function(t,e){return void 0===a||t.instrument===a}),u=s.sort(function(t,e){return t.startTime===e.startTime?t.pitch-e.pitch:t.startTime-e.startTime}),l=u.map(function(t,e){return{step:t.quantizedStartStep,index:e,isOffset:0}}),c=u.map(function(t,e){return{step:t.quantizedEndStep,index:e,isOffset:1}}),p=l.concat(c).sort(function(t,e){return t.step===e.step?t.index===e.index?t.isOffset-e.isOffset:t.index-e.index:t.step-e.step}),h=r?Math.ceil((i.MIDI_VELOCITIES-1)/r):void 0,f=[],d=0,m=r,y=0,g=p;y<g.length;y++){var v=g[y];if(v.step>d){for(;v.step>d+n;)f.push({type:"time-shift",steps:n}),d+=n;f.push({type:"time-shift",steps:v.step-d}),d=v.step}if(v.isOffset)f.push({type:"note-off",pitch:u[v.index].pitch});else{if(h){var b=Math.floor((u[v.index].velocity-i.MIN_MIDI_VELOCITY-1)/h)+1;b!==m&&(f.push({type:"velocity-change",velocityBin:b}),m=b)}f.push({type:"note-on",pitch:u[v.index].pitch})}}var _=!!s.some(function(t){return t.isDrum})&&(!s.some(function(t){return!t.isDrum})||void 0),w=Array.from(new Set(s.map(function(t){return t.program}))),S=_||1!==w.length?void 0:w[0],x=new t(f,n,r,S,_);return x.setNumSteps(e.totalQuantizedSteps),x},t.prototype.getNumSteps=function(){return this.events.filter(function(t){return"time-shift"===t.type}).map(function(t){return t.steps}).reduce(function(t,e){return t+e},0)},t.prototype.setNumSteps=function(t){var e=this.getNumSteps();if(e<t){if(this.events.length){var n=this.events[this.events.length-1];if("time-shift"===n.type){var r=Math.min(t-e,this.maxShiftSteps-n.steps);n.steps+=r,e+=r}}for(;e<t;)e+this.maxShiftSteps>t?(this.events.push({type:"time-shift",steps:t-e}),e=t):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),e+=this.maxShiftSteps)}else if(e>t)for(;this.events.length&&e>t;){var i=this.events[this.events.length-1];"time-shift"===i.type?e-i.steps<t?(i.steps-=e-t,e=t):(this.events.pop(),e-=i.steps):this.events.pop()}},t.prototype.toNoteSequence=function(t){for(var e=this,n=this.numVelocityBins?Math.ceil((i.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,o=r.NoteSequence.create(),a=0,s=void 0,u=new Map,l=i.MIN_MIDI_PITCH;l<=i.MAX_MIDI_PITCH;++l)u.set(l,[]);for(var c=0,p=this.events;c<p.length;c++){var h=p[c];switch(h.type){case"note-on":u.get(h.pitch).push([a,s]);break;case"note-off":var f=u.get(h.pitch);if(f.length){var d=f.shift(),m=d[0],y=d[1];a>m?o.notes.push(r.NoteSequence.Note.create({pitch:h.pitch,velocity:y,instrument:t,quantizedStartStep:m,quantizedEndStep:a,program:this.program,isDrum:this.isDrum})):console.log("Ignoring zero-length note: "+("(pitch = "+h.pitch+", step = "+a+")"))}else console.log("Ignoring note-off with no previous note-on:"+("(pitch = "+h.pitch+", step = "+a+")"));break;case"time-shift":a+=h.steps;break;case"velocity-change":if(!n)throw new Error("Unexpected velocity change event: "+h);s=i.MIN_MIDI_VELOCITY+(h.velocityBin-1)*n+1;break;default:throw new Error("Unrecognized performance event: "+h)}}return u.forEach(function(n,i){for(var s=0,u=n;s<u.length;s++){var l=u[s],c=l[0],p=l[1];a>c?o.notes.push(r.NoteSequence.Note.create({pitch:i,velocity:p,instrument:t,quantizedStartStep:c,quantizedEndStep:a,program:e.program,isDrum:e.isDrum})):console.log("Ignoring zero-length note: "+("(pitch = "+i+", step = "+a+")"))}}),o.totalQuantizedSteps=a,o},t}();e.Performance=a},function(t,e,n){"use strict";var r=n(151),i=r.Reader,o=r.util,a=r.roots.default||(r.roots.default={});a.tensorflow=function(){var t={};return t.Any=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.typeUrl="",t.prototype.value=o.newBuffer([]),t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.Any;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.typeUrl=t.string();break;case 2:r.value=t.bytes();break;default:t.skipType(7&o)}}return r},t}(),t.DataType=function(){var t={},e=Object.create(t);return e[t[0]="DT_INVALID"]=0,e[t[1]="DT_FLOAT"]=1,e[t[2]="DT_DOUBLE"]=2,e[t[3]="DT_INT32"]=3,e[t[4]="DT_UINT8"]=4,e[t[5]="DT_INT16"]=5,e[t[6]="DT_INT8"]=6,e[t[7]="DT_STRING"]=7,e[t[8]="DT_COMPLEX64"]=8,e[t[9]="DT_INT64"]=9,e[t[10]="DT_BOOL"]=10,e[t[11]="DT_QINT8"]=11,e[t[12]="DT_QUINT8"]=12,e[t[13]="DT_QINT32"]=13,e[t[14]="DT_BFLOAT16"]=14,e[t[101]="DT_FLOAT_REF"]=101,e[t[102]="DT_DOUBLE_REF"]=102,e[t[103]="DT_INT32_REF"]=103,e[t[104]="DT_UINT8_REF"]=104,e[t[105]="DT_INT16_REF"]=105,e[t[106]="DT_INT8_REF"]=106,e[t[107]="DT_STRING_REF"]=107,e[t[108]="DT_COMPLEX64_REF"]=108,e[t[109]="DT_INT64_REF"]=109,e[t[110]="DT_BOOL_REF"]=110,e[t[111]="DT_QINT8_REF"]=111,e[t[112]="DT_QUINT8_REF"]=112,e[t[113]="DT_QINT32_REF"]=113,e[t[114]="DT_BFLOAT16_REF"]=114,e}(),t.TensorShape=function(){function t(t){if(this.dim=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.dim=o.emptyArray,t.prototype.unknownRank=!1,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.TensorShape;t.pos<n;){var o=t.uint32();switch(o>>>3){case 2:r.dim&&r.dim.length||(r.dim=[]),r.dim.push(a.tensorflow.TensorShape.Dim.decode(t,t.uint32()));break;case 3:r.unknownRank=t.bool();break;default:t.skipType(7&o)}}return r},t.Dim=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.size=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.name="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.TensorShape.Dim;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.size=t.int64();break;case 2:r.name=t.string();break;default:t.skipType(7&o)}}return r},t}(),t}(),t.Tensor=function(){function t(t){if(this.floatVal=[],this.doubleVal=[],this.intVal=[],this.stringVal=[],this.scomplexVal=[],this.int64Val=[],this.boolVal=[],this.uint32Val=[],this.uint64Val=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.dtype=0,t.prototype.tensorShape=null,t.prototype.versionNumber=0,t.prototype.tensorContent=o.newBuffer([]),t.prototype.floatVal=o.emptyArray,t.prototype.doubleVal=o.emptyArray,t.prototype.intVal=o.emptyArray,t.prototype.stringVal=o.emptyArray,t.prototype.scomplexVal=o.emptyArray,t.prototype.int64Val=o.emptyArray,t.prototype.boolVal=o.emptyArray,t.prototype.uint32Val=o.emptyArray,t.prototype.uint64Val=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.Tensor;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.dtype=t.int32();break;case 2:r.tensorShape=a.tensorflow.TensorShape.decode(t,t.uint32());break;case 3:r.versionNumber=t.int32();break;case 4:r.tensorContent=t.bytes();break;case 5:if(r.floatVal&&r.floatVal.length||(r.floatVal=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.floatVal.push(t.float());else r.floatVal.push(t.float());break;case 6:if(r.doubleVal&&r.doubleVal.length||(r.doubleVal=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.doubleVal.push(t.double());else r.doubleVal.push(t.double());break;case 7:if(r.intVal&&r.intVal.length||(r.intVal=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.intVal.push(t.int32());else r.intVal.push(t.int32());break;case 8:r.stringVal&&r.stringVal.length||(r.stringVal=[]),r.stringVal.push(t.bytes());break;case 9:if(r.scomplexVal&&r.scomplexVal.length||(r.scomplexVal=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.scomplexVal.push(t.float());else r.scomplexVal.push(t.float());break;case 10:if(r.int64Val&&r.int64Val.length||(r.int64Val=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.int64Val.push(t.int64());else r.int64Val.push(t.int64());break;case 11:if(r.boolVal&&r.boolVal.length||(r.boolVal=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.boolVal.push(t.bool());else r.boolVal.push(t.bool());break;case 16:if(r.uint32Val&&r.uint32Val.length||(r.uint32Val=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.uint32Val.push(t.uint32());else r.uint32Val.push(t.uint32());break;case 17:if(r.uint64Val&&r.uint64Val.length||(r.uint64Val=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.uint64Val.push(t.uint64());else r.uint64Val.push(t.uint64());break;default:t.skipType(7&o)}}return r},t}(),t.AttrValue=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}t.prototype.list=null,t.prototype.s=o.newBuffer([]),t.prototype.i=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.f=0,t.prototype.b=!1,t.prototype.type=0,t.prototype.shape=null,t.prototype.tensor=null,t.prototype.placeholder="",t.prototype.func=null;var e;return Object.defineProperty(t.prototype,"value",{get:o.oneOfGetter(e=["list","s","i","f","b","type","shape","tensor","placeholder","func"]),set:o.oneOfSetter(e)}),t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.AttrValue;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.list=a.tensorflow.AttrValue.ListValue.decode(t,t.uint32());break;case 2:r.s=t.bytes();break;case 3:r.i=t.int64();break;case 4:r.f=t.float();break;case 5:r.b=t.bool();break;case 6:r.type=t.int32();break;case 7:r.shape=a.tensorflow.TensorShape.decode(t,t.uint32());break;case 8:r.tensor=a.tensorflow.Tensor.decode(t,t.uint32());break;case 9:r.placeholder=t.string();break;case 10:r.func=a.tensorflow.NameAttrList.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t.ListValue=function(){function t(t){if(this.s=[],this.i=[],this.f=[],this.b=[],this.type=[],this.shape=[],this.tensor=[],this.func=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.s=o.emptyArray,t.prototype.i=o.emptyArray,t.prototype.f=o.emptyArray,t.prototype.b=o.emptyArray,t.prototype.type=o.emptyArray,t.prototype.shape=o.emptyArray,t.prototype.tensor=o.emptyArray,t.prototype.func=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.AttrValue.ListValue;t.pos<n;){var o=t.uint32();switch(o>>>3){case 2:r.s&&r.s.length||(r.s=[]),r.s.push(t.bytes());break;case 3:if(r.i&&r.i.length||(r.i=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.i.push(t.int64());else r.i.push(t.int64());break;case 4:if(r.f&&r.f.length||(r.f=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.f.push(t.float());else r.f.push(t.float());break;case 5:if(r.b&&r.b.length||(r.b=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.b.push(t.bool());else r.b.push(t.bool());break;case 6:if(r.type&&r.type.length||(r.type=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.type.push(t.int32());else r.type.push(t.int32());break;case 7:r.shape&&r.shape.length||(r.shape=[]),r.shape.push(a.tensorflow.TensorShape.decode(t,t.uint32()));break;case 8:r.tensor&&r.tensor.length||(r.tensor=[]),r.tensor.push(a.tensorflow.Tensor.decode(t,t.uint32()));break;case 9:r.func&&r.func.length||(r.func=[]),r.func.push(a.tensorflow.NameAttrList.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return r},t}(),t}(),t.NameAttrList=function(){function t(t){if(this.attr={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name="",t.prototype.attr=o.emptyObject,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n,r=void 0===e?t.len:t.pos+e,s=new a.tensorflow.NameAttrList;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:s.name=t.string();break;case 2:t.skip().pos++,s.attr===o.emptyObject&&(s.attr={}),n=t.string(),t.pos++,s.attr[n]=a.tensorflow.AttrValue.decode(t,t.uint32());break;default:t.skipType(7&u)}}return s},t}(),t.NodeDef=function(){function t(t){if(this.input=[],this.attr={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name="",t.prototype.op="",t.prototype.input=o.emptyArray,t.prototype.device="",t.prototype.attr=o.emptyObject,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n,r=void 0===e?t.len:t.pos+e,s=new a.tensorflow.NodeDef;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:s.name=t.string();break;case 2:s.op=t.string();break;case 3:s.input&&s.input.length||(s.input=[]),s.input.push(t.string());break;case 4:s.device=t.string();break;case 5:t.skip().pos++,s.attr===o.emptyObject&&(s.attr={}),n=t.string(),t.pos++,s.attr[n]=a.tensorflow.AttrValue.decode(t,t.uint32());break;default:t.skipType(7&u)}}return s},t}(),t.VersionDef=function(){function t(t){if(this.badConsumers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.producer=0,t.prototype.minConsumer=0,t.prototype.badConsumers=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.VersionDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.producer=t.int32();break;case 2:r.minConsumer=t.int32();break;case 3:if(r.badConsumers&&r.badConsumers.length||(r.badConsumers=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.badConsumers.push(t.int32());else r.badConsumers.push(t.int32());break;default:t.skipType(7&o)}}return r},t}(),t.GraphDef=function(){function t(t){if(this.node=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.node=o.emptyArray,t.prototype.versions=null,t.prototype.library=null,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.GraphDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.node&&r.node.length||(r.node=[]),r.node.push(a.tensorflow.NodeDef.decode(t,t.uint32()));break;case 4:r.versions=a.tensorflow.VersionDef.decode(t,t.uint32());break;case 2:r.library=a.tensorflow.FunctionDefLibrary.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t}(),t.CollectionDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}t.prototype.nodeList=null,t.prototype.bytesList=null,t.prototype.int64List=null,t.prototype.floatList=null,t.prototype.anyList=null;var e;return Object.defineProperty(t.prototype,"kind",{get:o.oneOfGetter(e=["nodeList","bytesList","int64List","floatList","anyList"]),set:o.oneOfSetter(e)}),t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.nodeList=a.tensorflow.CollectionDef.NodeList.decode(t,t.uint32());break;case 2:r.bytesList=a.tensorflow.CollectionDef.BytesList.decode(t,t.uint32());break;case 3:r.int64List=a.tensorflow.CollectionDef.Int64List.decode(t,t.uint32());break;case 4:r.floatList=a.tensorflow.CollectionDef.FloatList.decode(t,t.uint32());break;case 5:r.anyList=a.tensorflow.CollectionDef.AnyList.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t.NodeList=function(){function t(t){if(this.value=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.value=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef.NodeList;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(t.string());break;default:t.skipType(7&o)}}return r},t}(),t.BytesList=function(){function t(t){if(this.value=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.value=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef.BytesList;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(t.bytes());break;default:t.skipType(7&o)}}return r},t}(),t.Int64List=function(){function t(t){if(this.value=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.value=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef.Int64List;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:if(r.value&&r.value.length||(r.value=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.value.push(t.int64());else r.value.push(t.int64());break;default:t.skipType(7&o)}}return r},t}(),t.FloatList=function(){function t(t){if(this.value=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.value=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef.FloatList;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:if(r.value&&r.value.length||(r.value=[]),2===(7&o))for(var s=t.uint32()+t.pos;t.pos<s;)r.value.push(t.float());else r.value.push(t.float());break;default:t.skipType(7&o)}}return r},t}(),t.AnyList=function(){function t(t){if(this.value=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.value=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.CollectionDef.AnyList;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.value&&r.value.length||(r.value=[]),r.value.push(a.tensorflow.Any.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return r},t}(),t}(),t.SaverDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.filenameTensorName="",t.prototype.saveTensorName="",t.prototype.restoreOpName="",t.prototype.maxToKeep=0,t.prototype.sharded=!1,t.prototype.keepCheckpointEveryNHours=0,t.prototype.version=0,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.SaverDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.filenameTensorName=t.string();break;case 2:r.saveTensorName=t.string();break;case 3:r.restoreOpName=t.string();break;case 4:r.maxToKeep=t.int32();break;case 5:r.sharded=t.bool();break;case 6:r.keepCheckpointEveryNHours=t.float();break;case 7:r.version=t.int32();break;default:t.skipType(7&o)}}return r},t.CheckpointFormatVersion=function(){var t={},e=Object.create(t);return e[t[0]="LEGACY"]=0,e[t[1]="V1"]=1,e[t[2]="V2"]=2,e}(),t}(),t.TensorInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}t.prototype.name="",t.prototype.cooSparse=null,t.prototype.dtype=0,t.prototype.tensorShape=null;var e;return Object.defineProperty(t.prototype,"encoding",{get:o.oneOfGetter(e=["name","cooSparse"]),set:o.oneOfSetter(e)}),t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.TensorInfo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.name=t.string();break;case 4:r.cooSparse=a.tensorflow.TensorInfo.CooSparse.decode(t,t.uint32());break;case 2:r.dtype=t.int32();break;case 3:r.tensorShape=a.tensorflow.TensorShape.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t.CooSparse=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.valuesTensorName="",t.prototype.indicesTensorName="",t.prototype.denseShapeTensorName="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.TensorInfo.CooSparse;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.valuesTensorName=t.string();break;case 2:r.indicesTensorName=t.string();break;case 3:r.denseShapeTensorName=t.string();break;default:t.skipType(7&o)}}return r},t}(),t}(),t.SignatureDef=function(){function t(t){if(this.inputs={},this.outputs={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.inputs=o.emptyObject,t.prototype.outputs=o.emptyObject,t.prototype.methodName="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n,r=void 0===e?t.len:t.pos+e,s=new a.tensorflow.SignatureDef;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:t.skip().pos++,s.inputs===o.emptyObject&&(s.inputs={}),n=t.string(),t.pos++,s.inputs[n]=a.tensorflow.TensorInfo.decode(t,t.uint32());break;case 2:t.skip().pos++,s.outputs===o.emptyObject&&(s.outputs={}),n=t.string(),t.pos++,s.outputs[n]=a.tensorflow.TensorInfo.decode(t,t.uint32());break;case 3:s.methodName=t.string();break;default:t.skipType(7&u)}}return s},t}(),t.AssetFileDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.tensorInfo=null,t.prototype.filename="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.AssetFileDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.tensorInfo=a.tensorflow.TensorInfo.decode(t,t.uint32());break;case 2:r.filename=t.string();break;default:t.skipType(7&o)}}return r},t}(),t.OpDef=function(){function t(t){if(this.inputArg=[],this.outputArg=[],this.attr=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name="",t.prototype.inputArg=o.emptyArray,t.prototype.outputArg=o.emptyArray,t.prototype.attr=o.emptyArray,t.prototype.deprecation=null,t.prototype.summary="",t.prototype.description="",t.prototype.isCommutative=!1,t.prototype.isAggregate=!1,t.prototype.isStateful=!1,t.prototype.allowsUninitializedInput=!1,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.OpDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.name=t.string();break;case 2:r.inputArg&&r.inputArg.length||(r.inputArg=[]),r.inputArg.push(a.tensorflow.OpDef.ArgDef.decode(t,t.uint32()));break;case 3:r.outputArg&&r.outputArg.length||(r.outputArg=[]),r.outputArg.push(a.tensorflow.OpDef.ArgDef.decode(t,t.uint32()));break;case 4:r.attr&&r.attr.length||(r.attr=[]),r.attr.push(a.tensorflow.OpDef.AttrDef.decode(t,t.uint32()));break;case 8:r.deprecation=a.tensorflow.OpDef.OpDeprecation.decode(t,t.uint32());break;case 5:r.summary=t.string();break;case 6:r.description=t.string();break;case 18:r.isCommutative=t.bool();break;case 16:r.isAggregate=t.bool();break;case 17:r.isStateful=t.bool();break;case 19:r.allowsUninitializedInput=t.bool();break;default:t.skipType(7&o)}}return r},t.ArgDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name="",t.prototype.description="",t.prototype.type=0,t.prototype.typeAttr="",t.prototype.numberAttr="",t.prototype.typeListAttr="",t.prototype.isRef=!1,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.OpDef.ArgDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.name=t.string();break;case 2:r.description=t.string();break;case 3:r.type=t.int32();break;case 4:r.typeAttr=t.string();break;case 5:r.numberAttr=t.string();break;case 6:r.typeListAttr=t.string();break;case 16:r.isRef=t.bool();break;default:t.skipType(7&o)}}return r},t}(),t.AttrDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name="",t.prototype.type="",t.prototype.defaultValue=null,t.prototype.description="",t.prototype.hasMinimum=!1,t.prototype.minimum=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.allowedValues=null,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.OpDef.AttrDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.name=t.string();break;case 2:r.type=t.string();break;case 3:r.defaultValue=a.tensorflow.AttrValue.decode(t,t.uint32());break;case 4:r.description=t.string();break;case 5:r.hasMinimum=t.bool();break;case 6:r.minimum=t.int64();break;case 7:r.allowedValues=a.tensorflow.AttrValue.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t}(),t.OpDeprecation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.version=0,t.prototype.explanation="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.OpDef.OpDeprecation;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.version=t.int32();break;case 2:r.explanation=t.string();break;default:t.skipType(7&o)}}return r},t}(),t}(),t.OpList=function(){function t(t){if(this.op=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.op=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.OpList;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.op&&r.op.length||(r.op=[]),r.op.push(a.tensorflow.OpDef.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return r},t}(),t.MetaGraphDef=function(){function t(t){if(this.collectionDef={},this.signatureDef={},this.assetFileDef=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.metaInfoDef=null,t.prototype.graphDef=null,t.prototype.saverDef=null,t.prototype.collectionDef=o.emptyObject,t.prototype.signatureDef=o.emptyObject,t.prototype.assetFileDef=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n,r=void 0===e?t.len:t.pos+e,s=new a.tensorflow.MetaGraphDef;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:s.metaInfoDef=a.tensorflow.MetaGraphDef.MetaInfoDef.decode(t,t.uint32());break;case 2:s.graphDef=a.tensorflow.GraphDef.decode(t,t.uint32());break;case 3:s.saverDef=a.tensorflow.SaverDef.decode(t,t.uint32());break;case 4:t.skip().pos++,s.collectionDef===o.emptyObject&&(s.collectionDef={}),n=t.string(),t.pos++,s.collectionDef[n]=a.tensorflow.CollectionDef.decode(t,t.uint32());break;case 5:t.skip().pos++,s.signatureDef===o.emptyObject&&(s.signatureDef={}),n=t.string(),t.pos++,s.signatureDef[n]=a.tensorflow.SignatureDef.decode(t,t.uint32());break;case 6:s.assetFileDef&&s.assetFileDef.length||(s.assetFileDef=[]),s.assetFileDef.push(a.tensorflow.AssetFileDef.decode(t,t.uint32()));break;default:t.skipType(7&u)}}return s},t.MetaInfoDef=function(){function t(t){if(this.tags=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.metaGraphVersion="",t.prototype.strippedOpList=null,t.prototype.anyInfo=null,t.prototype.tags=o.emptyArray,t.prototype.tensorflowVersion="",t.prototype.tensorflowGitVersion="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.MetaGraphDef.MetaInfoDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.metaGraphVersion=t.string();break;case 2:r.strippedOpList=a.tensorflow.OpList.decode(t,t.uint32());break;case 3:r.anyInfo=a.tensorflow.Any.decode(t,t.uint32());break;case 4:r.tags&&r.tags.length||(r.tags=[]),r.tags.push(t.string());break;case 5:r.tensorflowVersion=t.string();break;case 6:r.tensorflowGitVersion=t.string();break;default:t.skipType(7&o)}}return r},t}(),t}(),t.SavedModel=function(){function t(t){if(this.metaGraphs=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.savedModelSchemaVersion=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.metaGraphs=o.emptyArray,t.decode=function(t,e){
t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.SavedModel;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.savedModelSchemaVersion=t.int64();break;case 2:r.metaGraphs&&r.metaGraphs.length||(r.metaGraphs=[]),r.metaGraphs.push(a.tensorflow.MetaGraphDef.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return r},t}(),t.FunctionDefLibrary=function(){function t(t){if(this.function=[],this.gradient=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.function=o.emptyArray,t.prototype.gradient=o.emptyArray,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.FunctionDefLibrary;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.function&&r.function.length||(r.function=[]),r.function.push(a.tensorflow.FunctionDef.decode(t,t.uint32()));break;case 2:r.gradient&&r.gradient.length||(r.gradient=[]),r.gradient.push(a.tensorflow.GradientDef.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return r},t}(),t.FunctionDef=function(){function t(t){if(this.attr={},this.nodeDef=[],this.ret={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.signature=null,t.prototype.attr=o.emptyObject,t.prototype.nodeDef=o.emptyArray,t.prototype.ret=o.emptyObject,t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n,r=void 0===e?t.len:t.pos+e,s=new a.tensorflow.FunctionDef;t.pos<r;){var u=t.uint32();switch(u>>>3){case 1:s.signature=a.tensorflow.OpDef.decode(t,t.uint32());break;case 5:t.skip().pos++,s.attr===o.emptyObject&&(s.attr={}),n=t.string(),t.pos++,s.attr[n]=a.tensorflow.AttrValue.decode(t,t.uint32());break;case 3:s.nodeDef&&s.nodeDef.length||(s.nodeDef=[]),s.nodeDef.push(a.tensorflow.NodeDef.decode(t,t.uint32()));break;case 4:t.skip().pos++,s.ret===o.emptyObject&&(s.ret={}),n=t.string(),t.pos++,s.ret[n]=t.string();break;default:t.skipType(7&u)}}return s},t}(),t.GradientDef=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.functionName="",t.prototype.gradientFunc="",t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new a.tensorflow.GradientDef;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.functionName=t.string();break;case 2:r.gradientFunc=t.string();break;default:t.skipType(7&o)}}return r},t}(),t}(),t.exports=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(198);e.FrozenModel=r.FrozenModel,e.loadFrozenModel=r.loadFrozenModel;var i=n(233);e.version_converter=i.version},function(t,e,n){"use strict";function r(t,e){return p.ENV.engine.tidy(t,e,!0)}function i(t){return f.assert(f.isFunction(t),"The f passed in grad(f) must be a function"),function(e,n){return f.assert(e instanceof h.Tensor,"The x passed in grad(f)(x) must be a tensor"),f.assert(null==n||n instanceof h.Tensor,"The dy passed in grad(f)(x, dy) must be a tensor"),p.ENV.engine.tidy(function(){var r=p.ENV.engine.gradients(function(){return t(e)},[e],n),i=r.value,o=r.grads;return null!=n&&f.assertShapesMatch(i.shape,n.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),c(o),o[0]})}}function o(t){return f.assert(f.isFunction(t),"The f passed in grads(f) must be a function"),function(e,n){return f.assert(Array.isArray(e)&&e.every(function(t){return t instanceof h.Tensor}),"The args passed in grads(f)(args) must be an array of tensors"),f.assert(null==n||n instanceof h.Tensor,"The dy passed in grads(f)(args, dy) must be a tensor"),p.ENV.engine.tidy(function(){var r=p.ENV.engine.gradients(function(){return t.apply(void 0,e)},e,n),i=r.value,o=r.grads;return null!=n&&f.assertShapesMatch(i.shape,n.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),c(o),o})}}function a(t){return f.assert(f.isFunction(t),"The f passed in valueAndGrad(f) must be a function"),function(e,n){f.assert(e instanceof h.Tensor,"The x passed in valueAndGrad(f)(x) must be a tensor"),f.assert(null==n||n instanceof h.Tensor,"The dy passed in valueAndGrad(f)(x, dy) must be a tensor");var r=p.ENV.engine.gradients(function(){return t(e)},[e],n),i=r.grads,o=r.value;return c(i),{grad:i[0],value:o}}}function s(t){return f.assert(f.isFunction(t),"The f passed in valueAndGrads(f) must be a function"),function(e,n){f.assert(Array.isArray(e)&&e.every(function(t){return t instanceof h.Tensor}),"The args passed in valueAndGrads(f)(args) must be array of tensors"),f.assert(null==n||n instanceof h.Tensor,"The dy passed in valueAndGrads(f)(args, dy) must be a tensor");var r=p.ENV.engine.gradients(function(){return t.apply(void 0,e)},e,n);return null!=n&&f.assertShapesMatch(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),c(r.grads),r}}function u(t,e){if(f.assert(f.isFunction(t),"The f passed in variableGrads(f) must be a function"),f.assert(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof h.Variable}),"The varList passed in variableGrads(f, varList) must be an array of variables"),null==e){e=[];for(var n in p.ENV.engine.registeredVariables)e.push(p.ENV.engine.registeredVariables[n])}var r=e.length;e=e.filter(function(t){return t.trainable}),f.assert(e.length>0,"variableGrads() expects at least one of the input variables to be "+("trainable, but none of the "+r+" variables is ")+"trainable.");var i=!0,o=p.ENV.engine.gradients(t,e,null,i),a=o.value,s=o.grads;f.assert(s.some(function(t){return null!=t}),"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),f.assert(0===a.rank,"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+a.rank+" tensor"));var u={};return e.forEach(function(t,e){null!=s[e]&&(u[t.name]=s[e])}),{value:a,grads:u}}function l(t){return p.ENV.engine.customGrad(t)}function c(t){var e=t.filter(function(t){return null==t}).length;if(e>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}Object.defineProperty(e,"__esModule",{value:!0});var p=n(3),h=n(15),f=n(2);e.gradScope=r,e.grad=i,e.grads=o,e.valueAndGrad=a,e.valueAndGrads=s,e.variableGrads=u,e.customGrad=l},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DTYPE_VALUE_SIZE_MAP={float32:4,int32:4,uint16:2,uint8:1,bool:1}},function(t,e,n){"use strict";function r(t,e){return o(this,void 0,void 0,function(){var n,r,i;return a(this,function(o){switch(o.label){case 0:return n=t.map(function(t){return fetch(t,e)}),[4,Promise.all(n)];case 1:return r=o.sent(),[4,Promise.all(r.map(function(t){return t.arrayBuffer()}))];case 2:return i=o.sent(),[2,i]}})})}function i(t,e,n,i){return void 0===e&&(e=""),o(this,void 0,void 0,function(){var o,c,p,h,f,d,m,y,g,v;return a(this,function(a){switch(a.label){case 0:if(o=t.map(function(){return!1}),c={},p=null!=n?n.map(function(){return!1}):[],h=[],t.forEach(function(t,e){var r=0;t.weights.forEach(function(t){var i="quantization"in t?t.quantization.dtype:t.dtype,a=l.DTYPE_VALUE_SIZE_MAP[i]*s.sizeFromShape(t.shape),u=function(){o[e]=!0,null==c[e]&&(c[e]=[]),c[e].push({manifestEntry:t,groupOffset:r,sizeBytes:a})};null!=n?n.forEach(function(e,n){e===t.name&&(u(),p[n]=!0)}):u(),h.push(t.name),r+=a})}),!p.every(function(t){return t}))throw f=n.filter(function(t,e){return!p[e]}),new Error("Could not find weights in manifest with names: "+(f.join(", ")+". \n")+"Manifest JSON has weights with names: "+(h.join(", ")+"."));return d=o.reduce(function(t,e,n){return e&&t.push(n),t},[]),m=[],d.forEach(function(n){t[n].paths.forEach(function(t){var n=e+(e.endsWith("/")?"":"/")+t;m.push(n)})}),[4,r(m,i)];case 1:return y=a.sent(),g={},v=0,d.forEach(function(e){for(var n=t[e].paths.length,r=0,i=0;i<n;i++)r+=y[v+i].byteLength;for(var o=new ArrayBuffer(r),a=new Uint8Array(o),s=0,l=0;l<n;l++){var p=new Uint8Array(y[v+l]);a.set(p,s),s+=p.byteLength}var h=c[e];h.forEach(function(t){var e=o.slice(t.groupOffset,t.groupOffset+t.sizeBytes),n=u.decodeWeights(e,[t.manifestEntry]);for(var r in n)g[r]=n[r]}),v+=n}),[2,g]}})})}var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),u=n(40),l=n(114);e.loadWeightsAsArrayBuffer=r,e.loadWeights=i},function(t,e,n){"use strict";function r(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=o.zeros(t.shape),i=t.toFloat(),u=n.complex(i,r);return r.dispose(),i.dispose(),u}if(!s.hasEncodingLoss(t.dtype,e))return a.Tensor.make(t.shape,{dataId:t.dataId},e);if("complex64"===t.dtype){var l=n.real(t),u=l.cast(e);return l.dispose(),u}if("int32"===e)return n.int(t);if("bool"===e){var c=o.scalar(0,t.dtype),u=n.notEqual(t,c);return c.dispose(),u}throw new Error("Error in Cast: unknown dtype argument ("+e+")")}function i(t,e){return a.Tensor.make(e,{dataId:t.dataId},t.dtype)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(9),a=n(15),s=n(2);e.castTensor=r,e.reshapeTensor=i},function(t,e,n){"use strict";function r(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}function i(t,e){return t instanceof Float32Array?t:new Float32Array(t)}var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(74),u=n(3),l=n(17),c=n(129),p=n(130),h=n(24),f=n(58),d=n(134),m=n(138),y=n(82),g=n(307),v=n(84),b=n(140),_=n(9),w=n(15),S=n(60),x=n(2),T=n(2),P=n(76),E=n(116),A=n(118),N=n(77),O=n(120),k=n(121),I=n(245),C=n(246),M=n(247),R=n(248),D=n(122),L=n(122),F=n(123),z=n(123),q=n(249),V=n(250),B=n(251),j=n(252),U=n(253),G=n(254),W=n(255),H=n(256),Q=n(257),K=n(258),Y=n(259),X=n(124),$=n(124),J=n(260),Z=n(261),tt=n(262),et=n(125),nt=n(263),rt=n(264),it=n(265),ot=n(266),at=n(267),st=n(268),ut=n(269),lt=n(270),ct=n(271),pt=n(272),ht=n(273),ft=n(274),dt=n(275),mt=n(276),yt=n(277),gt=n(278),vt=n(279),bt=n(280),_t=n(281),wt=n(282),St=n(283),xt=n(284),Tt=n(285),Pt=n(286),Et=n(56),At=n(287),Nt=n(288),Ot=n(289),kt=n(128),It=n(128),Ct=n(290),Mt=n(57),Rt=n(78),Dt=10,Lt=300;e.SIZE_UPLOAD_UNIFORM=4,e.MATMUL_SHARED_DIM_THRESHOLD=1e3;var Ft=function(){function t(t,e){if(void 0===e&&(e=!0),this.gpgpu=t,this.delayedStorage=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.lruDataGPU=[],this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.binaryCache={},this.disposed=!1,u.ENV.get("WEBGL_VERSION")<1)throw new Error("WebGL is not supported on this device");if(null==t){var n=s.getWebGLContext(u.ENV.get("WEBGL_VERSION"));this.gpgpu=new et.GPGPUContext(n),this.canvas=n.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;u.ENV.get("WEBGL_PAGING_ENABLED")&&(this.NUM_BYTES_BEFORE_PAGING=window.screen.height*window.screen.width*window.devicePixelRatio*Lt),this.textureManager=new At.TextureManager(this.gpgpu)}return t.prototype.register=function(t,e,n){if(this.texData.has(t))throw new Error("Data buffer is already registered");this.texData.set(t,{shape:e,dtype:n,values:null,texture:null,complexTensors:null,texShape:null,usage:Et.TextureUsage.RENDER,isPacked:!1})},t.prototype.setDataMover=function(t){this.texData=new P.DataStorage(t)},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n=[t.height,t.width],r=[t.height,t.width,e];if(!(t instanceof HTMLVideoElement||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(t instanceof HTMLVideoElement){if(null==this.fromPixels2DContext){if(!u.ENV.get("IS_BROWSER"))throw new Error("Can't read pixels from HTMLImageElement outside the browser.");if("complete"!==document.readyState)throw new Error("The DOM is not ready yet. Please call tf.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),t=this.fromPixels2DContext.canvas}var i=this.makeTensorHandle(n,"int32");this.texData.get(i.dataId).usage=Et.TextureUsage.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(i.dataId),t);var o=new J.FromPixelsProgram(r),a=this.compileAndRun(o,[i]);return this.disposeData(i.dataId),a},t.prototype.makeTensorHandle=function(t,e){var n={};return this.register(n,t,e),{dataId:n,shape:t,dtype:e}},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendWebGL.write(): values can not be null");var n=this.texData.get(t),r=n.texture,i=n.texShape,o=n.usage,a=n.dtype,s=n.isPacked;if("complex64"===a)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");null!=r&&(this.releaseTexture(t,r,i,o,s),n.texture=null,n.texShape=null),n.usage=Et.TextureUsage.UPLOAD,n.values=e,this.delayedStorage||this.uploadToGPU(t)},t.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,i=e.complexTensors;if(null!=n)return this.convertAndCacheOnCPU(t);var o,a=null!=this.activeTimers;a&&(o=performance.now());var s;if("complex64"===r){var u=i.real.dataSync(),l=i.imag.dataSync();s=A.mergeRealAndImagArrays(u,l)}else s=this.getValuesFromTexture(t);return a&&(this.downloadWaitMs+=performance.now()-o),this.convertAndCacheOnCPU(t,s)},t.prototype.read=function(t){return o(this,void 0,void 0,function(){var e,n,r,i,o,s,l,c,p;return a(this,function(a){switch(a.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})];if(n=this.texData.get(t),r=n.texture,i=n.values,o=n.texShape,null!=i)return[2,this.convertAndCacheOnCPU(t)];if(this.pendingRead.set(t,[]),!u.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===u.ENV.get("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return s=this.gpgpu.maybeCreateBufferFromTexture(r,o[0],o[1]),[4,this.gpgpu.createAndWaitForFence()];case 1:return a.sent(),l=s instanceof WebGLTexture?this.getValuesFromTexture(t):this.gpgpu.downloadFloat32MatrixFromBuffer(s,o[0],o[1]),c=this.convertAndCacheOnCPU(t,l),p=this.pendingRead.get(t),this.pendingRead.delete(t),p.forEach(function(t){return t(c)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)),[2,c]}})})},t.prototype.getValuesFromTexture=function(t){var e=this.texData.get(t),n=e.shape,r=e.dtype,i=e.texture,o=e.texShape;if(u.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")){if(this.texData.get(t).isPacked){var a=x.sizeFromShape(n.slice(0,n.length-2)),s=n.length>1?n[n.length-2]:1,l=n[n.length-1];return this.gpgpu.downloadMatrixFromPackedTexture(i,a,s,l,o[0],o[1])}return this.gpgpu.downloadFloat32MatrixFromOutputTexture(i,o[0],o[1])}var c=this.makeTensorHandle(n,"float32");c.size=T.sizeFromShape(n),this.texData.get(c.dataId).usage=Et.TextureUsage.DOWNLOAD;var p=new Y.EncodeFloatProgram(n),h=!1;this.compileAndRun(p,[{shape:n,dtype:r,dataId:t}],c,null,h);var f=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(f.texture,f.texShape[0],f.texShape[1]);return this.disposeData(c.dataId),d},t.prototype.time=function(t){return o(this,void 0,void 0,function(){var e,n,r,i,o,s,u;return a(this,function(a){switch(a.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),i=x.flatten(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),o=x.flatten(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),[4,Promise.all(i)];case 1:return s=a.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:x.sum(s),getExtraProfileInfo:function(){return s.map(function(t,e){return{name:o[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return u.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},t.prototype.endTimer=function(t){return u.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),t):(t.endMs=performance.now(),t)},t.prototype.getQueryTime=function(t){return o(this,void 0,void 0,function(){var e;return a(this,function(n){return u.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(e=t,[2,e.endMs-e.startMs])})})},t.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return void this.pendingDisposal.add(t);if(this.texData.has(t)){var e=this.texData.get(t),n=e.texture,r=e.texShape,i=e.usage,o=e.complexTensors,a=e.isPacked;null!=n&&this.releaseTexture(t,n,r,i,a),null!=o&&(o.real.dispose(),o.imag.dispose()),this.texData.delete(t)}}},t.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},t.prototype.getCPUBackend=function(){return u.ENV.get("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=u.ENV.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=Dt),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.getCanvas=function(){return this.canvas},t.prototype.complex=function(t,e){var n=this.makeOutputArray(t.shape,"complex64"),r=this.texData.get(n.dataId);return r.complexTensors={real:u.ENV.engine.keep(t.clone()),imag:u.ENV.engine.keep(e.clone())},n},t.prototype.real=function(t){var e=this.texData.get(t.dataId);return e.complexTensors.real.clone()},t.prototype.imag=function(t){var e=this.texData.get(t.dataId);return e.complexTensors.imag.clone()},t.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);var r=new Tt.SliceProgram(n),i=r.getCustomSetupFunc(e);return this.compileAndRun(r,[t],null,i)},t.prototype.stridedSlice=function(t,e,n,r,i,o,a,s,u){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r,i,o,a,s,u);var l=v.getStridedSlicedInfo(t.shape,e,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return h.indexOf(e)===-1});if(f.some(function(t){return 0===t}))return _.tensor([],f);var d=new Pt.StridedSliceProgram(c,r,p,h);return this.compileAndRun(d,[t])},t.prototype.reverse=function(t,e){var n=new _t.ReverseProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.concat2Tensors=function(t,e,n){var r=f.computeOutShape([t.shape,e.shape],n),i=t.as2D(-1,T.sizeFromShape(t.shape.slice(n))),o=e.as2D(-1,T.sizeFromShape(e.shape.slice(n))),a=new B.ConcatProgram(i.shape,o.shape),s=this.compileAndRun(a,[i,o]);return s.reshape(r)},t.prototype.concat=function(t,e){if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];for(var n=t[0],r=1;r<t.length;++r)n=this.concat2Tensors(n,t[r],e);return n},t.prototype.neg=function(t){var e=new It.UnaryOpProgram(t.shape,kt.NEG);return this.compileAndRun(e,[t])},t.prototype.batchMatMul=function(t,n,r,i){var o=r?t.shape[2]:t.shape[1],a=i?n.shape[1]:n.shape[2],s=r?t.shape[1]:t.shape[2],l=t.shape,c=l[0];if((1===o||1===a)&&s>e.MATMUL_SHARED_DIM_THRESHOLD){r&&(t=t.transpose([0,2,1])),i&&(n=n.transpose([0,2,1]));var p=1===a?t:t.as3D(c,s,1),h=1===a?2:1,f=1===a?n.as3D(c,1,s):n;return this.multiply(p,f).sum(h,!0)}if(1===c){var d=t.as2D(t.shape[1],t.shape[2]),m=n.as2D(n.shape[1],n.shape[2]),y=new ut.MatMulPackedProgram(d.shape,m.shape,[o,a],r,i),g=this.compileAndRun(y,[d,m],this.makePackedTensor(y.outputShape));return u.ENV.get("WEBGL_LAZILY_UNPACK")===!1&&(g=this.unpackTensor(g)),g.reshape([1,g.shape[0],g.shape[1]])}return this.compileAndRun(new st.MatMulProgram(t.shape,n.shape,r,i),[t,n])},t.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),i=new L.BinaryOpComplexProgram(D.COMPLEX_MULTIPLY.REAL,t.shape,e.shape),o=new L.BinaryOpComplexProgram(D.COMPLEX_MULTIPLY.IMAG,t.shape,e.shape),a=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag),this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),l=this.complex(s,u);return s.dispose(),u.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);var c=new z.BinaryOpProgram(F.MUL,t.shape,e.shape),p=this.makeOutputArray(c.outputShape,t.dtype);return this.compileAndRun(c,[t,e],p)},t.prototype.batchNormalization=function(t,e,n,r,i,o){var a=[t,e,n],s=null;null!=o&&(s=o.shape,a.push(o));var l=null;null!=i&&(l=i.shape,a.push(i));var c=null,p=M.BatchNormProgram;u.ENV.get("WEBGL_PACK_BATCHNORMALIZATION")&&(c=this.makePackedTensor(t.shape),p=R.BatchNormPackedProgram);var h=new p(t.shape,e.shape,n.shape,s,l,r);return this.compileAndRun(h,a,c)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){var o=new it.LRNProgram(t.shape,e,n,r,i);return this.compileAndRun(o,[t])},t.prototype.LRNGrad=function(t,e,n,r,i,o,a){var s=new ot.LRNGradProgram(e.shape,r,i,o,a);return this.compileAndRun(s,[e,n,t])},t.prototype.tile=function(t,e){var n=new Nt.TileProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.pad=function(t,e,n){var r=new ht.PadProgram(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.transpose=function(t,e){var n=new Ot.TransposeProgram(t.shape,e);return this.compileAndRun(n,[t])},t.prototype.gather=function(t,e,n){var r=new Z.GatherProgram(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},t.prototype.batchToSpaceND=function(t,e,n){x.assert(t.rank<=4,"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");var r=e.reduce(function(t,e){return t*e}),i=p.getReshaped(t.shape,e,r),o=p.getPermuted(i.length,e.length),a=p.getReshapedPermuted(t.shape,e,r),s=p.getSliceBeginCoords(n,e.length),u=p.getSliceSize(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(t,e,n){x.assert(t.rank<=4,"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),s=p.getReshaped(a.shape,e,r,!1),u=p.getPermuted(s.length,e.length,!1),l=p.getReshapedPermuted(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(l)},t.prototype.reduce=function(t,e,n){var r=t.shape[0],i=t.shape[1],o=m.computeOptimalWindowSize(i),a={windowSize:o,inSize:i,batchSize:r},s=new dt.ReduceProgram(a,e),u=s.outputShape,l=u[0],c=u[1],p=this.makeOutputArray([l,c],n);return this.compileAndRun(s,[t],p),1===p.shape[1]?p:this.reduce(p,e,n)},t.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],i=t.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o=m.computeOptimalWindowSize(i),a={windowSize:o,inSize:i,batchSize:r},s=new I.ArgMinMaxProgram(a,e,null==n),u=s.outputShape,l=u[0],c=u[1],p=this.makeOutputArray([l,c],"int32"),h=[t];return null!=n&&h.push(n),this.compileAndRun(s,h,p),1===p.shape[1]?p:this.argReduce(t,e,p)},t.prototype.sum=function(t,e){h.assertAxesAreInnerMostDims("sum",e,t.rank);var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o),s=S.sumOutType(t.dtype);return this.reduce(a,"sum",s).reshape(r)},t.prototype.prod=function(t,e){var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o),s=S.sumOutType(t.dtype);return this.reduce(a,"prod",s).reshape(r)},t.prototype.unsortedSegmentSum=function(t,e,n){var r=0,i=h.getAxesPermutation([r],t.rank),o=t;null!=i&&(o=t.transpose(i),r=h.getInnerMostAxes(1,t.rank)[0]);var a=g.computeOutShape(o.shape,r,n),s=x.sizeFromShape([o.shape[r]]),u=o.as2D(-1,s),l=S.sumOutType(t.dtype),c=this.segOpCompute(u,"unsortedSegmentSum",e,l,n).reshape(a);return null!=i&&(c=c.transpose(h.getUndoAxesPermutation(i))),c},t.prototype.segOpCompute=function(t,e,n,r,i){var o=t.shape[0],a=t.shape[1],s=g.segOpComputeOptimalWindowSize(a,i),u={windowSize:s,inSize:a,batchSize:o,numSegments:i},l=new St.SegmentOpProgram(u,e),c=l.outputShape,p=c[0],h=c[1],f=this.makeOutputArray([p,h],r);return this.compileAndRun(l,[t,n],f),f.shape[1]===i?f:(n=_.range(0,i).tile([a/s]),this.segOpCompute(f,e,n,r,i))},t.prototype.argMin=function(t,e){var n=[e];h.assertAxesAreInnerMostDims("argMin",n,t.rank);var r=h.computeOutAndReduceShapes(t.shape,n),i=r[0],o=r[1],a=x.sizeFromShape(o),s=t.as2D(-1,a);return this.argReduce(s,"min").reshape(i)},t.prototype.argMax=function(t,e){var n=[e];h.assertAxesAreInnerMostDims("argMax",n,t.rank);var r=h.computeOutAndReduceShapes(t.shape,n),i=r[0],o=r[1],a=x.sizeFromShape(o),s=t.as2D(-1,a);return this.argReduce(s,"max").reshape(i)},t.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var i=new Q.CumSumProgram(t.shape,n,r);return this.compileAndRun(i,[t])},t.prototype.equal=function(t,e){var n=new z.BinaryOpProgram(F.EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.notEqual=function(t,e){var n=new z.BinaryOpProgram(F.NOT_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);var n=new z.BinaryOpProgram(F.LESS,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.lessEqual=function(t,e){var n=new z.BinaryOpProgram(F.LESS_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);var n=new z.BinaryOpProgram(F.GREATER,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.greaterEqual=function(t,e){var n=new z.BinaryOpProgram(F.GREATER_EQUAL,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalNot=function(t){var e=new It.UnaryOpProgram(t.shape,kt.LOGICAL_NOT);return this.compileAndRun(e,[t])},t.prototype.logicalAnd=function(t,e){var n=new z.BinaryOpProgram(F.LOGICAL_AND,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.logicalOr=function(t,e){var n=new z.BinaryOpProgram(F.LOGICAL_OR,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[t,e],r)},t.prototype.select=function(t,e,n){var r=new xt.SelectProgram(t.rank,e.shape,e.rank),i=this.makeOutputArray(r.outputShape,S.upcastType(e.dtype,n.dtype));return this.compileAndRun(r,[t,e,n],i)},t.prototype.where=function(t){c.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return Rt.whereImpl(t.shape,e)},t.prototype.topk=function(t,e,n){var r=t.dataSync();return k.topkImpl(r,t.shape,t.dtype,e,n)},t.prototype.min=function(t,e){h.assertAxesAreInnerMostDims("min",e,t.rank);var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},t.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=new z.BinaryOpProgram(F.MIN,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.mod=function(t,e){var n=new z.BinaryOpProgram(F.MOD,t.shape,e.shape),r=n.getCustomSetupFunc();return this.compileAndRun(n,[t,e],null,r)},t.prototype.max=function(t,e){h.assertAxesAreInnerMostDims("max",e,t.rank);var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},t.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=new z.BinaryOpProgram(F.MAX,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.all=function(t,e){h.assertAxesAreInnerMostDims("all",e,t.rank);var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},t.prototype.any=function(t,e){h.assertAxesAreInnerMostDims("any",e,t.rank);var n=h.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=x.sizeFromShape(i),a=t.as2D(-1,o);
return this.reduce(a,"any",a.dtype).reshape(r)},t.prototype.squaredDifference=function(t,e){var n=new z.BinaryOpProgram(F.SQUARED_DIFFERENCE,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.realDivide=function(t,e){var n=F.DIV,r="float32",i=new z.BinaryOpProgram(n,t.shape,e.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[t,e],o)},t.prototype.floorDiv=function(t,e){var n=F.INT_DIV,r="int32",i=new z.BinaryOpProgram(n,t.shape,e.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[t,e],o)},t.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,F.ADD);var n=new z.BinaryOpProgram(F.ADD,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,S.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,i=this.texData.get(t.dataId),o=this.texData.get(e.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map(function(i){var o=i[0],a=i[1],s=new z.BinaryOpProgram(n,t.shape,e.shape),u=r.makeOutputArray(s.outputShape,S.upcastType(o.dtype,a.dtype)),l=r.makeComplexComponentTensorHandle(t,o),c=r.makeComplexComponentTensorHandle(e,a);return r.compileAndRun(s,[l,c],u)}),s=a[0],u=a[1],l=this.complex(s,u);return s.dispose(),u.dispose(),l},t.prototype.makeComplexComponentTensorHandle=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},t.prototype.addN=function(t){for(var e=t[0],n=1;n<t.length;n++)e=this.add(e,t[n]);return e},t.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,F.SUB);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=new z.BinaryOpProgram(F.SUB,t.shape,e.shape),r=this.makeOutputArray(n.outputShape,S.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],r)},t.prototype.pow=function(t,e){var n=new z.BinaryOpProgram(F.POW,t.shape,e.shape),r=n.getCustomSetupFunc(),i=this.makeOutputArray(n.outputShape,S.upcastType(t.dtype,e.dtype));return this.compileAndRun(n,[t,e],i,r)},t.prototype.ceil=function(t){var e=new It.UnaryOpProgram(t.shape,kt.CEIL);return this.compileAndRun(e,[t])},t.prototype.floor=function(t){var e=new It.UnaryOpProgram(t.shape,kt.FLOOR);return this.compileAndRun(e,[t])},t.prototype.sign=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SIGN);return this.compileAndRun(e,[t])},t.prototype.round=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ROUND);return this.compileAndRun(e,[t])},t.prototype.exp=function(t){var e=new It.UnaryOpProgram(t.shape,kt.EXP);return this.compileAndRun(e,[t])},t.prototype.expm1=function(t){var e=new It.UnaryOpProgram(t.shape,kt.EXPM1);return this.compileAndRun(e,[t])},t.prototype.log=function(t){var e=new It.UnaryOpProgram(t.shape,kt.LOG),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.log1p=function(t){var e=new It.UnaryOpProgram(t.shape,kt.LOG1P);return this.compileAndRun(e,[t])},t.prototype.sqrt=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SQRT);return this.compileAndRun(e,[t])},t.prototype.rsqrt=function(t){var e=new It.UnaryOpProgram(t.shape,kt.RSQRT);return this.compileAndRun(e,[t])},t.prototype.square=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SQUARE);return this.compileAndRun(e,[t])},t.prototype.reciprocal=function(t){var e=new It.UnaryOpProgram(t.shape,kt.RECIPROCAL);return this.compileAndRun(e,[t])},t.prototype.relu=function(t){var e=new It.UnaryOpProgram(t.shape,kt.RELU);return this.compileAndRun(e,[t])},t.prototype.elu=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ELU);return this.compileAndRun(e,[t])},t.prototype.eluDer=function(t,e){var n=new z.BinaryOpProgram(F.ELU_DER,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.selu=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SELU);return this.compileAndRun(e,[t])},t.prototype.int=function(t){var e=new It.UnaryOpProgram(t.shape,kt.TO_INT),n=this.makeOutputArray(e.outputShape,"int32");return this.compileAndRun(e,[t],n)},t.prototype.clip=function(t,e,n){var r=new q.ClipProgram(t.shape,e,n);return this.compileAndRun(r,[t])},t.prototype.abs=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ABS);return this.compileAndRun(e,[t])},t.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new V.ComplexAbsProgram(t.shape),r=[this.makeComplexComponentTensorHandle(t,e.complexTensors.real),this.makeComplexComponentTensorHandle(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SIGMOID);return this.compileAndRun(e,[t])},t.prototype.softplus=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SOFTPLUS);return this.compileAndRun(e,[t])},t.prototype.sin=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SIN);return this.compileAndRun(e,[t])},t.prototype.cos=function(t){var e=new It.UnaryOpProgram(t.shape,kt.COS);return this.compileAndRun(e,[t])},t.prototype.tan=function(t){var e=new It.UnaryOpProgram(t.shape,kt.TAN);return this.compileAndRun(e,[t])},t.prototype.asin=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ASIN);return this.compileAndRun(e,[t])},t.prototype.acos=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ACOS);return this.compileAndRun(e,[t])},t.prototype.atan=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ATAN);return this.compileAndRun(e,[t])},t.prototype.atan2=function(t,e){var n=new z.BinaryOpProgram(F.ATAN2,t.shape,e.shape);return this.compileAndRun(n,[t,e])},t.prototype.sinh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.SINH);return this.compileAndRun(e,[t])},t.prototype.cosh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.COSH);return this.compileAndRun(e,[t])},t.prototype.tanh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.TANH);return this.compileAndRun(e,[t])},t.prototype.asinh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ASINH);return this.compileAndRun(e,[t])},t.prototype.acosh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ACOSH),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.atanh=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ATANH),n=e.getCustomSetupFunc();return this.compileAndRun(e,[t],null,n)},t.prototype.erf=function(t){var e=new It.UnaryOpProgram(t.shape,kt.ERF);return this.compileAndRun(e,[t])},t.prototype.step=function(t,e){var n=new It.UnaryOpProgram(t.shape,kt.STEP(e));return this.compileAndRun(n,[t])},t.prototype.conv2dWithIm2Row=function(t,e,n){var r=n.filterWidth,i=n.filterHeight,o=n.inChannels,a=n.outWidth,s=n.outHeight,l=r*i*o,c=s*a,p=[l,c],h=t.squeeze([0]),f=e.reshape([l,-1]),d=new rt.Im2ColProgram(p,h.shape,n),m=this.compileAndRun(d,[h],this.makePackedTensor(p)),y=new ut.MatMulPackedProgram(m.shape,f.shape,[c,n.outChannels],!0,!1),g=this.compileAndRun(y,[m,f],this.makePackedTensor(y.outputShape));return u.ENV.get("WEBGL_LAZILY_UNPACK")===!1&&(g=this.unpackTensor(g)),g.reshape([1,s,a,n.outChannels])},t.prototype.conv2d=function(t,e,n){if(u.ENV.get("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new G.Conv2DProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerInput=function(t,e,n){var r=new j.Conv2DDerInputProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.conv2dDerFilter=function(t,e,n){var r=new j.Conv2DDerFilterProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2D=function(t,e,n){var r=new W.DepthwiseConv2DProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new U.DepthwiseConv2DDerInputProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new U.DepthwiseConv2DDerFilterProgram(n);return this.compileAndRun(r,[t,e])},t.prototype.maxPool=function(t,e){var n=new ft.Pool2DProgram(e,"max",!1),r=this.makeOutputArray(n.outputShape,t.dtype);return this.compileAndRun(n,[t],r)},t.prototype.avgPool=function(t,e){var n=new ft.Pool2DProgram(e,"avg",!1),r=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[t],r)},t.prototype.maxPoolBackprop=function(t,e,n,r){var i=!0,o=new ft.Pool2DProgram(r,"max",i),a=this.compileAndRun(o,[e]),s=new at.MaxPool2DBackpropProgram(r),u=this.makeOutputArray(s.outputShape,e.dtype),l=this.compileAndRun(s,[t,a],u);return a.dispose(),l},t.prototype.avgPoolBackprop=function(t,e,n){var r=new C.AvgPool2DBackpropProgram(n),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[t],i)},t.prototype.cast=function(t,e){return E.castTensor(t,e,this)},t.prototype.reshape=function(t,e){return this.texData.get(t.dataId).isPacked&&!Mt.isReshapeFree(t.shape,e)?this.packedReshape(t,e):E.reshapeTensor(t,e)},t.prototype.resizeBilinear=function(t,e,n,r){var i=new gt.ResizeBilinearProgram(t.shape,e,n,r);return this.compileAndRun(i,[t])},t.prototype.resizeBilinearBackprop=function(t,e,n){var r=new yt.ResizeBilinearBackpropProgram(t,e,n);return this.compileAndRun(r,[t])},t.prototype.resizeNearestNeighbor=function(t,e,n,r){var i=new bt.ResizeNearestNeighborProgram(t.shape,e,n,r);return this.compileAndRun(i,[t])},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new vt.ResizeNearestNeigborBackpropProgram(t,e,n);return this.compileAndRun(r,[t])},t.prototype.multinomial=function(t,e,n,r){var i=e?t:b.softmax(t),o=i.shape[0],a=i.shape[1],s=new lt.MultinomialProgram(o,a,n),u=this.makeOutputArray(s.outputShape,"int32"),l=s.getCustomSetupFunc(r);return this.compileAndRun(s,[i],u,l)},t.prototype.oneHot=function(t,e,n,r){var i=new ct.OneHotProgram(t.size,e,n,r);return this.compileAndRun(i,[t])},t.prototype.nonMaxSuppression=function(t,e,n,r,i){c.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=t.dataSync(),a=e.dataSync();return N.nonMaxSuppressionImpl(o,a,n,r,i)},t.prototype.cropAndResize=function(t,e,n,r,i,o){var a=new H.CropAndResizeProgram(t.shape,e.shape,r,i,o);return this.compileAndRun(a,[t,e,n])},t.prototype.depthToSpace=function(t,e,n){x.assert(e>1,"blockSize should be > 1 for depthToSpace, but was: "+e);var r=t.shape[0],i="NHWC"===n?t.shape[1]:t.shape[2],o="NHWC"===n?t.shape[2]:t.shape[3],a="NHWC"===n?t.shape[3]:t.shape[1],s=i*e,u=o*e,l=a/(e*e),c="NHWC"===n?[r,s,u,l]:[r,l,s,u],p=new K.DepthToSpaceProgram(c,e,n);return this.compileAndRun(p,[t])},t.prototype.split=function(t,e,n){return O.split(t,e,n)},t.prototype.scatterND=function(t,e,n){var r=y.calculateShapes(e,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=[u/a,a],c=t.reshape([o,i]),p=e.reshape([o,a]);if(0===u)return E.reshapeTensor(_.tensor([]),n);var h=_.scalar(0),f=new wt.ScatterProgram(o,i,c.rank,p.rank,s,l);return this.compileAndRun(f,[p,c,h]).reshape(n)},t.prototype.sparseToDense=function(t,e,n,r){var i=y.calculateShapes(e,t,n),o=i.sliceRank,a=i.numUpdates,s=i.strides,u=i.outputSize,l=!1,c=new wt.ScatterProgram(a,o,t.rank,e.rank,s,[u,1],l);return this.compileAndRun(c,[e,t,r]).reshape(n)},t.prototype.fft=function(t){var e=!1;return this.fftImpl(t,e)},t.prototype.ifft=function(t){var e=!0;return this.fftImpl(t,e)},t.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new $.FFTProgram(X.COMPLEX_FFT.REAL,t.shape,e),i=new $.FFTProgram(X.COMPLEX_FFT.IMAG,t.shape,e),o=[this.makeComplexComponentTensorHandle(t,n.complexTensors.real),this.makeComplexComponentTensorHandle(t,n.complexTensors.imag)],a=this.compileAndRun(r,o),s=this.compileAndRun(i,o),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=d.prepareAndValidate(t,e),o=i[0],a=i[1],s=i[2],u=i[3],l=e.reshape([a,r]),c=t.reshape([t.size/s,s]),p=new tt.GatherNDProgram(r,u,[a,s]);return this.compileAndRun(p,[c,l]).reshape(o)},t.prototype.makeOutputArray=function(t,e){return w.Tensor.make(t,{},e)},t.prototype.makePackedTensor=function(t){var e=w.Tensor.make(t,{});return this.texData.get(e.dataId).isPacked=!0,e},t.prototype.unpackTensor=function(t){var e=new Ct.UnpackProgram(t.shape);return this.compileAndRun(e,[t])},t.prototype.getBatchDim=function(t,e){return void 0===e&&(e=2),x.sizeFromShape(t.slice(0,t.length-e))},t.prototype.getRowsCols=function(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]},t.prototype.packedReshape=function(t,e){var n=t.reshape([this.getBatchDim(t.shape)].concat(this.getRowsCols(t.shape))),r=[this.getBatchDim(e)].concat(this.getRowsCols(e)),i=new mt.ReshapePackedProgram(r,n.shape);return this.compileAndRun(i,[n],this.makePackedTensor(r)).reshape(e)},t.prototype.compileAndRun=function(t,e,n,r,i){var o=this;if(void 0===i&&(i=!0),null==n&&(n=this.makeOutputArray(t.outputShape,e[0].dtype)),0===n.size)return this.texData.get(n.dataId).values=T.getTypedArrayFromDType(n.dtype,0),n;var a=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=o.texData.get(e.dataId);if(null==n.texture&&(n.isPacked||!t.usesPackedTextures)&&x.sizeFromShape(e.shape)<=u.ENV.get("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:o.readSync(e.dataId)};if(n.isPacked!==!!t.usesPackedTextures){var r=void 0,i=void 0;n.isPacked?(r=new Ct.UnpackProgram(e.shape),i=o.compileAndRun(r,[e])):(r=new pt.PackProgram(e.shape),i=o.compileAndRun(r,[e],o.makePackedTensor(e.shape))),n=o.texData.get(i.dataId),e=i}return o.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(n.dataId);var s,l={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},c=nt.makeShaderKey(t,a,l),p=this.getAndSaveBinary(c,function(){return nt.compileProgram(o.gpgpu,t,a,l)}),h=null!=this.activeTimers;if(h&&(s=this.startTimer()),nt.runProgram(p,a,l,r),u.ENV.get("WEBGL_PAGING_ENABLED")&&i&&this.numBytesInGPU>this.NUM_BYTES_BEFORE_PAGING)for(var f=this.numBytesInGPU-this.NUM_BYTES_BEFORE_PAGING;f>0&&this.lruDataGPU.length>0;){var d=this.lruDataGPU.shift(),m=this.texData.get(d),y=m.shape,g=m.dtype;f-=this.computeBytes(y,g),this.read(d)}return h&&(s=this.endTimer(s),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(s)})),n},t.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){if(!this.disposed){for(var t in this.binaryCache)this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram);this.textureManager.dispose(),this.canvas.remove(),null!=this.fromPixels2DContext&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&this.gpgpu.dispose(),this.disposed=!0}},t.prototype.floatPrecision=function(){var t=this;return l.tidy(function(){return t.abs(_.scalar(1e-8)).get()>0?32:16})},t.prototype.uploadToGPU=function(t){var e=this.texData.get(t),n=e.shape,r=e.values,o=e.texture,a=e.dtype,s=e.usage,l=e.isPacked;if(null==o){var c,p=null!=this.activeTimers;p&&(c=performance.now());var h=Mt.getTextureShapeFromLogicalShape(n,l);e.texShape=h;var f=this.acquireTexture(t,h,s,l);if(e.texture=f,null!=r){if(l){var d=x.sizeFromShape(n.slice(0,n.length-2)),m=n.length>1?n[n.length-2]:1,y=n[n.length-1];this.gpgpu.uploadMatrixToPackedTexture(f,d,m,y,i(r,a))}else this.gpgpu.uploadMatrixToTexture(f,h[0],h[1],i(r,a));e.values=null,p&&(this.uploadWaitMs+=performance.now()-c)}}else if(u.ENV.get("WEBGL_PAGING_ENABLED")){var g=this.lruDataGPU.indexOf(t);g>=0&&(this.lruDataGPU.splice(this.lruDataGPU.indexOf(t),1),this.lruDataGPU.push(t))}},t.prototype.convertAndCacheOnCPU=function(t,e){var n=this.delayedStorage,i=this.texData.get(t),o=i.texture,a=i.texShape,s=i.dtype,u=i.usage,l=i.isPacked;return n&&null!=o&&(this.releaseTexture(t,o,a,u,l),i.texture=null,i.texShape=null),i.usage=Et.TextureUsage.UPLOAD,null!=e&&(i.values=r(e,s)),i.values},t.prototype.releaseTexture=function(t,e,n,r,i){var o=this.texData.get(t),a=o.shape,s=o.dtype;if(u.ENV.get("WEBGL_PAGING_ENABLED")){var l=this.lruDataGPU.indexOf(t);l>=0&&this.lruDataGPU.splice(l,1)}this.numBytesInGPU-=this.computeBytes(a,s),this.textureManager.releaseTexture(e,n,r,i)},t.prototype.acquireTexture=function(t,e,n,r){var i=this.texData.get(t),o=i.shape,a=i.dtype;return u.ENV.get("WEBGL_PAGING_ENABLED")&&this.lruDataGPU.push(t),this.numBytesInGPU+=this.computeBytes(o,a),this.textureManager.acquireTexture(e,n,r)},t.prototype.computeBytes=function(t,e){return x.sizeFromShape(t)*x.bytesPerElement(e)},t}();e.MathBackendWebGL=Ft,u.ENV.get("IS_BROWSER")&&u.ENV.registerBackend("webgl",function(){return new Ft},2,w.setTensorTracker)},function(t,e){"use strict";function n(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+(t.length+", imag: "+e.length+"."));for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function r(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}function i(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function o(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],r[Math.floor(i/4)]=t[i+1];return{real:n,imag:r}}function a(t,e){var n=t[2*e],r=t[2*e+1];return{real:n,imag:r}}function s(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function u(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),i=0;i<Math.ceil(t/2);i++){var o=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}function l(t,e,n){var r=(n?2:-2)*Math.PI*(t/e),i=Math.cos(r),o=Math.sin(r);return{real:i,imag:o}}Object.defineProperty(e,"__esModule",{value:!0}),e.mergeRealAndImagArrays=n,e.splitRealAndImagArrays=r,e.complexWithEvenIndex=i,e.complexWithOddIndex=o,e.getComplexWithIndex=a,e.assignToTypedArray=s,e.exponents=u,e.exponent=l},function(t,e){"use strict";function n(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function r(t,e){return 1===e?[t]:n(t,e)}function i(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}Object.defineProperty(e,"__esModule",{value:!0}),e.getVecChannels=n,e.getChannels=r,e.getSourceCoords=i},function(t,e){"use strict";function n(t,e,n){var r=Array(t.rank).fill(0),i=t.shape.slice();return e.map(function(e){i[n]=e;var o=t.slice(r,i);return r[n]+=e,o})}Object.defineProperty(e,"__esModule",{value:!0}),e.split=n},function(t,e,n){"use strict";function r(t,e,n,r,a){for(var s=e[e.length-1],u=[t.length/s,s],l=u[0],c=u[1],p=o.getTypedArrayFromDType(n,l*r),h=o.getTypedArrayFromDType("int32",l*r),f=0;f<l;f++){for(var d=f*c,m=t.subarray(d,d+c),y=[],g=0;g<m.length;g++)y.push({value:m[g],index:g});y.sort(function(t,e){return e.value-t.value});for(var v=f*r,b=p.subarray(v,v+r),_=h.subarray(v,v+r),g=0;g<r;g++)b[g]=y[g].value,_[g]=y[g].index}var w=e.slice();return w[w.length-1]=r,[i.tensor(p,w,n),i.tensor(h,w,"int32")]}Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),o=n(2);e.topkImpl=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(25);e.COMPLEX_MULTIPLY={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};var i=function(){function t(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "}return t}();e.BinaryOpComplexProgram=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(25),i="\n  if (isNaN(a)) return a;\n  if (isNaN(b)) return b;\n";e.ADD="return a + b;",e.SUB="return a - b;",e.MUL="return a * b;",e.DIV="if (a == b) return 1.0;\n  return a / b;",e.INT_DIV="\n  float resultSign = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  int result = ia / ib;\n  int amodb = ia - ib * result;\n\n  if (resultSign < 0.0 && amodb != 0) {\n    result -= 1;\n  }\n  return float(result);\n",e.POW="\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nreturn (round(mod(b, 2.0)) == 0 || round(mod(b, 2.0)) == 2) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.SQUARED_DIFFERENCE="return (a - b) * (a - b);",e.EQUAL="return float(a == b);",e.NOT_EQUAL="return float(a != b);",e.LESS="return float(a < b);",e.LESS_EQUAL="return float(a <= b);",e.GREATER="return float(a > b);",e.GREATER_EQUAL="return float(a >= b);",e.LOGICAL_AND="return float(a >= 1.0 && b >= 1.0);",e.LOGICAL_OR="return float(a >= 1.0 || b >= 1.0);",e.MAX=i+"\n  return max(a, b);\n",e.MIN=i+"\n  return min(a, b);\n",e.MOD="if (b == 0.0) return NAN;\n  return mod(a, b);",e.ATAN2=i+"\n  return atan(a, b);\n",e.ELU_DER="return (b >= 1.0) ? a : a * (b + 1.0);";var o=function(){function t(t,e,n){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.outputShape=r.assertAndGetBroadcastShape(e,n),this.userCode="\n      uniform float NAN;\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}();e.BinaryOpProgram=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.COMPLEX_FFT={REAL:"return real * expR - imag * expI;",IMAG:"return real * expI + imag * expR;"};var n=function(){function t(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+o+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "}return t}();e.FFTProgram=n},function(t,e,n){"use strict";function r(t){for(var e=0,n=t.length-1,r=-1;e<=n;){var i=e+n>>1,o=t[i]();o?(r=i,e=i+1):n=i-1}return r}var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(74),s=n(3),u=n(2),l=n(126),c=n(56),p=n(57),h=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.autoDebugValidate=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[],null!=t?this.gl=t:this.gl=a.getWebGLContext(s.ENV.get("WEBGL_VERSION")),1===s.ENV.get("WEBGL_VERSION")?(this.textureFloatExtension=p.getExtensionOrThrow(this.gl,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),s.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=p.getExtensionOrThrow(this.gl,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=p.getExtensionOrThrow(this.gl,"EXT_color_buffer_float"),this.vertexBuffer=l.createVertexBuffer(this.gl),this.indexBuffer=l.createIndexBuffer(this.gl),this.framebuffer=p.createFramebuffer(this.gl),this.textureConfig=l.getTextureConfig(this.gl,this.textureHalfFloatExtension)}return t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;p.callAndCheck(e,function(){return e.finish()}),p.callAndCheck(e,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),p.callAndCheck(e,function(){return e.deleteFramebuffer(t.framebuffer)}),p.callAndCheck(e,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),p.callAndCheck(e,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),p.callAndCheck(e,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.enableAutomaticDebugValidation=function(t){this.autoDebugValidate=t,p.enableDebugWebGLErrorChecking(t)},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),l.createFloat32MatrixTexture(this.gl,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),l.createFloat16MatrixTexture(this.gl,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),l.createUnsignedBytesMatrixTexture(this.gl,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),l.uploadPixelDataToTexture(this.gl,t,e)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),l.createFloat16PackedMatrixTexture(this.gl,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),l.createPackedMatrixTexture(this.gl,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(p.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer),this.outputTexture=null),p.callAndCheck(this.gl,function(){return e.gl.deleteTexture(t)})},t.prototype.uploadMatrixToTexture=function(t,e,n,r){this.throwIfDisposed();var i=p.getNumChannels();return l.uploadMatrixToTexture(this.gl,t,e,n,r,i,this.textureConfig)},t.prototype.uploadMatrixToPackedTexture=function(t,e,n,r,i){return this.throwIfDisposed(),l.uploadMatrixToPackedTexture(this.gl,t,e,n,r,i,this.textureConfig)},t.prototype.downloadFloat32MatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return l.downloadFloat32MatrixFromOutputTexture(r.gl,e,n,r.textureConfig)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return l.downloadByteEncodedFloatMatrixFromOutputTexture(r.gl,e,n,r.textureConfig)})},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e,n){return l.downloadFloat32MatrixFromBuffer(this.gl,t,e,n,this.textureConfig)},t.prototype.maybeCreateBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=l.maybeCreateBufferFromOutputTexture(this.gl,t,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(s.ENV.get("WEBGL_FENCE_API_ENABLED")){var i=t,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=i.clientWaitSync(o,0,0);return t===i.ALREADY_SIGNALED||t===i.CONDITION_SATISFIED},e=o}else s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n,r,i,o){var a=this;return this.downloadMatrixDriver(t,function(){return l.downloadMatrixFromPackedOutputTexture(a.gl,e,n,r,i,o,a.textureConfig)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=p.createFragmentShader(e,t),r=l.createVertexShader(e),i=p.createProgram(e);return p.callAndCheck(e,function(){return e.attachShader(i,r)}),p.callAndCheck(e,function(){return e.attachShader(i,n)}),p.linkProgram(e,i),this.autoDebugValidate&&p.validateProgram(e,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=l.bindVertexProgramAttributeStreams(e,this.program,this.vertexBuffer)),i},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&p.callAndCheck(this.gl,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.autoDebugValidate&&p.validateProgram(this.gl,this.program),p.callAndCheck(this.gl,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?p.getProgramUniformLocationOrThrow(this.gl,t,e):p.getProgramUniformLocation(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),p.callAndCheck(this.gl,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),p.bindTextureToProgramUniformSampler(this.gl,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=c.getPackedMatrixTextureShapeWidthHeight(e,n),i=r[0],o=r[1];this.setOutputMatrixTextureDriver(t,i,o)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e);
},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&p.validateProgram(this.gl,this.program),p.validateFramebuffer(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.autoDebugValidate&&this.debugValidate(),p.callAndCheck(t,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),p.callAndCheck(this.gl,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=p.getExtensionOrThrow(this.gl,2===s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},t.prototype.endQuery=function(){if(2===s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},t.prototype.waitForQueryAndGetTime=function(t){return i(this,void 0,void 0,function(){var e=this;return o(this,function(n){switch(n.label){case 0:return[4,u.repeatedTry(function(){return e.disposed||e.isQueryAvailable(t,s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,s.ENV.get("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl,r=n.getQueryParameter(t,n.QUERY_RESULT);return r/1e6}var i=this.getQueryTimerExtensionWebGL1(),r=i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT);return r/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}var r=this.getQueryTimerExtensionWebGL1(),i=r.getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=r(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e){var n=this.itemsToPoll[e].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||u.repeatedTry(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),p.bindColorTextureToFramebuffer(this.gl,t,this.framebuffer),this.autoDebugValidate&&p.validateFramebuffer(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(p.bindColorTextureToFramebuffer(this.gl,this.outputTexture,this.framebuffer),this.autoDebugValidate&&p.validateFramebuffer(this.gl)):p.unbindColorTextureFromFramebuffer(this.gl,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;p.bindColorTextureToFramebuffer(r,t,this.framebuffer),this.autoDebugValidate&&p.validateFramebuffer(r),this.outputTexture=t,p.callAndCheck(r,function(){return r.viewport(0,0,e,n)}),p.callAndCheck(r,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var i=this;this.throwIfDisposed(),p.callAndCheck(this.gl,function(){return i.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();e.GPGPUContext=h,e.binSearchLastTrue=r},function(t,e,n){"use strict";function r(t){var e="\n    precision highp float;\n    attribute vec3 clipSpacePos;\n    attribute vec2 uv;\n    varying vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }";return E.createVertexShader(t,e)}function i(t){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return E.createStaticVertexBuffer(t,e)}function o(t){var e=new Uint16Array([0,1,2,2,1,3]);return E.createStaticIndexBuffer(t,e)}function a(t,e){var n,r,i,o,a,s,u,l,c=t;return 2===x.ENV.get("WEBGL_VERSION")?(n=c.R32F,r=c.R16F,i=c.RGBA32F,o=c.RED,s=4,u=1,l=c.HALF_FLOAT):(n=t.RGBA,r=t.RGBA,i=c.RGBA,o=t.RGBA,s=4,u=4,l=null!=e?e.HALF_FLOAT_OES:null),a=t.RGBA,{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:a,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function s(t,e,n,r,i,o){E.validateTextureSize(e,n);var a=E.createTexture(t),s=t.TEXTURE_2D;return E.callAndCheck(t,function(){return t.bindTexture(s,a)}),E.callAndCheck(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),E.callAndCheck(t,function(){return t.texParameteri(s,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),E.callAndCheck(t,function(){return t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST)}),E.callAndCheck(t,function(){return t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST)}),E.callAndCheck(t,function(){return t.texImage2D(s,0,r,e,n,0,i,o,null)}),E.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)}),a}function u(t,e,n,r){var i=P.getUnpackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1];return s(t,o,a,r.internalFormatFloat,r.textureFormatFloat,t.FLOAT)}function l(t,e,n,r){var i=P.getUnpackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1];return s(t,o,a,r.internalFormatFloat,r.textureFormatFloat,r.textureTypeHalfFloat)}function c(t,e,n,r){var i=P.getUnpackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1];return s(t,o,a,t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function p(t,e,n,r){var i=P.getPackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1];return s(t,o,a,r.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function h(t,e,n,r){var i=P.getPackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1];return s(t,o,a,r.internalFormatHalfFloat,t.RGBA,r.textureTypeHalfFloat)}function f(t,e,n){var r=0,i=12,o=20;E.callAndCheck(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,n)});var a=E.bindVertexBufferToProgramAttribute(t,e,"clipSpacePos",n,3,o,r);return a&&E.bindVertexBufferToProgramAttribute(t,e,"uv",n,2,o,i)}function d(t,e,n){E.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),E.callAndCheck(t,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)}),E.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function m(t,e,n,r,i,o){E.validateTextureSize(n,r),E.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,e)}),E.callAndCheck(t,function(){return t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,r,o,t.FLOAT,i)}),E.callAndCheck(t,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function y(t,e,n,r,i,o,a){var s,u=P.getUnpackedMatrixTextureShapeWidthHeight(n,r),l=u[0],c=u[1];1===a.defaultNumChannels?s=i:(s=new Float32Array(P.getUnpackedArraySizeFromMatrixSize(i.length,o)),P.encodeMatrixToUnpackedArray(i,s,o)),m(t,e,l,c,s,a.textureFormatFloat)}function g(t,e,n,r,i,o,a){var s=P.getPackedMatrixTextureShapeWidthHeight(r,i),u=s[0],l=s[1],c=new Float32Array(P.getPackedRGBAArraySizeFromMatrixShape(r,i));P.encodeMatrixToPackedRGBA(o,n,r,i,c),m(t,e,u,l,c,t.RGBA)}function v(t,e,n,r,i){var o=e;if(2===x.ENV.get("WEBGL_VERSION")){var a=t,s=a.createBuffer();E.callAndCheck(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,s)});var u=4,l=u*P.getUnpackedArraySizeFromMatrixSize(n*r,i.downloadUnpackNumChannels);E.callAndCheck(t,function(){return t.bufferData(a.PIXEL_PACK_BUFFER,l,t.STATIC_DRAW)}),E.callAndCheck(t,function(){return a.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),E.callAndCheck(t,function(){return t.bindBuffer(a.PIXEL_PACK_BUFFER,null)}),o=s}return o}function b(t,e,n,r,i){var o=t,a=new Float32Array(P.getUnpackedArraySizeFromMatrixSize(n*r,i.downloadUnpackNumChannels));o.bindBuffer(t.ARRAY_BUFFER,e),o.getBufferSubData(t.ARRAY_BUFFER,0,a),o.bindBuffer(t.ARRAY_BUFFER,null);var s=new Float32Array(n*r);return P.decodeMatrixFromUnpackedArray(a,s,i.downloadUnpackNumChannels),s}function _(t,e,n,r){var i=P.getUnpackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1],s=new Float32Array(P.getUnpackedArraySizeFromMatrixSize(e*n,r.downloadUnpackNumChannels));E.callAndCheck(t,function(){return t.readPixels(0,0,o,a,r.downloadTextureFormat,t.FLOAT,s)});var u=new Float32Array(e*n);return P.decodeMatrixFromUnpackedArray(s,u,r.downloadUnpackNumChannels),u}function w(t,e,n,r){var i=P.getUnpackedMatrixTextureShapeWidthHeight(e,n),o=i[0],a=i[1],s=4,u=new Uint8Array(P.getUnpackedArraySizeFromMatrixSize(e*n,s));return E.callAndCheck(t,function(){return t.readPixels(0,0,o,a,r.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function S(t,e,n,r,i,o,a){var s=P.getPackedMatrixTextureShapeWidthHeight(i,o),u=s[0],l=s[1],c=new Float32Array(P.getPackedRGBAArraySizeFromMatrixShape(i,o));E.callAndCheck(t,function(){return t.readPixels(0,0,u,l,t.RGBA,t.FLOAT,c)});var p=new Float32Array(T.sizeFromShape([e,n,r]));return P.decodeMatrixFromPackedRGBA(c,e,n,r,p)}Object.defineProperty(e,"__esModule",{value:!0});var x=n(3),T=n(2),P=n(56),E=n(57);e.createVertexShader=r,e.createVertexBuffer=i,e.createIndexBuffer=o,e.getTextureConfig=a,e.createFloat32MatrixTexture=u,e.createFloat16MatrixTexture=l,e.createUnsignedBytesMatrixTexture=c,e.createPackedMatrixTexture=p,e.createFloat16PackedMatrixTexture=h,e.bindVertexProgramAttributeStreams=f,e.uploadPixelDataToTexture=d,e.uploadMatrixToTexture=y,e.uploadMatrixToPackedTexture=g,e.maybeCreateBufferFromOutputTexture=v,e.downloadFloat32MatrixFromBuffer=b,e.downloadFloat32MatrixFromOutputTexture=_,e.downloadByteEncodedFloatMatrixFromOutputTexture=w,e.downloadMatrixFromPackedOutputTexture=S},function(t,e,n){"use strict";function r(t,e,n){void 0===n&&(n="index");var r=a.computeStrides(e);return r.map(function(e,i){var o="int "+t[i]+" = "+n+" / "+e,a=i===r.length-1?"int "+t[i+1]+" = "+n+" - "+t[i]+" * "+e:"index -= "+t[i]+" * "+e;return o+"; "+a+";"}).join("")}function i(t){return 1===t.length?""+t[0]:"vec"+t.length+"("+t.join(",")+")"}function o(t,e){if(t.length!==e.length)throw new Error("Vectors to be dotted must be of the same length -"+("got "+t.length+" and "+e.length));for(var n=[],r=Math.floor(t.length/4),o=t.length%4,a=0;a<r;a++){var s=t.slice(4*a,4*a+4),u=e.slice(4*a,4*a+4);n.push(i(s)+", "+i(u))}if(0!==o){var s=t.slice(4*r),u=e.slice(4*r);1===s.length&&(s=s.map(function(t){return"float("+t+")"}),u=u.map(function(t){return"float("+t+")"})),n.push(i(s)+", "+i(u))}return n.map(function(t,e){return"dot("+t+")"}).join("+")}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2);e.getLogicalCoordinatesFromFlatIndex=r,e.dotify=o},function(t,e,n){"use strict";function r(t){return void 0===t&&(t=0),s+("\n    return x > 0.0 ? 1.0 : float("+t+");\n  ")}Object.defineProperty(e,"__esModule",{value:!0});var i=n(133),o=n(83),a=function(){function t(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float NAN;\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(){var t=this;return function(e,n){null==t.startLoc&&(t.startLoc=e.getUniformLocationNoThrow(n,"NAN"),null==t.startLoc)||e.gl.uniform1f(t.startLoc,NaN)}},t}();e.UnaryOpProgram=a;var s="if (isNaN(x)) return x;";e.ABS="return abs(x);",e.RELU=s+"\n  return (x < 0.0) ? 0.0 : x;\n",e.ELU="return (x >= 0.0) ? x : (exp(x) - 1.0);",e.SELU="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+o.SELU_SCALEALPHA+";\n  float scale = "+o.SELU_SCALE+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",e.STEP=r,e.NEG="return -x;",e.CEIL="return ceil(x);",e.FLOOR="return floor(x);",e.SIGN="\n  if (isNaN(x)) { return 0.0; }\n  return sign(x);\n",e.ROUND="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",e.EXP="return exp(x);",e.EXPM1="return exp(x) - 1.0;",e.LOG="if (x < 0.0) return NAN;\n  return log(x);",e.LOG1P="return log(1.0 + x);",e.SQRT="return sqrt(x);",e.RSQRT="return inversesqrt(x);",e.SIGMOID="return 1.0 / (1.0 + exp(-1.0 * x));",e.SOFTPLUS="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",e.SIN=s+"\n  return sin(x);\n",e.COS=s+"\n  return cos(x);\n",e.TAN="return tan(x);",e.ASIN="return asin(x);",e.ACOS="return acos(x);",e.ATAN=s+"\n  return atan(x);\n",e.SINH="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",e.COSH="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",e.TANH="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",e.ASINH="return log(x + sqrt(x * x + 1.0));",e.ACOSH=s+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",e.ATANH=s+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",e.ERF='\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '+i.ERF_P+";\n  float a1 = "+i.ERF_A1+";\n  float a2 = "+i.ERF_A2+";\n  float a3 = "+i.ERF_A3+";\n  float a4 = "+i.ERF_A4+";\n  float a5 = "+i.ERF_A5+";\n\n  float t = 1.0 / (1.0 + p * x);\n  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);\n",e.SQUARE="return x * x;",e.RECIPROCAL="return 1.0 / x;",e.LOGICAL_NOT="return float(!(x >= 1.0));",e.TO_INT="return float(int(x));"},function(t,e,n){"use strict";function r(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.ENV.get("IS_TEST")||console.warn.apply(console,t)}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];o.ENV.get("IS_TEST")||console.log.apply(console,t)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3);e.warn=r,e.log=i},function(t,e){"use strict";function n(t,e,n,r){void 0===r&&(r=!0);var i=[];if(r)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([t[a+1]/e[a],e[a]]);i=i.concat(t.slice(o+1))}return i}function r(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var i=e+1;i<t;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{for(var o=[],a=[],i=1;i<t;++i)i>=2*e+1||i%2===1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function i(t,e,n,r){void 0===r&&(r=!0);var i=[];r?i.push(t[0]/n):i.push(t[0]*n);for(var o=1;o<t.length;++o)o<=e.length?r?i.push(e[o-1]*t[o]):i.push(t[o]/e[o-1]):i.push(t[o]);return i}function o(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function a(t,e,n){for(var r=t.slice(0,1),i=0;i<n;++i)r.push(t[i+1]-e[i][0]-e[i][1]);return r}Object.defineProperty(e,"__esModule",{value:!0}),e.getReshaped=n,e.getPermuted=r,e.getReshapedPermuted=i,e.getSliceBeginCoords=o,e.getSliceSize=a},function(t,e,n){"use strict";function r(t,e){var n=g.convertToTensor(t,"a","notEqual"),r=g.convertToTensor(e,"b","notEqual");return y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape),m.ENV.engine.runKernel(function(t){return t.notEqual(n,r)},{$a:n,$b:r})}function i(t,e){var n=g.convertToTensor(t,"a","notEqualStrict"),r=g.convertToTensor(e,"b","notEqualStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}function o(t,e){var n=g.convertToTensor(t,"a","less"),r=g.convertToTensor(e,"b","less");return y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape),m.ENV.engine.runKernel(function(t){return t.less(n,r)},{$a:n,$b:r})}function a(t,e){var n=g.convertToTensor(t,"a","lessStrict"),r=g.convertToTensor(e,"b","lessStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}function s(t,e){var n=g.convertToTensor(t,"a","equal"),r=g.convertToTensor(e,"b","equal");return y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape),m.ENV.engine.runKernel(function(t){return t.equal(n,r)},{$a:n,$b:r})}function u(t,e){var n=g.convertToTensor(t,"a","equalStrict"),r=g.convertToTensor(e,"b","equalStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}function l(t,e){var n=g.convertToTensor(t,"a","lessEqual"),r=g.convertToTensor(e,"b","lessEqual");return y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape),m.ENV.engine.runKernel(function(t){return t.lessEqual(n,r)},{$a:n,$b:r})}function c(t,e){var n=g.convertToTensor(t,"a","lessEqualStrict"),r=g.convertToTensor(e,"b","lessEqualStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}function p(t,e){var n=g.convertToTensor(t,"a","greater"),r=g.convertToTensor(e,"b","greater");return y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape),m.ENV.engine.runKernel(function(t){return t.greater(n,r)},{$a:n,$b:r})}function h(t,e){var n=g.convertToTensor(t,"a","greaterStrict"),r=g.convertToTensor(e,"b","greaterStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}function f(t,e){var n=g.convertToTensor(t,"a","greaterEqual"),r=g.convertToTensor(e,"b","greaterEqual");y.assertTypesMatch(n,r),b.assertAndGetBroadcastShape(n.shape,r.shape);var i=function(t){return{$a:function(){return w.zerosLike(n)},$b:function(){return w.zerosLike(r)}}};return m.ENV.engine.runKernel(function(t){return t.greaterEqual(n,r)},{$a:n,$b:r},i)}function d(t,e){var n=g.convertToTensor(t,"a","greaterEqualStrict"),r=g.convertToTensor(e,"b","greaterEqualStrict");return v.assertShapesMatch(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}Object.defineProperty(e,"__esModule",{value:!0});var m=n(3),y=n(49),g=n(6),v=n(2),b=n(25),_=n(5),w=n(9);e.equal=_.op({equal_:s}),e.equalStrict=_.op({equalStrict_:u}),e.greater=_.op({greater_:p}),e.greaterEqual=_.op({greaterEqual_:f}),e.greaterEqualStrict=_.op({greaterEqualStrict_:d}),e.greaterStrict=_.op({greaterStrict_:h}),e.less=_.op({less_:o}),e.lessEqual=_.op({lessEqual_:l}),e.lessEqualStrict=_.op({lessEqualStrict_:c}),e.lessStrict=_.op({lessStrict_:a}),e.notEqual=_.op({notEqual_:r}),e.notEqualStrict=_.op({notEqualStrict_:i})},function(t,e,n){"use strict";function r(t,e,n,r,o,a,u){void 0===u&&(u="channelsLast");var l,c=s(e),p=c[0],h=c[1];if("channelsLast"===u)l=[p,h,t[3],t[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat "+u);l=[p,h,t[1],t[1]]}return i(t,l,n,r,o,a,!1,u)}function i(t,e,n,r,i,o,a,c){void 0===a&&(a=!1),void 0===c&&(c="channelsLast");var p=[-1,-1,-1,-1],h=p[0],f=p[1],d=p[2],m=p[3];if("channelsLast"===c)h=t[0],f=t[1],d=t[2],m=t[3];else{if("channelsFirst"!==c)throw new Error("Unknown dataFormat "+c);h=t[0],m=t[1],f=t[2],d=t[3]}var y,g=e[0],v=e[1],b=e[3],_=s(n),w=_[0],S=_[1],x=s(r),T=x[0],P=x[1],E=u(g,T),A=u(v,P),N=l(i,f,d,w,S,E,A,o),O=N.padInfo,k=N.outHeight,I=N.outWidth,C=a?b*m:b;return"channelsFirst"===c?y=[h,C,k,I]:"channelsLast"===c&&(y=[h,k,I,C]),{batchSize:h,dataFormat:c,inHeight:f,inWidth:d,inChannels:m,outHeight:k,outWidth:I,outChannels:C,padInfo:O,strideHeight:w,strideWidth:S,filterHeight:g,filterWidth:v,effectiveFilterHeight:E,effectiveFilterWidth:A,dilationHeight:T,dilationWidth:P,inShape:t,outShape:y,filterShape:e}}function o(t,e,n,r,i,o){null==i&&(i=a(t,e,r));var s=t[0],u=t[1],l=c((s-e+2*i)/r+1,o);f.assert(f.isInt(l),"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters");var p=c((u-e+2*i)/r+1,o);return f.assert(f.isInt(p),"The output # of columns ("+p+") must be an integer. Change the stride and/or zero pad parameters"),[l,p,n]}function a(t,e,n,r){void 0===r&&(r=1);var i=u(e,r);return Math.floor((t[0]*(n-1)-n+i)/2)}function s(t){return"number"==typeof t?[t,t]:t}function u(t,e){return e<=1?t:t+(t-1)*(e-1)}function l(t,e,n,r,i,a,s,u){var l,c,p;if("number"==typeof t){var h=0===t?"VALID":"NUMBER";l={top:t,bottom:t,left:t,right:t,type:h};var f=o([e,n,1],a,1,r,t,u);c=f[0],p=f[1]}else if("same"===t){c=Math.ceil(e/r),p=Math.ceil(n/i);var d=(c-1)*r+a-e,m=(p-1)*i+s-n,y=Math.floor(d/2),g=d-y,v=Math.floor(m/2),b=m-v;l={top:y,bottom:g,left:v,right:b,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-a+1)/r),p=Math.ceil((n-s+1)/i)}return{padInfo:l,outHeight:c,outWidth:p}}function c(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function p(t){var e=s(t),n=e[0],r=e[1];return 1===n&&1===r}function h(t,e){return p(t)||p(e)}Object.defineProperty(e,"__esModule",{value:!0});var f=n(2);e.computePool2DInfo=r,e.computeConv2DInfo=i,e.computeDefaultPad=a,e.tupleValuesAreOne=p,e.eitherStridesOrDilationsAreOne=h},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ERF_P=.3275911,e.ERF_A1=.254829592,e.ERF_A2=-.284496736,e.ERF_A3=1.421413741,e.ERF_A4=-1.453152027,e.ERF_A5=1.061405429},function(t,e,n){"use strict";function r(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+(" but the rank was "+t.rank+"."));if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+(" but the dtype was "+e.dtype+"."));if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+(e.shape[e.rank-1]+" vs. "+t.rank));if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty."+(" Input shape: "+t.shape+"."));for(var n=e.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var s=t.shape,u=n.slice();u.pop();for(var l=1,a=r;a<t.rank;++a)l*=s[a],u.push(s[a]);var c=i.computeStrides(t.shape).map(function(t){return t/l}).concat([1]).slice(0,r);return[u,o,l,c]}Object.defineProperty(e,"__esModule",{value:!0});var i=n(2);e.prepareAndValidate=r},function(t,e,n){"use strict";function r(t,e,n){void 0===n&&(n=d.SUM_BY_NONZERO_WEIGHTS);var r=y.convertToTensor(t,"losses","computeWeightedLoss"),i=null;null!=e&&(i=y.convertToTensor(e,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(n===d.NONE)return o;if(n===d.SUM)return o.sum();if(n===d.MEAN){if(null==i)return o.mean();var a=g.sizeFromShape(r.shape)/g.sizeFromShape(i.shape),s=o.sum().div(i.sum());return a>1?s.div(w.scalar(a)):s}if(n===d.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(w.scalar(r.size));var u=i.mul(w.ones(r.shape)),l=u.notEqual(w.scalar(0)).sum().toFloat();return o.sum().div(l)}throw Error("Unknown reduction: "+n)}function i(t,n,r,i){void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=y.convertToTensor(t,"labels","absoluteDifference"),a=y.convertToTensor(n,"predictions","absoluteDifference"),s=null;null!=r&&(s=y.convertToTensor(r,"weights","absoluteDifference")),g.assertShapesMatch(o.shape,a.shape,"Error in absoluteDifference: ");var u=o.sub(a).abs();return e.computeWeightedLoss(u,s,i)}function o(t,n,r,i){void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=y.convertToTensor(t,"labels","meanSquaredError"),a=y.convertToTensor(n,"predictions","meanSquaredError"),s=null;null!=r&&(s=y.convertToTensor(r,"weights","meanSquaredError")),g.assertShapesMatch(o.shape,a.shape,"Error in meanSquaredError: ");var u=o.squaredDifference(a);return e.computeWeightedLoss(u,s,i)}function a(t,n,r,i,o){void 0===o&&(o=d.SUM_BY_NONZERO_WEIGHTS);var a=y.convertToTensor(t,"labels","cosineDistance"),s=y.convertToTensor(n,"predictions","cosineDistance"),u=null;null!=i&&(u=y.convertToTensor(i,"weights","cosineDistance")),g.assertShapesMatch(a.shape,s.shape,"Error in cosineDistance: ");var l=w.scalar(1),c=l.sub(a.mul(s).sum(r,!0));return e.computeWeightedLoss(c,u,o)}function s(t,n,r,i){void 0===i&&(i=d.SUM_BY_NONZERO_WEIGHTS);var o=y.convertToTensor(t,"labels","hingeLoss"),a=y.convertToTensor(n,"predictions","hingeLoss"),s=null;null!=r&&(s=y.convertToTensor(r,"weights","hingeLoss")),g.assertShapesMatch(o.shape,a.shape,"Error in hingeLoss: ");var u=w.scalar(1);o=w.scalar(2).mul(o).sub(u);var l=u.sub(o.mul(a)).relu();return e.computeWeightedLoss(l,s,i)}function u(t,n,r,i,o){void 0===i&&(i=1e-7),void 0===o&&(o=d.SUM_BY_NONZERO_WEIGHTS);var a=y.convertToTensor(t,"labels","logLoss"),s=y.convertToTensor(n,"predictions","logLoss"),u=null;null!=r&&(u=y.convertToTensor(r,"weights","logLoss")),g.assertShapesMatch(a.shape,s.shape,"Error in logLoss: ");var l=w.scalar(1),c=w.scalar(i),p=a.mul(s.add(c).log()).neg().sub(l.sub(a).mul(l.sub(s).add(c).log()));return e.computeWeightedLoss(p,u,o)}function l(t,e){var n=y.convertToTensor(t,"labels","sigmoidCrossEntropyWithLogits"),r=y.convertToTensor(e,"logits","sigmoidCrossEntropyWithLogits");g.assertShapesMatch(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}function c(t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=d.SUM_BY_NONZERO_WEIGHTS);var a=y.convertToTensor(t,"multiClassLabels","sigmoidCrossEntropy"),s=y.convertToTensor(n,"logits","sigmoidCrossEntropy"),u=null;if(null!=r&&(u=y.convertToTensor(r,"weights","sigmoidCrossEntropy")),g.assertShapesMatch(a.shape,s.shape,"Error in sigmoidCrossEntropy: "),i>0){var c=w.scalar(i),p=w.scalar(1),h=w.scalar(.5);a=a.mul(p.sub(c)).add(h.mul(c))}var f=l(a,s);return e.computeWeightedLoss(f,u,o)}function p(t,n,r,i,o){void 0===i&&(i=1),void 0===o&&(o=d.SUM_BY_NONZERO_WEIGHTS);var a=y.convertToTensor(t,"labels","huberLoss"),s=y.convertToTensor(n,"predictions","huberLoss"),u=null;null!=r&&(u=y.convertToTensor(r,"weights","huberLoss")),g.assertShapesMatch(a.shape,s.shape,"Error in huberLoss: ");var l=w.scalar(i),c=s.sub(a).abs(),p=b.minimum(c,l),h=c.sub(p),f=w.scalar(.5).mul(p.square()).add(l.mul(h));return e.computeWeightedLoss(f,u,o)}function h(t,e,n){if(void 0===n&&(n=-1),n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+n));var r=m.customGrad(function(t,e){var r=!0,i=e.logSumExp([n],r),o=e.toFloat().sub(i),a=o.mul(t).neg(),s=a.sum([n]),u=function(e){var r=v.expandShapeToKeepDim(e.shape,[n]);return[e.reshape(r).mul(t.toFloat().sub(o.exp())),e.reshape(r).mul(o.exp().sub(t.toFloat()))]};return{value:s,gradFunc:u}});return r(t,e)}function f(t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=d.SUM_BY_NONZERO_WEIGHTS);var a=y.convertToTensor(t,"onehotLabels","softmaxCrossEntropy"),s=y.convertToTensor(n,"logits","softmaxCrossEntropy"),u=null;if(null!=r&&(u=y.convertToTensor(r,"weights","softmaxCrossEntropy")),g.assertShapesMatch(a.shape,s.shape,"Error in softmaxCrossEntropy: "),i>0){var l=w.scalar(i),c=w.scalar(1),p=w.scalar(a.shape[1]);a=a.mul(c.sub(l)).add(l.div(p))}var f=h(a,s);return e.computeWeightedLoss(f,u,o)}Object.defineProperty(e,"__esModule",{value:!0});var d,m=n(17),y=n(6),g=n(2),v=n(24),b=n(48),_=n(5),w=n(9);!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(d=e.Reduction||(e.Reduction={})),e.absoluteDifference=_.op({absoluteDifference_:i}),e.computeWeightedLoss=_.op({computeWeightedLoss_:r}),e.cosineDistance=_.op({cosineDistance_:a}),e.hingeLoss=_.op({hingeLoss_:s}),e.huberLoss=_.op({huberLoss_:p}),e.logLoss=_.op({logLoss_:u}),e.meanSquaredError=_.op({meanSquaredError_:o}),e.sigmoidCrossEntropy=_.op({sigmoidCrossEntropy_:c}),e.softmaxCrossEntropy=_.op({softmaxCrossEntropy_:f})},function(t,e,n){"use strict";function r(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1);var i=s.convertToTensor(t,"a","matMul"),o=s.convertToTensor(e,"b","matMul"),l=n?i.shape[i.rank-2]:i.shape[i.rank-1],c=r?o.shape[o.rank-1]:o.shape[o.rank-2],p=n?i.shape[i.rank-1]:i.shape[i.rank-2],h=r?o.shape[o.rank-2]:o.shape[o.rank-1],f=i.shape.slice(0,-2),d=o.shape.slice(0,-2),m=u.sizeFromShape(f),y=u.sizeFromShape(d);u.assert(i.rank>=2&&o.rank>=2&&i.rank===o.rank,"Error in matMul: inputs must have the same rank of at least 2, "+("got ranks "+i.rank+" and "+o.rank+".")),u.assert(u.arraysEqual(f,d),"Error in matMul: outer dimensions ("+f+") and ("+(d+") of Tensors with shapes "+i.shape+" and ")+(o.shape+" must match.")),u.assert(l===c,"Error in matMul: inner shapes ("+l+") and ("+(c+") of Tensors with shapes "+i.shape+" and ")+(o.shape+" and transposeA="+n)+(" and transposeB="+r+" must match."));var g=i.shape.slice(0,-2).concat([p,h]),v=n?i.as3D(m,l,p):i.as3D(m,p,l),b=r?o.as3D(y,h,c):o.as3D(y,c,h),_=function(t){return n||r?!n&&r?{$a:function(){return t.matMul(b.toFloat(),!1,!1)},$b:function(){return t.matMul(v.toFloat(),!0,!1)}}:n&&!r?{$a:function(){return b.toFloat().matMul(t,!1,!0)},$b:function(){return v.toFloat().matMul(t,!1,!1)}}:{$a:function(){return b.toFloat().matMul(t,!0,!0)},$b:function(){return t.matMul(v.toFloat(),!0,!0)}}:{$a:function(){return t.matMul(b.toFloat(),!1,!0)},$b:function(){return v.toFloat().matMul(t,!0,!1)}}},w=a.ENV.engine.runKernel(function(t){return t.batchMatMul(v,b,n,r)},{$a:v,$b:b},_);return w.reshape(g)}function i(t,e){var n=s.convertToTensor(t,"v1","outerProduct"),r=s.convertToTensor(e,"v2","outerProduct");return u.assert(1===n.rank&&1===r.rank,"Error in outerProduct: inputs must be rank 1, but got ranks "+(n.rank+" and "+r.rank+".")),n.as2D(-1,1).matMul(r.as2D(1,-1))}function o(t,e){var n=s.convertToTensor(t,"t1","dot"),r=s.convertToTensor(e,"t2","dot");u.assert(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(n.rank+" and "+r.rank+"."));var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return u.assert(i===o,"Error in dot: inner dimensions of inputs must match, but got "+(i+" and "+o+".")),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),s=n(6),u=n(2),l=n(5);e.matMul=l.op({matMul_:r}),e.dot=l.op({dot_:o}),e.outerProduct=l.op({outerProduct_:i})},function(t,e,n){"use strict";function r(t,e,n,r){
void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1),t=o.convertToTensor(t,"x","norm");var s=i(t,e,n),u=s.shape;if(r){var l=a.parseAxisParam(n,t.shape);u=a.expandShapeToKeepDim(s.shape,l)}return s.reshape(u)}function i(t,e,n){if(void 0===n&&(n=null),0===t.rank)return t.abs();if(1!==t.rank&&null===n)return i(t.reshape([-1]),e,n);if(1===t.rank||"number"==typeof n||n instanceof Array&&1===n.length){if(1===e)return t.abs().sum(n);if(e===1/0)return t.abs().max(n);if(e===-(1/0))return t.abs().min(n);if("euclidean"===e||2===e)return t.abs().pow(u.scalar(2,"int32")).sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}if(n instanceof Array&&2===n.length){if(1===e)return t.abs().sum(n[0]).max(n[1]-1);if(e===1/0)return t.abs().sum(n[1]).max(n[0]);if(e===-(1/0))return t.abs().sum(n[1]).min(n[0]);if("fro"===e||"euclidean"===e)return t.square().sum(n).sqrt();throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+n)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),a=n(24),s=n(5),u=n(9);e.norm=s.op({norm_:r})},function(t,e,n){"use strict";function r(t){return t<=e.PARALLELIZE_THRESHOLD?t:i.nearestDivisor(t,Math.floor(Math.sqrt(t)))}Object.defineProperty(e,"__esModule",{value:!0});var i=n(2);e.PARALLELIZE_THRESHOLD=30,e.computeOptimalWindowSize=r},function(t,e,n){"use strict";function r(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","logSumExp"),i=b.parseAxisParam(e,r.shape),o=r.max(i,!0),a=r.sub(o),s=a.exp(),u=s.sum(i),l=u.log(),c=o.reshape(l.shape).add(l);if(n){var p=b.expandShapeToKeepDim(c.shape,i);return c.reshape(p)}return c}function i(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=b.parseAxisParam(e,r.shape),o=y.customGrad(function(t){var e=b.getAxesPermutation(i,t.rank),r=i,o=t;null!=e&&(o=t.transpose(e),r=b.getInnerMostAxes(r.length,t.rank));var a=m.ENV.engine.runKernel(function(t){return t.sum(o,r)},{permutedX:o});if(n){var s=b.expandShapeToKeepDim(a.shape,i);a=a.reshape(s)}var u=function(e){var n=t.shape.slice();i.forEach(function(t){n[t]=1});var r=e.reshape(n),o=r.mul(w.ones(t.shape,"float32"));return o};return{value:a,gradFunc:u}});return o(r)}function o(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=b.parseAxisParam(e,r.shape),o=b.getAxesPermutation(i,r.rank),a=i,s=r;null!=o&&(s=r.transpose(o),a=b.getInnerMostAxes(a.length,r.rank));var u=m.ENV.engine.runKernel(function(t){return t.prod(s,a)},{permutedX:s});if(n){var l=b.expandShapeToKeepDim(u.shape,i);u=u.reshape(l)}return u}function a(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","mean"),i=b.parseAxisParam(e,r.shape),o=b.computeOutAndReduceShapes(r.shape,i),a=o[1],s=v.sizeFromShape(a),u=y.customGrad(function(t){var r=w.scalar(s),o=r.dtype===t.dtype?t:t.cast(r.dtype),a=o.div(r),u=a.sum(e,n),l=function(e){var n=t.shape.slice();i.forEach(function(t){n[t]=1});var o=e.reshape(n),a=o.mul(w.ones(t.shape,"float32")).div(r);return a};return{value:u,gradFunc:l}});return u(r)}function s(t,e,n,r,i){var o=e[0];return o.rank<n.rank&&(o=o.reshape(b.expandShapeToKeepDim(o.shape,r))),t.rank<n.rank&&(t=t.reshape(b.expandShapeToKeepDim(t.shape,r))),{$x:function(){var e=t.mul(n.equal(o).cast(t.dtype));return null==i?e:e.transpose(i)}}}function u(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","min"),i=r,o=b.parseAxisParam(e,r.shape),a=o,u=b.getAxesPermutation(a,r.rank);null!=u&&(r=r.transpose(u),a=b.getInnerMostAxes(a.length,r.rank));var l=function(t,e){return s(t,e,i,o,u)},c=m.ENV.engine.runKernel(function(t,e){return e(t.min(r,a))},{$x:r},l);if(n){var p=b.expandShapeToKeepDim(c.shape,o);c=c.reshape(p)}return c}function l(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","max"),i=r,o=b.parseAxisParam(e,r.shape),a=o,u=b.getAxesPermutation(a,r.rank);null!=u&&(r=r.transpose(u),a=b.getInnerMostAxes(a.length,r.rank));var l=function(t,e){return s(t,e,i,o,u)},c=m.ENV.engine.runKernel(function(t,e){return e(t.max(r,a))},{$x:r},l);if(n){var p=b.expandShapeToKeepDim(c.shape,o);c=c.reshape(p)}return c}function c(t,e){void 0===e&&(e=0);var n=g.convertToTensor(t,"x","argMin");null==e&&(e=0);var r=b.parseAxisParam(e,n.shape),i=b.getAxesPermutation(r,n.rank);null!=i&&(n=n.transpose(i),r=b.getInnerMostAxes(r.length,n.rank));var o=function(t){return{$x:function(){return w.zerosLike(n)}}};return m.ENV.engine.runKernel(function(t){return t.argMin(n,r[0])},{$x:n},o)}function p(t,e){void 0===e&&(e=0);var n=g.convertToTensor(t,"x","argMax");null==e&&(e=0);var r=b.parseAxisParam(e,n.shape),i=b.getAxesPermutation(r,n.rank);null!=i&&(n=n.transpose(i),r=b.getInnerMostAxes(r.length,n.rank));var o=function(t){return{$x:function(){return w.zerosLike(n)}}};return m.ENV.engine.runKernel(function(t){return t.argMax(n,r[0])},{$x:n},o)}function h(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","all","bool");v.assert("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=b.parseAxisParam(e,r.shape),o=i,a=b.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=b.getInnerMostAxes(o.length,r.rank));var s=m.ENV.engine.runKernel(function(t){return t.all(r,o)},{$x:r});if(n){var u=b.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}function f(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=g.convertToTensor(t,"x","any","bool");v.assert("bool"===r.dtype,"Error Tensor must be of type bool. Got: "+r.dtype);var i=b.parseAxisParam(e,r.shape),o=i,a=b.getAxesPermutation(o,r.rank);null!=a&&(r=r.transpose(a),o=b.getInnerMostAxes(o.length,r.rank));var s=m.ENV.engine.runKernel(function(t){return t.any(r,o)},{$x:r});if(n){var u=b.expandShapeToKeepDim(s.shape,i);return s.reshape(u)}return s}function d(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1),t=g.convertToTensor(t,"x","moments");var r=b.parseAxisParam(e,t.shape),i=t.mean(r,n),o=i.shape;n||(o=b.expandShapeToKeepDim(i.shape,r));var a=t.toFloat().sub(i.reshape(o)).square(),s=a.mean(r,n);return{mean:i,variance:s}}Object.defineProperty(e,"__esModule",{value:!0});var m=n(3),y=n(17),g=n(6),v=n(2),b=n(24),_=n(5),w=n(9);e.all=_.op({all_:h}),e.any=_.op({any_:f}),e.argMax=_.op({argMax_:p}),e.argMin=_.op({argMin_:c}),e.logSumExp=_.op({logSumExp_:r}),e.max=_.op({max_:l}),e.mean=_.op({mean_:a}),e.min=_.op({min_:u}),e.moments=_.op({moments_:d}),e.sum=_.op({sum_:i}),e.prod=_.op({prod_:o})},function(t,e,n){"use strict";function r(t,e){void 0===e&&(e=-1);var n=a.convertToTensor(t,"logits","softmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+n.rank+" and dim was "+e));var r=o.customGrad(function(t){var n=!0,r=t.logSumExp([e],n),i=t.toFloat().sub(r),o=i.exp(),a=function(t){var n=t.mul(o),r=!0;return n.sub(n.sum([e],r).mul(o))};return{value:o,gradFunc:a}});return r(n)}function i(t,e){void 0===e&&(e=-1);var n=a.convertToTensor(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+n.rank+" and axis was "+e));var r=o.customGrad(function(t){var n=!0,r=t.max(e,!0),i=t.sub(r),o=i.toFloat().sub(i.exp().sum(e,n).log()),a=function(t){var r=o.exp();return t.sub(t.sum(e,n).mul(r))};return{value:o,gradFunc:a}});return r(n)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(113),a=n(6),s=n(5);e.softmax=s.op({softmax_:r}),e.logSoftmax=s.op({logSoftmax_:i})},function(t,e,n){"use strict";function r(t){l.assert("complex64"===t.dtype,"The dtype for tf.spectral.fft() must be complex64 "+("but got "+t.dtype+"."));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e),i=a.ENV.engine.runKernel(function(t){return t.fft(r)},{input:t});return i.reshape(t.shape)}function i(t){l.assert("complex64"===t.dtype,"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+t.dtype+"."));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e),i=a.ENV.engine.runKernel(function(t){return t.ifft(r)},{input:t});return i.reshape(t.shape)}function o(t){l.assert("float32"===t.dtype,"The dtype for rfft() must be real value but\n    got "+t.dtype);var e=t.shape[t.shape.length-1],n=t.size/e,r=t.zerosLike(),i=s.complex(t,r).as2D(n,e),o=a.ENV.engine.runKernel(function(t){return t.fft(i)},{complexInput:i}),u=Math.floor(e/2)+1,c=s.real(o),p=s.imag(o),h=c.split([u,e-u],c.shape.length-1),f=p.split([u,e-u],p.shape.length-1),d=t.shape.slice();return d[t.shape.length-1]=u,s.complex(h[0],f[0]).reshape(d)}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),s=n(79),u=n(5),l=n(2);e.fft=u.op({fft_:r}),e.ifft=u.op({ifft_:i}),e.rfft=u.op({rfft_:o})},function(t,e,n){"use strict";function r(t){return new c.Model(t)}function i(t){return new p.Sequential(t)}function o(t,e){return void 0===e&&(e=!0),p.loadModelInternal(t,e)}function a(t){return l.Input(t)}function s(t,e){u.CallbackConstructorRegistry.registerCallbackConstructor(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var u=n(50),l=n(51),c=n(62),p=n(95);e.model=r,e.sequential=i,e.loadModel=o,e.input=a,e.registerCallbackConstructor=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(327);e.constraints=r;var i=n(328);e.initializers=i;var o=n(329);e.layers=o;var a=n(331);e.models=a;var s=n(330);e.metrics=s;var u=n(332);e.regularizers=u;var l=n(50);e.CallbackList=l.CallbackList,e.CustomCallback=l.CustomCallback,e.History=l.History;var c=n(322);e.Callback=c.Callback;var p=n(12);e.InputSpec=p.InputSpec,e.SymbolicTensor=p.SymbolicTensor;var h=n(62);e.Model=h.Model;var f=n(142);e.input=f.input,e.loadModel=f.loadModel,e.model=f.model,e.registerCallbackConstructor=f.registerCallbackConstructor,e.sequential=f.sequential;var d=n(93);e.RNN=d.RNN;var m=n(95);e.Sequential=m.Sequential;var y=n(64);e.LayerVariable=y.LayerVariable;var g=n(147);e.version_layers=g.version},function(t,e,n){"use strict";function r(t,e){return y.tidy(function(){var n=m.mul(g.getScalar(.5),m.onesLike(e)),r=v.cast(m.greater(e,n),t.dtype);return m.mean(m.equal(t,r),-1)})}function i(t,e){return y.tidy(function(){return v.cast(m.equal(m.argMax(t,-1),m.argMax(e,-1)),"float32")})}function o(t,e){return y.tidy(function(){var n=g.getScalar(1);return m.logicalAnd(t.equal(n),e.equal(n)).sum().cast("float32")})}function a(t,e){return y.tidy(function(){var n=g.getScalar(1),r=g.getScalar(0);return m.logicalAnd(t.equal(n),e.equal(r)).sum().cast("float32")})}function s(t,e){return y.tidy(function(){var n=g.getScalar(1),r=g.getScalar(0);return m.logicalAnd(t.equal(r),e.equal(n)).sum().cast("float32")})}function u(t,e){return y.tidy(function(){var n=g.getScalar(0),r=o(t,e),i=s(t,e),a=r.add(i);return m.where(m.greater(a,n),r.div(a),n).cast("float32")})}function l(t,e){return y.tidy(function(){var n=g.getScalar(0),r=o(t,e),i=a(t,e),s=r.add(i);return m.where(m.greater(s,n),r.div(s),n).cast("float32")})}function c(t,e){return w.binaryCrossentropy(t,e)}function p(t,e){throw new b.NotImplementedError}function h(t,e){throw new b.NotImplementedError}function f(t,e){throw new b.NotImplementedError}function d(t){var n={binaryAccuracy:r,categoricalAccuracy:i,precision:u,categoricalCrossentropy:e.categoricalCrossentropy,sparseCategoricalCrossentropy:e.sparseCategoricalCrossentropy,mse:e.mse,MSE:e.MSE,mae:e.mae,MAE:e.MAE,mape:e.mape,MAPE:e.MAPE,cosine:e.cosine};if("string"==typeof t&&t in n)return n[t];if("string"!=typeof t&&null!=t)return t;throw new b.ValueError("Unknown metric "+t)}Object.defineProperty(e,"__esModule",{value:!0});var m=n(1),y=n(1),g=n(8),v=n(13),b=n(7),_=n(52),w=n(52);e.binaryAccuracy=r,e.categoricalAccuracy=i,e.precision=u,e.recall=l,e.binaryCrossentropy=c,e.sparseCategoricalAccuracy=p,e.topKCategoricalAccuracy=h,e.sparseTopKCategoricalAccuracy=f,e.mse=_.meanSquaredError,e.MSE=_.meanSquaredError,e.mae=_.meanAbsoluteError,e.MAE=_.meanAbsoluteError,e.mape=_.meanAbsolutePercentageError,e.MAPE=_.meanAbsolutePercentageError,e.categoricalCrossentropy=_.categoricalCrossentropy,e.cosine=_.cosineProximity,e.sparseCategoricalCrossentropy=_.sparseCategoricalCrossentropy,e.get=d},function(t,e,n){"use strict";function r(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"==typeof n}function i(t,e){if(null===t)return null;if("string"==typeof t)return a.toCamelCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var n=[],o=t.length,s=0;s<o;++s){var u=t[s];r(e,s,u)?n.push(u):n.push(i(u,e))}return n}for(var l={},c=0,p=Object.keys(t);c<p.length;c++){var h=p[c],f=t[h];if("name"===h&&"string"==typeof f)l[h]=f;else{var d=a.toCamelCase(h);l[d]=i(f,d)}}return l}function o(t,e){if(null===t||void 0===t)return null;if("string"==typeof t)return a.toSnakeCase(t);if("number"==typeof t||"boolean"==typeof t)return t;if(t instanceof Array){for(var n=[],i=t.length,s=0;s<i;++s){var u=t[s];r(e,s,u)?n.push(u):n.push(o(u,e))}return n}for(var l={},c=0,p=Object.keys(t);c<p.length;c++){var h=p[c],f=t[h],d=a.toSnakeCase(h);"name"!==h&&"className"!==h||"string"!=typeof f?l[d]=o(f,h):l[d]=f}return l}Object.defineProperty(e,"__esModule",{value:!0});var a=n(10);e.convertPythonicToTs=i,e.convertTsToPythonic=o},function(t,e){"use strict";function n(t){for(var e=0,n=0,r=t;n<r.length;n++){var i=r[n];e+=0===i.shape.length?1:i.shape.reduce(function(t,e){return t*e})}return e}Object.defineProperty(e,"__esModule",{value:!0}),e.countParamsInWeights=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="0.8.5";e.version=n},function(t,e){"use strict";"use restrict";function n(t){var e=32;return t&=-t,t&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}var r=32;e.INT_BITS=r,e.INT_MAX=2147483647,e.INT_MIN=-1<<r-1,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>r-1;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,n;return e=(t>65535)<<4,t>>>=e,n=(t>255)<<3,t>>>=n,e|=n,n=(t>15)<<2,t>>>=n,e|=n,n=(t>3)<<1,t>>>=n,e|=n,e|t>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return t-=t>>>1&1431655765,t=(858993459&t)+(t>>>2&858993459),16843009*(t+(t>>>4)&252645135)>>>24},e.countTrailingZeros=n,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,t&=15,27030>>>t&1};var i=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,r=e,i=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--i;t[e]=r<<i&255}}(i),e.reverse=function(t){return i[255&t]<<24|i[t>>>8&255]<<16|i[t>>>16&255]<<8|i[t>>>24&255]},e.interleave2=function(t,e){return t&=65535,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e&=65535,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1},e.deinterleave2=function(t,e){return t=t>>>e&1431655765,t=858993459&(t|t>>>1),t=252645135&(t|t>>>2),t=16711935&(t|t>>>4),t=65535&(t|t>>>16),t<<16>>16},e.interleave3=function(t,e,n){return t&=1023,t=4278190335&(t|t<<16),t=251719695&(t|t<<8),t=3272356035&(t|t<<4),t=1227133513&(t|t<<2),e&=1023,e=4278190335&(e|e<<16),e=251719695&(e|e<<8),e=3272356035&(e|e<<4),e=1227133513&(e|e<<2),t|=e<<1,n&=1023,n=4278190335&(n|n<<16),n=251719695&(n|n<<8),n=3272356035&(n|n<<4),n=1227133513&(n|n<<2),t|n<<2},e.deinterleave3=function(t,e){return t=t>>>e&1227133513,t=3272356035&(t|t>>>2),t=251719695&(t|t>>>4),t=4278190335&(t|t>>>8),t=1023&(t|t>>>16),t<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>n(t)+1}},function(t,e,n){(function(t){/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
"use strict";function r(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}function i(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(t,e){if(i()<e)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=a.prototype):(null===t&&(t=new a(e)),t.length=e),t}function a(t,e,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return s(this,t,e,n)}function s(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?f(t,e,n,r):"string"==typeof e?p(t,e,n):d(t,e)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function l(t,e,n,r){return u(e),e<=0?o(t,e):void 0!==n?"string"==typeof r?o(t,e).fill(n,r):o(t,e).fill(n):o(t,e)}function c(t,e){if(u(e),t=o(t,e<0?0:0|m(e)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function p(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|g(e,n);t=o(t,r);var i=t.write(e,n);return i!==r&&(t=t.slice(0,i)),t}function h(t,e){var n=e.length<0?0:0|m(e.length);t=o(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function f(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),a.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=a.prototype):t=h(t,e),t}function d(t,e){if(a.isBuffer(e)){var n=0|m(e.length);return t=o(t,n),0===t.length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||X(e.length)?o(t,0):h(t,e);if("Buffer"===e.type&&Z(e.data))return h(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t}function y(t){return+t!=t&&(t=0),a.alloc(+t)}function g(t,e){if(a.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(t).length;default:if(r)return W(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return M(this,e,n);case"utf8":case"utf-8":return O(this,e,n);case"ascii":return I(this,e,n);case"latin1":case"binary":return C(this,e,n);case"base64":return N(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function b(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function _(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=a.from(e,r)),a.isBuffer(e))return 0===e.length?-1:w(t,e,n,r,i);if("number"==typeof e)return e&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):w(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,n,r,i){function o(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}var a=1,s=t.length,u=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,n/=2}var l;if(i){var c=-1;for(l=n;l<s;l++)if(o(t,l)===o(e,c===-1?0:l-c)){if(c===-1&&(c=l),l-c+1===u)return c*a}else c!==-1&&(l-=l-c),c=-1}else for(n+u>s&&(n=s-u),l=n;l>=0;l--){for(var p=!0,h=0;h<u;h++)if(o(t,l+h)!==o(e,h)){p=!1;break}if(p)return l}return-1}function S(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;var o=e.length;if(o%2!==0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function x(t,e,n,r){return Y(W(e,t.length-n),t,n,r)}function T(t,e,n,r){return Y(H(e),t,n,r)}function P(t,e,n,r){return T(t,e,n,r)}function E(t,e,n,r){return Y(K(e),t,n,r)}function A(t,e,n,r){return Y(Q(e,t.length-n),t,n,r)}function N(t,e,n){return 0===e&&n===t.length?$.fromByteArray(t):$.fromByteArray(t.slice(e,n))}function O(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o=t[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s<=n){var u,l,c,p;switch(s){case 1:o<128&&(a=o);break;case 2:u=t[i+1],128===(192&u)&&(p=(31&o)<<6|63&u,p>127&&(a=p));break;case 3:u=t[i+1],l=t[i+2],128===(192&u)&&128===(192&l)&&(p=(15&o)<<12|(63&u)<<6|63&l,p>2047&&(p<55296||p>57343)&&(a=p));break;case 4:u=t[i+1],l=t[i+2],c=t[i+3],128===(192&u)&&128===(192&l)&&128===(192&c)&&(p=(15&o)<<18|(63&u)<<12|(63&l)<<6|63&c,p>65535&&p<1114112&&(a=p))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),i+=s}return k(r)}function k(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=tt));return n}function I(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function C(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function M(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=G(t[o]);return i}function R(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,n,r,i,o){if(!a.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function F(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function z(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function q(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function V(t,e,n,r,i){return i||q(t,e,n,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(t,e,n,r,23,4),n+4}function B(t,e,n,r,i){return i||q(t,e,n,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(t,e,n,r,52,8),n+8}function j(t){if(t=U(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function U(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function G(t){return t<16?"0"+t.toString(16):t.toString(16)}function W(t,e){e=e||1/0;for(var n,r=t.length,i=null,o=[],a=0;a<r;++a){if(n=t.charCodeAt(a),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=(i-55296<<10|n-56320)+65536}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function H(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function Q(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}function K(t){return $.toByteArray(j(t))}function Y(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function X(t){return t!==t}var $=n(345),J=n(358),Z=n(361);e.Buffer=a,e.SlowBuffer=y,e.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:r(),e.kMaxLength=i(),a.poolSize=8192,a._augment=function(t){return t.__proto__=a.prototype,t},a.from=function(t,e,n){return s(null,t,e,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(t,e,n){return l(null,t,e,n)},a.allocUnsafe=function(t){return c(null,t)},a.allocUnsafeSlow=function(t){return c(null,t)},a.isBuffer=function(t){return!(null==t||!t._isBuffer)},a.compare=function(t,e){if(!a.isBuffer(t)||!a.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Z(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=a.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!a.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},a.byteLength=g,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)b(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},a.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?O(this,0,t):v.apply(this,arguments)},a.prototype.equals=function(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},a.prototype.compare=function(t,e,n,r,i){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;for(var o=i-r,s=n-e,u=Math.min(o,s),l=this.slice(r,i),c=t.slice(e,n),p=0;p<u;++p)if(l[p]!==c[p]){o=l[p],s=c[p];break}return o<s?-1:s<o?1:0},a.prototype.includes=function(t,e,n){return this.indexOf(t,e,n)!==-1},a.prototype.indexOf=function(t,e,n){return _(this,t,e,n,!0)},a.prototype.lastIndexOf=function(t,e,n){return _(this,t,e,n,!1)},a.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return S(this,t,e,n);case"utf8":case"utf-8":return x(this,t,e,n);case"ascii":return T(this,t,e,n);case"latin1":case"binary":return P(this,t,e,n);case"base64":return E(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;a.prototype.slice=function(t,e){var n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t);var r;if(a.TYPED_ARRAY_SUPPORT)r=this.subarray(t,e),r.__proto__=a.prototype;else{var i=e-t;r=new a(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},a.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},a.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},a.prototype.readUInt8=function(t,e){return e||D(t,1,this.length),this[t]},a.prototype.readUInt16LE=function(t,e){return e||D(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function(t,e){return e||D(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function(t,e){return e||D(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function(t,e){return e||D(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},a.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*e)),o},a.prototype.readInt8=function(t,e){return e||D(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},a.prototype.readInt16LE=function(t,e){e||D(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt16BE=function(t,e){e||D(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},a.prototype.readInt32LE=function(t,e){return e||D(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return e||D(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return e||D(t,4,this.length),J.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return e||D(t,4,this.length),J.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return e||D(t,8,this.length),J.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return e||D(t,8,this.length),J.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){var i=Math.pow(2,8*n)-1;L(this,t,e,n,i,0)}var o=1,a=0;for(this[e]=255&t;++a<n&&(o*=256);)this[e+a]=t/o&255;return e+n},a.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e|=0,n|=0,!r){var i=Math.pow(2,8*n)-1;L(this,t,e,n,i,0)}var o=n-1,a=1;for(this[e+o]=255&t;--o>=0&&(a*=256);)this[e+o]=t/a&255;return e+n},a.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},a.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},a.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},a.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):z(this,t,e,!0),e+4},a.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z(this,t,e,!1),e+4},a.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},a.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);L(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},a.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):F(this,t,e,!0),e+2},a.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):F(this,t,e,!1),e+2},a.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):z(this,t,e,!0),e+4},a.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):z(this,t,e,!1),e+4},a.prototype.writeFloatLE=function(t,e,n){return V(this,t,e,!0,n)},a.prototype.writeFloatBE=function(t,e,n){return V(this,t,e,!1,n)},a.prototype.writeDoubleLE=function(t,e,n){return B(this,t,e,!0,n)},a.prototype.writeDoubleBE=function(t,e,n){return B(this,t,e,!1,n)},a.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},a.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0);var o;if("number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=a.isBuffer(t)?t:W(new a(t,r).toString()),u=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%u]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(e,function(){return this}())},function(t,e,n){"use strict";function r(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}function i(t){var e=new r;e.pre=t.pre,e.body=t.body,e.post=t.post;var n=t.args.slice(0);e.argTypes=n;for(var i=0;i<n.length;++i){var a=n[i];if("array"===a||"object"==typeof a&&a.blockIndices){if(e.argTypes[i]="array",e.arrayArgs.push(i),e.arrayBlockIndices.push(a.blockIndices?a.blockIndices:0),e.shimArgs.push("array"+i),i<e.pre.args.length&&e.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<e.post.args.length&&e.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===a)e.scalarArgs.push(i),e.shimArgs.push("scalar"+i);else if("index"===a){if(e.indexArgs.push(i),i<e.pre.args.length&&e.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<e.body.args.length&&e.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<e.post.args.length&&e.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===a){if(e.shapeArgs.push(i),i<e.pre.args.length&&e.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<e.body.args.length&&e.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<e.post.args.length&&e.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof a||!a.offset)throw new Error("cwise: Unknown argument type "+n[i]);e.argTypes[i]="offset",e.offsetArgs.push({array:a.array,offset:a.offset}),e.offsetArgIndex.push(i)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,o(e)}var o=n(351);t.exports=i},function(t,e,n){"use strict";t.exports=n(367)},function(t,e,n){"use strict";function r(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function i(t){this.buf=t,this.pos=0,this.len=t.length}function o(){var t=new c(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw r(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw r(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function a(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function s(){if(this.pos+8>this.len)throw r(this,8);return new c(a(this.buf,this.pos+=4),a(this.buf,this.pos+=4))}t.exports=i;var u,l=n(37),c=l.LongBits,p=l.utf8,h="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new i(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new i(t);throw Error("illegal buffer")};i.create=l.Buffer?function(t){return(i.create=function(t){return l.Buffer.isBuffer(t)?new u(t):h(t)})(t)}:h,i.prototype._slice=l.Array.prototype.subarray||l.Array.prototype.slice,i.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,r(this,10);return t}}(),i.prototype.int32=function(){return 0|this.uint32()},i.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},i.prototype.bool=function(){return 0!==this.uint32()},i.prototype.fixed32=function(){if(this.pos+4>this.len)throw r(this,4);return a(this.buf,this.pos+=4)},i.prototype.sfixed32=function(){if(this.pos+4>this.len)throw r(this,4);return 0|a(this.buf,this.pos+=4)},i.prototype.float=function(){if(this.pos+4>this.len)throw r(this,4);var t=l.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},i.prototype.double=function(){if(this.pos+8>this.len)throw r(this,4);var t=l.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},i.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw r(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},i.prototype.string=function(){var t=this.bytes();return p.read(t,0,t.length)},i.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw r(this,t);this.pos+=t}else do if(this.pos>=this.len)throw r(this);while(128&this.buf[this.pos++]);return this},i.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!==(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},i._configure=function(t){u=t;var e=l.Long?"toLong":"toNumber";l.merge(i.prototype,{int64:function(){return o.call(this)[e](!1)},uint64:function(){return o.call(this)[e](!0)},sint64:function(){return o.call(this).zzDecode()[e](!1)},fixed64:function(){return s.call(this)[e](!0)},sfixed64:function(){return s.call(this)[e](!1)}})}},function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function i(){}function o(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function a(){this.len=0,this.head=new r(i,0,0),this.tail=this.head,this.states=null}function s(t,e,n){e[n]=255&t}function u(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t}function l(t,e){this.len=t,this.next=void 0,this.val=e}function c(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function p(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}t.exports=a;var h,f=n(37),d=f.LongBits,m=f.base64,y=f.utf8;a.create=f.Buffer?function(){return(a.create=function(){return new h})()}:function(){return new a},a.alloc=function(t){return new f.Array(t)},f.Array!==Array&&(a.alloc=f.pool(a.alloc,f.Array.prototype.subarray)),a.prototype._push=function(t,e,n){return this.tail=this.tail.next=new r(t,e,n),this.len+=e,this},l.prototype=Object.create(r.prototype),l.prototype.fn=u,a.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new l((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},a.prototype.int32=function(t){return t<0?this._push(c,10,d.fromNumber(t)):this.uint32(t)},a.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},a.prototype.uint64=function(t){var e=d.from(t);return this._push(c,e.length(),e)},a.prototype.int64=a.prototype.uint64,a.prototype.sint64=function(t){var e=d.from(t).zzEncode();return this._push(c,e.length(),e)},a.prototype.bool=function(t){return this._push(s,1,t?1:0)},a.prototype.fixed32=function(t){return this._push(p,4,t>>>0)},a.prototype.sfixed32=a.prototype.fixed32,a.prototype.fixed64=function(t){var e=d.from(t);return this._push(p,4,e.lo)._push(p,4,e.hi)},a.prototype.sfixed64=a.prototype.fixed64,a.prototype.float=function(t){return this._push(f.float.writeFloatLE,4,t)},a.prototype.double=function(t){return this._push(f.float.writeDoubleLE,8,t)};var g=f.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};a.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(s,1,0);if(f.isString(t)){var n=a.alloc(e=m.length(t));m.decode(t,n,0),t=n}return this.uint32(e)._push(g,e,t)},a.prototype.string=function(t){var e=y.length(t);return e?this.uint32(e)._push(y.write,e,t):this._push(s,1,0)},a.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new r(i,0,0),this.len=0,this},a.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new r(i,0,0),this.len=0),this},a.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},a.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},a._configure=function(t){h=t}},function(t,e,n){var r=n(374),i=n(376),o=n(379),a=n(378),s=n(377),u=n(375),l=n(380);l.alea=r,l.xor128=i,l.xorwow=o,l.xorshift7=a,l.xor4096=s,l.tychei=u,t.exports=l},function(t,e,n){var r,i;(function(n){var o=o||function(){var t=[];return{getAll:function(){return t},removeAll:function(){t=[]},add:function(e){t.push(e)},remove:function(e){var n=t.indexOf(e);n!==-1&&t.splice(n,1)},update:function(e,n){if(0===t.length)return!1;var r=0;for(e=void 0!==e?e:o.now();r<t.length;)t[r].update(e)||n?r++:t.splice(r,1);return!0}}}();"undefined"==typeof window&&"undefined"!=typeof n?o.now=function(){var t=n.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?o.now=window.performance.now.bind(window.performance):void 0!==Date.now?o.now=Date.now:o.now=function(){return(new Date).getTime()},o.Tween=function(t){var e,n=t,r={},i={},a={},s=1e3,u=0,l=!1,c=!1,p=!1,h=0,f=null,d=o.Easing.Linear.None,m=o.Interpolation.Linear,y=[],g=null,v=!1,b=null,_=null,w=null;this.to=function(t,e){return i=t,void 0!==e&&(s=e),this},this.start=function(t){o.add(this),c=!0,v=!1,f=void 0!==t?t:o.now(),f+=h;for(var e in i){if(i[e]instanceof Array){if(0===i[e].length)continue;i[e]=[n[e]].concat(i[e])}void 0!==n[e]&&(r[e]=n[e],r[e]instanceof Array==!1&&(r[e]*=1),a[e]=r[e]||0)}return this},this.stop=function(){return c?(o.remove(this),c=!1,null!==w&&w.call(n,n),this.stopChainedTweens(),this):this},this.end=function(){return this.update(f+s),this},this.stopChainedTweens=function(){for(var t=0,e=y.length;t<e;t++)y[t].stop()},this.delay=function(t){return h=t,this},this.repeat=function(t){return u=t,this},this.repeatDelay=function(t){return e=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return d=t,this},this.interpolation=function(t){return m=t,this},this.chain=function(){return y=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return b=t,this},this.onComplete=function(t){return _=t,this},this.onStop=function(t){return w=t,this},this.update=function(t){var o,c,w;if(t<f)return!0;v===!1&&(null!==g&&g.call(n,n),v=!0),c=(t-f)/s,c=c>1?1:c,w=d(c);for(o in i)if(void 0!==r[o]){var S=r[o]||0,x=i[o];x instanceof Array?n[o]=m(x,w):("string"==typeof x&&(x="+"===x.charAt(0)||"-"===x.charAt(0)?S+parseFloat(x):parseFloat(x)),"number"==typeof x&&(n[o]=S+(x-S)*w))}if(null!==b&&b.call(n,w),1===c){if(u>0){isFinite(u)&&u--;for(o in a){if("string"==typeof i[o]&&(a[o]=a[o]+parseFloat(i[o])),l){var T=a[o];a[o]=i[o],i[o]=T}r[o]=a[o]}return l&&(p=!p),f=void 0!==e?t+e:t+h,!0}null!==_&&_.call(n,n);for(var P=0,E=y.length;P<E;P++)y[P].start(f+s);return!1}return!0}},o.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){
return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2,t<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?.5*(t*t*((e+1)*t-e)):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-o.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*o.Easing.Bounce.In(2*t):.5*o.Easing.Bounce.Out(2*t-1)+.5}}},o.Interpolation={Linear:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=o.Interpolation.Utils.Linear;return e<0?a(t[0],t[1],r):e>1?a(t[n],t[n-1],n-r):a(t[i],t[i+1>n?n:i+1],r-i)},Bezier:function(t,e){for(var n=0,r=t.length-1,i=Math.pow,a=o.Interpolation.Utils.Bernstein,s=0;s<=r;s++)n+=i(1-e,r-s)*i(e,s)*t[s]*a(r,s);return n},CatmullRom:function(t,e){var n=t.length-1,r=n*e,i=Math.floor(r),a=o.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(i=Math.floor(r=n*(1+e))),a(t[(i-1+n)%n],t[i],t[(i+1)%n],t[(i+2)%n],r-i)):e<0?t[0]-(a(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[n]-(a(t[n],t[n],t[n-1],t[n-1],r-n)-t[n]):a(t[i?i-1:0],t[i],t[n<i+1?n:i+1],t[n<i+2?n:i+2],r-i)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=o.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:function(){var t=[1];return function(e){var n=1;if(t[e])return t[e];for(var r=e;r>1;r--)n*=r;return t[e]=n,n}}(),CatmullRom:function(t,e,n,r,i){var o=.5*(n-t),a=.5*(r-e),s=i*i,u=i*s;return(2*e-2*n+o+a)*u+(-3*e+3*n-2*o-a)*s+o*i+e}}},function(n){r=[],i=function(){return o}.apply(e,r),!(void 0!==i&&(t.exports=i))}(this)}).call(e,n(66))},function(t,e,n){(function(t,r){"use strict";function i(t){if(t){var e=t.length||t.byteLength,n=v.log2(e);S[n].push(t)}}function o(t){i(t.buffer)}function a(t){var t=v.nextPow2(t),e=v.log2(t),n=S[e];return n.length>0?n.pop():new ArrayBuffer(t)}function s(t){return new Uint8Array(a(t),0,t)}function u(t){return new Uint16Array(a(2*t),0,t)}function l(t){return new Uint32Array(a(4*t),0,t)}function c(t){return new Int8Array(a(t),0,t)}function p(t){return new Int16Array(a(2*t),0,t)}function h(t){return new Int32Array(a(4*t),0,t)}function f(t){return new Float32Array(a(4*t),0,t)}function d(t){return new Float64Array(a(8*t),0,t)}function m(t){return _?new Uint8ClampedArray(a(t),0,t):s(t)}function y(t){return new DataView(a(t),0,t)}function g(t){t=v.nextPow2(t);var e=v.log2(t),n=x[e];return n.length>0?n.pop():new r(t)}var v=n(148),b=n(356);t.__TYPEDARRAY_POOL||(t.__TYPEDARRAY_POOL={UINT8:b([32,0]),UINT16:b([32,0]),UINT32:b([32,0]),INT8:b([32,0]),INT16:b([32,0]),INT32:b([32,0]),FLOAT:b([32,0]),DOUBLE:b([32,0]),DATA:b([32,0]),UINT8C:b([32,0]),BUFFER:b([32,0])});var _="undefined"!=typeof Uint8ClampedArray,w=t.__TYPEDARRAY_POOL;w.UINT8C||(w.UINT8C=b([32,0])),w.BUFFER||(w.BUFFER=b([32,0]));var S=w.DATA,x=w.BUFFER;e.free=function(t){if(r.isBuffer(t))x[v.log2(t.length)].push(t);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(t)&&(t=t.buffer),!t)return;var e=t.length||t.byteLength,n=0|v.log2(e);S[n].push(t)}},e.freeUint8=e.freeUint16=e.freeUint32=e.freeInt8=e.freeInt16=e.freeInt32=e.freeFloat32=e.freeFloat=e.freeFloat64=e.freeDouble=e.freeUint8Clamped=e.freeDataView=o,e.freeArrayBuffer=i,e.freeBuffer=function(t){x[v.log2(t.length)].push(t)},e.malloc=function(t,e){if(void 0===e||"arraybuffer"===e)return a(t);switch(e){case"uint8":return s(t);case"uint16":return u(t);case"uint32":return l(t);case"int8":return c(t);case"int16":return p(t);case"int32":return h(t);case"float":case"float32":return f(t);case"double":case"float64":return d(t);case"uint8_clamped":return m(t);case"buffer":return g(t);case"data":case"dataview":return y(t);default:return null}return null},e.mallocArrayBuffer=a,e.mallocUint8=s,e.mallocUint16=u,e.mallocUint32=l,e.mallocInt8=c,e.mallocInt16=p,e.mallocInt32=h,e.mallocFloat32=e.mallocFloat=f,e.mallocFloat64=e.mallocDouble=d,e.mallocUint8Clamped=m,e.mallocDataView=y,e.mallocBuffer=g,e.clearCache=function(){for(var t=0;t<32;++t)w.UINT8[t].length=0,w.UINT16[t].length=0,w.UINT32[t].length=0,w.INT8[t].length=0,w.INT16[t].length=0,w.INT32[t].length=0,w.FLOAT[t].length=0,w.DOUBLE[t].length=0,w.UINT8C[t].length=0,S[t].length=0,x[t].length=0}}).call(e,function(){return this}(),n(149).Buffer)},function(t,e){"use strict";function n(t,e){for(var n=1,r=t.length,i=t[0],o=t[0],a=1;a<r;++a)if(o=i,i=t[a],e(i,o)){if(a===n){n++;continue}t[n++]=i}return t.length=n,t}function r(t){for(var e=1,n=t.length,r=t[0],i=t[0],o=1;o<n;++o,i=r)if(i=r,r=t[o],r!==i){if(o===e){e++;continue}t[e++]=r}return t.length=e,t}function i(t,e,i){return 0===t.length?t:e?(i||t.sort(e),n(t,e)):(i||t.sort(),r(t))}t.exports=i},function(t,e,n){var r,i;r=[n(4),n(105),n(38)],i=function(t){"use strict";return t.AmplitudeEnvelope=function(){t.Envelope.apply(this,arguments),this.input=this.output=new t.Gain,this._sig.connect(this.output.gain)},t.extend(t.AmplitudeEnvelope,t.Envelope),t.AmplitudeEnvelope.prototype.dispose=function(){return this.input.dispose(),this.input=null,t.Envelope.prototype.dispose.call(this),this},t.AmplitudeEnvelope}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(18),n(38)],i=function(t){"use strict";return t.Volume=function(){var e=this.optionsObject(arguments,["volume"],t.Volume.defaults);this.output=this.input=new t.Gain(e.volume,t.Type.Decibels),this.volume=this.output.gain,this._readOnly("volume")},t.extend(t.Volume),t.Volume.defaults={volume:0},t.Volume.prototype.dispose=function(){return this.input.dispose(),t.prototype.dispose.call(this),this._writable("volume"),this.volume.dispose(),this.volume=null,this},t.Volume}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(159)],i=function(t){"use strict";t.Master=function(){t.call(this),this._unmutedVolume=1,this._muted=!1,this._volume=this.output=new t.Volume,this.volume=this._volume.volume,this._readOnly("volume"),this.input.chain(this.output,this.context.destination)},t.extend(t.Master),t.Master.defaults={volume:0,mute:!1},Object.defineProperty(t.Master.prototype,"mute",{get:function(){return this._muted},set:function(t){!this._muted&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-(1/0)):this._muted&&!t&&(this.volume.value=this._unmutedVolume),this._muted=t}}),t.Master.prototype.chain=function(){this.input.disconnect(),this.input.chain.apply(this.input,arguments),arguments[arguments.length-1].connect(this.output)},t.Master.prototype.dispose=function(){t.prototype.dispose.call(this),this._writable("volume"),this._volume.dispose(),this._volume=null,this.volume=null},t.prototype.toMaster=function(){return this.connect(t.Master),this},AudioNode.prototype.toMaster=function(){return this.connect(t.Master),this};var e=t.Master;return t._initAudioContext(function(){t.prototype.isUndef(t.Master)?(e.prototype.dispose.call(t.Master),e.call(t.Master)):t.Master=new e}),t.Master}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(20)],i=function(t){"use strict";return t.Param=function(){var e=this.optionsObject(arguments,["param","units","convert"],t.Param.defaults);this._param=this.input=e.param,this.units=e.units,this.convert=e.convert,this.overridden=!1,this.isUndef(e.value)||(this.value=e.value)},t.extend(t.Param),t.Param.defaults={units:t.Type.Default,convert:!0,param:void 0},Object.defineProperty(t.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(t){var e=this._fromUnits(t);this._param.value=e}}),t.Param.prototype._fromUnits=function(e){if(!this.convert&&!this.isUndef(this.convert))return e;switch(this.units){case t.Type.Time:return this.toSeconds(e);case t.Type.Frequency:return this.toFrequency(e);case t.Type.Decibels:return this.dbToGain(e);case t.Type.NormalRange:return Math.min(Math.max(e,0),1);case t.Type.AudioRange:return Math.min(Math.max(e,-1),1);case t.Type.Positive:return Math.max(e,0);default:return e}},t.Param.prototype._toUnits=function(e){if(!this.convert&&!this.isUndef(this.convert))return e;switch(this.units){case t.Type.Decibels:return this.gainToDb(e);default:return e}},t.Param.prototype._minOutput=1e-5,t.Param.prototype.setValueAtTime=function(t,e){return t=this._fromUnits(t),this._param.setValueAtTime(t,this.toSeconds(e)),this},t.Param.prototype.setRampPoint=function(t){t=this.defaultArg(t,this.now());var e=this._param.value;return this._param.setValueAtTime(e,t),this},t.Param.prototype.linearRampToValueAtTime=function(t,e){return t=this._fromUnits(t),this._param.linearRampToValueAtTime(t,this.toSeconds(e)),this},t.Param.prototype.exponentialRampToValueAtTime=function(t,e){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),this._param.exponentialRampToValueAtTime(t,this.toSeconds(e)),this},t.Param.prototype.exponentialRampToValue=function(t,e){var n=this.now(),r=this.value;return this.setValueAtTime(Math.max(r,this._minOutput),n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.linearRampToValue=function(t,e){var n=this.now();return this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this},t.Param.prototype.setTargetAtTime=function(t,e,n){return t=this._fromUnits(t),t=Math.max(this._minOutput,t),n=Math.max(this._minOutput,n),this._param.setTargetAtTime(t,this.toSeconds(e),n),this},t.Param.prototype.setValueCurveAtTime=function(t,e,n){for(var r=0;r<t.length;r++)t[r]=this._fromUnits(t[r]);return this._param.setValueCurveAtTime(t,this.toSeconds(e),this.toSeconds(n)),this},t.Param.prototype.cancelScheduledValues=function(t){return this._param.cancelScheduledValues(this.toSeconds(t)),this},t.Param.prototype.rampTo=function(e,n){return n=this.defaultArg(n,0),this.units===t.Type.Frequency||this.units===t.Type.BPM?this.exponentialRampToValue(e,n):this.linearRampToValue(e,n),this},t.Param.prototype.dispose=function(){return t.prototype.dispose.call(this),this._param=null,this},t.Param}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(402),n(18)],i=function(t){"use strict";return t.Monophonic=function(e){e=this.defaultArg(e,t.Monophonic.defaults),t.Instrument.call(this,e),this.portamento=e.portamento},t.extend(t.Monophonic,t.Instrument),t.Monophonic.defaults={portamento:0},t.Monophonic.prototype.triggerAttack=function(t,e,n){return e=this.toSeconds(e),this._triggerEnvelopeAttack(e,n),this.setNote(t,e),this},t.Monophonic.prototype.triggerRelease=function(t){return this._triggerEnvelopeRelease(t),this},t.Monophonic.prototype._triggerEnvelopeAttack=function(){},t.Monophonic.prototype._triggerEnvelopeRelease=function(){},t.Monophonic.prototype.setNote=function(t,e){if(e=this.toSeconds(e),this.portamento>0){var n=this.frequency.value;this.frequency.setValueAtTime(n,e);var r=this.toSeconds(this.portamento);this.frequency.exponentialRampToValueAtTime(t,e+r)}else this.frequency.setValueAtTime(t,e);return this},t.Monophonic}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(18),n(106)],i=function(t){"use strict";return t.TimelineSignal=function(){var e=this.optionsObject(arguments,["value","units"],t.Signal.defaults);t.Signal.apply(this,e),e.param=this._param,t.Param.call(this,e),this._events=new t.Timeline(10),this._initial=this._fromUnits(this._param.value)},t.extend(t.TimelineSignal,t.Param),t.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(t.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(t){var e=this._fromUnits(t);this._initial=e,this._param.value=e}}),t.TimelineSignal.prototype.setValueAtTime=function(e,n){return e=this._fromUnits(e),n=this.toSeconds(n),this._events.addEvent({type:t.TimelineSignal.Type.Set,value:e,time:n}),this._param.setValueAtTime(e,n),this},t.TimelineSignal.prototype.linearRampToValueAtTime=function(e,n){return e=this._fromUnits(e),n=this.toSeconds(n),this._events.addEvent({type:t.TimelineSignal.Type.Linear,value:e,time:n}),this._param.linearRampToValueAtTime(e,n),this},t.TimelineSignal.prototype.exponentialRampToValueAtTime=function(e,n){var r=this._searchBefore(n);r&&0===r.value&&this.setValueAtTime(this._minOutput,r.time),e=this._fromUnits(e);var i=Math.max(e,this._minOutput);return n=this.toSeconds(n),this._events.addEvent({type:t.TimelineSignal.Type.Exponential,value:i,time:n}),e<this._minOutput?(this._param.exponentialRampToValueAtTime(this._minOutput,n-1/t.context.sampleRate),this.setValueAtTime(0,n)):this._param.exponentialRampToValueAtTime(e,n),this},t.TimelineSignal.prototype.setTargetAtTime=function(e,n,r){return e=this._fromUnits(e),e=Math.max(this._minOutput,e),r=Math.max(this._minOutput,r),n=this.toSeconds(n),this._events.addEvent({type:t.TimelineSignal.Type.Target,value:e,time:n,constant:r}),this._param.setTargetAtTime(e,n,r),this},t.TimelineSignal.prototype.cancelScheduledValues=function(t){return this._events.cancel(t),this._param.cancelScheduledValues(this.toSeconds(t)),this},t.TimelineSignal.prototype.setRampPoint=function(e){e=this.toSeconds(e);var n=this.getValueAtTime(e),r=this._searchBefore(e);if(r&&r.time===e)this.cancelScheduledValues(e+this.sampleTime);else{var i=this._searchAfter(e);i&&(this.cancelScheduledValues(e),i.type===t.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(n,e):i.type===t.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(n,e)),this.setValueAtTime(n,e)}return this},t.TimelineSignal.prototype.linearRampToValueBetween=function(t,e,n){return this.setRampPoint(e),this.linearRampToValueAtTime(t,n),this},t.TimelineSignal.prototype.exponentialRampToValueBetween=function(t,e,n){return this.setRampPoint(e),this.exponentialRampToValueAtTime(t,n),this},t.TimelineSignal.prototype._searchBefore=function(t){return this._events.getEvent(t)},t.TimelineSignal.prototype._searchAfter=function(t){return this._events.getEventAfter(t)},t.TimelineSignal.prototype.getValueAtTime=function(e){var n=this._searchAfter(e),r=this._searchBefore(e),i=this._initial;if(null===r)i=this._initial;else if(r.type===t.TimelineSignal.Type.Target){var o,a=this._events.getEventBefore(r.time);o=null===a?this._initial:a.value,i=this._exponentialApproach(r.time,o,r.value,r.constant,e)}else i=null===n?r.value:n.type===t.TimelineSignal.Type.Linear?this._linearInterpolate(r.time,r.value,n.time,n.value,e):n.type===t.TimelineSignal.Type.Exponential?this._exponentialInterpolate(r.time,r.value,n.time,n.value,e):r.value;return i},t.TimelineSignal.prototype.connect=t.SignalBase.prototype.connect,t.TimelineSignal.prototype._exponentialApproach=function(t,e,n,r,i){return n+(e-n)*Math.exp(-(i-t)/r)},t.TimelineSignal.prototype._linearInterpolate=function(t,e,n,r,i){return e+(r-e)*((i-t)/(n-t))},t.TimelineSignal.prototype._exponentialInterpolate=function(t,e,n,r,i){return e=Math.max(this._minOutput,e),e*Math.pow(r/e,(i-t)/(n-t))},t.TimelineSignal.prototype.dispose=function(){t.Signal.prototype.dispose.call(this),t.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},t.TimelineSignal}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(45),n(165),n(414),n(412),n(411),n(413)],i=function(t){"use strict";t.OmniOscillator=function(){var e=this.optionsObject(arguments,["frequency","type"],t.OmniOscillator.defaults);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._sourceType=void 0,this._oscillator=null,this.type=e.type,this._readOnly(["frequency","detune"]),this.set(e)},t.extend(t.OmniOscillator,t.Oscillator),t.OmniOscillator.defaults={frequency:440,detune:0,type:"sine",phase:0};var e={Pulse:"PulseOscillator",PWM:"PWMOscillator",Osc:"Oscillator",FM:"FMOscillator",AM:"AMOscillator",Fat:"FatOscillator"};return t.OmniOscillator.prototype._start=function(t){this._oscillator.start(t)},t.OmniOscillator.prototype._stop=function(t){this._oscillator.stop(t)},Object.defineProperty(t.OmniOscillator.prototype,"type",{get:function(){var t="";return this._sourceType===e.FM?t="fm":this._sourceType===e.AM?t="am":this._sourceType===e.Fat&&(t="fat"),t+this._oscillator.type},set:function(t){"fm"===t.substr(0,2)?(this._createNewOscillator(e.FM),this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator(e.AM),this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator(e.Fat),this._oscillator.type=t.substr(3)):"pwm"===t?this._createNewOscillator(e.PWM):"pulse"===t?this._createNewOscillator(e.Pulse):(this._createNewOscillator(e.Osc),this._oscillator.type=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"partials",{get:function(){return this._oscillator.partials},set:function(t){this._oscillator.partials=t}}),t.OmniOscillator.prototype.set=function(e,n){return"type"===e?this.type=n:this.isObject(e)&&e.hasOwnProperty("type")&&(this.type=e.type),t.prototype.set.apply(this,arguments),this},t.OmniOscillator.prototype._createNewOscillator=function(e){if(e!==this._sourceType){this._sourceType=e;var n=t[e],r=this.now()+this.blockTime;if(null!==this._oscillator){var i=this._oscillator;i.stop(r),setTimeout(function(){i.dispose(),i=null},1e3*this.blockTime)}this._oscillator=new n,this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this.state===t.State.Started&&this._oscillator.start(r)}},Object.defineProperty(t.OmniOscillator.prototype,"phase",{get:function(){return this._oscillator.phase},set:function(t){this._oscillator.phase=t}}),Object.defineProperty(t.OmniOscillator.prototype,"width",{get:function(){if(this._sourceType===e.Pulse)return this._oscillator.width}}),Object.defineProperty(t.OmniOscillator.prototype,"count",{get:function(){if(this._sourceType===e.Fat)return this._oscillator.count},set:function(t){this._sourceType===e.Fat&&(this._oscillator.count=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"spread",{get:function(){if(this._sourceType===e.Fat)return this._oscillator.spread},set:function(t){this._sourceType===e.Fat&&(this._oscillator.spread=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationType",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM)return this._oscillator.modulationType},set:function(t){this._sourceType!==e.FM&&this._sourceType!==e.AM||(this._oscillator.modulationType=t)}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationIndex",{get:function(){if(this._sourceType===e.FM)return this._oscillator.modulationIndex}}),Object.defineProperty(t.OmniOscillator.prototype,"harmonicity",{get:function(){if(this._sourceType===e.FM||this._sourceType===e.AM)return this._oscillator.harmonicity}}),Object.defineProperty(t.OmniOscillator.prototype,"modulationFrequency",{get:function(){if(this._sourceType===e.PWM)return this._oscillator.modulationFrequency}}),t.OmniOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.detune.dispose(),this.detune=null,this.frequency.dispose(),this.frequency=null,this._oscillator.dispose(),this._oscillator=null,this._sourceType=null,this},t.OmniOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(45),n(18),n(69)],i=function(t){"use strict";return t.PulseOscillator=function(){var e=this.optionsObject(arguments,["frequency","width"],t.Oscillator.defaults);t.Source.call(this,e),this.width=new t.Signal(e.width,t.Type.NormalRange),this._widthGate=this.context.createGain(),this._sawtooth=new t.Oscillator({frequency:e.frequency,detune:e.detune,type:"sawtooth",phase:e.phase}),this.frequency=this._sawtooth.frequency,this.detune=this._sawtooth.detune,this._thresh=new t.WaveShaper(function(t){return t<0?-1:1}),this._sawtooth.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),this._readOnly(["width","frequency","detune"])},t.extend(t.PulseOscillator,t.Oscillator),t.PulseOscillator.defaults={frequency:440,detune:0,phase:0,width:.2},t.PulseOscillator.prototype._start=function(t){t=this.toSeconds(t),this._sawtooth.start(t),this._widthGate.gain.setValueAtTime(1,t)},t.PulseOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._sawtooth.stop(t),this._widthGate.gain.setValueAtTime(0,t)},Object.defineProperty(t.PulseOscillator.prototype,"phase",{get:function(){return this._sawtooth.phase},set:function(t){this._sawtooth.phase=t}}),Object.defineProperty(t.PulseOscillator.prototype,"type",{get:function(){return"pulse"}}),Object.defineProperty(t.PulseOscillator.prototype,"partials",{get:function(){return[]}}),t.PulseOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._sawtooth.dispose(),this._sawtooth=null,this._writable(["width","frequency","detune"]),this.width.dispose(),this.width=null,this._widthGate.disconnect(),this._widthGate=null,this._widthGate=null,this._thresh.disconnect(),this._thresh=null,this.frequency=null,this.detune=null,this},t.PulseOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(54),n(39),n(155)],i=function(t,e,n){var r=e.tileMargin,i=function(t,e){this.tile=t,this._offsetX=0,this._offsetY=0,this._currentX=0,this._currentY=0,this._tween=null,this.GRID=e};return i.prototype.draw=function(t,n,r,i,o,a){this._offsetX===o.x&&this._offsetY===o.y||this.move(o.x,o.y,a);var s=(this.tile.x+this._currentX)%e.gridWidth,u=(this.tile.y+this._currentY)%e.gridHeight;if(this._drawRect(t,s,u,n,r,i),this.tile.y+this._currentY>e.gridHeight-1&&this.tile.y+this._currentY<e.gridHeight){var l=this._currentY%1;l-=1,this._drawRect(t,s,l,n,r,i)}else if(this.tile.x+this._currentX>e.gridWidth-1&&this.tile.x+this._currentX<e.gridWidth){var c=this._currentX%1;c-=1,this._drawRect(t,c,u,n,r,i)}},i.prototype._drawRect=function(n,i,o,a,s,u){n.globalAlpha=.5,(this.tile.x+this._offsetX)%e.gridWidth===u?n.fillStyle=t.darkGrey:n.fillStyle=t.grey,n.beginPath(),n.fillRect(i*a+r,o*s+r,a-2*r,s-2*r),n.globalAlpha=1},i.prototype.move=function(t,r,i){var o=this._currentY%1,a=this._currentX%1;"down"===i&&this._offsetY===e.gridHeight-1&&0===r?this._currentY=-1-o:"up"===i&&0===this._offsetY&&r===e.gridHeight-1?this._currentY=e.gridHeight+o:"up"===i&&0===this._offsetY?this._currentY=e.gridHeight+o:"left"===i&&0===this._offsetX?this._currentX=e.gridWidth+a:"right"===i&&this._offsetX===e.gridWidth-1&&0===t&&(this._currentX=-1-a),this._tween&&this._tween.stop();var s=this;this._tween=new n.Tween({x:this._currentX,y:this._currentY}).to({x:t,y:r},200).onUpdate(function(){s._currentX=this.x,s._currentY=this.y,s.GRID._needsUpdate=!0}).start().easing(n.Easing.Quintic.InOut),this._offsetX=t,this._offsetY=r},i.prototype.isInColumn=function(t){return(this.tile.x+this._offsetX)%e.gridWidth===t},i.prototype.getRow=function(){return(this.tile.y+this._offsetY)%e.gridHeight},i.prototype.dispose=function(){this._tween&&this._tween.stop(),this._tween=null,this.tile=null,this.GRID=null},i}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(54),n(39)],i=function(t,e){var n=e.tileMargin,r=function(t,e,n,r,i){this.x=t,this.y=e,this._hovered=n||!1,void 0===r||r!==!0||void 0===i?(this.ml=!1,this.prob=null):(this.ml=!0,this.prob=i)};return r.prototype.draw=function(r,i,o,a){var s=e.notes[this.y];this.ml===!0?r.fillStyle=t.ml:e.singleColor===!1?r.fillStyle=t[s]:r.fillStyle=t.singleColor,r.beginPath(),r.fillRect(this.x*i+n,this.y*o+n,i-2*n,o-2*n),(this._hovered||this.x===a)&&(r.fillStyle="rgba(255, 255, 255, 0.4)",r.beginPath(),r.fillRect(this.x*i+n,this.y*o+n,i-2*n,o-2*n))},r.prototype.setPosition=function(t,e){this.x=t,this.y=e},r.prototype.hover=function(){this._hovered=!0},r.prototype.unhover=function(){this._hovered=!1},r.prototype.isHovered=function(){return this._hovered},r}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(383),n(170),n(23),n(169),n(70)],i=function(t,e,n,r,i){var o=function(t){this._element=document.createElement("div"),this._element.id="Bottom",t.appendChild(this._element),this._controlsContainer=document.createElement("div"),this._controlsContainer.id="Controls",this._element.appendChild(this._controlsContainer),this._playButton=document.createElement("div"),this._playButton.id="PlayButton",this._playButton.classList.add("Button"),this._playButton.classList.add("icon-svg_play"),this._controlsContainer.appendChild(this._playButton),this._playButton.addEventListener("click",this._playClicked.bind(this)),this._MLButton=document.createElement("div"),this._MLButton.id="MLButton",this._MLButton.classList.add("passive"),this._MLButton.classList.add("Button"),this._MLButton.classList.add("icon-svg_computer"),this._controlsContainer.appendChild(this._MLButton),this._MLButton.addEventListener("click",this._MLClicked.bind(this)),this.MLActive=!1,this._harmony=document.createElement("div"),this._harmony.id="Harmony",this._harmony.classList.add("Button"),this._controlsContainer.appendChild(this._harmony),this._harmony.addEventListener("click",this._directionClicked.bind(this)),this._directions=["none","right"],this._directionIndex=0,this.slider=new e(this._controlsContainer),this.onDirection=function(){},this.removeML=function(){},this.generatePattern=function(){},this._orientation=new r(this._rotated.bind(this))};return o.prototype._MLClicked=function(t){t.preventDefault(),console.log("ML Button Pressed"),this.MLActive===!1?(this._MLButton.classList.remove("passive"),this._MLButton.classList.add("active"),this.MLActive=!0,this.generatePattern()):(this._MLButton.classList.remove("active"),this._MLButton.classList.add("passive"),this.MLActive=!1,this.removeML())},o.prototype._playClicked=function(t){t.preventDefault(),"started"===n.state?(this._playButton.classList.remove("Playing"),this._playButton.classList.add("icon-svg_play"),this._playButton.classList.remove("icon-svg_pause"),n.stop()):(this._playButton.classList.add("Playing"),this._playButton.classList.remove("icon-svg_play"),this._playButton.classList.add("icon-svg_pause"),n.start("+0.1"))},o.prototype._rotated=function(){"started"===n.state&&(this._playButton.classList.remove("Playing"),this._playButton.classList.add("icon-svg_play"),this._playButton.classList.remove("icon-svg_pause"),n.stop())},o.prototype._directionClicked=function(t){t.preventDefault();var e=this._directions[this._directionIndex];this._harmony.classList.remove(e),this._directionIndex=(this._directionIndex+1)%this._directions.length;var n=this._directions[this._directionIndex];this._harmony.classList.add(n),this.onDirection(n)},o}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(23)],i=function(t){var e=function(t){window.addEventListener("orientationchange",this._changed.bind(this)),window.screen&&window.screen.orientation&&window.screen.orientation.addEventListener("change",this._screenChange.bind(this)),this._callback=t};return e.prototype._changed=function(){90===Math.abs(window.orientation)&&"started"===t.state&&this._callback()},e.prototype._screenChange=function(){90===Math.abs(window.screen.orientation.angle)&&"started"===t.state&&this._callback()},e}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(171),n(23)],i=function(t,e){var n=function(n){this._min=70,this._max=200,this.sliderContainer=document.createElement("div"),this.sliderContainer.id="SliderContainer",n.appendChild(this.sliderContainer),this.slider=new t(this.sliderContainer,this._min,this._max,e.bpm.value),this.slider.onchange=this._changed.bind(this),this.rabbit=document.createElement("div"),this.rabbit.id="Hare",this.rabbit.classList.add("icon-svg_fast_man"),this.sliderContainer.appendChild(this.rabbit),this.tortoise=document.createElement("div"),this.tortoise.id="Tortoise",this.tortoise.classList.add("icon-svg_slow_man"),this.sliderContainer.appendChild(this.tortoise),this.input=document.createElement("input"),this.input.type="number",this.input.id="manual-tempo",this.input.value=this.slider.getValue(),this.input.min=70,this.input.max=200,this.input.addEventListener("input",this._onInputChange.bind(this)),this.input.addEventListener("blur",this._resetInput.bind(this)),this.sliderContainer.appendChild(this.input)};return n.prototype._useMinMax=function(t){return t>this._max?this._max:t<this._min?this._min:t},n.prototype._resetInput=function(){var t=this.input.value;this.input.value=this._useMinMax(t)},n.prototype._onInputChange=function(){var t=this.input.value;this.slider.setValue(t),this._changed(t)},n.prototype._changed=function(t){this.input.value=t,e.bpm.value=this._useMinMax(t)},n}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(386)],i=function(t){var e=function(t,e,n,r){this._min=e||0,this._max=n||100,this._container=document.createElement("div"),this._container.classList.add("Slider"),t.appendChild(this._container),this._range=document.createElement("input"),this._range.type="range",this._range.id="Range",this._range.min=e,this._range.max=n,this._container.appendChild(this._range),this._range.addEventListener("input",this._change.bind(this)),this._rail=document.createElement("div"),this._rail.id="Rail",this._container.appendChild(this._rail),this._fill=document.createElement("div"),this._fill.id="Fill",this._rail.appendChild(this._fill),this._handle=document.createElement("div"),this._handle.id="Handle",this._container.appendChild(this._handle),this._value=0,this.onchange=function(){},this.setValue(r||50),window.addEventListener("resize",this._update.bind(this))};return e.prototype._change=function(){this._update(),this._value=parseFloat(this._range.value),this.onchange(this._range.value)},e.prototype._update=function(){var t=(this._range.value-this._min)/(this._max-this._min),e=this._handle.offsetWidth*t,n=this._handle.offsetWidth/2,r=t*this._container.offsetWidth;this._fill.style.width=(r-e+n).toString()+"px",this._handle.style.left=(r-e).toString()+"px"},e.prototype.setValue=function(t){this._value=t,this._range.value=t,this._update()},e.prototype.getValue=function(){return this._value},e}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(405),n(160),n(39),n(23),n(404)],i=function(t,e,n,r,i){var o=function(){this.melodyPlayer=new i(3,t).set({volume:-4,oscillator:{type:"triangle17"},envelope:{attack:.01,decay:.1,sustain:.2,release:1.7}}).toMaster(),this.melodyPlayer.stealVoices=!1,this.harmonyPlayer=new i(2,t).set({volume:-8,oscillator:{type:"triangle11"},envelope:{attack:.01,decay:.1,sustain:.2,release:1.7}}).toMaster()};return o.prototype.play=function(t,e){if(t.melody!==-1){var n=this._indexToNoteName(t.melody);
this.melodyPlayer.triggerAttackRelease(n,"8n",e,this._randomVelocity())}if(t.harmony!==-1){var r=this._indexToNoteName(t.harmony);this.harmonyPlayer.triggerAttackRelease(r,"8n",e,this._randomVelocity())}},o.prototype._indexToNoteName=function(t){var e=n.pitches.length-t-1,r=n.pitches[e];return r},o.prototype._randomVelocity=function(){return.8*(.5*Math.random()+.5)},o.prototype.tap=function(t){if("stopped"===r.state){var e=n.pitches.length-t-1,i=n.pitches[e];this.melodyPlayer.triggerAttackRelease(i,"8t","+0.01",this._randomVelocity())}},o}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(401),n(39)],i=function(t,e){var n=function(n){for(var r=[],i=0;i<e.gridWidth;i++)r.push(i);this.seq=new t(n,r,"8n").start(0)};return n}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){"use strict";function r(t){var e=a.parse(t),n=s.NoteSequence.create();n.ticksPerQuarter=e.header.PPQ,n.sourceInfo=s.NoteSequence.SourceInfo.create({parser:s.NoteSequence.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:s.NoteSequence.SourceInfo.EncodingType.MIDI}),e.header.timeSignature?n.timeSignatures.push(s.NoteSequence.TimeSignature.create({time:0,numerator:e.header.timeSignature[0],denominator:e.header.timeSignature[1]})):n.timeSignatures.push(s.NoteSequence.TimeSignature.create({time:0,numerator:4,denominator:4})),n.tempos.push(s.NoteSequence.Tempo.create({time:0,qpm:e.header.bpm}));for(var r=-1,i=0,o=e.tracks;i<o.length;i++){var l=o[i];l.notes.length>0&&(r+=1);for(var c=0,p=l.notes;c<p.length;c++){var h=p[c],f=h.time,d=h.duration,m=f+d;n.notes.push(s.NoteSequence.Note.create({instrument:r,program:l.instrumentNumber,startTime:f,endTime:m,pitch:h.midi,velocity:Math.floor(h.velocity*u.MIDI_VELOCITIES),isDrum:l.isPercussion})),m>n.totalTime&&(n.totalTime=m)}}return n}function i(t){if(l.isQuantizedSequence(t)&&(t=l.unquantizeSequence(t)),t.tempos&&0!==t.tempos.length||(t.tempos=[{time:0,qpm:u.DEFAULT_QUARTERS_PER_MINUTE}]),t.timeSignatures&&0!==t.timeSignatures.length||(t.timeSignatures=[{time:0,numerator:4,denominator:4}]),1!==t.tempos.length||0!==t.tempos[0].time)throw new c("NoteSequence must have exactly 1 tempo at time 0");if(1!==t.timeSignatures.length||0!==t.timeSignatures[0].time)throw new c("NoteSequence must have exactly 1 time signature at time 0");for(var e={header:{bpm:t.tempos[0].qpm,PPQ:t.ticksPerQuarter?t.ticksPerQuarter:u.DEFAULT_TICKS_PER_QUARTER,timeSignature:[t.timeSignatures[0].numerator,t.timeSignatures[0].denominator]},tracks:[]},n=new Map,r=0,i=t.notes;r<i.length;r++){var o=i[r],s=o.instrument?o.instrument:0;n.has(s)||n.set(s,[]),n.get(s).push(o)}for(var p=Array.from(n.keys()).sort(function(t,e){return t-e}),h=0;h<p.length;h++){if(h!==p[h])throw new c("Instrument list must be continuous and start at 0");var f=n.get(h),d={id:h,notes:[],isPercussion:void 0!==f[0].isDrum&&f[0].isDrum,channelNumber:f[0].isDrum?u.DRUM_CHANNEL:u.DEFAULT_CHANNEL,instrumentNumber:void 0===f[0].program?u.DEFAULT_PROGRAM:f[0].program};d.notes=f.map(function(t){var e=void 0===t.velocity?u.DEFAULT_VELOCITY:t.velocity;return{midi:t.pitch,time:t.startTime,duration:t.endTime-t.startTime,velocity:(e+1)/u.MIDI_VELOCITIES}}),e.tracks.push(d)}return new Uint8Array(a.fromJSON(e).toArray())}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=n(362),s=n(32),u=n(21),l=n(47),c=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.setPrototypeOf(r,n.prototype),r}return o(e,t),e}(Error);e.MidiConversionError=c,e.midiToSequenceProto=r,e.sequenceProtoToMidi=i},function(t,e,n){"use strict";function r(t,e){return t.quantizedStartStep<e.quantizedStartStep?-1:t.quantizedStartStep>e.quantizedStartStep?1:t.pitch<e.pitch?-1:1}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(104),u=n(72),l=n(21),c=n(55),p=n(177),h=function(){function t(){}return t}();e.BasePlayerCallback=h;var f=function(){function t(t,e){void 0===t&&(t=!1),this.playClick=t,this.callbackObject=e,this.desiredQPM=void 0}return t.prototype.setTempo=function(t){this.desiredQPM=t,"started"===s.Transport.state&&(s.Transport.bpm.value=t)},t.prototype.makeClickSequence=function(t){for(var e=u.sequences.clone(t),n=e.notes.map(function(t){return t.quantizedEndStep}),i=Math.max.apply(Math,n),o=0;o<i;o+=4){var a={pitch:o%16===0?l.LO_CLICK_PITCH:l.HI_CLICK_PITCH,quantizedStartStep:o,isDrum:!0,quantizedEndStep:o+1};e.notes.push(a)}return e.notes.sort(r),e},t.prototype.resumeContext=function(){s.context.resume()},t.prototype.start=function(t,e){var n=this;this.resumeContext();var r=u.sequences.isQuantizedSequence(t);if(this.playClick&&r&&(t=this.makeClickSequence(t)),e?s.Transport.bpm.value=e:t.tempos&&t.tempos.length>0&&t.tempos[0].qpm>0?s.Transport.bpm.value=t.tempos[0].qpm:s.Transport.bpm.value=l.DEFAULT_QUARTERS_PER_MINUTE,r)t=u.sequences.unquantizeSequence(t,e);else if(e)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");return this.currentPart=new s.Part(function(t,e){(n.playClick||e.pitch!==l.LO_CLICK_PITCH&&e.pitch!==l.HI_CLICK_PITCH)&&n.playNote(t,e),n.callbackObject&&s.Draw.schedule(function(){n.callbackObject.run(e,t)},t)},t.notes.map(function(t){return[t.startTime,t]})),this.desiredQPM&&(s.Transport.bpm.value=this.desiredQPM),this.currentPart.start(),"started"!==s.Transport.state&&s.Transport.start(),new Promise(function(e){n.scheduledStop=s.Transport.schedule(function(){n.stop(),e(),n.callbackObject&&n.callbackObject.stop()},"+"+t.totalTime)})},t.prototype.stop=function(){this.currentPart&&(this.currentPart.stop(),this.currentPart=null),s.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0},t.prototype.isPlaying=function(){return!!this.currentPart},t}();e.BasePlayer=f;var d=function(){function t(){var t=this;this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new s.MembraneSynth).toMaster(),this.tomLow=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomMid=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomHigh=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.closedHihat=new s.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.openHihat=new s.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.ride=(new s.MetalSynth).toMaster(),this.crash=new s.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toMaster(),this.snare=new s.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toMaster(),this.loClick=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new s.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.pitchPlayers=[function(e,n){return void 0===n&&(n=1),t.kick.triggerAttackRelease("C2","8n",e,n)},function(e,n){return void 0===n&&(n=1),t.snare.triggerAttackRelease("16n",e,n)},function(e,n){return void 0===n&&(n=1),t.closedHihat.triggerAttack(e,.3,n)},function(e,n){return void 0===n&&(n=1),t.openHihat.triggerAttack(e,.3,n)},function(e,n){return void 0===n&&(n=.5),t.tomLow.triggerAttack("G3",e,n)},function(e,n){return void 0===n&&(n=.5),t.tomMid.triggerAttack("C4",e,n)},function(e,n){return void 0===n&&(n=.5),t.tomHigh.triggerAttack("F4",e,n)},function(e,n){return void 0===n&&(n=1),t.crash.triggerAttack(e,1,n)},function(e,n){return void 0===n&&(n=1),t.ride.triggerAttack(e,.5,n)},function(e,n){return void 0===n&&(n=.5),t.loClick.triggerAttack("G5",e,n)},function(e,n){return void 0===n&&(n=.5),t.hiClick.triggerAttack("C6",e,n)}];for(var e=function(e){c.DEFAULT_DRUM_PITCH_CLASSES[e].forEach(function(n){t.DRUM_PITCH_TO_CLASS.set(n,e)})},n=0;n<c.DEFAULT_DRUM_PITCH_CLASSES.length;++n)e(n);this.DRUM_PITCH_TO_CLASS.set(l.LO_CLICK_PITCH,l.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(l.HI_CLICK_PITCH,l.HI_CLICK_CLASS)}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.playNote=function(t,e,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(t)](e,n)},t}(),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.synths=new Map,e.drumKit=d.getInstance(),e}return i(e,t),e.prototype.playNote=function(t,e){var n=e.hasOwnProperty("velocity")?e.velocity/l.MAX_MIDI_VELOCITY:void 0;if(e.isDrum)this.drumKit.playNote(e.pitch,t,n);else{var r=new s.Frequency(e.pitch,"midi"),i=e.endTime-e.startTime;this.getSynth(e.instrument,e.program).triggerAttackRelease(r,i,t,n)}},e.prototype.getSynth=function(t,e){if(this.synths.has(t))return this.synths.get(t);if(void 0!==e&&e>=32&&e<=39){var n=new s.Synth({oscillator:{type:"triangle"}}).toMaster();n.volume.value=5,this.synths.set(t,n)}else this.synths.set(t,new s.PolySynth(10).toMaster());return this.synths.get(t)},e.tone=s,e}(f);e.Player=m;var y=function(t){function e(e,n,r,i,o){void 0===n&&(n=s.Master);var a=t.call(this,!1,o)||this;return a.soundFont=new p.SoundFont(e),a.output=n,a.programOutputs=r,a.drumOutputs=i,a}return i(e,t),e.prototype.loadSamples=function(t){return o(this,void 0,void 0,function(){return a(this,function(e){switch(e.label){case 0:return[4,this.soundFont.loadSamples(t.notes.map(function(t){return{pitch:t.pitch,velocity:t.velocity,program:t.program||0,isDrum:t.isDrum||!1}}))];case 1:return e.sent(),[2]}})})},e.prototype.resumeContext=function(){s.context.resume()},e.prototype.start=function(e,n){var r=this;return this.resumeContext(),this.loadSamples(e).then(function(){return t.prototype.start.call(r,e,n)})},e.prototype.playNote=function(t,e){var n=this.output;this.programOutputs&&!e.isDrum?this.programOutputs.has(e.program)&&(n=this.programOutputs.get(e.program)):this.drumOutputs&&e.isDrum&&this.drumOutputs.has(e.pitch)&&(n=this.drumOutputs.get(e.pitch)),this.soundFont.playNote(e.pitch,e.velocity,t,e.endTime-e.startTime,e.program,e.isDrum,n)},e}(f);e.SoundFontPlayer=y;var g=function(t){function e(e){return t.call(this,!0,e)||this}return i(e,t),e}(m);e.PlayerWithClick=g},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(32),a=n(104),s=n(21),u=function(){function t(){}return t}();e.BaseRecorderCallback=u;var l=function(){function t(t,e){void 0===t&&(t={}),this.notes=[],this.midiInputs=[],this.loClick=new a.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new a.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.config={playClick:t.playClick,qpm:t.qpm||s.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:t.playCountIn},this.callbackObject=e,this.recording=!1,this.onNotes=new Map}return t.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return[4,navigator.requestMIDIAccess().then(function(e){return t.midiReady(e)},function(t){return console.log("Something went wrong",t)})];case 1:return e.sent(),[2]}})})},t.prototype.midiReady=function(t){console.log("Initialized Recorder");for(var e=t.inputs.values(),n=e.next();n&&!n.done;n=e.next())this.midiInputs.push(n.value)},t.prototype.isRecording=function(){return this.recording},t.prototype.setTempo=function(t){this.config.qpm=t,"started"===a.Transport.state&&(a.Transport.bpm.value=t)},t.prototype.enablePlayClick=function(t){this.config.playClick=t},t.prototype.enablePlayCountIn=function(t){this.config.playCountIn=t},t.prototype.initClickLoop=function(){var t=this,e=0;this.clickLoop=new a.Loop(function(n){e%4===0?t.loClick.triggerAttack("G5"):t.hiClick.triggerAttack("C6"),e++,t.config.playCountIn&&4===e&&(a.Transport.stop(),t.clickLoop.stop())},"4n")},t.prototype.getMIDIInputs=function(){return this.midiInputs},t.prototype.start=function(t){for(var e=this,n=t?t:this.midiInputs,r=0,i=n;r<i.length;r++){var o=i[r];o.onmidimessage=function(t){e.midiMessageReceived(t)}}this.config.playClick||this.config.playCountIn?(this.initClickLoop(),a.Transport.bpm.value=this.config.qpm,a.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map},t.prototype.stop=function(){var t=this;this.recording=!1;var e=Date.now();this.onNotes.forEach(function(n,r){t.noteOff(r,e)});for(var n=0,r=this.midiInputs;n<r.length;n++){var i=r[n];i.onmidimessage=null}return this.clickLoop&&(a.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()},t.prototype.getNoteSequence=function(){return 0===this.notes.length?null:o.NoteSequence.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})},t.prototype.midiMessageReceived=function(t){if(this.recording){var e=Date.now();void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=e);var n=9,r=8,i=t.data[0]>>4,o=t.data[1],a=t.data.length>2?t.data[2]:1;i===r||i===n&&0===a?(this.noteOff(o,e),this.callbackObject&&this.callbackObject.run(this.getNoteSequence())):i===n&&this.noteOn(o,a,e)}},t.prototype.noteOn=function(t,e,n){var r=1e3,i=new o.NoteSequence.Note;i.pitch=t,i.startTime=(n-this.firstNoteTimestamp)/r,i.velocity=e,this.onNotes.set(t,i)},t.prototype.noteOff=function(t,e){var n=1e3,r=this.onNotes.get(t);r&&(r.endTime=(e-this.firstNoteTimestamp)/n,this.notes.push(r)),this.onNotes.delete(t)},t}();e.Recorder=l},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(104),a=n(21),s=function(){function t(t){this.FADE_SECONDS=.1,this.baseURL=t,this.buffers=new o.Buffers([]),this.initialized=!1}return t.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return[4,fetch(this.baseURL+"/instrument.json").then(function(t){return t.json()}).then(function(e){t.name=e.name,t.minPitch=e.minPitch,t.maxPitch=e.maxPitch,t.durationSeconds=e.durationSeconds,t.releaseSeconds=e.releaseSeconds,t.percussive=e.percussive,t.velocities=e.velocities,t.initialized=!0})];case 1:return e.sent(),[2]}})})},t.prototype.sampleInfoToName=function(t){return this.velocities?"p"+t.pitch+"_v"+t.velocity:"p"+t.pitch},t.prototype.sampleNameToURL=function(t){return this.baseURL+"/"+t+".mp3"},t.prototype.nearestVelocity=function(t){if(!this.velocities)return t;t||(t=a.DEFAULT_VELOCITY);var e=void 0,n=a.MIDI_VELOCITIES;return this.velocities.forEach(function(r){var i=Math.abs(r-t);i<n&&(e=r,n=i)}),e},t.prototype.loadSamples=function(t){return r(this,void 0,void 0,function(){var e,n,r,a=this;return i(this,function(i){switch(i.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:i.sent(),i.label=2;case 2:return e=t.filter(function(t){return!(t.pitch<a.minPitch||t.pitch>a.maxPitch)||(console.log("Pitch "+t.pitch+" is outside the valid range for "+a.name+", ignoring."),!1)}).map(function(t){return a.sampleInfoToName({pitch:t.pitch,velocity:a.nearestVelocity(t.velocity)})}),n=Array.from(new Set(e)).filter(function(t){return!a.buffers.has(t)}),r=n.map(function(t){return{name:t,url:a.sampleNameToURL(t)}}),r.length>0?(r.forEach(function(t){return a.buffers.add(t.name,t.url)}),[4,new Promise(function(t){return o.Buffer.on("load",t)})]):[3,4];case 3:i.sent(),console.log("Loaded samples for "+this.name+"."),i.label=4;case 4:return[2]}})})},t.prototype.playNote=function(t,e,n,r,i){if(!this.initialized)throw new Error("Instrument is not initialized.");if(t<this.minPitch||t>this.maxPitch)return void console.log("Pitch "+t+" is outside the valid range for "+this.name+" ("+this.minPitch+"-"+this.maxPitch+")");var a=this.sampleInfoToName({pitch:t,velocity:this.nearestVelocity(e)});if(!this.buffers.has(a))throw new Error("Buffer not found for "+this.name+": "+a);var s=this.buffers.get(a);if(!s.loaded)throw new Error("Buffer not loaded for "+this.name+": "+a);r>this.durationSeconds&&console.log("Requested note duration longer than sample duration: "+r+" > "+this.durationSeconds);var u=new o.BufferSource(s).connect(i);if(u.start(n,0,void 0,1,0),!this.percussive&&r<this.durationSeconds){var l=new o.BufferSource(s).connect(i);u.stop(n+r+this.FADE_SECONDS,this.FADE_SECONDS),l.start(n+r,this.durationSeconds,void 0,1,this.FADE_SECONDS)}},t}();e.Instrument=s;var u=function(){function t(t){this.baseURL=t,this.instruments=new Map,this.initialized=!1}return t.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t=this;return i(this,function(e){switch(e.label){case 0:return[4,fetch(this.baseURL+"/soundfont.json").then(function(t){return t.json()}).then(function(e){t.name=e.name;for(var n in e.instruments){var r=t.baseURL+"/"+e.instruments[n];t.instruments.set("drums"===n?"drums":+n,new s(r))}t.initialized=!0})];case 1:return e.sent(),[2]}})})},t.prototype.loadSamples=function(t){return r(this,void 0,void 0,function(){var e,n=this;return i(this,function(r){switch(r.label){case 0:return this.initialized?[3,2]:[4,this.initialize()];case 1:r.sent(),r.label=2;case 2:return e=new Map,t.forEach(function(t){t.isDrum=t.isDrum||!1,t.program=t.program||0;var r=t.isDrum?"drums":t.program,i={pitch:t.pitch,velocity:t.velocity};e.has(r)?e.get(r).push(i):n.instruments.has(r)?e.set(r,[i]):console.log("No instrument in "+n.name+" for: program="+t.program+", isDrum="+t.isDrum)}),[4,Promise.all(Array.from(e.keys()).map(function(t){return n.instruments.get(t).loadSamples(e.get(t))}))];case 3:return r.sent(),[2]}})})},t.prototype.playNote=function(t,e,n,r,i,o,a){void 0===i&&(i=0),void 0===o&&(o=!1);var s=o?"drums":i;if(!this.initialized)throw new Error("SoundFont is not initialized.");return this.instruments.has(s)?void this.instruments.get(s).playNote(t,e,n,r,a):void console.log("No instrument in "+this.name+" for: program="+i+", isDrum="+o)},t}();e.SoundFont=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(72),i=n(21),o=function(){function t(t,e,n){void 0===n&&(n={}),this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119",minPitch:n.minPitch,maxPitch:n.maxPitch},this.noteSequence=t,this.sequenceIsQuantized=r.sequences.isQuantizedSequence(this.noteSequence),this.ctx=e.getContext("2d");var i=this.getCanvasSize();this.height=i.height;var o=window.devicePixelRatio||1;this.ctx.canvas.width=o*i.width,this.ctx.canvas.height=o*i.height,e.style.width=i.width+"px",e.style.height=i.height+"px",this.ctx.scale(o,o),this.redraw()}return t.prototype.redraw=function(t){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var e,n=0;n<this.noteSequence.notes.length;n++){var r=this.noteSequence.notes[n],i=this.config.noteSpacing*(n+1),o=this.getNoteStartTime(r)*this.config.pixelsPerTimeStep+i,a=(this.getNoteEndTime(r)-this.getNoteStartTime(r))*this.config.pixelsPerTimeStep,s=this.height-(r.pitch-this.config.minPitch)*this.config.noteHeight,u=.2,l=r.velocity?r.velocity/100+u:1,c=t&&this.isPaintingActiveNote(r,t);this.ctx.fillStyle="rgba("+(c?this.config.activeNoteRGB:this.config.noteRGB)+",\n          "+l+")",this.ctx.fillRect(o,s,a,this.config.noteHeight),c&&(e=o)}return e},t.prototype.getCanvasSize=function(){if(void 0===this.config.minPitch||void 0===this.config.maxPitch){this.config.minPitch=i.MAX_MIDI_PITCH,this.config.maxPitch=i.MIN_MIDI_PITCH;for(var t=0,e=this.noteSequence.notes;t<e.length;t++){var n=e[t];this.config.minPitch=Math.min(n.pitch,this.config.minPitch),this.config.maxPitch=Math.max(n.pitch,this.config.maxPitch)}this.config.minPitch-=2,this.config.maxPitch+=2}var r=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,o=this.noteSequence.notes.length,a=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime,s=o*this.config.noteSpacing+a*this.config.pixelsPerTimeStep;return{width:s,height:r}},t.prototype.getNoteStartTime=function(t){return this.sequenceIsQuantized?t.quantizedStartStep:t.startTime},t.prototype.getNoteEndTime=function(t){return this.sequenceIsQuantized?t.quantizedEndStep:t.endTime},t.prototype.isPaintingActiveNote=function(t,e){var n=this.getNoteStartTime(t)===this.getNoteStartTime(e),r=this.getNoteStartTime(t)<=this.getNoteStartTime(e)&&this.getNoteEndTime(t)>=this.getNoteEndTime(e);return n||r},t}();e.Visualizer=o},function(t,e,n){"use strict";function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0});var i=n(97);e.tf=i,r(n(72)),r(n(181)),r(n(183)),r(n(32)),r(n(187))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);e.ATTENTION_PREFIX="attention_cell_wrapper/";var i=function(){function t(t,e,n){this.cells=t,this.attnLength=e,this.attnSize=n}return t.isWrapped=function(t){return"rnn/"+e.ATTENTION_PREFIX+"kernel"in t},t.prototype.initialize=function(t){var n="rnn/"+e.ATTENTION_PREFIX;this.attnInputMatrix=t[n+"kernel"],this.attnInputBias=t[n+"bias"],this.attnW=t[n+"attention/attn_w"],this.attnV=t[n+"attention/attn_v"],this.attnMatrix=t[n+"attention/kernel"],this.attnBias=t[n+"attention/bias"],this.attnOutputMatrix=t[n+"attention_output_projection/kernel"],this.attnOutputBias=t[n+"attention_output_projection/bias"]},t.prototype.initState=function(){var t=r.zeros([this.attnSize]),e=r.zeros([1,this.attnSize*this.attnLength]);return{attention:t,attentionState:e}},t.prototype.call=function(t,e,n,i){var o,a=r.concat([t,i.attention.as2D(1,-1)],1),s=r.add(r.matMul(a,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));o=r.multiRNNCell(this.cells,s,e,n),e=o[0],n=o[1];for(var u=r.reshape(i.attentionState,[-1,this.attnLength,1,this.attnSize]),l=r.conv2d(u,this.attnW,[1,1],"same"),c=[],p=0;p<e.length;p++)c.push(e[p]),c.push(n[p]);var h=r.concat(c,1),f=r.matMul(h,this.attnMatrix).reshape([-1,1,1,this.attnSize]),d=r.sum(r.mul(this.attnV,r.tanh(r.add(l,f))),[2,3]),m=r.softmax(d),y=r.sum(r.mul(r.reshape(m,[-1,this.attnLength,1,1]),u),[1,2]),g=y.reshape([-1,this.attnSize]),v=i.attentionState.reshape([-1,this.attnLength,this.attnSize]),b=r.slice(v,[0,1,0],[v.shape[0],v.shape[1]-1,v.shape[2]]),_=r.add(r.matMul(r.concat([n[2],g],1),this.attnOutputMatrix),this.attnOutputBias),w=g.flatten(),S=r.concat([b,_.as3D(_.shape[0],1,_.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:_,c:e,h:n,attentionState:{attention:w,attentionState:S}}},t}();e.AttentionWrapper=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(182);e.MusicRNN=r.MusicRNN},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(109),s=n(71),u=n(55),l=n(46),c=n(47),p=n(180),h="multi_rnn_cell/cell_%d/basic_lstm_cell/",f=function(){function t(t,e){this.checkpointURL=t,this.spec=e,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}return t.prototype.isInitialized=function(){return this.initialized},t.prototype.instantiateFromSpec=function(){this.dataConverter=u.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?s.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map(function(t){return a.auxiliaryInputFromSpec(t)}):void 0},t.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t,e,n,r,a,s,u,c,f=this;return i(this,function(i){switch(i.label){case 0:return this.dispose(),t=performance.now(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then(function(t){return t.json()}).then(function(t){if("MusicRNN"!==t.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  "+t.type);f.spec=t})];case 1:i.sent(),i.label=2;case 2:return this.instantiateFromSpec(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(t){return t.json()}).then(function(t){return o.io.loadWeights(t,f.checkpointURL)})];case 3:e=i.sent(),n=p.AttentionWrapper.isWrapped(e),r=n?"rnn/"+p.ATTENTION_PREFIX:"rnn/",this.forgetBias=o.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0,a=0,s=function(){var t=r+h.replace("%d",a.toString());return t+"kernel"in e?(u.lstmCells.push(function(n,r,i){return o.basicLSTMCell(f.forgetBias,e[t+"kernel"],e[t+"bias"],n,r,i)}),u.biasShapes.push(e[t+"bias"].shape[0]),void++a):"break"},u=this;for(;;)if(c=s(),"break"===c)break;return this.lstmFcW=e["fully_connected/weights"],this.lstmFcB=e["fully_connected/biases"],n&&(this.attentionWrapper=new p.AttentionWrapper(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(e)),this.rawVars=e,this.initialized=!0,l.logWithDuration("Initialized model",t,"MusicRNN"),[2]}})})},t.prototype.dispose=function(){var t=this;Object.keys(this.rawVars).forEach(function(e){return t.rawVars[e].dispose()}),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1},t.prototype.continueSequence=function(t,e,n,o){return r(this,void 0,void 0,function(){var r;return i(this,function(i){switch(i.label){case 0:return[4,this.continueSequenceImpl(t,e,n,o,!1)];case 1:return r=i.sent(),[2,r.sequence]}})})},t.prototype.continueSequenceAndReturnProbabilities=function(t,e,n,o){return r(this,void 0,void 0,function(){return i(this,function(r){return[2,this.continueSequenceImpl(t,e,n,o,!0)]})})},t.prototype.continueSequenceImpl=function(t,e,n,a,s){return r(this,void 0,void 0,function(){var r,u,p,h,f,d,m,y,g=this;return i(this,function(i){switch(i.label){case 0:if(c.assertIsRelativeQuantizedSequence(t),this.chordEncoder&&!a)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&a)throw new Error("Unexpected chord progression provided.");
return this.initialized?[3,2]:[4,this.initialize()];case 1:i.sent(),i.label=2;case 2:return r=performance.now(),u=o.tidy(function(){var r=g.dataConverter.toTensor(t),i=r.shape[0],u=r.shape[1],l=g.chordEncoder?g.chordEncoder.encodeProgression(a,i+e):void 0,c=g.auxInputs?o.concat(g.auxInputs.map(function(t){return t.getTensors(i+e)}),1):void 0,p=g.sampleRnn(r,e,n,l,c,s),h=p.samples;return{samples:o.stack(h).as2D(h.length,u),probs:p.probs}}),[4,u];case 3:if(p=i.sent(),h=this.dataConverter.toNoteSequence(p.samples,t.quantizationInfo.stepsPerQuarter),f=[],!s)return[3,7];d=0,i.label=4;case 4:return d<p.probs.length?(y=(m=f).push,[4,p.probs[d].data()]):[3,7];case 5:y.apply(m,[i.sent()]),p.probs[d].dispose(),i.label=6;case 6:return d++,[3,4];case 7:return u.samples.dispose(),h.then(function(){return l.logWithDuration("Continuation completed",r,"MusicRNN",20)}),[2,{sequence:h,probs:f}]}})})},t.prototype.sampleRnn=function(t,e,n,r,i,a){for(var s,u=t.shape[0],l=t.shape[1],c=[],p=[],h=0;h<this.biasShapes.length;h++)c.push(o.zeros([1,this.biasShapes[h]/4])),p.push(o.zeros([1,this.biasShapes[h]/4]));var f,d=this.attentionWrapper?this.attentionWrapper.initState():null;t=t.toFloat();for(var m=[],y=[],g=o.split(t.toFloat(),u),v=r?o.split(r,r.shape[0]):void 0,b=i?o.split(i,i.shape[0]):void 0,h=0;h<u+e;h++){var _=void 0;if(h<u)_=g[h];else{var w=f.matMul(this.lstmFcW).add(this.lstmFcB).as1D(),S=void 0;n?(w=w.div(o.scalar(n)),S=o.multinomial(w,1).as1D()):S=w.argMax().as1D(),a&&y.push(o.softmax(w)),_=o.oneHot(S,l).toFloat(),m.push(_.as1D())}if(h===u+e-1)break;var x=[];if(v&&x.push(v[h+1]),x.push(_),b&&x.push(b[h]),_=o.concat(x,1),this.attentionWrapper){var T=this.attentionWrapper.call(_,c,p,d);c=T.c,p=T.h,d=T.attentionState,f=T.output}else s=o.multiRNNCell(this.lstmCells,_,c,p),c=s[0],p=s[1],f=p[p.length-1]}return{samples:m,probs:y}},t}();e.MusicRNN=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(184);e.Decoder=r.Decoder,e.Encoder=r.Encoder,e.MusicVAE=r.MusicVAE},function(t,e,n){"use strict";function r(t,e){return e.matMul(t.kernel).add(t.bias)}function i(t,e,n){for(var i=[],o=[],a=[],s=u.split(r(n,t).tanh(),2*e.length,1),l=function(t){var n=e[t],r=u.scalar(1);i.push(function(t,e,i){return u.basicLSTMCell(r,n.kernel,n.bias,t,e,i)}),o.push(s[2*t]),a.push(s[2*t+1])},c=0;c<e.length;++c)l(c);return{cell:i,c:o,h:a}}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=n(71),c=n(21),p=n(55),h=n(46),f=function(){function t(t,e){if(void 0===t)throw Error("`kernel` is undefined.");if(void 0===e)throw Error("`bias` is undefined.");this.kernel=t,this.bias=e}return t}();e.LayerVars=f;var d=function(){function t(){}return t}();e.Encoder=d;var m=function(t){function e(e,n,r){var i=t.call(this)||this;return i.lstmFwVars=e,i.lstmBwVars=n,i.muVars=r,i.zDims=r?i.muVars.bias.shape[0]:null,i}return o(e,t),e.prototype.encode=function(t,e){var n=this;if(e)throw new Error("Variable-length segments not supported in flat encoder");return u.tidy(function(){var e=n.singleDirection(t,!0),i=n.singleDirection(t,!1),o=u.concat([e[1],i[1]],1);return n.muVars?r(n.muVars,o):o})},e.prototype.singleDirection=function(t,e){for(var n=t.shape[0],r=t.shape[1],i=e?this.lstmFwVars:this.lstmBwVars,o=[u.zeros([n,i.bias.shape[0]/4]),u.zeros([n,i.bias.shape[0]/4])],a=u.scalar(1),s=function(t,e){return u.basicLSTMCell(a,i.kernel,i.bias,t,e[0],e[1])},l=u.split(t.toFloat(),r,1),c=0,p=e?l:l.reverse();c<p.length;c++){var h=p[c];o=s(h.squeeze([1]),o)}return o},e}(d),y=function(t){function e(e,n,r){var i=t.call(this)||this;return i.baseEncoders=e,i.numSteps=n,i.muVars=r,i.zDims=i.muVars.bias.shape[0],i}return o(e,t),e.prototype.encode=function(t,e){var n=this;if(e){if(1!==t.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(e.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return u.tidy(function(){for(var i=t,o=0;o<n.baseEncoders.length;++o){for(var a=n.numSteps[o],s=u.split(i,a,1),l=[],c=0;c<a;++c)l.push(n.baseEncoders[o].encode(0===o&&e?u.slice3d(s[c],[0,0,0],[1,e[c],-1]):s[c]));i=u.stack(l,1)}return r(n.muVars,i.squeeze([1]))})},e}(d),g=function(){function t(){}return t}();e.Decoder=g;var v=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.lstmCellVars=e,o.zToInitStateVars=n,o.outputProjectVars=r,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=i||r.bias.shape[0],o}return o(e,t),e.prototype.decode=function(t,e,n,o,a){var s=this,l=t.shape[0];return u.tidy(function(){for(var c,p=i(t,s.lstmCellVars,s.zToInitStateVars),h=[],f=n?n:u.zeros([l,s.outputDims]),d=a?u.split(u.tile(a,[l,1]),a.shape[0]):void 0,m=0;m<e;++m){var y=d?[f,t,d[m]]:[f,t];c=u.multiRNNCell(p.cell,u.concat(y,1),p.c,p.h),p.c=c[0],p.h=c[1];var g=r(s.outputProjectVars,p.h[p.h.length-1]);f=s.sample(g,o),h.push(f)}return u.stack(h,1)})},e}(g),b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.sample=function(t,e){var n=t,r=e?u.multinomial(n.div(u.scalar(e)),1).as1D():n.argMax(1).as1D();return u.oneHot(r,this.outputDims).toFloat()},e}(v),_=function(t){function e(e,n,r,i){var o=t.call(this,e,n,r,i.numDims)||this;return o.nade=i,o}return o(e,t),e.prototype.sample=function(t,e){var n=u.split(t,[this.nade.numHidden,this.nade.numDims],1),r=n[0],i=n[1];return this.nade.sample(r,i)},e}(v),w=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.sample=function(t,e){var n=u.split(t,3,1),r=n[0],i=n[1],o=n[2];if(i=u.sigmoid(i),o=u.tanh(o),e){r=u.sigmoid(r.div(u.scalar(e)));var a=u.randomUniform(r.shape,0,1);r=u.greater(r,a).toFloat()}else r=u.greater(u.sigmoid(r),.5).toFloat();return u.concat([r,i,o],1)},e}(v),function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.coreDecoders=e,o.lstmCellVars=n,o.zToInitStateVars=r,o.numSteps=i,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=o.coreDecoders.reduce(function(t,e){return t+e.outputDims},0),o}return o(e,t),e.prototype.decode=function(t,e,n,r,o){var a=this,s=t.shape[0];return u.tidy(function(){for(var n,l=i(t,a.lstmCellVars,a.zToInitStateVars),c=[],p=a.coreDecoders.map(function(t){}),h=u.zeros([s,1]),f=o?u.split(o,a.numSteps):void 0,d=0;d<a.numSteps;++d){n=u.multiRNNCell(l.cell,h,l.c,l.h),l.c=n[0],l.h=n[1];for(var m=[],y=0;y<a.coreDecoders.length;++y)m.push(a.coreDecoders[y].decode(l.h[l.h.length-1],e/a.numSteps,p[y],r,f?f[d]:void 0));c.push(u.concat(m,-1)),p=m.map(function(t){return t.slice([0,-1,0],[s,1,t.shape[t.rank-1]]).squeeze([1]).toFloat()})}return u.concat(c,1)})},e}(g)),S=function(){function t(t,e){this.numDims=t.shape[0],this.numHidden=t.shape[2],this.encWeights=t.as2D(this.numDims,this.numHidden),this.decWeightsT=e.as2D(this.numDims,this.numHidden)}return t.prototype.sample=function(t,e){var n=this,r=t.shape[0];return u.tidy(function(){for(var i=[],o=t.clone(),a=0;a<n.numDims;a++){var s=u.sigmoid(o),l=n.encWeights.slice([a,0],[1,n.numHidden]).as1D(),c=n.decWeightsT.slice([a,0],[1,n.numHidden]),p=e.slice([0,a],[r,1]),h=p.add(u.matMul(s,c,!1,!0)),f=h.sigmoid(),d=f.greaterEqual(u.scalar(.5)).toFloat().as1D();a<n.numDims-1&&(o=o.add(u.outerProduct(d.toFloat(),l))),i.push(d)}return u.stack(i,1)})},t}();e.Nade=S;var x=function(){function t(t,e){this.initialized=!1,this.checkpointURL=t,this.spec=e}return t.prototype.instantiateFromSpec=function(){this.dataConverter=p.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?l.chordEncoderFromType(this.spec.chordEncoder):void 0},t.prototype.dispose=function(){var t=this;void 0!==this.rawVars&&Object.keys(this.rawVars).forEach(function(e){return t.rawVars[e].dispose()}),this.encoder=void 0,this.decoder=void 0,this.initialized=!1},t.prototype.getLstmLayers=function(t,e){for(var n=[],r=0;;){var i=t.replace("%d",r.toString());if(!(i+"kernel"in e))break;n.push(new f(e[i+"kernel"],e[i+"bias"])),++r}return n},t.prototype.initialize=function(){return a(this,void 0,void 0,function(){var t,e,n,r,i,o,a,l,c,p,d,g,v,x,T,P,E,A,N,O,k=this;return s(this,function(s){switch(s.label){case 0:return this.dispose(),t=performance.now(),this.spec?[3,2]:[4,fetch(this.checkpointURL+"/config.json").then(function(t){return t.json()}).then(function(t){if("MusicVAE"!==t.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  "+t.type);k.spec=t})];case 1:s.sent(),s.label=2;case 2:return this.instantiateFromSpec(),e="cell_%d/lstm_cell/",n="multi_rnn_cell/"+e,r="decoder/hierarchical_level_0/",i="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/",o="encoder/"+i,a="encoder/hierarchical_level_%d/"+i.replace("%d","0"),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(t){return t.json()}).then(function(t){return u.io.loadWeights(t,k.checkpointURL)})];case 3:if(l=s.sent(),this.rawVars=l,c=new f(l["encoder/mu/kernel"],l["encoder/mu/bias"]),this.dataConverter.numSegments){if(p=this.getLstmLayers(a.replace("%s","fw"),l),d=this.getLstmLayers(a.replace("%s","bw"),l),p.length!==d.length||2!==p.length)throw Error("Only 2 hierarchical encoder levels are supported. "+("Got "+p.length+" forward and "+d.length+" ")+"backward.");g=[0,1].map(function(t){return new m(p[t],d[t])}),this.encoder=new y(g,[this.dataConverter.numSegments,1],c)}else{if(v=this.getLstmLayers(o.replace("%s","fw"),l),x=this.getLstmLayers(o.replace("%s","bw"),l),v.length!==x.length||1!==v.length)throw Error("Only single-layer bidirectional encoders are supported. "+("Got "+v.length+" forward and "+x.length+" ")+"backward.");this.encoder=new m(v[0],x[0],c)}if(T=this.dataConverter.numSegments?"core_decoder/":"",P=[],this.dataConverter.NUM_SPLITS)for(E=0;E<this.dataConverter.NUM_SPLITS;++E)P.push(T+"core_decoder_"+E+"/decoder/");else P.push(T+"decoder/");if(A=P.map(function(t){var e=k.getLstmLayers(t+n,l),r=new f(l[t+"z_to_initial_state/kernel"],l[t+"z_to_initial_state/bias"]),i=new f(l[t+"output_projection/kernel"],l[t+"output_projection/bias"]);return t+"nade/w_enc"in l?new _(e,r,i,new S(l[t+"nade/w_enc"],l[t+"nade/w_dec_t"])):new b(e,r,i)}),this.dataConverter.numSegments)N=this.getLstmLayers(r+e,l),O=new f(l[r+"initial_state/kernel"],l[r+"initial_state/bias"]),this.decoder=new w(A,N,O,this.dataConverter.numSegments);else{if(1!==A.length)throw Error("Unexpected number of base decoders without conductor: "+A.length);this.decoder=A[0]}return this.initialized=!0,h.logWithDuration("Initialized model",t,"MusicVAE"),[2]}})})},t.prototype.isInitialized=function(){return this.initialized},t.prototype.interpolate=function(t,e,n,r){return a(this,void 0,void 0,function(){var i,o,a,l,c=this;return s(this,function(s){switch(s.label){case 0:if(this.chordEncoder&&!r)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&r)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:s.sent(),s.label=2;case 2:return i=0,[4,this.encode(t,r)];case 3:return o=s.sent(),a=u.tidy(function(){return c.getInterpolatedZs(o,e)}),o.dispose(),l=this.decode(a,n,r),a.dispose(),l.then(function(){return h.logWithDuration("Interpolation completed",i,"MusicVAE",20)}),[2,l]}})})},t.prototype.getSegmentLengths=function(t){return a(this,void 0,void 0,function(){var e,n,r,i,o,a,l,c,p=this;return s(this,function(s){switch(s.label){case 0:if(t.shape[0]>1)throw new Error("Variable-length segments not supported for batch size > 1.");return e=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=u.tidy(function(){return u.min(u.equal(t.squeeze([0]),p.dataConverter.endTensor.expandDims(0)),1)}),[4,r.data()];case 1:for(i=s.sent(),r.dispose(),o=e/n,a=[],l=0,c=i.indexOf(1);c!==-1;)a.push(c-l+1),l+=o,c=i.indexOf(1,l);if(a.length!==n)throw new Error("Incorrect number of segments: "+a.length+" != "+n);return[2,a]}})})},t.prototype.encodeChordProgression=function(t){var e=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=this.dataConverter.SEGMENTED_BY_TRACK?e/n:e,i=this.dataConverter.SEGMENTED_BY_TRACK?u.concat2d([this.chordEncoder.encode(c.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(t,r-1)],0):this.chordEncoder.encodeProgression(t,r);return this.dataConverter.SEGMENTED_BY_TRACK?u.tile(i,[n,1]):i},t.prototype.encode=function(t,e){return a(this,void 0,void 0,function(){var n,r,i,o,a,l,c=this;return s(this,function(s){switch(s.label){case 0:if(this.chordEncoder&&!e)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&e)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&e.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:s.sent(),s.label=2;case 2:return n=performance.now(),r=u.tidy(function(){return u.stack(t.map(function(t){return c.dataConverter.toTensor(t)}))}),this.dataConverter.endTensor?[4,this.getSegmentLengths(r)]:[3,4];case 3:return o=s.sent(),[3,5];case 4:o=void 0,s.label=5;case 5:return i=o,this.chordEncoder&&(a=u.tidy(function(){var n=c.encodeChordProgression(e),i=u.tile(u.expandDims(n,0),[t.length,1,1]);return r.concat(i,2)}),r.dispose(),r=a),l=this.encoder.encode(r,i),r.dispose(),h.logWithDuration("Encoding completed",n,"MusicVAE",20),[2,l]}})})},t.prototype.decode=function(t,e,n,r){return void 0===r&&(r=4),a(this,void 0,void 0,function(){var i,o,a,l,c,p,f,d,m,y=this;return s(this,function(s){switch(s.label){case 0:if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&n.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");return this.initialized?[3,2]:[4,this.initialize()];case 1:s.sent(),s.label=2;case 2:i=performance.now(),o=this.dataConverter.numSteps,a=u.tidy(function(){var r=y.chordEncoder?y.encodeChordProgression(n):void 0,i=y.decoder.decode(t,o,void 0,e,r);return u.split(i,i.shape[0]).map(function(t){return t.squeeze([0])})}),l=[],c=0,p=a,s.label=3;case 3:return c<p.length?(f=p[c],m=(d=l).push,[4,this.dataConverter.toNoteSequence(f,r)]):[3,6];case 4:m.apply(d,[s.sent()]),f.dispose(),s.label=5;case 5:return c++,[3,3];case 6:return h.logWithDuration("Decoding completed",i,"MusicVAE",20),[2,l]}})})},t.prototype.getInterpolatedZs=function(t,e){if("number"==typeof e&&(e=[e]),2!==t.shape[0]&&4!==t.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==e.length&&2!==e.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");var n=e[0],r=2===e.length?e[1]:n,i=u.tidy(function(){var e=u.linspace(0,1,n),i=t.slice([0,0],[1,t.shape[1]]).as1D(),o=t.slice([1,0],[1,t.shape[1]]).as1D();if(2===t.shape[0]){var a=o.sub(i);return u.outerProduct(e,a).add(i)}if(4===t.shape[0]){var s=u.linspace(0,1,r),l=t.slice([2,0],[1,t.shape[1]]).as1D(),c=t.slice([3,0],[1,t.shape[1]]).as1D(),p=u.scalar(1).sub(e),h=u.scalar(1).sub(s),f=i.mul(u.outerProduct(h,p).as3D(r,n,1));return f=u.addStrict(f,o.mul(u.outerProduct(s,p).as3D(r,n,1))),f=u.addStrict(f,l.mul(u.outerProduct(h,e).as3D(r,n,1))),f=u.addStrict(f,c.mul(u.outerProduct(s,e).as3D(r,n,1))),f.as2D(n*r,t.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")});return i},t.prototype.sample=function(t,e,n,r){return void 0===e&&(e=.5),void 0===r&&(r=c.DEFAULT_STEPS_PER_QUARTER),a(this,void 0,void 0,function(){var i,o,a,l=this;return s(this,function(s){switch(s.label){case 0:if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");return this.initialized?[3,2]:[4,this.initialize()];case 1:s.sent(),s.label=2;case 2:return i=performance.now(),o=u.tidy(function(){return u.randomNormal([t,l.decoder.zDims])}),a=this.decode(o,e,n,r),o.dispose(),a.then(function(){return h.logWithDuration("Sampling completed",i,"MusicVAE",20)}),[2,a]}})})},t}();e.MusicVAE=x},function(t,e,n){"use strict";var r=n(151),i=r.Reader,o=r.Writer,a=r.util,s=r.roots.default||(r.roots.default={});s.tensorflow=function(){var t={};return t.magenta=function(){var t={};return t.NoteSequence=function(){function t(t){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id="",t.prototype.filename="",t.prototype.referenceNumber=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.collectionName="",t.prototype.ticksPerQuarter=0,t.prototype.timeSignatures=a.emptyArray,t.prototype.keySignatures=a.emptyArray,t.prototype.tempos=a.emptyArray,t.prototype.notes=a.emptyArray,t.prototype.totalTime=0,t.prototype.totalQuantizedSteps=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.pitchBends=a.emptyArray,t.prototype.controlChanges=a.emptyArray,t.prototype.partInfos=a.emptyArray,t.prototype.sourceInfo=null,t.prototype.textAnnotations=a.emptyArray,t.prototype.sectionAnnotations=a.emptyArray,t.prototype.sectionGroups=a.emptyArray,t.prototype.quantizationInfo=null,t.prototype.subsequenceInfo=null,t.prototype.sequenceMetadata=null,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(10).string(t.id),null!=t.filename&&t.hasOwnProperty("filename")&&e.uint32(18).string(t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&e.uint32(26).string(t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&e.uint32(32).int32(t.ticksPerQuarter),null!=t.timeSignatures&&t.timeSignatures.length)for(var n=0;n<t.timeSignatures.length;++n)s.tensorflow.magenta.NoteSequence.TimeSignature.encode(t.timeSignatures[n],e.uint32(42).fork()).ldelim();if(null!=t.keySignatures&&t.keySignatures.length)for(var n=0;n<t.keySignatures.length;++n)s.tensorflow.magenta.NoteSequence.KeySignature.encode(t.keySignatures[n],e.uint32(50).fork()).ldelim();if(null!=t.tempos&&t.tempos.length)for(var n=0;n<t.tempos.length;++n)s.tensorflow.magenta.NoteSequence.Tempo.encode(t.tempos[n],e.uint32(58).fork()).ldelim();if(null!=t.notes&&t.notes.length)for(var n=0;n<t.notes.length;++n)s.tensorflow.magenta.NoteSequence.Note.encode(t.notes[n],e.uint32(66).fork()).ldelim();if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&e.uint32(73).double(t.totalTime),null!=t.pitchBends&&t.pitchBends.length)for(var n=0;n<t.pitchBends.length;++n)s.tensorflow.magenta.NoteSequence.PitchBend.encode(t.pitchBends[n],e.uint32(82).fork()).ldelim();if(null!=t.controlChanges&&t.controlChanges.length)for(var n=0;n<t.controlChanges.length;++n)s.tensorflow.magenta.NoteSequence.ControlChange.encode(t.controlChanges[n],e.uint32(90).fork()).ldelim();if(null!=t.partInfos&&t.partInfos.length)for(var n=0;n<t.partInfos.length;++n)s.tensorflow.magenta.NoteSequence.PartInfo.encode(t.partInfos[n],e.uint32(98).fork()).ldelim();if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&s.tensorflow.magenta.NoteSequence.SourceInfo.encode(t.sourceInfo,e.uint32(106).fork()).ldelim(),null!=t.textAnnotations&&t.textAnnotations.length)for(var n=0;n<t.textAnnotations.length;++n)s.tensorflow.magenta.NoteSequence.TextAnnotation.encode(t.textAnnotations[n],e.uint32(114).fork()).ldelim();if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&s.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(t.quantizationInfo,e.uint32(122).fork()).ldelim(),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&e.uint32(128).int64(t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&s.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(t.subsequenceInfo,e.uint32(138).fork()).ldelim(),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&e.uint32(144).int64(t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&s.tensorflow.magenta.SequenceMetadata.encode(t.sequenceMetadata,e.uint32(154).fork()).ldelim(),null!=t.sectionAnnotations&&t.sectionAnnotations.length)for(var n=0;n<t.sectionAnnotations.length;++n)s.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(t.sectionAnnotations[n],e.uint32(162).fork()).ldelim();if(null!=t.sectionGroups&&t.sectionGroups.length)for(var n=0;n<t.sectionGroups.length;++n)s.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroups[n],e.uint32(170).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.id=t.string();break;case 2:r.filename=t.string();break;case 18:r.referenceNumber=a.Long?t.int64().toNumber():t.int64();break;case 3:r.collectionName=t.string();break;case 4:r.ticksPerQuarter=t.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(s.tensorflow.magenta.NoteSequence.TimeSignature.decode(t,t.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(s.tensorflow.magenta.NoteSequence.KeySignature.decode(t,t.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(s.tensorflow.magenta.NoteSequence.Tempo.decode(t,t.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(s.tensorflow.magenta.NoteSequence.Note.decode(t,t.uint32()));break;case 9:r.totalTime=t.double();break;case 16:r.totalQuantizedSteps=a.Long?t.int64().toNumber():t.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(s.tensorflow.magenta.NoteSequence.PitchBend.decode(t,t.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(s.tensorflow.magenta.NoteSequence.ControlChange.decode(t,t.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(s.tensorflow.magenta.NoteSequence.PartInfo.decode(t,t.uint32()));break;case 13:r.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.decode(t,t.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(s.tensorflow.magenta.NoteSequence.TextAnnotation.decode(t,t.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(s.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(t,t.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(s.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32()));break;case 15:r.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(t,t.uint32());break;case 17:r.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(t,t.uint32());break;case 19:r.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!a.isString(t.id))return"id: string expected";if(null!=t.filename&&t.hasOwnProperty("filename")&&!a.isString(t.filename))return"filename: string expected";if(null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&!(a.isInteger(t.referenceNumber)||t.referenceNumber&&a.isInteger(t.referenceNumber.low)&&a.isInteger(t.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=t.collectionName&&t.hasOwnProperty("collectionName")&&!a.isString(t.collectionName))return"collectionName: string expected";if(null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&!a.isInteger(t.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=t.timeSignatures&&t.hasOwnProperty("timeSignatures")){if(!Array.isArray(t.timeSignatures))return"timeSignatures: array expected";for(var e=0;e<t.timeSignatures.length;++e){var n=s.tensorflow.magenta.NoteSequence.TimeSignature.verify(t.timeSignatures[e]);if(n)return"timeSignatures."+n}}if(null!=t.keySignatures&&t.hasOwnProperty("keySignatures")){if(!Array.isArray(t.keySignatures))return"keySignatures: array expected";for(var e=0;e<t.keySignatures.length;++e){var n=s.tensorflow.magenta.NoteSequence.KeySignature.verify(t.keySignatures[e]);if(n)return"keySignatures."+n}}if(null!=t.tempos&&t.hasOwnProperty("tempos")){if(!Array.isArray(t.tempos))return"tempos: array expected";for(var e=0;e<t.tempos.length;++e){var n=s.tensorflow.magenta.NoteSequence.Tempo.verify(t.tempos[e]);if(n)return"tempos."+n}}if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(var e=0;e<t.notes.length;++e){var n=s.tensorflow.magenta.NoteSequence.Note.verify(t.notes[e]);if(n)return"notes."+n}}if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&"number"!=typeof t.totalTime)return"totalTime: number expected";if(null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&!(a.isInteger(t.totalQuantizedSteps)||t.totalQuantizedSteps&&a.isInteger(t.totalQuantizedSteps.low)&&a.isInteger(t.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=t.pitchBends&&t.hasOwnProperty("pitchBends")){if(!Array.isArray(t.pitchBends))return"pitchBends: array expected";for(var e=0;e<t.pitchBends.length;++e){var n=s.tensorflow.magenta.NoteSequence.PitchBend.verify(t.pitchBends[e]);if(n)return"pitchBends."+n}}if(null!=t.controlChanges&&t.hasOwnProperty("controlChanges")){if(!Array.isArray(t.controlChanges))return"controlChanges: array expected";for(var e=0;e<t.controlChanges.length;++e){var n=s.tensorflow.magenta.NoteSequence.ControlChange.verify(t.controlChanges[e]);if(n)return"controlChanges."+n}}if(null!=t.partInfos&&t.hasOwnProperty("partInfos")){if(!Array.isArray(t.partInfos))return"partInfos: array expected";for(var e=0;e<t.partInfos.length;++e){var n=s.tensorflow.magenta.NoteSequence.PartInfo.verify(t.partInfos[e]);if(n)return"partInfos."+n}}if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")){var n=s.tensorflow.magenta.NoteSequence.SourceInfo.verify(t.sourceInfo);if(n)return"sourceInfo."+n}if(null!=t.textAnnotations&&t.hasOwnProperty("textAnnotations")){if(!Array.isArray(t.textAnnotations))return"textAnnotations: array expected";for(var e=0;e<t.textAnnotations.length;++e){var n=s.tensorflow.magenta.NoteSequence.TextAnnotation.verify(t.textAnnotations[e]);if(n)return"textAnnotations."+n}}if(null!=t.sectionAnnotations&&t.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(t.sectionAnnotations))return"sectionAnnotations: array expected";for(var e=0;e<t.sectionAnnotations.length;++e){var n=s.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(t.sectionAnnotations[e]);if(n)return"sectionAnnotations."+n}}if(null!=t.sectionGroups&&t.hasOwnProperty("sectionGroups")){if(!Array.isArray(t.sectionGroups))return"sectionGroups: array expected";for(var e=0;e<t.sectionGroups.length;++e){var n=s.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroups[e]);if(n)return"sectionGroups."+n}}if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")){var n=s.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(t.quantizationInfo);if(n)return"quantizationInfo."+n}if(null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")){var n=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(t.subsequenceInfo);if(n)return"subsequenceInfo."+n}if(null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")){var n=s.tensorflow.magenta.SequenceMetadata.verify(t.sequenceMetadata);if(n)return"sequenceMetadata."+n}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence)return t;var e=new s.tensorflow.magenta.NoteSequence;if(null!=t.id&&(e.id=String(t.id)),null!=t.filename&&(e.filename=String(t.filename)),null!=t.referenceNumber&&(a.Long?(e.referenceNumber=a.Long.fromValue(t.referenceNumber)).unsigned=!1:"string"==typeof t.referenceNumber?e.referenceNumber=parseInt(t.referenceNumber,10):"number"==typeof t.referenceNumber?e.referenceNumber=t.referenceNumber:"object"==typeof t.referenceNumber&&(e.referenceNumber=new a.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber())),null!=t.collectionName&&(e.collectionName=String(t.collectionName)),null!=t.ticksPerQuarter&&(e.ticksPerQuarter=0|t.ticksPerQuarter),t.timeSignatures){if(!Array.isArray(t.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");e.timeSignatures=[];for(var n=0;n<t.timeSignatures.length;++n){if("object"!=typeof t.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");e.timeSignatures[n]=s.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(t.timeSignatures[n])}}if(t.keySignatures){if(!Array.isArray(t.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");e.keySignatures=[];for(var n=0;n<t.keySignatures.length;++n){if("object"!=typeof t.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");e.keySignatures[n]=s.tensorflow.magenta.NoteSequence.KeySignature.fromObject(t.keySignatures[n])}}if(t.tempos){if(!Array.isArray(t.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");e.tempos=[];for(var n=0;n<t.tempos.length;++n){if("object"!=typeof t.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");e.tempos[n]=s.tensorflow.magenta.NoteSequence.Tempo.fromObject(t.tempos[n])}}if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");e.notes=[];for(var n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");e.notes[n]=s.tensorflow.magenta.NoteSequence.Note.fromObject(t.notes[n])}}if(null!=t.totalTime&&(e.totalTime=Number(t.totalTime)),null!=t.totalQuantizedSteps&&(a.Long?(e.totalQuantizedSteps=a.Long.fromValue(t.totalQuantizedSteps)).unsigned=!1:"string"==typeof t.totalQuantizedSteps?e.totalQuantizedSteps=parseInt(t.totalQuantizedSteps,10):"number"==typeof t.totalQuantizedSteps?e.totalQuantizedSteps=t.totalQuantizedSteps:"object"==typeof t.totalQuantizedSteps&&(e.totalQuantizedSteps=new a.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber())),
t.pitchBends){if(!Array.isArray(t.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");e.pitchBends=[];for(var n=0;n<t.pitchBends.length;++n){if("object"!=typeof t.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");e.pitchBends[n]=s.tensorflow.magenta.NoteSequence.PitchBend.fromObject(t.pitchBends[n])}}if(t.controlChanges){if(!Array.isArray(t.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");e.controlChanges=[];for(var n=0;n<t.controlChanges.length;++n){if("object"!=typeof t.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");e.controlChanges[n]=s.tensorflow.magenta.NoteSequence.ControlChange.fromObject(t.controlChanges[n])}}if(t.partInfos){if(!Array.isArray(t.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");e.partInfos=[];for(var n=0;n<t.partInfos.length;++n){if("object"!=typeof t.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");e.partInfos[n]=s.tensorflow.magenta.NoteSequence.PartInfo.fromObject(t.partInfos[n])}}if(null!=t.sourceInfo){if("object"!=typeof t.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");e.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(t.sourceInfo)}if(t.textAnnotations){if(!Array.isArray(t.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");e.textAnnotations=[];for(var n=0;n<t.textAnnotations.length;++n){if("object"!=typeof t.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");e.textAnnotations[n]=s.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(t.textAnnotations[n])}}if(t.sectionAnnotations){if(!Array.isArray(t.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");e.sectionAnnotations=[];for(var n=0;n<t.sectionAnnotations.length;++n){if("object"!=typeof t.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");e.sectionAnnotations[n]=s.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(t.sectionAnnotations[n])}}if(t.sectionGroups){if(!Array.isArray(t.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");e.sectionGroups=[];for(var n=0;n<t.sectionGroups.length;++n){if("object"!=typeof t.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");e.sectionGroups[n]=s.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroups[n])}}if(null!=t.quantizationInfo){if("object"!=typeof t.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");e.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(t.quantizationInfo)}if(null!=t.subsequenceInfo){if("object"!=typeof t.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");e.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(t.subsequenceInfo)}if(null!=t.sequenceMetadata){if("object"!=typeof t.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");e.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.fromObject(t.sequenceMetadata)}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),e.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,a.Long){var r=new a.Long(0,0,!1);n.totalQuantizedSteps=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=e.longs===String?"0":0;if(n.subsequenceInfo=null,a.Long){var r=new a.Long(0,0,!1);n.referenceNumber=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.referenceNumber=e.longs===String?"0":0;n.sequenceMetadata=null}if(null!=t.id&&t.hasOwnProperty("id")&&(n.id=t.id),null!=t.filename&&t.hasOwnProperty("filename")&&(n.filename=t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&(n.collectionName=t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=t.ticksPerQuarter),t.timeSignatures&&t.timeSignatures.length){n.timeSignatures=[];for(var i=0;i<t.timeSignatures.length;++i)n.timeSignatures[i]=s.tensorflow.magenta.NoteSequence.TimeSignature.toObject(t.timeSignatures[i],e)}if(t.keySignatures&&t.keySignatures.length){n.keySignatures=[];for(var i=0;i<t.keySignatures.length;++i)n.keySignatures[i]=s.tensorflow.magenta.NoteSequence.KeySignature.toObject(t.keySignatures[i],e)}if(t.tempos&&t.tempos.length){n.tempos=[];for(var i=0;i<t.tempos.length;++i)n.tempos[i]=s.tensorflow.magenta.NoteSequence.Tempo.toObject(t.tempos[i],e)}if(t.notes&&t.notes.length){n.notes=[];for(var i=0;i<t.notes.length;++i)n.notes[i]=s.tensorflow.magenta.NoteSequence.Note.toObject(t.notes[i],e)}if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&(n.totalTime=e.json&&!isFinite(t.totalTime)?String(t.totalTime):t.totalTime),t.pitchBends&&t.pitchBends.length){n.pitchBends=[];for(var i=0;i<t.pitchBends.length;++i)n.pitchBends[i]=s.tensorflow.magenta.NoteSequence.PitchBend.toObject(t.pitchBends[i],e)}if(t.controlChanges&&t.controlChanges.length){n.controlChanges=[];for(var i=0;i<t.controlChanges.length;++i)n.controlChanges[i]=s.tensorflow.magenta.NoteSequence.ControlChange.toObject(t.controlChanges[i],e)}if(t.partInfos&&t.partInfos.length){n.partInfos=[];for(var i=0;i<t.partInfos.length;++i)n.partInfos[i]=s.tensorflow.magenta.NoteSequence.PartInfo.toObject(t.partInfos[i],e)}if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&(n.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.toObject(t.sourceInfo,e)),t.textAnnotations&&t.textAnnotations.length){n.textAnnotations=[];for(var i=0;i<t.textAnnotations.length;++i)n.textAnnotations[i]=s.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(t.textAnnotations[i],e)}if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(t.quantizationInfo,e)),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof t.totalQuantizedSteps?n.totalQuantizedSteps=e.longs===String?String(t.totalQuantizedSteps):t.totalQuantizedSteps:n.totalQuantizedSteps=e.longs===String?a.Long.prototype.toString.call(t.totalQuantizedSteps):e.longs===Number?new a.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber():t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(t.subsequenceInfo,e)),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&("number"==typeof t.referenceNumber?n.referenceNumber=e.longs===String?String(t.referenceNumber):t.referenceNumber:n.referenceNumber=e.longs===String?a.Long.prototype.toString.call(t.referenceNumber):e.longs===Number?new a.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber():t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.toObject(t.sequenceMetadata,e)),t.sectionAnnotations&&t.sectionAnnotations.length){n.sectionAnnotations=[];for(var i=0;i<t.sectionAnnotations.length;++i)n.sectionAnnotations[i]=s.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(t.sectionAnnotations[i],e)}if(t.sectionGroups&&t.sectionGroups.length){n.sectionGroups=[];for(var i=0;i<t.sectionGroups.length;++i)n.sectionGroups[i]=s.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroups[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.pitch=0,t.prototype.pitchName=0,t.prototype.velocity=0,t.prototype.startTime=0,t.prototype.quantizedStartStep=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.endTime=0,t.prototype.quantizedEndStep=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.numerator=0,t.prototype.denominator=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.prototype.part=0,t.prototype.voice=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.pitch&&t.hasOwnProperty("pitch")&&e.uint32(8).int32(t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&e.uint32(16).int32(t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&e.uint32(25).double(t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&e.uint32(33).double(t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(40).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(48).int32(t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(56).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(64).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(72).bool(t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(80).int32(t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&e.uint32(88).int32(t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&e.uint32(96).int32(t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&e.uint32(104).int64(t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&e.uint32(112).int64(t.quantizedEndStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.Note;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.pitch=t.int32();break;case 11:r.pitchName=t.int32();break;case 2:r.velocity=t.int32();break;case 3:r.startTime=t.double();break;case 13:r.quantizedStartStep=a.Long?t.int64().toNumber():t.int64();break;case 4:r.endTime=t.double();break;case 14:r.quantizedEndStep=a.Long?t.int64().toNumber():t.int64();break;case 5:r.numerator=t.int32();break;case 6:r.denominator=t.int32();break;case 7:r.instrument=t.int32();break;case 8:r.program=t.int32();break;case 9:r.isDrum=t.bool();break;case 10:r.part=t.int32();break;case 12:r.voice=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.pitch&&t.hasOwnProperty("pitch")&&!a.isInteger(t.pitch))return"pitch: integer expected";if(null!=t.pitchName&&t.hasOwnProperty("pitchName"))switch(t.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=t.velocity&&t.hasOwnProperty("velocity")&&!a.isInteger(t.velocity)?"velocity: integer expected":null!=t.startTime&&t.hasOwnProperty("startTime")&&"number"!=typeof t.startTime?"startTime: number expected":null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&!(a.isInteger(t.quantizedStartStep)||t.quantizedStartStep&&a.isInteger(t.quantizedStartStep.low)&&a.isInteger(t.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=t.endTime&&t.hasOwnProperty("endTime")&&"number"!=typeof t.endTime?"endTime: number expected":null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&!(a.isInteger(t.quantizedEndStep)||t.quantizedEndStep&&a.isInteger(t.quantizedEndStep.low)&&a.isInteger(t.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=t.numerator&&t.hasOwnProperty("numerator")&&!a.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!a.isInteger(t.denominator)?"denominator: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!a.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!a.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null!=t.part&&t.hasOwnProperty("part")&&!a.isInteger(t.part)?"part: integer expected":null!=t.voice&&t.hasOwnProperty("voice")&&!a.isInteger(t.voice)?"voice: integer expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.Note)return t;var e=new s.tensorflow.magenta.NoteSequence.Note;switch(null!=t.pitch&&(e.pitch=0|t.pitch),t.pitchName){case"UNKNOWN_PITCH_NAME":case 0:e.pitchName=0;break;case"F_FLAT_FLAT":case 1:e.pitchName=1;break;case"C_FLAT_FLAT":case 2:e.pitchName=2;break;case"G_FLAT_FLAT":case 3:e.pitchName=3;break;case"D_FLAT_FLAT":case 4:e.pitchName=4;break;case"A_FLAT_FLAT":case 5:e.pitchName=5;break;case"E_FLAT_FLAT":case 6:e.pitchName=6;break;case"B_FLAT_FLAT":case 7:e.pitchName=7;break;case"F_FLAT":case 8:e.pitchName=8;break;case"C_FLAT":case 9:e.pitchName=9;break;case"G_FLAT":case 10:e.pitchName=10;break;case"D_FLAT":case 11:e.pitchName=11;break;case"A_FLAT":case 12:e.pitchName=12;break;case"E_FLAT":case 13:e.pitchName=13;break;case"B_FLAT":case 14:e.pitchName=14;break;case"F":case 15:e.pitchName=15;break;case"C":case 16:e.pitchName=16;break;case"G":case 17:e.pitchName=17;break;case"D":case 18:e.pitchName=18;break;case"A":case 19:e.pitchName=19;break;case"E":case 20:e.pitchName=20;break;case"B":case 21:e.pitchName=21;break;case"F_SHARP":case 22:e.pitchName=22;break;case"C_SHARP":case 23:e.pitchName=23;break;case"G_SHARP":case 24:e.pitchName=24;break;case"D_SHARP":case 25:e.pitchName=25;break;case"A_SHARP":case 26:e.pitchName=26;break;case"E_SHARP":case 27:e.pitchName=27;break;case"B_SHARP":case 28:e.pitchName=28;break;case"F_SHARP_SHARP":case 29:e.pitchName=29;break;case"C_SHARP_SHARP":case 30:e.pitchName=30;break;case"G_SHARP_SHARP":case 31:e.pitchName=31;break;case"D_SHARP_SHARP":case 32:e.pitchName=32;break;case"A_SHARP_SHARP":case 33:e.pitchName=33;break;case"E_SHARP_SHARP":case 34:e.pitchName=34;break;case"B_SHARP_SHARP":case 35:e.pitchName=35}return null!=t.velocity&&(e.velocity=0|t.velocity),null!=t.startTime&&(e.startTime=Number(t.startTime)),null!=t.quantizedStartStep&&(a.Long?(e.quantizedStartStep=a.Long.fromValue(t.quantizedStartStep)).unsigned=!1:"string"==typeof t.quantizedStartStep?e.quantizedStartStep=parseInt(t.quantizedStartStep,10):"number"==typeof t.quantizedStartStep?e.quantizedStartStep=t.quantizedStartStep:"object"==typeof t.quantizedStartStep&&(e.quantizedStartStep=new a.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber())),null!=t.endTime&&(e.endTime=Number(t.endTime)),null!=t.quantizedEndStep&&(a.Long?(e.quantizedEndStep=a.Long.fromValue(t.quantizedEndStep)).unsigned=!1:"string"==typeof t.quantizedEndStep?e.quantizedEndStep=parseInt(t.quantizedEndStep,10):"number"==typeof t.quantizedEndStep?e.quantizedEndStep=t.quantizedEndStep:"object"==typeof t.quantizedEndStep&&(e.quantizedEndStep=new a.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber())),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),null!=t.part&&(e.part=0|t.part),null!=t.voice&&(e.voice=0|t.voice),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=e.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,a.Long){var r=new a.Long(0,0,!1);n.quantizedStartStep=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.quantizedStartStep=e.longs===String?"0":0;if(a.Long){var r=new a.Long(0,0,!1);n.quantizedEndStep=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.quantizedEndStep=e.longs===String?"0":0}return null!=t.pitch&&t.hasOwnProperty("pitch")&&(n.pitch=t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&(n.velocity=t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&(n.startTime=e.json&&!isFinite(t.startTime)?String(t.startTime):t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&(n.endTime=e.json&&!isFinite(t.endTime)?String(t.endTime):t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&(n.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(n.denominator=t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&(n.part=t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&(n.pitchName=e.enums===String?s.tensorflow.magenta.NoteSequence.PitchName[t.pitchName]:t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&(n.voice=t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&("number"==typeof t.quantizedStartStep?n.quantizedStartStep=e.longs===String?String(t.quantizedStartStep):t.quantizedStartStep:n.quantizedStartStep=e.longs===String?a.Long.prototype.toString.call(t.quantizedStartStep):e.longs===Number?new a.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber():t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&("number"==typeof t.quantizedEndStep?n.quantizedEndStep=e.longs===String?String(t.quantizedEndStep):t.quantizedEndStep:n.quantizedEndStep=e.longs===String?a.Long.prototype.toString.call(t.quantizedEndStep):e.longs===Number?new a.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber():t.quantizedEndStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.PitchName=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_PITCH_NAME"]=0,e[t[1]="F_FLAT_FLAT"]=1,e[t[2]="C_FLAT_FLAT"]=2,e[t[3]="G_FLAT_FLAT"]=3,e[t[4]="D_FLAT_FLAT"]=4,e[t[5]="A_FLAT_FLAT"]=5,e[t[6]="E_FLAT_FLAT"]=6,e[t[7]="B_FLAT_FLAT"]=7,e[t[8]="F_FLAT"]=8,e[t[9]="C_FLAT"]=9,e[t[10]="G_FLAT"]=10,e[t[11]="D_FLAT"]=11,e[t[12]="A_FLAT"]=12,e[t[13]="E_FLAT"]=13,e[t[14]="B_FLAT"]=14,e[t[15]="F"]=15,e[t[16]="C"]=16,e[t[17]="G"]=17,e[t[18]="D"]=18,e[t[19]="A"]=19,e[t[20]="E"]=20,e[t[21]="B"]=21,e[t[22]="F_SHARP"]=22,e[t[23]="C_SHARP"]=23,e[t[24]="G_SHARP"]=24,e[t[25]="D_SHARP"]=25,e[t[26]="A_SHARP"]=26,e[t[27]="E_SHARP"]=27,e[t[28]="B_SHARP"]=28,e[t[29]="F_SHARP_SHARP"]=29,e[t[30]="C_SHARP_SHARP"]=30,e[t[31]="G_SHARP_SHARP"]=31,e[t[32]="D_SHARP_SHARP"]=32,e[t[33]="A_SHARP_SHARP"]=33,e[t[34]="E_SHARP_SHARP"]=34,e[t[35]="B_SHARP_SHARP"]=35,e}(),t.TimeSignature=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.numerator=0,t.prototype.denominator=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(16).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(24).int32(t.denominator),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.TimeSignature;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 2:r.numerator=t.int32();break;case 3:r.denominator=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.numerator&&t.hasOwnProperty("numerator")&&!a.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!a.isInteger(t.denominator)?"denominator: integer expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.TimeSignature)return t;var e=new s.tensorflow.magenta.NoteSequence.TimeSignature;return null!=t.time&&(e.time=Number(t.time)),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&(n.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(n.denominator=t.denominator),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.KeySignature=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.key=0,t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.key&&t.hasOwnProperty("key")&&e.uint32(16).int32(t.key),null!=t.mode&&t.hasOwnProperty("mode")&&e.uint32(24).int32(t.mode),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.KeySignature;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 2:r.key=t.int32();break;case 3:r.mode=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time)return"time: number expected";if(null!=t.key&&t.hasOwnProperty("key"))switch(t.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=t.mode&&t.hasOwnProperty("mode"))switch(t.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.KeySignature)return t;var e=new s.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=t.time&&(e.time=Number(t.time)),t.key){case"C":case 0:e.key=0;break;case"C_SHARP":case 1:e.key=1;break;case"D_FLAT":case 1:e.key=1;break;case"D":case 2:e.key=2;break;case"D_SHARP":case 3:e.key=3;break;case"E_FLAT":case 3:e.key=3;break;case"E":case 4:e.key=4;break;case"F":case 5:e.key=5;break;case"F_SHARP":case 6:e.key=6;break;case"G_FLAT":case 6:e.key=6;break;case"G":case 7:e.key=7;break;case"G_SHARP":case 8:e.key=8;break;case"A_FLAT":case 8:e.key=8;break;case"A":case 9:e.key=9;break;case"A_SHARP":case 10:e.key=10;break;case"B_FLAT":case 10:e.key=10;break;case"B":case 11:e.key=11}switch(t.mode){case"MAJOR":case 0:e.mode=0;break;case"MINOR":case 1:e.mode=1;break;case"NOT_SPECIFIED":case 2:e.mode=2;break;case"MIXOLYDIAN":case 3:e.mode=3;break;case"DORIAN":case 4:e.mode=4;break;case"PHRYGIAN":case 5:e.mode=5;break;case"LYDIAN":case 6:e.mode=6;break;case"LOCRIAN":case 7:e.mode=7}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.key=e.enums===String?"C":0,n.mode=e.enums===String?"MAJOR":0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.key&&t.hasOwnProperty("key")&&(n.key=e.enums===String?s.tensorflow.magenta.NoteSequence.KeySignature.Key[t.key]:t.key),null!=t.mode&&t.hasOwnProperty("mode")&&(n.mode=e.enums===String?s.tensorflow.magenta.NoteSequence.KeySignature.Mode[t.mode]:t.mode),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t.Key=function(){var t={},e=Object.create(t);return e[t[0]="C"]=0,e[t[1]="C_SHARP"]=1,e.D_FLAT=1,e[t[2]="D"]=2,e[t[3]="D_SHARP"]=3,e.E_FLAT=3,e[t[4]="E"]=4,e[t[5]="F"]=5,e[t[6]="F_SHARP"]=6,e.G_FLAT=6,e[t[7]="G"]=7,e[t[8]="G_SHARP"]=8,e.A_FLAT=8,e[t[9]="A"]=9,e[t[10]="A_SHARP"]=10,e.B_FLAT=10,e[t[11]="B"]=11,e}(),t.Mode=function(){var t={},e=Object.create(t);return e[t[0]="MAJOR"]=0,e[t[1]="MINOR"]=1,e[t[2]="NOT_SPECIFIED"]=2,e[t[3]="MIXOLYDIAN"]=3,e[t[4]="DORIAN"]=4,e[t[5]="PHRYGIAN"]=5,e[t[6]="LYDIAN"]=6,e[t[7]="LOCRIAN"]=7,e}(),t}(),t.Tempo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.qpm=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&e.uint32(17).double(t.qpm),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.Tempo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 2:r.qpm=t.double();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.qpm&&t.hasOwnProperty("qpm")&&"number"!=typeof t.qpm?"qpm: number expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.Tempo)return t;var e=new s.tensorflow.magenta.NoteSequence.Tempo;return null!=t.time&&(e.time=Number(t.time)),null!=t.qpm&&(e.qpm=Number(t.qpm)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.qpm=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&(n.qpm=e.json&&!isFinite(t.qpm)?String(t.qpm):t.qpm),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.PitchBend=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.bend=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.bend&&t.hasOwnProperty("bend")&&e.uint32(16).int32(t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(24).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(32).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(40).bool(t.isDrum),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.PitchBend;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 2:r.bend=t.int32();break;case 3:r.instrument=t.int32();break;case 4:r.program=t.int32();break;case 5:r.isDrum=t.bool();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.bend&&t.hasOwnProperty("bend")&&!a.isInteger(t.bend)?"bend: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!a.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!a.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.PitchBend)return t;var e=new s.tensorflow.magenta.NoteSequence.PitchBend;return null!=t.time&&(e.time=Number(t.time)),null!=t.bend&&(e.bend=0|t.bend),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.bend&&t.hasOwnProperty("bend")&&(n.bend=t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.ControlChange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.quantizedStep=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.controlNumber=0,t.prototype.controlValue=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&e.uint32(16).int32(t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&e.uint32(24).int32(t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(32).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(40).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(48).bool(t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(56).int64(t.quantizedStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.ControlChange;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 7:r.quantizedStep=a.Long?t.int64().toNumber():t.int64();break;case 2:r.controlNumber=t.int32();break;case 3:r.controlValue=t.int32();break;case 4:r.instrument=t.int32();break;case 5:r.program=t.int32();break;case 6:r.isDrum=t.bool();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&!(a.isInteger(t.quantizedStep)||t.quantizedStep&&a.isInteger(t.quantizedStep.low)&&a.isInteger(t.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&!a.isInteger(t.controlNumber)?"controlNumber: integer expected":null!=t.controlValue&&t.hasOwnProperty("controlValue")&&!a.isInteger(t.controlValue)?"controlValue: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!a.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!a.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!=typeof t.isDrum?"isDrum: boolean expected":null;
},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.ControlChange)return t;var e=new s.tensorflow.magenta.NoteSequence.ControlChange;return null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(a.Long?(e.quantizedStep=a.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"==typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"==typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"==typeof t.quantizedStep&&(e.quantizedStep=new a.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.controlNumber&&(e.controlNumber=0|t.controlNumber),null!=t.controlValue&&(e.controlValue=0|t.controlValue),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,a.Long){var r=new a.Long(0,0,!1);n.quantizedStep=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.quantizedStep=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&(n.controlNumber=t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&(n.controlValue=t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"==typeof t.quantizedStep?n.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:n.quantizedStep=e.longs===String?a.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new a.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.PartInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.part=0,t.prototype.name="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(8).int32(t.part),null!=t.name&&t.hasOwnProperty("name")&&e.uint32(18).string(t.name),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.PartInfo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.part=t.int32();break;case 2:r.name=t.string();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.part&&t.hasOwnProperty("part")&&!a.isInteger(t.part)?"part: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!a.isString(t.name)?"name: string expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.PartInfo)return t;var e=new s.tensorflow.magenta.NoteSequence.PartInfo;return null!=t.part&&(e.part=0|t.part),null!=t.name&&(e.name=String(t.name)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.part=0,n.name=""),null!=t.part&&t.hasOwnProperty("part")&&(n.part=t.part),null!=t.name&&t.hasOwnProperty("name")&&(n.name=t.name),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.SourceInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sourceType=0,t.prototype.encodingType=0,t.prototype.parser=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&e.uint32(8).int32(t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&e.uint32(16).int32(t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&e.uint32(24).int32(t.parser),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.SourceInfo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.sourceType=t.int32();break;case 2:r.encodingType=t.int32();break;case 3:r.parser=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.sourceType&&t.hasOwnProperty("sourceType"))switch(t.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=t.encodingType&&t.hasOwnProperty("encodingType"))switch(t.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=t.parser&&t.hasOwnProperty("parser"))switch(t.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.SourceInfo)return t;var e=new s.tensorflow.magenta.NoteSequence.SourceInfo;switch(t.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:e.sourceType=0;break;case"SCORE_BASED":case 1:e.sourceType=1;break;case"PERFORMANCE_BASED":case 2:e.sourceType=2}switch(t.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:e.encodingType=0;break;case"MUSIC_XML":case 1:e.encodingType=1;break;case"ABC":case 2:e.encodingType=2;break;case"MIDI":case 3:e.encodingType=3;break;case"MUSICNET":case 4:e.encodingType=4}switch(t.parser){case"UNKNOWN_PARSER":case 0:e.parser=0;break;case"MUSIC21":case 1:e.parser=1;break;case"PRETTY_MIDI":case 2:e.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:e.parser=3;break;case"MAGENTA_MUSICNET":case 4:e.parser=4;break;case"MAGENTA_ABC":case 5:e.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:e.parser=6}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.sourceType=e.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=e.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=e.enums===String?"UNKNOWN_PARSER":0),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&(n.sourceType=e.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[t.sourceType]:t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&(n.encodingType=e.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[t.encodingType]:t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&(n.parser=e.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.Parser[t.parser]:t.parser),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t.SourceType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_SOURCE_TYPE"]=0,e[t[1]="SCORE_BASED"]=1,e[t[2]="PERFORMANCE_BASED"]=2,e}(),t.EncodingType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_ENCODING_TYPE"]=0,e[t[1]="MUSIC_XML"]=1,e[t[2]="ABC"]=2,e[t[3]="MIDI"]=3,e[t[4]="MUSICNET"]=4,e}(),t.Parser=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_PARSER"]=0,e[t[1]="MUSIC21"]=1,e[t[2]="PRETTY_MIDI"]=2,e[t[3]="MAGENTA_MUSIC_XML"]=3,e[t[4]="MAGENTA_MUSICNET"]=4,e[t[5]="MAGENTA_ABC"]=5,e[t[6]="TONEJS_MIDI_CONVERT"]=6,e}(),t}(),t.TextAnnotation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.quantizedStep=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.text="",t.prototype.annotationType=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.text&&t.hasOwnProperty("text")&&e.uint32(18).string(t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&e.uint32(24).int32(t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(32).int64(t.quantizedStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.TextAnnotation;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 4:r.quantizedStep=a.Long?t.int64().toNumber():t.int64();break;case 2:r.text=t.string();break;case 3:r.annotationType=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time)return"time: number expected";if(null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&!(a.isInteger(t.quantizedStep)||t.quantizedStep&&a.isInteger(t.quantizedStep.low)&&a.isInteger(t.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=t.text&&t.hasOwnProperty("text")&&!a.isString(t.text))return"text: string expected";if(null!=t.annotationType&&t.hasOwnProperty("annotationType"))switch(t.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.TextAnnotation)return t;var e=new s.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(a.Long?(e.quantizedStep=a.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"==typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"==typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"==typeof t.quantizedStep&&(e.quantizedStep=new a.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.text&&(e.text=String(t.text)),t.annotationType){case"UNKNOWN":case 0:e.annotationType=0;break;case"CHORD_SYMBOL":case 1:e.annotationType=1;break;case"BEAT":case 2:e.annotationType=2}return e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,n.text="",n.annotationType=e.enums===String?"UNKNOWN":0,a.Long){var r=new a.Long(0,0,!1);n.quantizedStep=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.quantizedStep=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.text&&t.hasOwnProperty("text")&&(n.text=t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&(n.annotationType=e.enums===String?s.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[t.annotationType]:t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"==typeof t.quantizedStep?n.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:n.quantizedStep=e.longs===String?a.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new a.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t.TextAnnotationType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN"]=0,e[t[1]="CHORD_SYMBOL"]=1,e[t[2]="BEAT"]=2,e}(),t}(),t.QuantizationInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}t.prototype.stepsPerQuarter=0,t.prototype.stepsPerSecond=0;var e;return Object.defineProperty(t.prototype,"resolution",{get:a.oneOfGetter(e=["stepsPerQuarter","stepsPerSecond"]),set:a.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&e.uint32(8).int32(t.stepsPerQuarter),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&e.uint32(16).int32(t.stepsPerSecond),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.QuantizationInfo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.stepsPerQuarter=t.int32();break;case 2:r.stepsPerSecond=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(e.resolution=1,!a.isInteger(t.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")){if(1===e.resolution)return"resolution: multiple values";if(e.resolution=1,!a.isInteger(t.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.QuantizationInfo)return t;var e=new s.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=t.stepsPerQuarter&&(e.stepsPerQuarter=0|t.stepsPerQuarter),null!=t.stepsPerSecond&&(e.stepsPerSecond=0|t.stepsPerSecond),e},t.toObject=function(t,e){e||(e={});var n={};return null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=t.stepsPerQuarter,e.oneofs&&(n.resolution="stepsPerQuarter")),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=t.stepsPerSecond,e.oneofs&&(n.resolution="stepsPerSecond")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.SubsequenceInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.startTimeOffset=0,t.prototype.endTimeOffset=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&e.uint32(9).double(t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&e.uint32(17).double(t.endTimeOffset),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.SubsequenceInfo;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.startTimeOffset=t.double();break;case 2:r.endTimeOffset=t.double();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&"number"!=typeof t.startTimeOffset?"startTimeOffset: number expected":null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&"number"!=typeof t.endTimeOffset?"endTimeOffset: number expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.SubsequenceInfo)return t;var e=new s.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=t.startTimeOffset&&(e.startTimeOffset=Number(t.startTimeOffset)),null!=t.endTimeOffset&&(e.endTimeOffset=Number(t.endTimeOffset)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=e.json&&!isFinite(t.startTimeOffset)?String(t.startTimeOffset):t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=e.json&&!isFinite(t.endTimeOffset)?String(t.endTimeOffset):t.endTimeOffset),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.SectionAnnotation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.sectionId=a.Long?a.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(32).int64(t.sectionId),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.SectionAnnotation;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.time=t.double();break;case 4:r.sectionId=a.Long?t.int64().toNumber():t.int64();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!=typeof t.time?"time: number expected":null!=t.sectionId&&t.hasOwnProperty("sectionId")&&!(a.isInteger(t.sectionId)||t.sectionId&&a.isInteger(t.sectionId.low)&&a.isInteger(t.sectionId.high))?"sectionId: integer|Long expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.SectionAnnotation)return t;var e=new s.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=t.time&&(e.time=Number(t.time)),null!=t.sectionId&&(a.Long?(e.sectionId=a.Long.fromValue(t.sectionId)).unsigned=!1:"string"==typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"==typeof t.sectionId?e.sectionId=t.sectionId:"object"==typeof t.sectionId&&(e.sectionId=new a.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,a.Long){var r=new a.Long(0,0,!1);n.sectionId=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.sectionId=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"==typeof t.sectionId?n.sectionId=e.longs===String?String(t.sectionId):t.sectionId:n.sectionId=e.longs===String?a.Long.prototype.toString.call(t.sectionId):e.longs===Number?new a.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.Section=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}t.prototype.sectionId=a.Long?a.Long.fromBits(0,0,!1):0,t.prototype.sectionGroup=null;var e;return Object.defineProperty(t.prototype,"sectionType",{get:a.oneOfGetter(e=["sectionId","sectionGroup"]),set:a.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(8).int64(t.sectionId),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&s.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroup,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.Section;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.sectionId=a.Long?t.int64().toNumber():t.int64();break;case 2:r.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32());break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";var e={};if(null!=t.sectionId&&t.hasOwnProperty("sectionId")&&(e.sectionType=1,!(a.isInteger(t.sectionId)||t.sectionId&&a.isInteger(t.sectionId.low)&&a.isInteger(t.sectionId.high))))return"sectionId: integer|Long expected";if(null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")){if(1===e.sectionType)return"sectionType: multiple values";e.sectionType=1;var n=s.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroup);if(n)return"sectionGroup."+n}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.Section)return t;var e=new s.tensorflow.magenta.NoteSequence.Section;if(null!=t.sectionId&&(a.Long?(e.sectionId=a.Long.fromValue(t.sectionId)).unsigned=!1:"string"==typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"==typeof t.sectionId?e.sectionId=t.sectionId:"object"==typeof t.sectionId&&(e.sectionId=new a.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),null!=t.sectionGroup){if("object"!=typeof t.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");e.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroup)}return e},t.toObject=function(t,e){e||(e={});var n={};return null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"==typeof t.sectionId?n.sectionId=e.longs===String?String(t.sectionId):t.sectionId:n.sectionId=e.longs===String?a.Long.prototype.toString.call(t.sectionId):e.longs===Number?new a.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId,e.oneofs&&(n.sectionType="sectionId")),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&(n.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroup,e),e.oneofs&&(n.sectionType="sectionGroup")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.SectionGroup=function(){function t(t){if(this.sections=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sections=a.emptyArray,t.prototype.numTimes=0,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.sections&&t.sections.length)for(var n=0;n<t.sections.length;++n)s.tensorflow.magenta.NoteSequence.Section.encode(t.sections[n],e.uint32(10).fork()).ldelim();return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&e.uint32(16).int32(t.numTimes),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.NoteSequence.SectionGroup;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(s.tensorflow.magenta.NoteSequence.Section.decode(t,t.uint32()));break;case 2:r.numTimes=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.sections&&t.hasOwnProperty("sections")){if(!Array.isArray(t.sections))return"sections: array expected";for(var e=0;e<t.sections.length;++e){var n=s.tensorflow.magenta.NoteSequence.Section.verify(t.sections[e]);if(n)return"sections."+n}}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&!a.isInteger(t.numTimes)?"numTimes: integer expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.NoteSequence.SectionGroup)return t;var e=new s.tensorflow.magenta.NoteSequence.SectionGroup;if(t.sections){if(!Array.isArray(t.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");e.sections=[];for(var n=0;n<t.sections.length;++n){if("object"!=typeof t.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");e.sections[n]=s.tensorflow.magenta.NoteSequence.Section.fromObject(t.sections[n])}}return null!=t.numTimes&&(e.numTimes=0|t.numTimes),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.sections=[]),e.defaults&&(n.numTimes=0),t.sections&&t.sections.length){n.sections=[];for(var r=0;r<t.sections.length;++r)n.sections[r]=s.tensorflow.magenta.NoteSequence.Section.toObject(t.sections[r],e)}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&(n.numTimes=t.numTimes),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t}(),t.SequenceMetadata=function(){function t(t){if(this.genre=[],this.composers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.title="",t.prototype.artist="",t.prototype.genre=a.emptyArray,t.prototype.composers=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.title&&t.hasOwnProperty("title")&&e.uint32(10).string(t.title),null!=t.artist&&t.hasOwnProperty("artist")&&e.uint32(18).string(t.artist),null!=t.genre&&t.genre.length)for(var n=0;n<t.genre.length;++n)e.uint32(26).string(t.genre[n]);if(null!=t.composers&&t.composers.length)for(var n=0;n<t.composers.length;++n)e.uint32(34).string(t.composers[n]);return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.SequenceMetadata;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.title=t.string();break;case 2:r.artist=t.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(t.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(t.string());break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.title&&t.hasOwnProperty("title")&&!a.isString(t.title))return"title: string expected";if(null!=t.artist&&t.hasOwnProperty("artist")&&!a.isString(t.artist))return"artist: string expected";if(null!=t.genre&&t.hasOwnProperty("genre")){if(!Array.isArray(t.genre))return"genre: array expected";for(var e=0;e<t.genre.length;++e)if(!a.isString(t.genre[e]))return"genre: string[] expected"}if(null!=t.composers&&t.hasOwnProperty("composers")){if(!Array.isArray(t.composers))return"composers: array expected";for(var e=0;e<t.composers.length;++e)if(!a.isString(t.composers[e]))return"composers: string[] expected"}return null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.SequenceMetadata)return t;var e=new s.tensorflow.magenta.SequenceMetadata;if(null!=t.title&&(e.title=String(t.title)),null!=t.artist&&(e.artist=String(t.artist)),t.genre){if(!Array.isArray(t.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");e.genre=[];for(var n=0;n<t.genre.length;++n)e.genre[n]=String(t.genre[n])}if(t.composers){if(!Array.isArray(t.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");e.composers=[];for(var n=0;n<t.composers.length;++n)e.composers[n]=String(t.composers[n])}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.genre=[],n.composers=[]),e.defaults&&(n.title="",n.artist=""),null!=t.title&&t.hasOwnProperty("title")&&(n.title=t.title),null!=t.artist&&t.hasOwnProperty("artist")&&(n.artist=t.artist),t.genre&&t.genre.length){n.genre=[];for(var r=0;r<t.genre.length;++r)n.genre[r]=t.genre[r]}if(t.composers&&t.composers.length){n.composers=[];for(var r=0;r<t.composers.length;++r)n.composers[r]=t.composers[r]}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t.VelocityRange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.min=0,t.prototype.max=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),null!=t.min&&t.hasOwnProperty("min")&&e.uint32(8).int32(t.min),null!=t.max&&t.hasOwnProperty("max")&&e.uint32(16).int32(t.max),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));for(var n=void 0===e?t.len:t.pos+e,r=new s.tensorflow.magenta.VelocityRange;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:r.min=t.int32();break;case 2:r.max=t.int32();break;default:t.skipType(7&o)}}return r},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!=typeof t||null===t?"object expected":null!=t.min&&t.hasOwnProperty("min")&&!a.isInteger(t.min)?"min: integer expected":null!=t.max&&t.hasOwnProperty("max")&&!a.isInteger(t.max)?"max: integer expected":null},t.fromObject=function(t){if(t instanceof s.tensorflow.magenta.VelocityRange)return t;var e=new s.tensorflow.magenta.VelocityRange;return null!=t.min&&(e.min=0|t.min),null!=t.max&&(e.max=0|t.max),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.min=0,n.max=0),null!=t.min&&t.hasOwnProperty("min")&&(n.min=t.min),null!=t.max&&t.hasOwnProperty("max")&&(n.max=t.max),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},t}(),t}(),t}(),t.exports=s},function(t,e,n){"use strict";function r(t){return C(this,void 0,void 0,function(){return M(this,function(e){return[2,fetch(t).then(function(t){return t.arrayBuffer()}).then(function(t){return j.decodeAudioData(t)})]})})}function i(t){return C(this,void 0,void 0,function(){var e,n;return M(this,function(r){return e=new FileReader,n=new Promise(function(n,r){e.onerror=function(){e.abort(),r(new DOMException("Something went wrong reading that file."))},e.onload=function(){n(e.result)},e.readAsArrayBuffer(t)}),[2,n.then(function(t){return j.decodeAudioData(t)})]})})}function o(t){return C(this,void 0,void 0,function(){var e;return M(this,function(n){switch(n.label){case 0:return[4,l(t)];case 1:return e=n.sent(),[2,s(a(e,{sampleRate:z.SAMPLE_RATE,hopLength:z.SPEC_HOP_LENGTH,nMels:z.MEL_SPEC_BINS,nFft:2048,fMin:30}))]}})})}function a(t,e){e.power||(e.power=2);var n=p(t,e),r=c(n,e.power),i=r[0],o=r[1];e.nFft=o;var a=b(e);return h(i,a)}function s(t,e,n){void 0===e&&(e=1e-10),void 0===n&&(n=80);for(var r=t.length,i=t[0].length,o=[],a=0;a<r;a++)o[a]=new Float32Array(i);for(var a=0;a<r;a++)for(var s=0;s<i;s++){var u=t[a][s];o[a][s]=10*Math.log10(Math.max(e,u))}if(n){if(n<0)throw new Error("topDb must be non-negative.");for(var a=0;a<r;a++)for(var l=I(o[a]),s=0;s<i;s++)o[a][s]=Math.max(o[a][s],l-n)}return o}function u(t){if(1===t.numberOfChannels)return t.getChannelData(0);if(2!==t.numberOfChannels)throw Error(t.numberOfChannels+" channel audio is not supported.");for(var e=t.getChannelData(0),n=t.getChannelData(1),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=(e[i]+n[i])/2;return r}function l(t,e){return void 0===e&&(e=z.SAMPLE_RATE),C(this,void 0,void 0,function(){var n,r,i,o,a;return M(this,function(s){return t.sampleRate===e?[2,u(t)]:(n=t.sampleRate,r=t.length*e/n,B?(F.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5),o=u(t),a=new Float32Array(r),L(D(a,[r]),D(o,[o.length])),[2,a]):(i=j.createBufferSource(),i.buffer=t,i.connect(j.destination),i.start(),[2,j.startRendering().then(function(t){return t.getChannelData(0)})]))})})}function c(t,e){var n=t.map(function(t){return k(x(t),e)}),r=t[0].length-1;return[n,r]}function p(t,e){var n=e.nFft||2048,r=e.winLength||n,i=e.hopLength||Math.floor(r/4),o=w(r);o=m(o,n),t=g(t,Math.floor(n/2));for(var a=v(t,n,i),s=[],u=a.length,l=n+2,c=0;c<u;c++){var p=new Float32Array(l);s[c]=p}for(var c=0;c<u;c++){var h=d(a[c],o),p=_(h);s[c].set(p.slice(0,l))}return s}function h(t,e){for(var n=[],r=0;r<t.length;r++)n[r]=f(t[r],e);return n}function f(t,e){if(t.length!==e[0].length)throw new Error("Each entry in filterbank should have dimensions "+("matching FFT. |mags| = "+t.length+", ")+("|filterbank[0]| = "+e[0].length+"."));for(var n=new Float32Array(e.length),r=0;r<e.length;r++){var i=d(t,e[r]);n[r]=i.reduce(function(t,e){return t+e})}return n}function d(t,e){if(t.length!==e.length)return console.error("Buffer length "+t.length+" != window length "+e.length+"."),null;for(var n=new Float32Array(t.length),r=0;r<t.length;r++)n[r]=e[r]*t[r];return n}function m(t,e){if(t.length>e)throw new Error("Data is longer than length.");
var n=Math.floor((e-t.length)/2),r=e-t.length-n;return y(t,[n,r])}function y(t,e){var n,r;"object"==typeof e?(n=e[0],r=e[1]):n=r=e;var i=new Float32Array(t.length+n+r);return i.set(t,n),i}function g(t,e){for(var n=y(t,e),r=0;r<e;r++)n[r]=n[2*e-r],n[n.length-r-1]=n[n.length-2*e+r-1];return n}function v(t,e,n){for(var r=Math.floor((t.length-e)/n)+1,i=Array.from({length:r},function(t,n){return new Float32Array(e)}),o=0;o<r;o++){var a=o*n,s=t.slice(a,a+e);i[o].set(s),s.length===e}return i}function b(t){for(var e=t.fMin||0,n=t.fMax||t.sampleRate/2,r=t.nMels||128,i=t.nFft||2048,o=E(t.sampleRate,i),a=A(r+2,e,n),s=N(a),u=O(a,o),l=u[0].length,c=[],p=0;p<r;p++){c[p]=new Float32Array(l);for(var h=0;h<u[p].length;h++){var f=-u[p][h]/s[p],d=u[p+2][h]/s[p+1],m=Math.max(0,Math.min(f,d));c[p][h]=m}}for(var y=function(t){var e=2/(a[2+t]-a[t]);c[t]=c[t].map(function(t){return t*e})},p=0;p<c.length;p++)y(p);return c}function _(t){var e=new R(t.length),n=e.createComplexArray(),r=e.toComplexArray(t);return e.transform(n,r),n}function w(t){for(var e=new Float32Array(t),n=0;n<t;n++)e[n]=.5*(1-Math.cos(2*Math.PI*n/(t-1)));return e}function S(t,e,n){for(var r=(e-t)/(n-1),i=new Float32Array(n),o=0;o<n;o++)i[o]=t+r*o;return i}function x(t){for(var e=new Float32Array(t.length/2),n=0;n<t.length/2;n++)e[n]=Math.sqrt(t[2*n]*t[2*n]+t[2*n+1]*t[2*n+1]);return e}function T(t){return 1125*Math.log(1+t/700)}function P(t){return 700*(Math.exp(t/1125)-1)}function E(t,e){return S(0,t/2,Math.floor(1+e/2))}function A(t,e,n){var r=T(e),i=T(n),o=S(r,i,t),a=o.map(function(t){return P(t)});return a}function N(t){for(var e=new Float32Array(t.length-1),n=0;n<t.length;n++)e[n]=t[n+1]-t[n];return e}function O(t,e){for(var n=[],r=0;r<t.length;r++)n[r]=new Float32Array(e.length);for(var r=0;r<t.length;r++)for(var i=0;i<e.length;i++)n[r][i]=t[r]-e[i];return n}function k(t,e){return t.map(function(t){return Math.pow(t,e)})}function I(t){return t.reduce(function(t,e){return Math.max(t,e)})}var C=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},M=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var R=n(357),D=n(99),L=n(365),F=n(46),z=n(73),q=44100,V=window,B=V.webkitOfflineAudioContext,j=B?new V.webkitOfflineAudioContext(1,q,q):new V.OfflineAudioContext(1,z.SAMPLE_RATE,z.SAMPLE_RATE);e.loadAudioFromUrl=r,e.loadAudioFromFile=i,e.preprocessAudio=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(188);e.OnsetsAndFrames=r.OnsetsAndFrames},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(97),a=n(46),s=n(186),u=n(73),l=n(189),c=function(){function t(t,e){void 0===e&&(e=250),this.checkpointURL=t,this.chunkLength=e}return t.prototype.initialize=function(){return r(this,void 0,void 0,function(){var t,e,n=this;return i(this,function(r){switch(r.label){case 0:return this.dispose(),t=performance.now(),[4,fetch(this.checkpointURL+"/weights_manifest.json").then(function(t){return t.json()}).then(function(t){return o.io.loadWeights(t,n.checkpointURL)})];case 1:return e=r.sent(),this.build(e),Object.keys(e).map(function(t){return e[t].dispose()}),this.initialized=!0,a.logWithDuration("Initialized model",t,"O&F"),[2]}})})},t.prototype.dispose=function(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)},t.prototype.isInitialized=function(){return this.initialized},t.prototype.transcribeFromMelSpec=function(t,e){return void 0===e&&(e=4),r(this,void 0,void 0,function(){var n,r,s,u,c,p,h=this;return i(this,function(i){return this.isInitialized()||this.initialize(),n=performance.now(),a.log("Computing onsets, frames, and velocities...","O&F",20),r=o.tidy(function(){var n=l.batchInput(t,h.chunkLength);return h.processBatches(n,h.chunkLength,t.length,e)}),s=r[0],u=r[1],c=r[2],a.log("Converting to NoteSequence...","O&F",20),p=l.pianorollToNoteSequence(s,u,c),p.then(function(){s.dispose(),u.dispose(),c.dispose(),a.logWithDuration("Transcribed from mel spec",n,"O&F")}),[2,p]})})},t.prototype.transcribeFromAudioBuffer=function(t,e){return void 0===e&&(e=4),r(this,void 0,void 0,function(){var n,r,o=this;return i(this,function(i){return n=performance.now(),r=s.preprocessAudio(t),r.then(function(){return a.logWithDuration("Converted audio to mel spec",n,"O&F",20)}),[2,r.then(function(t){return o.transcribeFromMelSpec(t.map(function(t){return Array.from(t)},e))})]})})},t.prototype.transcribeFromAudioFile=function(t){return r(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return[4,s.loadAudioFromFile(t)];case 1:return e=n.sent(),[2,this.transcribeFromAudioBuffer(e)]}})})},t.prototype.transcribeFromAudioURL=function(t){return r(this,void 0,void 0,function(){var e;return i(this,function(n){switch(n.label){case 0:return[4,s.loadAudioFromUrl(t)];case 1:return e=n.sent(),[2,this.transcribeFromAudioBuffer(e)]}})})},t.prototype.processBatches=function(t,e,n,r){var i,a,s,u,c=this,p=function(t){return[c.onsetsCnn.predict(t,r),c.activationCnn.predict(t,r),c.velocityCnn.predict(t,r)]};if(1===t.shape[0])i=p(t.expandDims(-1)),a=i[0],s=i[1],u=i[2];else{for(var h=p(t.expandDims(-1)),f=[],d=0;d<3;++d)f.push(l.unbatchOutput(h[d],e,n));a=f[0],s=f[1],u=f[2]}var m=this.onsetsRnn.predict(a,this.chunkLength);a.dispose();var y=o.concat3d([m,s],-1);s.dispose();var g=this.frameRnn.predict(y,this.chunkLength),v=o.clipByValue(u,0,1).mul(o.scalar(80)).add(o.scalar(10)).toInt();return u.dispose(),[g.squeeze(),m.squeeze(),v.squeeze()]},t.prototype.build=function(t){var e=this;o.tidy(function(){e.onsetsCnn=new p,e.onsetsCnn.setWeights(t,"onsets"),e.onsetsRnn=new h([null,e.onsetsCnn.outputShape[2]]),e.onsetsRnn.setWeights(t,"onsets","onset_probs"),e.activationCnn=new p("sigmoid"),e.activationCnn.setWeights(t,"frame","activation_probs"),e.frameRnn=new h([null,2*u.MIDI_PITCHES]),e.frameRnn.setWeights(t,"frame","frame_probs"),e.velocityCnn=new p("linear"),e.velocityCnn.setWeights(t,"velocity","onset_velocities")})},t}();e.OnsetsAndFrames=c;var p=function(){function t(t){this.nn=o.sequential();var e={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,u.MEL_SPEC_BINS,1],trainable:!1},n={scale:!1,trainable:!1};this.nn.add(o.layers.conv2d(e)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),e.inputShape=null,this.nn.add(o.layers.conv2d(e)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),this.nn.add(o.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),e.filters=96,this.nn.add(o.layers.conv2d(e)),this.nn.add(o.layers.batchNormalization(n)),this.nn.add(o.layers.activation({activation:"relu"})),this.nn.add(o.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));var r=this.nn.outputShape;this.nn.add(o.layers.reshape({targetShape:[r[1],r[2]*r[3]]})),this.nn.add(o.layers.dense({units:768,activation:"relu",trainable:!1})),t&&this.nn.add(o.layers.dense({units:u.MIDI_PITCHES,activation:t,trainable:!1})),this.outputShape=this.nn.outputShape}return t.prototype.dispose=function(){this.nn.dispose()},t.prototype.predict=function(t,e){return this.nn.predict(t,{batchSize:e})},t.prototype.setWeights=function(t,e,n){function r(e){var n=t[e];if(void 0===n)throw Error("Variable not found: "+e);return n}var i=[r(e+"/conv0/weights"),r(e+"/conv0/BatchNorm/beta"),r(e+"/conv0/BatchNorm/moving_mean"),r(e+"/conv0/BatchNorm/moving_variance"),r(e+"/conv1/weights"),r(e+"/conv1/BatchNorm/beta"),r(e+"/conv1/BatchNorm/moving_mean"),r(e+"/conv1/BatchNorm/moving_variance"),r(e+"/conv2/weights"),r(e+"/conv2/BatchNorm/beta"),r(e+"/conv2/BatchNorm/moving_mean"),r(e+"/conv2/BatchNorm/moving_variance"),r(e+"/fc_end/weights"),r(e+"/fc_end/biases")];n&&(i=i.concat([r(e+"/"+n+"/weights"),r(e+"/"+n+"/biases")])),this.nn.setWeights(i)},t}(),h=function(){function t(t,e){function n(){var n=o.layers.lstm({inputShape:t,units:e,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),r=[o.input({shape:t}),o.input({shape:[e]}),o.input({shape:[e]})],i=n.apply(r);return o.model({inputs:r,outputs:i})}void 0===e&&(e=384),this.dense=o.sequential(),this.units=e,this.lstm=n(),this.dense.add(o.layers.dense({inputShape:[null,e],units:u.MIDI_PITCHES,activation:"sigmoid",trainable:!1}))}return t.prototype.dispose=function(){this.lstm.dispose(),this.dense.dispose()},t.prototype.setWeights=function(t,e,n){function r(e){var n=t[e];if(void 0===n)throw Error("Variable not found: "+e);return n}var i=this,a=function(t,e){void 0===e&&(e=0);var n=o.split(t,4,-1),r=n[0],i=n[1],a=n[2],s=n[3];return o.concat([r,a.add(o.scalar(e)),i,s],-1)},s=function(t){return o.split(a(t),[t.shape[0]-i.units,i.units])},u="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell",l=function(t){return t.setWeights(s(r(e+"/"+u+"/kernel")).concat(a(r(e+"/"+u+"/bias"),1)))};l(this.lstm),this.dense.setWeights([r(e+"/"+n+"/weights"),r(e+"/"+n+"/biases")])},t.prototype.predict=function(t,e){var n=this;return o.tidy(function(){return n.predictImpl(t,e)})},t.prototype.predictImpl=function(t,e){for(var n=t.shape[1],r=Math.ceil(n/e),i=[o.zeros([1,this.units]),o.zeros([1,this.units])],a=[],s=0;s<r;++s){var u=t.slice([0,s*e],[-1,s<r-1?e:-1]),l=this.lstm.predict([u,i[0],i[1]]);a.push(this.dense.predict(l[0])),i=l.slice(1)}return 1===a.length?a[0]:o.concat3d(a,1)},t}()},function(t,e,n){"use strict";function r(t,e){var n=Math.ceil(t.length/e),r=t.length%e,i=0;if(n>1&&r>0&&r<=p&&(n-=1,i=r,r=0),1===n)return u.tensor2d(t).expandDims(0);var o=e+2*p,a=u.tensor2d(t.slice(0,o)).expandDims(0),s=u.tensor2d(t.slice(t.length-o)).expandDims(0);if(2===n)return u.concat([a,s],0);var l;l=r?u.tensor2d(t).pad([[0,e-r],[0,0]]).as3D(n,e,-1):u.tensor2d(t.slice(0,t.length-i)).as3D(n,e,-1);var c=u.slice(l,[0,e-p],[n-2,-1]),h=u.slice(l,[2,0],[-1,p]),f=u.concat([c,l.slice(1,n-2),h],1);return u.concat([a,f,s],0)}function i(t,e,n){return 1===t.shape[0]?t:u.tidy(function(){var r=t.slice([0,0],[1,e]),i=n%e;i<=p&&(i+=e);var o=t.slice([t.shape[0]-1,t.shape[1]-i],[-1,-1]),a=[r,o];if(t.shape[0]>2){var s=t.shape[0]-2,l=t.slice([1,p],[s,e]);a=[r,l.as3D(1,s*e,-1),o]}return u.concat(a,1)})}function o(t,e,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=.5),a(this,void 0,void 0,function(){function o(t,e){p.notes.push(l.NoteSequence.Note.create({pitch:t+c.MIN_MIDI_PITCH,startTime:(h[t]-1)*c.FRAME_LENGTH_SECONDS,endTime:e*c.FRAME_LENGTH_SECONDS,velocity:f[t]})),h[t]=0}function a(t,e,n){h[t]?d[t]||(o(t,e),h[t]=e+1,f[t]=n):(h[t]=e+1,f[t]=n)}var p,h,f,d,m,y,g,v,b,_,w,S,x;return s(this,function(s){switch(s.label){case 0:return p=l.NoteSequence.create(),h=new Uint32Array(c.MIDI_PITCHES),f=new Uint8Array(c.MIDI_PITCHES),d=new Uint8Array(c.MIDI_PITCHES),m=u.tidy(function(){var o=u.greater(e,r),a=u.greater(t,i);return o=o.pad([[0,1],[0,0]]),a=a.pad([[0,1],[0,0]]),n=n.pad([[0,1],[0,0]]),a=u.logicalOr(a,o),[a,o,n]}),[4,Promise.all(m.map(function(t){return t.data()}))];case 1:for(y=s.sent(),g=y[0],v=y[1],b=y[2],m.forEach(function(t){return t.dispose()}),_=t.shape[0],w=0;w<_+1;++w){for(S=0;S<c.MIDI_PITCHES;++S)x=w*c.MIDI_PITCHES+S,v[x]?a(S,w,b[x]):!g[x]&&h[S]&&o(S,w);d=v.slice(w*c.MIDI_PITCHES,(w+1)*c.MIDI_PITCHES)}return p.totalTime=_*c.FRAME_LENGTH_SECONDS,[2,p]}})})}var a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var u=n(97),l=n(32),c=n(73),p=3;e.batchInput=r,e.unbatchOutput=i,e.pianorollToNoteSequence=o},function(t,e){"use strict";function n(t,e){for(var n=new Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(t){if(o)if(o=!1,t)a(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,a(t))}})}t.exports=n},function(t,e){"use strict";var n=e;n.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var r=new Array(64),i=new Array(123),o=0;o<64;)i[r[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;n.encode=function(t,e,n){for(var i,o=null,a=[],s=0,u=0;e<n;){var l=t[e++];switch(u){case 0:a[s++]=r[l>>2],i=(3&l)<<4,u=1;break;case 1:a[s++]=r[i|l>>4],i=(15&l)<<2,u=2;break;case 2:a[s++]=r[i|l>>6],a[s++]=r[63&l],u=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return u&&(a[s++]=r[i],a[s++]=61,1===u&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var a="invalid encoding";n.decode=function(t,e,n){for(var r,o=n,s=0,u=0;u<t.length;){var l=t.charCodeAt(u++);if(61===l&&s>1)break;if(void 0===(l=i[l]))throw Error(a);switch(s){case 0:r=l,s=1;break;case 1:e[n++]=r<<2|(48&l)>>4,r=l,s=2;break;case 2:e[n++]=(15&r)<<4|(60&l)>>2,r=l,s=3;break;case 3:e[n++]=(3&r)<<6|l,s=0}}if(1===s)throw Error(a);return n-o},n.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)}},function(t,e){"use strict";function n(){this._listeners={}}t.exports=n,n.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},n.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},n.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this}},function(t,e){"use strict";function n(t){return"undefined"!=typeof Float32Array?function(){function e(t,e,n){o[0]=t,e[n]=a[0],e[n+1]=a[1],e[n+2]=a[2],e[n+3]=a[3]}function n(t,e,n){o[0]=t,e[n]=a[3],e[n+1]=a[2],e[n+2]=a[1],e[n+3]=a[0]}function r(t,e){return a[0]=t[e],a[1]=t[e+1],a[2]=t[e+2],a[3]=t[e+3],o[0]}function i(t,e){return a[3]=t[e],a[2]=t[e+1],a[1]=t[e+2],a[0]=t[e+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];t.writeFloatLE=s?e:n,t.writeFloatBE=s?n:e,t.readFloatLE=s?r:i,t.readFloatBE=s?i:r}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>3.4028234663852886e38)t((i<<31|2139095040)>>>0,n,r);else if(e<1.1754943508222875e-38)t((i<<31|Math.round(e/1.401298464324817e-45))>>>0,n,r);else{var o=Math.floor(Math.log(e)/Math.LN2),a=8388607&Math.round(e*Math.pow(2,-o)*8388608);t((i<<31|o+127<<23|a)>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,o=r>>>23&255,a=8388607&r;return 255===o?a?NaN:i*(1/0):0===o?1.401298464324817e-45*i*a:i*Math.pow(2,o-150)*(a+8388608)}t.writeFloatLE=e.bind(null,r),t.writeFloatBE=e.bind(null,i),t.readFloatLE=n.bind(null,o),t.readFloatBE=n.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){function e(t,e,n){o[0]=t,e[n]=a[0],e[n+1]=a[1],e[n+2]=a[2],e[n+3]=a[3],e[n+4]=a[4],e[n+5]=a[5],e[n+6]=a[6],e[n+7]=a[7]}function n(t,e,n){o[0]=t,e[n]=a[7],e[n+1]=a[6],e[n+2]=a[5],e[n+3]=a[4],e[n+4]=a[3],e[n+5]=a[2],e[n+6]=a[1],e[n+7]=a[0]}function r(t,e){return a[0]=t[e],a[1]=t[e+1],a[2]=t[e+2],a[3]=t[e+3],a[4]=t[e+4],a[5]=t[e+5],a[6]=t[e+6],a[7]=t[e+7],o[0]}function i(t,e){return a[7]=t[e],a[6]=t[e+1],a[5]=t[e+2],a[4]=t[e+3],a[3]=t[e+4],a[2]=t[e+5],a[1]=t[e+6],a[0]=t[e+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];t.writeDoubleLE=s?e:n,t.writeDoubleBE=s?n:e,t.readDoubleLE=s?r:i,t.readDoubleBE=s?i:r}():function(){function e(t,e,n,r,i,o){var a=r<0?1:0;if(a&&(r=-r),0===r)t(0,i,o+e),t(1/r>0?0:2147483648,i,o+n);else if(isNaN(r))t(0,i,o+e),t(2146959360,i,o+n);else if(r>1.7976931348623157e308)t(0,i,o+e),t((a<<31|2146435072)>>>0,i,o+n);else{var s;if(r<2.2250738585072014e-308)s=r/5e-324,t(s>>>0,i,o+e),t((a<<31|s/4294967296)>>>0,i,o+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),s=r*Math.pow(2,-u),t(4503599627370496*s>>>0,i,o+e),t((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+n)}}}function n(t,e,n,r,i){var o=t(r,i+e),a=t(r,i+n),s=2*(a>>31)+1,u=a>>>20&2047,l=4294967296*(1048575&a)+o;return 2047===u?l?NaN:s*(1/0):0===u?5e-324*s*l:s*Math.pow(2,u-1075)*(l+4503599627370496)}t.writeDoubleLE=e.bind(null,r,0,4),t.writeDoubleBE=e.bind(null,i,4,0),t.readDoubleLE=n.bind(null,o,0,4),t.readDoubleBE=n.bind(null,a,4,0)}(),t}function r(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function i(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=n(n)},function(module,exports){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},function(t,e){"use strict";function n(t,e,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){if(n<1||n>i)return t(n);a+n>r&&(o=t(r),a=0);var s=e.call(o,a,a+=n);return 7&a&&(a=(7|a)+1),s}}t.exports=n},function(t,e){"use strict";var n=e;n.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:55296===(64512&n)&&56320===(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},n.read=function(t,e,n){var r=n-e;if(r<1)return"";for(var i,o=null,a=[],s=0;e<n;)i=t[e++],i<128?a[s++]=i:i>191&&i<224?a[s++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,a[s++]=55296+(i>>10),a[s++]=56320+(1023&i)):a[s++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0);return o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},n.write=function(t,e,n){for(var r,i,o=n,a=0;a<t.length;++a)r=t.charCodeAt(a),r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(i=t.charCodeAt(a+1)))?(r=65536+((1023&r)<<10)+(1023&i),++a,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-o}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var n=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(n))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map(function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId}).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}();e.ExecutionContext=n},function(t,e,n){"use strict";function r(t,e,n){return i(this,void 0,void 0,function(){var r;return o(this,function(i){switch(i.label){case 0:return r=new c(t,e,n),[4,r.load()];case 1:return i.sent(),[2,r]}})})}var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(111),u=n(232),l=n(199),c=function(){function t(t,e,n){this.modelUrl=t,this.weightManifestUrl=e,this.requestOption=n,this.version="n/a"}return Object.defineProperty(t.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),t.prototype.findIOHandler=function(){var t=[this.modelUrl,this.weightManifestUrl];if(this.requestOption)this.handler=a.io.browserHTTPRequest(t,this.requestOption);else{var e=a.io.getLoadHandlers(t);if(0===e.length)e.push(a.io.browserHTTPRequest(t,this.requestOption));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for "+("URL '"+[t]+"'"));this.handler=e[0]}},t.prototype.load=function(){return i(this,void 0,void 0,function(){var t,e,n;return o(this,function(r){switch(r.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,this.handler.load()];case 1:return t=r.sent(),e=s.tensorflow.GraphDef.decode(new Uint8Array(t.modelTopology)),this.version=e.versions.producer+"."+e.versions.minConsumer,n=a.io.decodeWeights(t.weightData,t.weightSpecs),this.executor=new l.GraphExecutor(u.OperationMapper.Instance.transformGraph(e)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}})})},t.prototype.predict=function(t,e){return this.execute_(t,!0,this.outputNodes)},t.prototype.constructTensorMap=function(t){var e=t instanceof a.Tensor?[t]:t;if(e.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+("the frozen model has "+this.inputNodes.length+" placeholders, ")+("while there are "+e.length+" input tensors."));return this.inputNodes.reduce(function(t,n,r){return t[n]=e[r],t},{})},t.prototype.execute=function(t,e){return this.execute_(t,!1,e)},t.prototype.execute_=function(t,e,n){if(void 0===e&&(e=!0),n=n||this.outputNodes,(t instanceof a.Tensor||Array.isArray(t))&&(t=this.constructTensorMap(t)),this.executor.isControlFlowModel||this.executor.isDynamicShapeModel)throw new Error("The model contains control flow or dynamic shape ops, please use executeAsync method");var r=this.executor.execute(this.convertTensorMapToTensorsMap(t),e,n),i=Object.keys(r);return Array.isArray(n)&&n.length>1?n.map(function(t){return r[t]}):r[i[0]]},t.prototype.executeAsync=function(t,e){return i(this,void 0,void 0,function(){var n,r;return o(this,function(i){switch(i.label){case 0:if(!this.executor.isControlFlowModel&&!this.executor.isDynamicShapeModel)throw new Error("The model does not contain control flow or dynamic shape ops, please use execute method for better performance.");return e=e||this.outputNodes,(t instanceof a.Tensor||Array.isArray(t))&&(t=this.constructTensorMap(t)),[4,this.executor.executeAsync(this.convertTensorMapToTensorsMap(t),e)];case 1:return n=i.sent(),r=Object.keys(n),[2,Array.isArray(e)&&e.length>1?e.map(function(t){return n[t]}):n[r[0]]]}})})},t.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce(function(e,n){return e[n]=[t[n]],e},{})},t.prototype.dispose=function(){this.executor.dispose()},t}();e.FrozenModel=c,e.loadFrozenModel=r},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(11),u=n(231),l=n(197),c=function(){function t(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this.placeholders=t.placeholders,this._outputs=t.outputs,this.compile()}return Object.defineProperty(t.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id;
})});this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.placeholders.map(function(t){return{name:t.name,shape:t.params.shape?t.params.shape.value:void 0,dtype:t.params.dtype?t.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this._outputs.map(function(t){return{name:t.name,shape:t.params.shape?t.params.shape.value:void 0,dtype:t.params.dtype?t.params.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.placeholders.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.outputs.map(function(t){return t.name})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isControlFlowModel",{get:function(){return this.graph.withControlFlow},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDynamicShapeModel",{get:function(){return this.graph.withDynamicShape},enumerable:!0,configurable:!0}),t.prototype.compile=function(t){if(!this.graph.withControlFlow&&!this.graph.withDynamicShape){var e=[],n=t||this.graph.placeholders,r=n.map(function(t){return t.name}).sort(),i=r.join(this.SEPERATOR);if(!this.compiledMap.get(i)){for(var o=n.concat(this.graph.weights),a={};o.length>0;){var u=o.pop();a[u.name]=!0,e.push(u),u.children.forEach(function(t){!a[t.name]&&t.inputNames.every(function(t){var e=s.getNodeNameAndIndex(t)[0];return a[e]})&&o.push(t)})}this.compiledMap.set(i,e)}}},t.prototype.execute=function(t,e,n){var i=this;void 0===e&&(e=!0);var o=Object.keys(t).sort();this.checkInput(t,e),this.checkInputShapeAndType(t,e),this.compile(o.map(function(t){return i.graph.nodes[t]}));var s=this.calculateOutputs(n);this.checkOutput(this.compiledMap.get(o.join(this.SEPERATOR)),s);var c={},p=a.tidy(function(){for(var e=new l.ExecutionContext(i._weightMap,c),n=r({},i.weightMap,t),a=i.getFrozenTensorIds(n),p={},h=i.compiledMap.get(o.join(i.SEPERATOR)),f=0;f<h.length;f++){var d=h[f];if(n[d.name]||(n[d.name]=u.executeOp(d,n,e),i.checkTensorForDisposal(d.name,d,n,e,a,p)),s.every(function(t){return!!n[t]}))break}return i.findOutputs(n,e,s)});return p},t.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map(function(e){return t[e]}).map(function(t){return t.map(function(t){return t.id})}));return new Set(e)},t.prototype.checkTensorForDisposal=function(t,e,n,r,i,o){"control"!==e.category&&(n[t].forEach(function(t){null!=t&&(o[t.id]=(o[t.id]||0)+e.children.length)}),e.inputs.forEach(function(t){if("control"!==t.category){var e=s.getTensorsForCurrentContenxt(t.name,n,r);null!=e&&e.forEach(function(t){if(t&&!i.has(t.id)){var e=o[t.id];1===e?(t.dispose(),delete o[t.id]):null!=e&&o[t.id]--}})}}))},t.prototype.executeAsync=function(t,e){return i(this,void 0,void 0,function(){var n,r,i,a,s,u,c,p=this;return o(this,function(o){switch(o.label){case 0:return this.checkInput(t,!1),this.checkInputShapeAndType(t,!1),n={},r=new l.ExecutionContext(this._weightMap,n),[4,this.executeWithControlFlow(t,r)];case 1:return i=o.sent(),a=this.findOutputs(i,r,e),s=Object.keys(a).map(function(t){return a[t].id}),u=Object.keys(t).map(function(e){return t[e].map(function(t){return t.id})}),c=[].concat.apply([],u),Object.keys(i).forEach(function(t){var e=i[t];e.forEach(function(t){t&&s.indexOf(t.id)===-1&&c.indexOf(t.id)===-1&&p.weightIds.indexOf(t.id)===-1&&t.dispose()})}),[2,a]}})})},t.prototype.executeWithControlFlow=function(t,e){return i(this,void 0,void 0,function(){var n,i,a,s,u,l,c,p,h=this;return o(this,function(o){switch(o.label){case 0:n=Object.keys(t),i=n.map(function(t){return h.graph.nodes[t]}),a=i.concat(this.graph.weights).map(function(t){return{node:t,contexts:e.currentContext}}),s=r({},this.weightMap,t),u={},l=this.getFrozenTensorIds(s),c={},o.label=1;case 1:return a.length>0?(p=this.processStack(i,a,e,s,c,l,u),[4,Promise.all(p)]):[3,3];case 2:return o.sent(),[3,1];case 3:return[2,s]}})})},t.prototype.processStack=function(t,e,n,r,i,o,a){for(var l=this,c=[],p=function(){var p=e.pop();n.currentContext=p.contexts;var f="";if("enter"===p.node.op&&s.getParamValue("isConstant",p.node,r,n)&&(f=s.getNodeNameAndIndex(p.node.name,n)[0]),t.indexOf(p.node)===-1){var d=u.executeOp(p.node,r,n);f||(f=s.getNodeNameAndIndex(p.node.name,n)[0]);var m=n.currentContext;d instanceof Promise?c.push(d.then(function(t){return r[f]=t,n.currentContext=m,l.checkTensorForDisposal(f,p.node,r,n,o,a),l.processChildNodes(p.node,e,n,r,i),t})):(r[f]=d,h.checkTensorForDisposal(f,p.node,r,n,o,a),h.processChildNodes(p.node,e,n,r,i))}else h.processChildNodes(p.node,e,n,r,i)},h=this;e.length>0;)p();return c},t.prototype.processChildNodes=function(t,e,n,r,i){t.children.forEach(function(t){var o=s.getNodeNameAndIndex(t.name,n)[0];i[o]||("merge"===t.op?t.inputNames.some(function(t){return!!s.getTensor(t,r,n)})&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})):t.inputNames.every(function(t){return!!s.getTensor(t,r,n)})&&(i[o]=!0,e.push({contexts:n.currentContext,node:t})))})},t.prototype.calculateOutputs=function(t){return!t||t instanceof Array||(t=[t]),t||this.graph.outputs.map(function(t){return t.name})},t.prototype.findOutputs=function(t,e,n){var r=this.calculateOutputs(n);return r.reduce(function(n,r){return n[r]=s.getTensor(r,t,e),n},{})},t.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach(function(e){return t.weightMap[e].forEach(function(t){return t.dispose()})})},t.prototype.checkInputShapeAndType=function(t,e){void 0===e&&(e=!0),this.placeholders.forEach(function(n){var r=t[n.name];if(e||r){var i=r[0];if(n.params.shape&&n.params.shape.value){var o=n.params.shape.value,s=o.length===i.shape.length&&i.shape.every(function(t,e){return o[e]===-1||o[e]===t});a.util.assert(s,"The shape of dict['"+n.name+"'] provided in model.execute(dict) must be ["+o+"], but was ["+i.shape+"]")}n.params.dtype&&n.params.dtype.value&&a.util.assert(i.dtype===n.params.dtype.value,"The dtype of dict['"+n.name+"'] provided in model.execute(dict) must be "+n.params.dtype.value+", but was "+i.dtype)}})},t.prototype.checkInput=function(t,e){var n=this;void 0===e&&(e=!0);var r=Object.keys(t),i=[],o=[];this.inputNodes.forEach(function(t){r.indexOf(t)===-1&&i.push(t)}),r.forEach(function(t){n.inputNodes.indexOf(t)===-1&&o.push(t)});var a=o.filter(function(t){return!n.graph.nodes[t]});if(i.length>0&&e)throw new Error("The dict provided in model.execute(dict) has the keys "+("["+r+"], but is missing the required keys: ["+i+"]."));if(o.length>0&&e)throw new Error("The dict provided in model.execute(dict) has "+("unused keys: ["+o+"]. Please provide only the following keys: ")+("["+this.inputNodes+"]."));if(a.length>0)throw new Error("The dict provided in model.execute(dict) has "+("keys: ["+a+"] not part of model graph."))},t.prototype.checkOutput=function(t,e){var n=t.map(function(t){return t.name}),r=[];if(e.forEach(function(t){n.indexOf(t)===-1&&r.push(t)}),r.length>0)throw new Error("The following outputs are not be generated by the execution: "+("["+r+"]."))},t}();e.GraphExecutor=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=function(){function t(e,n,r,i,o,a,s){this.name=e,this.dtype=n,this.maxSize=r,this.elementShape=i,this.identicalElementShapes=o,this.dynamicSize=a,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.id=t.nextId++}return Object.defineProperty(t.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),t.prototype.clearAndClose=function(){this.tensors.forEach(function(t){return t.tensor.dispose()}),this.tensors=[],this.closed_=!0},t.prototype.size=function(){return this.tensors.length},t.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},t.prototype.readMany=function(t){var e=this;return t.map(function(t){return e.read(t)})},t.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+",\n          because the value dtype is "+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(0===this.size()&&0===this.elementShape.length&&(this.elementShape=e.shape),this.assertShapesMatch(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),n&&n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(n&&n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");n.tensor=e,n.written=!0,this.tensors[t]=n},t.prototype.writeMany=function(t,e){var n=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,"+("because the index size: "+t.length+" is not the same as tensors size: "+e.length+"."));t.forEach(function(t,r){return n.write(t,e[r])})},t.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var n=0;n<this.size();n++)t.push(n)}if(0===t.length)return r.tensor([],[0].concat(this.elementShape));var i=this.readMany(t);return this.assertShapesMatch(this.elementShape,i[0].shape,"TensorArray shape mismatch: "),r.stack(i,0)},t.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(0===this.size())return r.tensor([],[0].concat(this.elementShape));for(var e=[],n=0;n<this.size();n++)e.push(n);var i=this.readMany(e);return this.assertShapesMatch(this.elementShape,i[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+i[0].shape+")"),r.concat(i,0)},t.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var n=Math.max.apply(Math,t);if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(t,r.unstack(e,0))},t.prototype.split=function(t,e){var n=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var i=0,o=t.map(function(t){return i+=t});if(i!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+i+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var a=0===i?0:e.size/i,s=[];r.tidy(function(){e=e.reshape([1,i,a]);for(var u=0;u<t.length;++u){var l=0===u?0:o[u-1],c=[0,l,0],p=[1,t[u],a];s[u]=r.slice(e,c,p).reshape(n.elementShape)}return s});for(var u=[],l=0;l<t.length;l++)u[l]=l;this.writeMany(u,s)},t.prototype.assertShapesMatch=function(t,e,n){void 0===n&&(n=""),r.util.assert(this.arraysEqual(t,e),n+(" Shapes "+t+" and "+e+" must match"))},t.prototype.arraysEqual=function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==-1&&e[n]!==-1&&t[n]!==e[n])return!1;return!0},t.nextId=0,t}();e.TensorArray=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"add":return[r.add(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"addN":return[r.addN(i.getParamValue("tensors",t,e,n))];case"mod":return[r.mod(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"mul":return[r.mul(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"div":return[r.div(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"floorDiv":return[r.floorDiv(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"sub":return[r.sub(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"minimum":return[r.minimum(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"maximum":return[r.maximum(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"pow":return[r.pow(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"squaredDifference":return[r.squaredDifference(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="arithmetic"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"abs":return[r.abs(i.getParamValue("x",t,e,n))];case"acos":return[r.acos(i.getParamValue("x",t,e,n))];case"acosh":return[r.acosh(i.getParamValue("x",t,e,n))];case"asin":return[r.asin(i.getParamValue("x",t,e,n))];case"asinh":return[r.asinh(i.getParamValue("x",t,e,n))];case"atan":return[r.atan(i.getParamValue("x",t,e,n))];case"atan2":return[r.atan2(i.getParamValue("x",t,e,n),i.getParamValue("y",t,e,n))];case"atanh":return[r.atanh(i.getParamValue("x",t,e,n))];case"ceil":return[r.ceil(i.getParamValue("x",t,e,n))];case"cos":return[r.cos(i.getParamValue("x",t,e,n))];case"cosh":return[r.cosh(i.getParamValue("x",t,e,n))];case"elu":return[r.elu(i.getParamValue("x",t,e,n))];case"erf":return[r.erf(i.getParamValue("x",t,e,n))];case"exp":return[r.exp(i.getParamValue("x",t,e,n))];case"expm1":return[r.expm1(i.getParamValue("x",t,e,n))];case"floor":return[r.floor(i.getParamValue("x",t,e,n))];case"log":return[r.log(i.getParamValue("x",t,e,n))];case"log1p":return[r.log1p(i.getParamValue("x",t,e,n))];case"neg":return[r.neg(i.getParamValue("x",t,e,n))];case"reciprocal":return[r.reciprocal(i.getParamValue("x",t,e,n))];case"relu":return[r.relu(i.getParamValue("x",t,e,n))];case"round":return[r.round(i.getParamValue("x",t,e,n))];case"selu":return[r.selu(i.getParamValue("x",t,e,n))];case"sigmoid":return[r.sigmoid(i.getParamValue("x",t,e,n))];case"sin":return[r.sin(i.getParamValue("x",t,e,n))];case"sign":return[r.sign(i.getParamValue("x",t,e,n))];case"sinh":return[r.sinh(i.getParamValue("x",t,e,n))];case"softplus":return[r.softplus(i.getParamValue("x",t,e,n))];case"sqrt":return[r.sqrt(i.getParamValue("x",t,e,n))];case"square":return[r.square(i.getParamValue("x",t,e,n))];case"tanh":return[r.tanh(i.getParamValue("x",t,e,n))];case"tan":return[r.tan(i.getParamValue("x",t,e,n))];case"clipByValue":return[r.clipByValue(i.getParamValue("x",t,e,n),i.getParamValue("clipValueMin",t,e,n),i.getParamValue("clipValueMax",t,e,n))];case"rsqrt":return[r.div(r.scalar(1,"float32"),r.sqrt(i.getTensor(t.inputNames[0],e,n)))];case"prod":return[r.prod(i.getParamValue("x",t,e,n),i.getParamValue("axes",t,e,n))];case"leakyRelu":return[r.leakyRelu(i.getParamValue("x",t,e,n),i.getParamValue("alpha",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="basic_math"},function(t,e,n){"use strict";function r(t,e,n){return i(this,void 0,void 0,function(){var r,i,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,E,A,N,O,k,I,C,M,R,D,L,F,z,q,V,B,j,U,G,W,H,Q,K;return o(this,function(o){switch(o.label){case 0:switch(r=t.op){case"loopCond":return[3,1];case"switch":return[3,2];case"merge":return[3,4];case"enter":return[3,5];case"exit":return[3,6];case"nextIteration":return[3,7];case"tensorArray":return[3,8];case"tensorArrayWrite":return[3,9];case"tensorArrayRead":return[3,10];case"tensorArrayGather":return[3,11];case"tensorArrayScatter":return[3,12];case"tensorArrayConcat":return[3,13];case"tensorArraySplit":return[3,14];case"tensorArraySize":return[3,15];case"tensorArrayClose":return[3,16]}return[3,17];case 1:return[2,[u.getParamValue("pred",t,e,n).clone()]];case 2:return i=u.getParamValue("pred",t,e,n),l=u.getParamValue("data",t,e,n),[4,i.data()];case 3:return[2,o.sent()[0]?[void 0,l.clone()]:[l.clone(),void 0]];case 4:return c=t.inputNames.find(function(t){return void 0!==u.getTensor(t,e,n)}),[2,c?[u.getTensor(c,e,n).clone()]:void 0];case 5:return p=u.getParamValue("frameName",t,e,n),h=u.getParamValue("tensor",t,e,n),n.enterFrame(p),[2,[h.clone()]];case 6:return f=u.getParamValue("tensor",t,e,n),n.exitFrame(),[2,[f.clone()]];case 7:return d=u.getParamValue("tensor",t,e,n),n.nextIteration(),[2,[d.clone()]];case 8:return m=u.getParamValue("size",t,e,n),y=u.getParamValue("dtype",t,e,n),g=u.getParamValue("elementShape",t,e,n),v=u.getParamValue("dynamicSize",t,e,n),b=u.getParamValue("clearAfterRead",t,e,n),_=u.getParamValue("identicalElementShapes",t,e,n),w=u.getParamValue("name",t,e,n),S=new s.TensorArray(w,y,m,g,_,v,b),n.addTensorArray(S),[2,[a.scalar(S.id),a.scalar(1)]];case 9:return x=u.getParamValue("tensorArrayId",t,e,n),T=u.getParamValue("index",t,e,n),P=u.getParamValue("tensor",t,e,n),E=n.getTensorArray(x),E.write(T,P),[2,[a.scalar(1)]];case 10:return A=u.getParamValue("tensorArrayId",t,e,n),N=u.getParamValue("index",t,e,n),O=n.getTensorArray(A),[2,[O.read(N)]];case 11:return k=u.getParamValue("tensorArrayId",t,e,n),I=u.getParamValue("indices",t,e,n),C=u.getParamValue("dtype",t,e,n),M=n.getTensorArray(k),[2,[M.gather(I,C)]];case 12:return R=u.getParamValue("tensorArrayId",t,e,n),D=u.getParamValue("indices",t,e,n),L=u.getParamValue("tensor",t,e,n),F=n.getTensorArray(R),F.scatter(D,L),[2,[a.scalar(1)]];case 13:return z=u.getParamValue("tensorArrayId",t,e,n),q=n.getTensorArray(z),V=u.getParamValue("dtype",t,e,n),[2,[q.concat(V)]];case 14:return B=u.getParamValue("tensorArrayId",t,e,n),j=u.getParamValue("tensor",t,e,n),U=u.getParamValue("lengths",t,e,n),G=n.getTensorArray(B),G.split(U,j),[2,[a.scalar(1)]];case 15:return W=u.getParamValue("tensorArrayId",t,e,n),H=n.getTensorArray(W),[2,[a.scalar(H.size(),"int32")]];case 16:return Q=u.getParamValue("tensorArrayId",t,e,n),K=n.getTensorArray(Q),K.clearAndClose(),[2,[]];case 17:throw TypeError("Node type "+t.op+" is not implemented")}})})}var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(200),u=n(11);e.executeOp=r,e.CATEGORY="control"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"conv1d":var o=i.getParamValue("stride",t,e,n),a=i.getParamValue("pad",t,e,n),s=i.getParamValue("dataFormat",t,e,n).toUpperCase(),u=i.getParamValue("dilation",t,e,n);return[r.conv1d(i.getParamValue("x",t,e,n),i.getParamValue("filter",t,e,n),o,a,s,u)];case"conv2d":var o=i.getParamValue("strides",t,e,n),a=i.getParamValue("pad",t,e,n),s=i.getParamValue("dataFormat",t,e,n).toUpperCase(),l=i.getParamValue("dilations",t,e,n);return[r.conv2d(i.getParamValue("x",t,e,n),i.getParamValue("filter",t,e,n),[o[1],o[2]],a,s,[l[0],l[1]])];case"conv2dTranspose":var c=i.getParamValue("outputShape",t,e,n),o=i.getParamValue("strides",t,e,n),a=i.getParamValue("pad",t,e,n);return[r.conv2dTranspose(i.getParamValue("x",t,e,n),i.getParamValue("filter",t,e,n),c,[o[1],o[2]],a)];case"depthwiseConv2d":var o=i.getParamValue("strides",t,e,n),a=i.getParamValue("pad",t,e,n),l=i.getParamValue("dilations",t,e,n),s=i.getParamValue("dataFormat",t,e,n).toUpperCase();return[r.depthwiseConv2d(i.getParamValue("input",t,e,n),i.getParamValue("filter",t,e,n),[o[1],o[2]],a,s,[l[0],l[1]])];case"avgPool":var o=i.getParamValue("strides",t,e,n),a=i.getParamValue("pad",t,e,n),p=i.getParamValue("kernelSize",t,e,n);return[r.avgPool(i.getParamValue("x",t,e,n),[p[1],p[2]],[o[1],o[2]],a)];case"maxPool":var o=i.getParamValue("strides",t,e,n),a=i.getParamValue("pad",t,e,n),p=i.getParamValue("kernelSize",t,e,n);return[r.maxPool(i.getParamValue("x",t,e,n),[p[1],p[2]],[o[1],o[2]],a)];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="convolution"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"fill":var o=i.getParamValue("shape",t,e,n),a=i.getParamValue("dtype",t,e,n),s=i.getParamValue("value",t,e,n);return[r.fill(o,s,a)];case"linspace":var u=i.getParamValue("start",t,e,n),l=i.getParamValue("stop",t,e,n),c=i.getParamValue("num",t,e,n);return[r.linspace(u,l,c)];case"oneHot":var p=i.getParamValue("indices",t,e,n),h=i.getParamValue("depth",t,e,n),f=i.getParamValue("onValue",t,e,n),d=i.getParamValue("offValue",t,e,n);return[r.oneHot(p,h,f,d)];case"ones":return[r.ones(i.getParamValue("shape",t,e,n),i.getParamValue("dtype",t,e,n))];case"onesLike":return[r.onesLike(i.getParamValue("x",t,e,n))];case"randomUniform":return[r.randomUniform(i.getParamValue("shape",t,e,n),i.getParamValue("minval",t,e,n),i.getParamValue("maxval",t,e,n),i.getParamValue("dtype",t,e,n))];case"range":var u=i.getParamValue("start",t,e,n),m=i.getParamValue("stop",t,e,n),y=i.getParamValue("step",t,e,n);return[r.range(u,m,y,i.getParamValue("dtype",t,e,n))];case"truncatedNormal":var o=i.getParamValue("shape",t,e,n),g=i.getParamValue("mean",t,e,n),v=i.getParamValue("stdDev",t,e,n),b=i.getParamValue("seed",t,e,n);return[r.truncatedNormal(o,g,v,i.getParamValue("dtype",t,e,n),b)];case"zeros":return[r.zeros(i.getParamValue("shape",t,e,n),i.getParamValue("dtype",t,e,n))];case"zerosLike":return[r.zerosLike(i.getParamValue("x",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="creation"},function(t,e,n){"use strict";function r(t,e,n){return i(this,void 0,void 0,function(){var r,i,u,l,c,p;return o(this,function(o){switch(o.label){case 0:switch(r=t.op){case"nonMaxSuppression":return[3,1];case"whereAsync":return[3,3];case"setdiff1dAsync":return[3,5]}return[3,7];case 1:return i=s.getParamValue("boxes",t,e,n),u=s.getParamValue("scores",t,e,n),l=s.getParamValue("maxOutputSize",t,e,n),c=s.getParamValue("iouThreshold",t,e,n),p=s.getParamValue("scoreThreshold",t,e,n),[4,a.image.nonMaxSuppressionAsync(i,u,l,c,p)];case 2:return[2,[o.sent()]];case 3:return[4,a.whereAsync(s.getParamValue("condition",t,e,n))];case 4:return[2,[o.sent()]];case 5:return[4,a.setdiff1dAsync(s.getParamValue("x",t,e,n),s.getParamValue("y",t,e,n))];case 6:return[2,o.sent()];case 7:throw TypeError("Node type "+t.op+" is not implemented")}})})}var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(11);e.executeOp=r,e.CATEGORY="dynamic"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"topK":var o=i.getParamValue("x",t,e,n),a=i.getParamValue("k",t,e,n),s=i.getParamValue("sorted",t,e,n),u=r.topk(o,a,s);return[u.values,u.indices];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="evaluation"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"const":return e[t.name];case"placeholder":var o=i.getParamValue("default",t,e,n);return[i.getTensor(t.name,e,n)||o];case"identity":case"stopGradient":case"fakeQuantWithMinMaxVars":return[i.getParamValue("x",t,e,n).clone()];case"snapshot":var a=i.getParamValue("x",t,e,n);return[a.clone()];case"shape":return[r.tensor1d(i.getParamValue("x",t,e,n).shape,"int32")];case"shapeN":return i.getParamValue("x",t,e,n).map(function(t){return r.tensor1d(t.shape)});case"size":return[r.scalar(i.getParamValue("x",t,e,n).size,"int32")];case"rank":return[r.scalar(i.getParamValue("x",t,e,n).rank,"int32")];case"noop":return[];case"print":var s=i.getParamValue("x",t,e,n),u=i.getParamValue("data",t,e,n),l=i.getParamValue("message",t,e,n),c=i.getParamValue("summarize",t,e,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(var p=0;p<u.length;p++)console.log(Array.prototype.slice.call(u[0].dataSync()).slice(0,c));return[s];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="graph"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"resizeBilinear":var o=i.getParamValue("images",t,e,n),a=i.getParamValue("size",t,e,n),s=i.getParamValue("alignCorners",t,e,n);return[r.image.resizeBilinear(o,[a[0],a[1]],s)];case"resizeNearestNeighbor":var o=i.getParamValue("images",t,e,n),a=i.getParamValue("size",t,e,n),s=i.getParamValue("alignCorners",t,e,n);return[r.image.resizeNearestNeighbor(o,[a[0],a[1]],s)];case"cropAndResize":var u=i.getParamValue("image",t,e,n),l=i.getParamValue("boxes",t,e,n),c=i.getParamValue("boxInd",t,e,n),p=i.getParamValue("cropSize",t,e,n),h=i.getParamValue("method",t,e,n),f=i.getParamValue("extrapolationValue",t,e,n);return[r.image.cropAndResize(u,l,c,p,h,f)];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="image"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"equal":return[r.equal(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"notEqual":return[r.notEqual(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"greater":return[r.greater(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"greaterEqual":return[r.greaterEqual(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"less":return[r.less(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"lessEqual":return[r.lessEqual(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"logicalAnd":return[r.logicalAnd(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"logicalNot":return[r.logicalNot(i.getParamValue("a",t,e,n))];case"logicalOr":return[r.logicalOr(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];case"where":return[r.where(i.getParamValue("condition",t,e,n),i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="logical"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"matMul":return[r.matMul(i.getParamValue("a",t,e,n),i.getParamValue("b",t,e,n),i.getParamValue("transposeA",t,e,n),i.getParamValue("transposeB",t,e,n))];case"transpose":return[r.transpose(i.getParamValue("x",t,e,n),i.getParamValue("perm",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="matrices"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"batchNormalization":return[r.batchNormalization(i.getParamValue("x",t,e,n),i.getParamValue("mean",t,e,n),i.getParamValue("variance",t,e,n),i.getParamValue("epsilon",t,e,n),i.getParamValue("scale",t,e,n),i.getParamValue("offset",t,e,n))];case"localResponseNormalization":return[r.localResponseNormalization(i.getParamValue("x",t,e,n),i.getParamValue("radius",t,e,n),i.getParamValue("bias",t,e,n),i.getParamValue("alpha",t,e,n),i.getParamValue("beta",t,e,n))];case"softmax":return[r.softmax(i.getParamValue("x",t,e,n))];case"logSoftmax":return[r.logSoftmax(i.getParamValue("x",t,e,n))];case"sparseToDense":return[r.sparseToDense(i.getParamValue("sparseIndices",t,e,n),i.getParamValue("outputShape",t,e,n),i.getParamValue("sparseValues",t,e,n),i.getParamValue("defaultValue",t,e,n))];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="normalization"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"max":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.max(i.getParamValue("x",t,e,n),o,a)];case"mean":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.mean(i.getParamValue("x",t,e,n),o,a)];case"min":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.min(i.getParamValue("x",t,e,n),o,a)];case"sum":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.sum(i.getParamValue("x",t,e,n),o,a)];case"all":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.all(i.getParamValue("x",t,e,n),o,a)];case"any":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);return[r.any(i.getParamValue("x",t,e,n),o,a)];case"argMax":var o=i.getParamValue("axis",t,e,n);return[r.argMax(i.getParamValue("x",t,e,n),o)];case"argMin":var o=i.getParamValue("axis",t,e,n);return[r.argMin(i.getParamValue("x",t,e,n),o)];case"prod":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("keepDims",t,e,n);
return[r.prod(i.getParamValue("x",t,e,n),o,a)];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="reduction"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"concat":var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("tensors",t,e,n);return[r.concat(a,o)];case"gather":var o=i.getParamValue("axis",t,e,n),s=i.getParamValue("x",t,e,n),u=i.getParamValue("indices",t,e,n);return[r.gather(s,u,o)];case"reverse":var o=i.getParamValue("axis",t,e,n),s=i.getParamValue("x",t,e,n);return[r.reverse(s,o)];case"slice":var l=i.getParamValue("begin",t,e,n),c=i.getParamValue("size",t,e,n);return[r.slice(i.getParamValue("x",t,e,n),l,c)];case"stridedSlice":var l=i.getParamValue("begin",t,e,n),p=i.getParamValue("end",t,e,n),h=i.getParamValue("strides",t,e,n),f=i.getParamValue("beginMask",t,e,n),d=i.getParamValue("endMask",t,e,n),m=i.getParamValue("ellipsisMask",t,e,n),y=i.getParamValue("newAxisMask",t,e,n),g=i.getParamValue("shrinkAxisMask",t,e,n),v=i.getParamValue("x",t,e,n);if(1===l.length&&v.shape.length>1)for(var b=1;b<v.shape.length;b++)l.push(0),p.push(v.shape[b]),h.push(h[0]);return[r.stridedSlice(v,l,p,h,f,d,m,y,g)];case"stack":return r.tidy(function(){var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("tensors",t,e,n),s=a[0].shape,u=a[0].squeeze().shape,l=a.map(function(t){var e=r.util.arraysEqual(t.shape,s);if(!e&&!r.util.arraysEqual(t.squeeze().shape,u))throw new Error("the input tensors shape does not match");return e?t:t.reshape(s)});return[r.stack(l,o)]});case"unstack":return r.tidy(function(){var o=i.getParamValue("axis",t,e,n),a=i.getParamValue("tensor",t,e,n);return r.unstack(a,o)});case"tile":var _=i.getParamValue("reps",t,e,n);return[r.tile(i.getParamValue("x",t,e,n),_)];case"split":var o=i.getParamValue("axis",t,e,n),w=i.getParamValue("numOrSizeSplits",t,e,n);return r.split(i.getParamValue("x",t,e,n),w,o);case"scatterNd":var u=i.getParamValue("indices",t,e,n),S=i.getParamValue("values",t,e,n),x=i.getParamValue("shape",t,e,n);return[r.scatterND(u,S,x)];case"gatherNd":var T=i.getParamValue("x",t,e,n),u=i.getParamValue("indices",t,e,n);return[r.gatherND(T,u)];case"sparseToDense":var u=i.getParamValue("sparseIndices",t,e,n),x=i.getParamValue("outputShape",t,e,n),P=i.getParamValue("sparseValues",t,e,n),E=i.getParamValue("defaultValue",t,e,n);return[r.sparseToDense(u,P,x,E)];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="slice_join"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(11);e.executeOp=function(t,e,n){switch(t.op){case"cast":return[r.cast(i.getParamValue("x",t,e,n),i.getParamValue("dtype",t,e,n))];case"expandDims":var o=i.getParamValue("axis",t,e,n);return[r.expandDims(i.getParamValue("x",t,e,n),o)];case"squeeze":var o=i.getParamValue("axis",t,e,n);return[r.squeeze(i.getParamValue("x",t,e,n),o)];case"reshape":return[r.reshape(i.getParamValue("x",t,e,n),i.getParamValue("shape",t,e,n))];case"pad":return[r.pad(i.getParamValue("x",t,e,n),i.split(i.getParamValue("padding",t,e,n),2),i.getParamValue("constantValue",t,e,n))];case"spaceToBatchND":var a=i.getParamValue("blockShape",t,e,n),s=i.split(i.getParamValue("paddings",t,e,n),2);return[r.spaceToBatchND(i.getParamValue("x",t,e,n),a,s)];case"batchToSpaceND":var a=i.getParamValue("blockShape",t,e,n),u=i.split(i.getParamValue("crops",t,e,n),2);return[r.batchToSpaceND(i.getParamValue("x",t,e,n),a,u)];case"depthToSpace":var l=i.getParamValue("blockSize",t,e,n),c=i.getParamValue("dataFormat",t,e,n);return[r.depthToSpace(i.getParamValue("x",t,e,n),l,c)];default:throw TypeError("Node type "+t.op+" is not implemented")}},e.CATEGORY="transformation"},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Add",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",dlOpName:"addN",category:"arithmetic",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",dlOpName:"add",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",dlOpName:"sub",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",dlOpName:"div",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",dlOpName:"floorDiv",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",dlOpName:"mul",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",dlOpName:"maximum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Minimum",dlOpName:"minimum",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"}]},{tfOpName:"Pow",dlOpName:"pow",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",dlOpName:"squaredDifference",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",dlOpName:"mod",category:"arithmetic",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Abs",dlOpName:"abs",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",dlOpName:"acos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",dlOpName:"asin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",dlOpName:"atan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",dlOpName:"atan2",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"y",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",dlOpName:"ceil",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"clip_value_min",dlParamName:"clipValueMin",type:"number"},{tfParamName:"clip_value_max",dlParamName:"clipValueMax",type:"number"}]},{tfOpName:"Cos",dlOpName:"cos",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",dlOpName:"cosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",dlOpName:"elu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",dlOpName:"exp",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",dlOpName:"floor",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",dlOpName:"log",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",dlOpName:"neg",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",dlOpName:"relu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",dlOpName:"clipByValue",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{dlParamName:"clipValueMin",type:"number",defaultValue:0},{dlParamName:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",dlOpName:"selu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",dlOpName:"sigmoid",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",dlOpName:"sin",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",dlOpName:"sinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",dlOpName:"sqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",dlOpName:"rsqrt",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",dlOpName:"square",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",dlOpName:"tan",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",dlOpName:"tanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",dlOpName:"sign",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",dlOpName:"round",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",dlOpName:"expm1",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",dlOpName:"log1p",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",dlOpName:"reciprocal",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",dlOpName:"softplus",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",dlOpName:"asinh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",dlOpName:"acosh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",dlOpName:"atanh",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",dlOpName:"erf",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",dlOpName:"prod",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axes",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",dlOpName:"leakyRelu",category:"basic_math",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:.2},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"LoopCond",dlOpName:"loopCond",category:"control",params:[{tfInputIndex:0,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Switch",dlOpName:"switch",category:"control",params:[{tfInputIndex:0,dlParamName:"data",type:"tensor"},{tfInputIndex:1,dlParamName:"pred",type:"tensor"}]},{tfOpName:"Merge",dlOpName:"merge",category:"control",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"}]},{tfOpName:"Enter",dlOpName:"enter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"frame_name",dlParamName:"frameName",type:"string"},{tfParamName:"is_constant",dlParamName:"isConstant",type:"bool"}]},{tfOpName:"Exit",dlOpName:"exit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",dlOpName:"nextIteration",category:"control",params:[{tfInputIndex:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",dlOpName:"tensorArray",category:"control",params:[{tfInputIndex:0,dlParamName:"size",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"},{tfParamName:"dynamic_size",dlParamName:"dynamicSize",type:"bool"},{tfParamName:"clear_after_read",dlParamName:"clearAfterRead",type:"bool"},{tfParamName:"identical_element_shapes",dlParamName:"identicalElementShapes",type:"bool"},{tfParamName:"tensor_array_name",dlParamName:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",dlOpName:"tensorArrayWrite",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",dlOpName:"tensorArrayRead",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"index",type:"number"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",dlOpName:"tensorArrayGather",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape",dlParamName:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",dlOpName:"tensorArrayScatter",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"indices",type:"number[]"},{tfInputIndex:2,dlParamName:"tensor",type:"tensor"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",dlOpName:"tensorArrayConcat",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"element_shape_except0",dlParamName:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",dlOpName:"tensorArraySplit",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"tensor",type:"tensor"},{tfInputIndex:2,dlParamName:"lengths",type:"number[]"},{tfInputIndex:3,dlParamName:"flowIn",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",dlOpName:"tensorArraySize",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"},{tfInputIndex:1,dlParamName:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",dlOpName:"tensorArrayClose",category:"control",params:[{tfInputIndex:0,dlParamName:"tensorArrayId",type:"number"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"AvgPool",dlOpName:"avgPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",dlOpName:"maxPool",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0},{tfParamName:"ksize",dlParamName:"kernelSize",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",dlOpName:"conv1d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"stride",dlParamName:"stride",type:"number"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NWC"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"dilation",dlParamName:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",dlOpName:"conv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"useCudnnOnGpu",dlParamName:"useCudnnOnGpu",type:"bool"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"Conv2DBackpropInput",dlOpName:"conv2dTranspose",category:"convolution",params:[{tfInputIndex:2,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfInputIndex:0,dlParamName:"outputShape",type:"number[]"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",dlOpName:"depthwiseConv2d",category:"convolution",params:[{tfInputIndex:0,dlParamName:"input",type:"tensor"},{tfInputIndex:1,dlParamName:"filter",type:"tensor"},{tfParamName:"strides",dlParamName:"strides",type:"number[]"},{tfParamName:"padding",dlParamName:"pad",type:"string"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",defaultValue:"NHWC"},{tfParamName:"dilations",dlParamName:"dilations",type:"number[]"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Fill",dlOpName:"fill",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfInputIndex:1,dlParamName:"value",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",dlOpName:"linspace",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"num",type:"number"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",dlOpName:"oneHot",category:"creation",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"depth",type:"number"},{tfInputIndex:2,dlParamName:"onValue",type:"number",defaultValue:1},{tfInputIndex:3,dlParamName:"offValue",type:"number",defaultValue:0},{tfParamName:"axis",dlParamName:"axis",type:"number",notSupported:!0},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",dlOpName:"ones",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",dlOpName:"onesLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",dlOpName:"randomUniform",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"minval",dlParamName:"minval",type:"number",defaultValue:0},{tfParamName:"maxval",dlParamName:"maxval",type:"number",defaultValue:1},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"seed",dlParamName:"seed",type:"number",defaultValue:0},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",dlOpName:"range",category:"creation",params:[{tfInputIndex:0,dlParamName:"start",type:"number"},{tfInputIndex:1,dlParamName:"stop",type:"number"},{tfInputIndex:2,dlParamName:"step",type:"number",defaultValue:0},{tfParamName:"Tidx",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"truncatedNormal",dlOpName:"truncatedNormal",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"means",dlParamName:"mean",type:"number",defaultValue:0},{tfParamName:"stddev",dlParamName:"stdDev",type:"number",defaultValue:1},{tfParamName:"seed",dlParamName:"seed",type:"number"},{tfParamName:"seed2",dlParamName:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"},{tfParamName:"T",dlParamName:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",dlOpName:"zeros",category:"creation",params:[{tfInputIndex:0,dlParamName:"shape",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",dlOpName:"zerosLike",category:"creation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"NonMaxSuppressionV2",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",dlOpName:"nonMaxSuppression",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"boxes",type:"tensor"},{tfInputIndex:1,dlParamName:"scores",type:"tensor"},{tfInputIndex:2,dlParamName:"maxOutputSize",type:"number"},{tfInputIndex:3,dlParamName:"iouThreshold",type:"number"},{tfInputIndex:4,dlParamName:"scoreThreshold",type:"number"}]},{tfOpName:"Where",dlOpName:"whereAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"condition",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",dlOpName:"setdiff1dAsync",category:"dynamic",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"y",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"TopKV2",dlOpName:"topK",category:"evaluation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"k",type:"number"},{tfParamName:"sorted",dlParamName:"sorted",type:"bool"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"PlaceholderWithDefault",dlOpName:"placeholder",category:"graph",params:[{tfInputIndex:0,dlParamName:"default",type:"tensor"},{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",dlOpName:"placeholder",category:"graph",params:[{tfParamName:"shape",dlParamName:"shape",type:"shape"},{tfParamName:"dtype",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"Const",dlOpName:"const",category:"graph"},{tfOpName:"Identity",dlOpName:"identity",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Snapshot",dlOpName:"snapshot",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Rank",dlOpName:"rank",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Size",dlOpName:"size",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"Shape",dlOpName:"shape",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"ShapeN",dlOpName:"shapeN",category:"graph",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"x",type:"tensors"}]},{tfOpName:"Print",dlOpName:"print",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfInputParamLength:1,dlParamName:"data",type:"tensors"},{tfParamName:"message",dlParamName:"message",type:"string"},{tfParamName:"first_n",dlParamName:"firstN",type:"number",notSupprted:!0},{tfParamName:"summarize",dlParamName:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",dlOpName:"noop",category:"graph",params:[]},{tfOpName:"StopGradient",dlOpName:"stopGradient",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",dlOpName:"fakeQuantWithMinMaxVars",category:"graph",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"min",dlParamName:"min",type:"number"},{tfParamName:"max",dlParamName:"max",type:"number"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"ResizeBilinear",dlOpName:"resizeBilinear",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",dlOpName:"resizeNearestNeighbor",category:"image",params:[{tfInputIndex:0,dlParamName:"images",type:"tensor"},{tfInputIndex:1,dlParamName:"size",type:"number[]"},{tfParamName:"align_corners",dlParamName:"alignCorners",type:"bool"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",dlOpName:"cropAndResize",category:"image",params:[{tfInputIndex:0,dlParamName:"image",type:"tensor"},{tfInputIndex:1,dlParamName:"boxes",type:"tensor"},{tfInputIndex:2,dlParamName:"boxInd",type:"tensor"},{tfInputIndex:3,dlParamName:"cropSize",type:"number[]"},{tfParamName:"method",dlParamName:"method",type:"string"},{tfParamName:"extrapolation_value",dlParamName:"extrapolationValue",type:"number"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Equal",dlOpName:"equal",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",dlOpName:"notEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",dlOpName:"greater",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",dlOpName:"greaterEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",dlOpName:"less",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",dlOpName:"lessEqual",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",dlOpName:"logicalAnd",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",dlOpName:"logicalNot",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",dlOpName:"logicalOr",category:"logical",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",dlOpName:"where",category:"logical",params:[{tfInputIndex:0,dlParamName:"condition",
type:"tensor"},{tfInputIndex:1,dlParamName:"a",type:"tensor"},{tfInputIndex:2,dlParamName:"b",type:"tensor"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"MatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"transpose_a",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"transpose_b",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",dlOpName:"matMul",category:"matrices",params:[{tfInputIndex:0,dlParamName:"a",type:"tensor"},{tfInputIndex:1,dlParamName:"b",type:"tensor"},{tfParamName:"adj_x",dlParamName:"transposeA",type:"bool",defaultValue:!1},{tfParamName:"adj_y",dlParamName:"transposeB",type:"bool",defaultValue:!1},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",dlOpName:"transpose",category:"matrices",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"perm",type:"number[]"},{tfParamName:"T",dlParamName:"dtype",type:"dtype",notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"FusedBatchNorm",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",dlOpName:"batchNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"scale",type:"tensor"},{tfInputIndex:2,dlParamName:"offset",type:"tensor"},{tfInputIndex:3,dlParamName:"mean",type:"tensor"},{tfInputIndex:4,dlParamName:"variance",type:"tensor"},{tfParamName:"epsilon",dlParamName:"epsilon",type:"number",defaultValue:.001},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",dlOpName:"localResponseNormalization",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"depth_radius",dlParamName:"radius",type:"number",defaultValue:5},{tfParamName:"bias",dlParamName:"bias",type:"number",defaultValue:1},{tfParamName:"alpha",dlParamName:"alpha",type:"number",defaultValue:1},{tfParamName:"beta",dlParamName:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",dlOpName:"softmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",dlOpName:"logSoftmax",category:"normalization",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"}]},{tfOpName:"SparseToDense",dlOpName:"sparseToDense",category:"normalization",params:[{tfInputIndex:0,dlParamName:"sparseIndices",type:"tensor"},{tfInputIndex:1,dlParamName:"outputShape",type:"number[]"},{tfInputIndex:2,dlParamName:"sparseValues",type:"tensor"},{tfInputIndex:3,dlParamName:"defaultValue",type:"tensor"},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Max",dlOpName:"max",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Mean",dlOpName:"mean",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Min",dlOpName:"min",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Sum",dlOpName:"sum",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"All",dlOpName:"all",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"Any",dlOpName:"any",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",dlOpName:"argMax",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"ArgMin",dlOpName:"argMin",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number"}]},{tfOpName:"Prod",dlOpName:"prod",category:"reduction",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"},{tfParamName:"keep_dims",dlParamName:"keepDims",type:"bool"}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"ConcatV2",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:-1,dlParamName:"axis",type:"number"}]},{tfOpName:"Concat",dlOpName:"concat",category:"slice_join",params:[{tfInputIndex:1,tfInputParamLength:1,dlParamName:"tensors",type:"tensors"},{tfInputIndex:0,dlParamName:"axis",type:"number"}]},{tfOpName:"GatherV2",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfInputIndex:2,dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",dlOpName:"gather",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",dlOpName:"reverse",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"axis",type:"number[]"}]},{tfOpName:"Slice",dlOpName:"slice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"size",type:"number[]"}]},{tfOpName:"StridedSlice",dlOpName:"stridedSlice",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"begin",type:"number[]"},{tfInputIndex:2,dlParamName:"end",type:"number[]"},{tfInputIndex:3,dlParamName:"strides",type:"number[]"},{tfParamName:"begin_mask",dlParamName:"beginMask",type:"number",defaultValue:0},{tfParamName:"end_mask",dlParamName:"endMask",type:"number",defaultValue:0},{tfParamName:"new_axis_mask",dlParamName:"newAxisMask",type:"number",defaultValue:0},{tfParamName:"ellipsis_mask",dlParamName:"ellipsisMask",type:"number",defaultValue:0},{tfParamName:"shrink_axis_mask",dlParamName:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",dlOpName:"stack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensors",type:"tensors"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",dlOpName:"unstack",category:"slice_join",params:[{tfInputIndex:0,tfInputParamLength:0,dlParamName:"tensor",type:"tensor"},{tfParamName:"axis",dlParamName:"axis",type:"number",defaultValue:0},{tfParamName:"num",dlParamName:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",dlOpName:"tile",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"reps",type:"number[]"}]},{tfOpName:"Split",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"axis",type:"number",defaultValue:0},{tfInputIndex:1,dlParamName:"x",type:"tensor"},{tfParamName:"num_split",dlParamName:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",dlOpName:"split",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"numOrSizeSplits",type:"number[]"},{tfInputIndex:2,dlParamName:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",dlOpName:"scatterNd",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"indices",type:"tensor"},{tfInputIndex:1,dlParamName:"values",type:"tensor"},{tfInputIndex:2,dlParamName:"shape",type:"number[]"}]},{tfOpName:"GatherNd",dlOpName:"gatherNd",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",dlOpName:"sparseToDense",category:"slice_join",params:[{tfInputIndex:0,dlParamName:"sparseIndices",type:"tensor"},{tfInputIndex:1,dlParamName:"outputShape",type:"number[]"},{tfInputIndex:2,dlParamName:"sparseValues",type:"tensor"},{tfInputIndex:3,dlParamName:"defaultValue",type:"tensor"},{tfParamName:"validate_indices",dlParamName:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=[{tfOpName:"Cast",dlOpName:"cast",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"SrcT",dlParamName:"sdtype",type:"dtype",notSupported:!0},{tfParamName:"DstT",dlParamName:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",dlOpName:"expandDims",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,tfParamNameDeprecated:"dim",dlParamName:"axis",type:"number"}]},{tfOpName:"Pad",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfParamName:"constant_value",dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",dlOpName:"pad",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"padding",type:"number[]"},{tfInputIndex:2,dlParamName:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",dlOpName:"reshape",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"shape",type:"number[]"}]},{tfOpName:"Squeeze",dlOpName:"squeeze",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"axis",tfParamNameDeprecated:"squeeze_dims",dlParamName:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",dlOpName:"spaceToBatchND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",dlOpName:"batchToSpaceND",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfInputIndex:1,dlParamName:"blockShape",type:"number[]"},{tfInputIndex:2,dlParamName:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",dlOpName:"depthToSpace",category:"transformation",params:[{tfInputIndex:0,dlParamName:"x",type:"tensor"},{tfParamName:"block_size",dlParamName:"blockSize",type:"number"},{tfParamName:"data_format",dlParamName:"dataFormat",type:"string"}]}]},function(t,e,n){"use strict";function r(t,e,n){switch(t.category){case"arithmetic":return i.executeOp(t,e,n);case"basic_math":return o.executeOp(t,e,n);case"control":return a.executeOp(t,e,n);case"convolution":return s.executeOp(t,e,n);case"creation":return u.executeOp(t,e,n);case"dynamic":return l.executeOp(t,e,n);case"evaluation":return c.executeOp(t,e,n);case"image":return h.executeOp(t,e,n);case"graph":return p.executeOp(t,e,n);case"logical":return f.executeOp(t,e,n);case"matrices":return d.executeOp(t,e,n);case"normalization":return m.executeOp(t,e,n);case"reduction":return y.executeOp(t,e,n);case"slice_join":return g.executeOp(t,e,n);case"transformation":return v.executeOp(t,e,n);default:throw TypeError("Node type "+t.op+" is not implemented")}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(201),o=n(202),a=n(203),s=n(204),u=n(205),l=n(206),c=n(207),p=n(208),h=n(209),f=n(210),d=n(211),m=n(212),y=n(213),g=n(214),v=n(215);e.executeOp=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(111),i=n(11),o=n(216),a=n(217),s=n(218),u=n(219),l=n(220),c=n(221),p=n(222),h=n(223),f=n(224),d=n(225),m=n(226),y=n(227),g=n(228),v=n(229),b=n(230),_=["Switch","Merge","Enter","Exit","NextIteration"],w=["NonMaxSuppressionV2","NonMaxSuppressionV3","Where"],S=function(){function t(){var t=[o,a,s,u,l,c,p,d,f,h,m,y,g,v,b],e=[].concat.apply([],t.map(function(t){return t.json}));this.opMappers=e.reduce(function(t,e){return t[e.tfOpName]=e,t},{})}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),t.prototype.isControlFlow=function(t){return _.some(function(e){return e===t.op})},t.prototype.isDynamicShape=function(t){return w.some(function(e){return e===t.op})},t.prototype.transformGraph=function(t){var e=this,n=t.node,r=!1,o=!1,a=[],s=[],u=n.reduce(function(t,n){return t[n.name]=e.mapNode(n),e.isControlFlow(n)&&(r=!0),e.isDynamicShape(n)&&(o=!0),"Placeholder"===n.op&&a.push(t[n.name]),"Const"===n.op&&s.push(t[n.name]),t},{}),l=[],c=[];return Object.keys(u).forEach(function(t){var e=u[t];e.inputNames.forEach(function(t){var n=i.getNodeNameAndIndex(t)[0];e.inputs.push(u[n]),u[n].children.push(e)}),0===e.inputs.length&&l.push(e)}),Object.keys(u).forEach(function(t){var e=u[t];0===e.children.length&&c.push(e)}),{nodes:u,inputs:l,outputs:c,weights:s,placeholders:a,withControlFlow:r,withDynamicShape:o}},t.prototype.mapNode=function(t){var e=this,n=this.opMappers[t.op];if(void 0===n)throw new Error("Tensorflow Op is not supported: "+t.op);var r={name:t.name,op:n.dlOpName,category:n.category,inputNames:(t.input||[]).map(function(t){return t.startsWith("^")?t.substr(1):t}),inputs:[],children:[],params:{}};return n.params&&(r.params=n.params.reduce(function(n,r){var i=r.tfInputIndex,o=r.tfInputParamLength,a=r.type,s=void 0;if(void 0===i)switch(r.type){case"string":s=e.getStringParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getStringParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"number":s=e.getNumberParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getNumberParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"number[]":s=e.getNumericArrayParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getNumericArrayParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"bool":s=e.getBoolParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getBoolParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"shape":s=e.getTensorShapeParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getTensorShapeParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"dtype":s=e.getDtypeParam(t.attr,r.tfParamName,r.defaultValue),void 0===s&&r.tfParamNameDeprecated&&(s=e.getDtypeParam(t.attr,r.tfParamNameDeprecated,r.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+r.type+" for op: "+t.op)}return n[r.dlParamName]={value:s,inputIndex:i,type:a,inputParamLength:o},n},{})),r},t.prototype.getStringParam=function(t,e,n,r){void 0===r&&(r=!1);var i=t[e];if(void 0!==i){var o=String.fromCharCode.apply(null,i.s);return r?o:o.toLowerCase()}return n},t.prototype.getBoolParam=function(t,e,n){var r=t[e];return r?r.b:n},t.prototype.getNumberParam=function(t,e,n){var r=t[e],i=r?r[r.value]:n;return"number"==typeof i?i:i.toInt()},t.prototype.getDtypeParam=function(t,e,n){var i=t[e];if(i&&i.type)switch(i.type){case r.tensorflow.DataType.DT_FLOAT:return"float32";case r.tensorflow.DataType.DT_INT32:return"int32";case r.tensorflow.DataType.DT_BOOL:return"bool";default:return n}return n},t.prototype.getTensorShapeParam=function(t,e,n){var r=t[e];return r&&r.shape?r.shape.dim.map(function(t){return"number"==typeof t.size?t.size:t.size.toInt()}):n},t.prototype.getNumericArrayParam=function(t,e,n){var r=t[e];return r?(r.list.f&&r.list.f.length?r.list.f:r.list.i).map(function(t){return"number"==typeof t?t:t.toInt()}):n},t}();e.OperationMapper=S},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="0.6.7";e.version=n},function(t,e,n){(function(t){"use strict";function n(){return new Promise(function(t){return r(function(){return t()})})}Object.defineProperty(e,"__esModule",{value:!0});var r="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:t;e.nextFrame=n}).call(e,n(387).setImmediate)},function(t,e){"use strict";function n(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}Object.defineProperty(e,"__esModule",{value:!0}),e.isMobile=n},function(t,e,n){"use strict";function r(t){var e=p.makeOnesTypedArray(p.sizeFromShape(t),"float32");return u.Tensor.make(t,{values:e})}var i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var a=n(315),s=n(316),u=n(15),l=n(49),c=n(2),p=n(2),h=function(){function t(t,e,n){this.backend=t,this.safeMode=e,this.debugMode=n,this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numDataBuffers=0,this.profiling=!1,this.gradientScopeCount=0,this.customGradientDepth=0,this.keepTensors=new Set,this.tensorInfo=new WeakMap,this.activeScope={track:[],name:"default scope"},this.scopeStack=[this.activeScope],this.profiler=new a.Profiler(t),this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.moveData=function(t){this.write(t,this.readSync(t))},t.prototype.tidy=function(t,e,n){var r=this;void 0===n&&(n=!1);var i=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=t}var o;return this.scopedRun(function(){return r.startScope(i,n)},function(){return r.endScope(o,n)},function(){return o=e(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.runKernel=function(t,e,n){var r,i=this,o=[],a=function(t){return o.push(t),t},s=this.activeScope.name,u=this.numBytes,l=this.numTensors;if(this.scopedRun(function(){return i.customGradientDepth++},function(){return i.customGradientDepth--},function(){r=i.debugMode()?i.profiler.profileKernel(s,function(){return t(i.backend,a)}):t(i.backend,a)}),this.shouldRecord()){var c={id:this.nextTapeNodeId++,name:s,inputs:e,outputs:Array.isArray(r)?r:[r]};null!=n&&(c.gradient=function(t){return n(t,o)}),this.activeTape.push(c)}return this.profiling&&this.activeProfile.kernels.push({name:s,bytesAdded:this.numBytes-u,totalBytesSnapshot:this.numBytes,tensorsAdded:this.numTensors-l,totalTensorsSnapshot:this.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShape:Array.isArray(r)?r.map(function(t){return t.shape}):r.shape}),r},t.prototype.registerTensor=function(t){var e=this.tensorInfo.has(t.dataId)?this.tensorInfo.get(t.dataId).refCount:0;this.numTensors++,0===e&&(this.numDataBuffers++,"complex64"!==t.dtype&&(this.numBytes+=c.sizeFromShape(t.shape)*c.bytesPerElement(t.dtype)),this.tensorInfo.set(t.dataId,{backend:this.backend,dtype:t.dtype,shape:t.shape,refCount:0}),this.backend.register(t.dataId,t.shape,t.dtype)),this.tensorInfo.get(t.dataId).refCount++,t instanceof u.Variable||this.track(t)},t.prototype.registerVariable=function(t){if(null!=this.registeredVariables[t.name])throw new Error("Variable with name "+t.name+" was already registered");this.registeredVariables[t.name]=t},t.prototype.disposeTensor=function(t){if(this.tensorInfo.has(t.dataId)){this.keepTensors.has(t.id)&&this.keepTensors.delete(t.id),this.numTensors--;var e=this.tensorInfo.get(t.dataId).refCount;if(e<=1){var n=this.tensorInfo.get(t.dataId);n.backend.disposeData(t.dataId),this.numDataBuffers--,"complex64"!==t.dtype&&(this.numBytes-=c.sizeFromShape(t.shape)*c.bytesPerElement(t.dtype)),this.tensorInfo.delete(t.dataId)}else this.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.registeredVariables){var e=this.registeredVariables[t];this.disposeTensor(e),delete this.registeredVariables[t]}},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.numTensors,t.numDataBuffers=this.numDataBuffers,t.numBytes=this.numBytes,t},t.prototype.profile=function(t){return i(this,void 0,void 0,function(){var e,n;return o(this,function(r){return this.profiling=!0,e=this.numBytes,n=this.numTensors,this.activeProfile.kernels=[],this.activeProfile.result=t(),this.profiling=!1,this.activeProfile.peakBytes=Math.max.apply(Math,this.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.activeProfile.newBytes=this.numBytes-e,this.activeProfile.newTensors=this.numTensors-n,[2,this.activeProfile]})})},t.prototype.shouldRecord=function(){return null!=this.activeTape&&0===this.customGradientDepth},t.prototype.addTapeNode=function(t,e,n){var r={};t.forEach(function(t,e){r[e]=t});var i=function(t){var e=n(t),r={};return e.forEach(function(t,e){r[e]=function(){return t}}),r},o={id:this.nextTapeNodeId++,name:this.activeScope.name,inputs:r,outputs:[e],gradient:i};this.activeTape.push(o)},t.prototype.keep=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {...}) to avoid memory leaks.");return this.keepTensors.add(t.id),t},t.prototype.startScope=function(t,e){void 0===e&&(e=!1),e&&0===this.gradientScopeCount&&(this.activeTape=[]),e&&this.gradientScopeCount++;var n={track:[],name:"unnamed scope"};t&&(n.name=t),this.scopeStack.push(n),this.activeScope=n},t.prototype.endScope=function(t,e){var n=this;void 0===e&&(e=!1),e&&(this.gradientScopeCount--,0===this.gradientScopeCount&&(this.activeTape=null));var r=new Set(this.keepTensors),i=l.getTensorsInContainer(t);i.forEach(function(t){return r.add(t.id)});for(var o=0;o<this.activeScope.track.length;o++){var a=this.activeScope.track[o];r.has(a.id)||(null!=this.activeTape?i.push(a):a.dispose())}var s=this.scopeStack.pop();this.activeScope=0===this.scopeStack.length?{track:[],name:"default scope"}:this.scopeStack[this.scopeStack.length-1],i.forEach(function(t){!n.keepTensors.has(t.id)&&l.isTensorInList(t,s.track)&&n.track(t)})},t.prototype.gradients=function(t,e,n,i){var o=this;return void 0===i&&(i=!1),c.assert(e.length>0,"gradients() received an empty list of xs."),this.tidy("gradients",function(){var a=t();c.assert(a instanceof u.Tensor,"The result y returned by f() must be a tensor.");var l=s.getFilteredNodesXToY(o.activeTape,e,a);if(!i&&0===l.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");var p={};p[a.id]=null==n?r(a.shape):n,s.backpropagateGradients(p,l);var h=e.map(function(t){return p[t.id]});return{value:a,grads:h}},!0)},t.prototype.customGrad=function(t){var e=this;return c.assert(c.isFunction(t),"The f passed in customGrad(f) must be a function."),function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];c.assert(n.every(function(t){return t instanceof u.Tensor}),"The args passed in customGrad(f)(x1, x2,...) must all be tensors");var i,o;if(e.scopedRun(function(){return e.customGradientDepth++},function(){return e.customGradientDepth--},function(){var r=!0;o=e.tidy(t.name,function(){var e=t.apply(void 0,n),r=e.value,o=e.gradFunc;return c.assert(r instanceof u.Tensor,"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),c.assert(c.isFunction(o),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),i=o,r},r)}),e.shouldRecord()){var a=function(t){var e=i(t),r=Array.isArray(e)?e:[e];return c.assert(r.length===n.length,"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),c.assert(r.every(function(t){return t instanceof u.Tensor}),"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."),r};e.addTapeNode(n,o,a)}return o}},t.prototype.write=function(t,e){var n=this.tensorInfo.get(t);this.backend!==n.backend&&(n.backend.disposeData(t),n.backend=this.backend,this.backend.register(t,n.shape,n.dtype)),this.backend.write(t,e)},t.prototype.readSync=function(t){var e=this.tensorInfo.get(t);return e.backend.readSync(t)},t.prototype.read=function(t){var e=this.tensorInfo.get(t);return e.backend.read(t)},t.prototype.fromPixels=function(t,e){return this.backend.fromPixels(t,e)},t.prototype.time=function(t){return i(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:return e=p.now(),[4,this.backend.time(t)];case 1:return n=r.sent(),n.wallMs=p.now()-e,[2,n]}})})},t.prototype.track=function(t){if(1===this.scopeStack.length&&this.safeMode)throw new Error("Safe mode is ON. Enclose all tensor operations inside tf.tidy(): tf.tidy(() => {op();...}); to avoid memory leaks.");return this.activeScope.track.push(t),t},t.nextTensorId=0,t.nextVariableId=0,t}();e.Engine=h},function(t,e,n){"use strict";function r(t){try{var e=y.getWebGLContext(t);if(null!=e)return!0}catch(t){return!1}return!1}function i(t){if(null==g){var e=y.getWebGLContext(t);g=e.getParameter(e.MAX_TEXTURE_SIZE)}return g}function o(t){if(0===t)return 0;var e,n=y.getWebGLContext(t);return e=p(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:p(n,"EXT_disjoint_timer_query")?1:0}function a(t){if(0===t)return!1;var e=y.getWebGLContext(t);if(1===t){if(!p(e,"OES_texture_float"))return!1}else if(!p(e,"EXT_color_buffer_float"))return!1;var n=h(e,t);return n}function s(t){if(0===t)return!1;var e=y.getWebGLContext(t);if(1===t){if(!p(e,"OES_texture_float"))return!1;if(!p(e,"WEBGL_color_buffer_float"))return!1}else if(!p(e,"EXT_color_buffer_float"))return!1;var n=h(e,t);return n}function u(t){if(2!==t)return!1;var e=y.getWebGLContext(t),n=null!=e.fenceSync;return n}function l(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}function c(){var t={};if("undefined"==typeof window||"undefined"==typeof window.location||"undefined"==typeof window.location.search)return t;var n=f(window.location.search);if(v in n){var r={},i=n[v].split(",");i.forEach(function(t){var e=t.split(":"),n=e[0],i=e[1];r[n]=i}),e.URL_PROPERTIES.forEach(function(e){e.name in r&&(console.log("Setting feature override from URL "+e.name+": "+r[e.name]),e.type===m.NUMBER?t[e.name]=+r[e.name]:e.type===m.BOOLEAN?t[e.name]="true"===r[e.name]:e.type===m.STRING?t[e.name]=r[e.name]:console.warn("Unknown URL param: "+e.name+"."))})}return t}function p(t,e){var n=t.getExtension(e);return null!=n}function h(t,e){var n=t.createFramebuffer(),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);var i=2===e?t.RGBA32F:t.RGBA;t.texImage2D(t.TEXTURE_2D,0,i,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),
t.deleteTexture(r),t.deleteFramebuffer(n),o}function f(t){var e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return d(e,n[0],n[1]),n.join("=")}),e}function d(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}Object.defineProperty(e,"__esModule",{value:!0});var m,y=n(74);!function(t){t[t.NUMBER=0]="NUMBER",t[t.BOOLEAN=1]="BOOLEAN",t[t.STRING=2]="STRING"}(m=e.Type||(e.Type={})),e.URL_PROPERTIES=[{name:"DEBUG",type:m.BOOLEAN},{name:"IS_BROWSER",type:m.BOOLEAN},{name:"WEBGL_LAZILY_UNPACK",type:m.BOOLEAN},{name:"WEBGL_CPU_FORWARD",type:m.BOOLEAN},{name:"WEBGL_PACK_BATCHNORMALIZATION",type:m.BOOLEAN},{name:"WEBGL_CONV_IM2COL",type:m.BOOLEAN},{name:"WEBGL_MAX_TEXTURE_SIZE",type:m.NUMBER},{name:"WEBGL_PAGING_ENABLED",type:m.BOOLEAN},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",type:m.NUMBER},{name:"WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",type:m.BOOLEAN},{name:"WEBGL_VERSION",type:m.NUMBER},{name:"WEBGL_RENDER_FLOAT32_ENABLED",type:m.BOOLEAN},{name:"WEBGL_DOWNLOAD_FLOAT_ENABLED",type:m.BOOLEAN},{name:"WEBGL_FENCE_API_ENABLED",type:m.BOOLEAN},{name:"WEBGL_SIZE_UPLOAD_UNIFORM",type:m.NUMBER},{name:"BACKEND",type:m.STRING},{name:"EPSILON",type:m.NUMBER},{name:"PROD",type:m.BOOLEAN},{name:"TENSORLIKE_CHECK_SHAPE_CONSISTENCY",type:m.BOOLEAN}],e.isWebGLVersionEnabled=r;var g;e.getWebGLMaxTextureSize=i,e.getWebGLDisjointQueryTimerVersion=o,e.isRenderToFloatTextureEnabled=a,e.isDownloadFloatTextureEnabled=s,e.isWebGLFenceEnabled=u,e.isChrome=l;var v="tfjsflags";e.getFeaturesFromURL=c,e.getQueryParams=f},function(t,e,n){"use strict";function r(t){return void 0===t&&(t="model"),new f(t)}function i(t){return new d(t)}var o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),u=n(40),l=n(41),c="model",p=".json",h=".weights.bin",f=function(){function t(e){if(!s.ENV.get("IS_BROWSER"))throw new Error("triggerDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e=c),this.modelTopologyFileName=e+p,this.weightDataFileName=e+h}return t.prototype.save=function(t){return o(this,void 0,void 0,function(){var e,n,r,i,o,s;return a(this,function(a){if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),t.modelTopology instanceof ArrayBuffer)throw new Error("DownloadTrigger.save() does not support saving model topology in binary formats yet.");return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,weightsManifest:n},i=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor,o.download=this.modelTopologyFileName,o.href=i,o.click(),null!=t.weightData&&(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=e,s.click()),[2,{modelArtifactsInfo:u.getModelArtifactsInfoForJSON(t)}]})})},t.URL_SCHEME="downloads://",t}();e.BrowserDownloads=f;var d=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return o(this,void 0,void 0,function(){var t,e,n=this;return a(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),s=a.modelTopology;if(null==s)return void i(new Error("modelTopology field is missing from file "+t.name));0===e.length&&r({modelTopology:s});var l=a.weightsManifest;if(null==l)return void i(new Error("weightManifest field is missing from file "+t.name));var c;try{c=n.checkManifestAndWeightFiles(l,e)}catch(t){return void i(t)}var p=[],h=[],f=[];l.forEach(function(t){t.paths.forEach(function(t){h.push(t),f.push(null)}),p.push.apply(p,t.weights)}),l.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,i=h.indexOf(t);f[i]=n,f.indexOf(null)===-1&&r({modelTopology:s,weightSpecs:p,weightData:u.concatenateArrayBuffers(f)})},e.onerror=function(e){i("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])})})},o.onerror=function(e){i("Failed to read model topology and weights manifest JSON "+("from file '"+t.name+"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},o.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return u.basename(t.name)}),i={},o=0,a=t;o<a.length;o++){var s=a[o];s.paths.forEach(function(t){var o=u.basename(t);if(n.indexOf(o)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+("'"+o+"'"));if(n.push(o),r.indexOf(o)===-1)throw new Error("Weight file with basename '"+o+"' is not provided.");i[t]=e[r.indexOf(o)]})}if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest "+("("+n.length+") and the number of weight files provided ")+("("+e.length+")."));return i},t}();e.browserDownloadsRouter=function(t){return s.ENV.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(f.URL_SCHEME)?r(t.slice(f.URL_SCHEME.length)):null},l.IORouterRegistry.registerSaveRouter(e.browserDownloadsRouter),e.browserDownloads=r,e.browserFiles=i},function(t,e,n){"use strict";function r(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),r=t.substring(0,e),i=n>e?t.substring(n):"";return[r+"/",i]}function i(t){return null!=t.match(h.URL_SCHEME_REGEX)}function o(t,e,n){return new h(t,e,n)}var a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var u=n(2),l=n(40),c=n(41),p=n(115),h=function(){function t(t,e,n){if(this.weightPathPrefix=n,this.DEFAULT_METHOD="POST","undefined"==typeof fetch)throw new Error("browserHTTPRequest is not supported outside the web browser without a fetch polyfill.");if(u.assert(null!=t&&t.length>0,"URL path for browserHTTPRequest must not be null, undefined or empty."),Array.isArray(t)&&u.assert(2===t.length,"URL paths for browserHTTPRequest must have a length of 2, "+("(actual length is "+t.length+").")),this.path=t,null!=e&&null!=e.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e||{}}return t.prototype.save=function(t){return a(this,void 0,void 0,function(){var e,n,r,i;return s(this,function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),e.body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,fetch(this.path,e)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:l.getModelArtifactsInfoForJSON(t),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(i.status+"."))}})})},t.prototype.load=function(){return a(this,void 0,void 0,function(){return s(this,function(t){return[2,Array.isArray(this.path)?this.loadBinaryModel():this.loadJSONModel()]})})},t.prototype.loadBinaryTopology=function(){return a(this,void 0,void 0,function(){var t,e;return s(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,fetch(this.path[0],this.requestInit)];case 1:if(t=n.sent(),!t.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.arrayBuffer()];case 2:return[2,n.sent()];case 3:throw e=n.sent(),new Error(this.path[0]+" not found. "+e);case 4:return[2]}})})},t.prototype.loadBinaryModel=function(){return a(this,void 0,void 0,function(){var t,e,n,r,i,o,a,u,l;return s(this,function(s){switch(s.label){case 0:return t=this.loadBinaryTopology(),[4,fetch(this.path[1],this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+e.statusText);return[4,Promise.all([t,e])];case 2:return n=s.sent(),r=n[0],i=n[1],[4,i.json()];case 3:return o=s.sent(),null==o?[3,5]:[4,this.loadWeights(o)];case 4:l=s.sent(),a=l[0],u=l[1],s.label=5;case 5:return[2,{modelTopology:r,weightSpecs:a,weightData:u}]}})})},t.prototype.loadJSONModel=function(){return a(this,void 0,void 0,function(){var t,e,n,r,i,o,a,u;return s(this,function(s){switch(s.label){case 0:return[4,fetch(this.path,this.requestInit)];case 1:if(t=s.sent(),!t.ok)throw new Error("BrowserHTTPRequest.load() failed due to HTTP response: "+t.statusText);return[4,t.json()];case 2:if(e=s.sent(),n=e.modelTopology,r=e.weightsManifest,null==n&&null==r)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==r?[3,4]:(a=e.weightsManifest,[4,this.loadWeights(a)]);case 3:u=s.sent(),i=u[0],o=u[1],s.label=4;case 4:return[2,{modelTopology:n,weightSpecs:i,weightData:o}]}})})},t.prototype.loadWeights=function(t){return a(this,void 0,void 0,function(){var e,n,i,o,a,u,c,h,f,d,m,y;return s(this,function(s){switch(s.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=r(e),i=n[0],o=n[1],a=this.weightPathPrefix||i,u=[],c=0,h=t;c<h.length;c++)f=h[c],u.push.apply(u,f.weights);return d=[],t.forEach(function(t){t.paths.forEach(function(t){d.push(a+t+o)})}),m=[u],y=l.concatenateArrayBuffers,[4,p.loadWeightsAsArrayBuffer(d,this.requestInit)];case 1:return[2,m.concat([y.apply(void 0,[s.sent()])])]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();e.BrowserHTTPRequest=h,e.parseUrl=r,e.httpRequestRouter=function(t){if("undefined"==typeof fetch)return null;var e=!0;return(e=Array.isArray(t)?t.every(function(t){return i(t)}):i(t))?o(t):null},c.IORouterRegistry.registerSaveRouter(e.httpRequestRouter),c.IORouterRegistry.registerLoadRouter(e.httpRequestRouter),e.browserHTTPRequest=o},function(t,e,n){"use strict";function r(){return u(this,void 0,void 0,function(){var t;return l(this,function(e){return t=i(),[2,new Promise(function(e,n){var r=t.deleteDatabase(d);r.onsuccess=function(){return e()},r.onerror=function(t){return n(t)}})]})})}function i(){if(!c.ENV.get("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function o(t){var e=t.result;e.createObjectStore(y,{keyPath:"modelPath"}),e.createObjectStore(g,{keyPath:"modelPath"})}function a(t){return new v(t)}function s(t){return t.startsWith(v.URL_SCHEME)?t.slice(v.URL_SCHEME.length):t}var u=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},l=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),p=n(40),h=n(75),f=n(41),d="tensorflowjs",m=1,y="models_store",g="model_info_store";e.deleteDatabase=r;var v=function(){function t(t){if(this.indexedDB=i(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return u(this,void 0,void 0,function(){return l(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return u(this,void 0,void 0,function(){return l(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var i=n.indexedDB.open(d,m);i.onupgradeneeded=function(){return o(i)},i.onsuccess=function(){var o=i.result;if(null==e){var a=o.transaction(y,"readonly"),s=a.objectStore(y),u=s.get(n.modelPath);u.onsuccess=function(){return null==u.result?(o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."))):void t(u.result.modelArtifacts)},u.onerror=function(t){return o.close(),r(u.error)},a.oncomplete=function(){return o.close()}}else{var l,c=p.getModelArtifactsInfoForJSON(e),h=o.transaction(g,"readwrite"),f=h.objectStore(g),d=f.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){l=o.transaction(y,"readwrite");var i=l.objectStore(y),a=i.put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});a.onsuccess=function(){return t({modelArtifactsInfo:c})},a.onerror=function(t){f=h.objectStore(g);var e=f.delete(n.modelPath);e.onsuccess=function(){return o.close(),r(a.error)},e.onerror=function(t){return o.close(),r(a.error)}}},d.onerror=function(t){return o.close(),r(d.error)},h.oncomplete=function(){null==l?o.close():l.oncomplete=function(){return o.close()}}}},i.onerror=function(t){return r(i.error)}})},t.URL_SCHEME="indexeddb://",t}();e.BrowserIndexedDB=v,e.indexedDBRouter=function(t){return c.ENV.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(v.URL_SCHEME)?a(t.slice(v.URL_SCHEME.length)):null},f.IORouterRegistry.registerSaveRouter(e.indexedDBRouter),f.IORouterRegistry.registerLoadRouter(e.indexedDBRouter),e.browserIndexedDB=a;var b=function(){function t(){this.indexedDB=i()}return t.prototype.listModels=function(){return u(this,void 0,void 0,function(){var t=this;return l(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open(d,m);r.onupgradeneeded=function(){return o(r)},r.onsuccess=function(){var t=r.result,i=t.transaction(g,"readonly"),o=i.objectStore(g),a=o.getAll();a.onsuccess=function(){for(var t={},n=0,r=a.result;n<r.length;n++){var i=r[n];t[i.modelPath]=i.modelArtifactsInfo}e(t)},a.onerror=function(e){return t.close(),n(a.error)},i.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return u(this,void 0,void 0,function(){var e=this;return l(this,function(n){return t=s(t),[2,new Promise(function(n,r){var i=e.indexedDB.open(d,m);i.onupgradeneeded=function(){return o(i)},i.onsuccess=function(){var e,o=i.result,a=o.transaction(g,"readwrite"),s=a.objectStore(g),u=s.get(t);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var i=s.delete(t),a=function(){e=o.transaction(y,"readwrite");var i=e.objectStore(y),a=i.delete(t);a.onsuccess=function(){return n(u.result.modelArtifactsInfo)},a.onerror=function(t){return r(u.error)}};i.onsuccess=a,i.onerror=function(t){return a(),o.close(),r(u.error)}},u.onerror=function(t){return o.close(),r(u.error)},a.oncomplete=function(){null==e?o.close():e.oncomplete=function(){return o.close()}}},i.onerror=function(t){return r(i.error)}})]})})},t}();if(e.BrowserIndexedDBManager=b,c.ENV.get("IS_BROWSER"))try{h.ModelStoreManagerRegistry.registerManager(v.URL_SCHEME,new b)}catch(t){}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n(240),n(242);var r=n(238);e.browserFiles=r.browserFiles;var i=n(239);e.browserHTTPRequest=i.browserHTTPRequest;var o=n(40);e.concatenateArrayBuffers=o.concatenateArrayBuffers,e.decodeWeights=o.decodeWeights,e.encodeWeights=o.encodeWeights,e.getModelArtifactsInfoForJSON=o.getModelArtifactsInfoForJSON;var a=n(243);e.fromMemory=a.fromMemory,e.withSaveHandler=a.withSaveHandler;var s=n(41),u=n(115);e.loadWeights=u.loadWeights;var l=s.IORouterRegistry.registerSaveRouter;e.registerSaveRouter=l;var c=s.IORouterRegistry.registerLoadRouter;e.registerLoadRouter=c;var p=s.IORouterRegistry.getSaveHandlers;e.getSaveHandlers=p;var h=s.IORouterRegistry.getLoadHandlers;e.getLoadHandlers=h;var f=n(75);e.copyModel=f.copyModel,e.listModels=f.listModels,e.moveModel=f.moveModel,e.removeModel=f.removeModel},function(t,e,n){"use strict";function r(){if(!c.ENV.get("IS_BROWSER")||"undefined"==typeof window.localStorage)throw new Error("purgeLocalStorageModels() cannot proceed because local storage is unavailable in the current environment.");for(var t=window.localStorage,e=[],n=0;n<t.length;++n){var r=t.key(n),i=y+m;if(r.startsWith(i)&&r.length>i.length){t.removeItem(r);var a=o(r);e.indexOf(a)===-1&&e.push(a)}}return e}function i(t){return{info:[y,t,g].join(m),topology:[y,t,v].join(m),weightSpecs:[y,t,b].join(m),weightData:[y,t,_].join(m)}}function o(t){var e=t.split(m);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(m)}function a(t){return t.startsWith(w.URL_SCHEME)?t.slice(w.URL_SCHEME.length):t}function s(t){return new w(t)}var u=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},l=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),p=n(2),h=n(40),f=n(75),d=n(41),m="/",y="tensorflowjs_models",g="info",v="model_topology",b="weight_specs",_="weight_data";e.purgeLocalStorageArtifacts=r;var w=function(){function t(t){if(!c.ENV.get("IS_BROWSER")||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=i(this.modelPath)}return t.prototype.save=function(t){return u(this,void 0,void 0,function(){var e,n,r,i;return l(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=h.getModelArtifactsInfoForJSON(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,h.arrayBufferToBase64String(t.weightData)),[2,{modelArtifactsInfo:r}]}catch(t){for(i in this.keys)this.LS.removeItem(this.keys[i]);throw new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+r.modelTopologyBytes+", ")+("weightSpecsBytes="+r.weightSpecsBytes+", ")+("weightDataBytes="+r.weightDataBytes+"."))}return[2]})})},t.prototype.load=function(){return u(this,void 0,void 0,function(){var t,e,n,r,i;return l(this,function(o){if(t=JSON.parse(this.LS.getItem(this.keys.info)),null==t)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},n=JSON.parse(this.LS.getItem(this.keys.topology)),null==n)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,r=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),null==r)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,i=this.LS.getItem(this.keys.weightData),null==i)throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."));return e.weightData=h.base64StringToArrayBuffer(i),[2,e]})})},t.URL_SCHEME="localstorage://",t}();e.BrowserLocalStorage=w,e.localStorageRouter=function(t){return c.ENV.get("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(w.URL_SCHEME)?s(t.slice(w.URL_SCHEME.length)):null},d.IORouterRegistry.registerSaveRouter(e.localStorageRouter),d.IORouterRegistry.registerLoadRouter(e.localStorageRouter),e.browserLocalStorage=s;var S=function(){function t(){p.assert(c.ENV.get("IS_BROWSER"),"Current environment is not a web browser"),p.assert("undefined"!=typeof window.localStorage,"Current browser does not appear to support localStorage"),this.LS=window.localStorage}return t.prototype.listModels=function(){return u(this,void 0,void 0,function(){var t,e,n,r,i,a;return l(this,function(s){for(t={},e=y+m,n=m+g,r=0;r<this.LS.length;++r)i=this.LS.key(r),i.startsWith(e)&&i.endsWith(n)&&(a=o(i),t[a]=JSON.parse(this.LS.getItem(i)));return[2,t]})})},t.prototype.removeModel=function(t){return u(this,void 0,void 0,function(){var e,n;return l(this,function(r){if(t=a(t),e=i(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(e.BrowserLocalStorageManager=S,c.ENV.get("IS_BROWSER"))try{f.ModelStoreManagerRegistry.registerManager(w.URL_SCHEME,new S)}catch(t){}},function(t,e){"use strict";function n(t,e,n){return new s(t,e,n)}function r(t){return new u(t)}var i=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},a=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,n){this.modelTopology=t,this.weightSpecs=e,this.weightData=n}return t.prototype.load=function(){return o(this,void 0,void 0,function(){var t;return a(this,function(e){return t={},null!=this.modelTopology&&(t=i({modelTopology:this.modelTopology},t)),null!=this.weightSpecs&&this.weightSpecs.length>0&&(t=i({weightSpecs:this.weightSpecs},t)),null!=this.weightData&&this.weightData.byteLength>0&&(t=i({weightData:this.weightData},t)),[2,t]})})},t}(),u=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return o(this,void 0,void 0,function(){return a(this,function(e){return[2,this.saveHandler(t)]})})},t}();e.fromMemory=n,e.withSaveHandler=r},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},i=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(154),a=n(3),s=n(129),u=n(130),l=n(24),c=n(25),p=n(58),h=n(133),f=n(134),d=n(22),m=n(22),y=n(82),g=n(83),v=n(84),b=n(15),_=n(60),w=n(2),S=n(2),x=n(76),T=n(116),P=n(118),E=n(77),A=n(120),N=n(121),O=n(78),k=function(){function t(){this.blockSize=48,this.firstUse=!0,a.ENV.get("IS_BROWSER")&&(this.fromPixels2DContext=document.createElement("canvas").getContext("2d"))}return t.prototype.setDataMover=function(t){this.data=new x.DataStorage(t)},t.prototype.register=function(t,e,n){if(this.firstUse&&(this.firstUse=!1,a.ENV.get("IS_NODE")&&s.warn("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================\n")),this.data.has(t))throw new Error("Data buffer is already registered");this.data.set(t,{dtype:n})},t.prototype.write=function(t,e){if(null==e)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(t).values=e},t.prototype.fromPixels=function(t,e){if(null==t)throw new Error("pixels passed to tf.fromPixels() can not be null");var n;if(a.ENV.get("IS_NODE")&&null==t.getContext)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(null!=t.getContext)n=t.getContext("2d").getImageData(0,0,t.width,t.height).data;else if(t instanceof ImageData)n=t.data;else{if(!(t instanceof HTMLImageElement||t instanceof HTMLVideoElement))throw new Error("pixels passed to tf.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement or ImageData, but was "+t.constructor.name);if(null==this.fromPixels2DContext)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=t.width,this.fromPixels2DContext.canvas.height=t.height,
this.fromPixels2DContext.drawImage(t,0,0,t.width,t.height),n=this.fromPixels2DContext.getImageData(0,0,t.width,t.height).data}var r;if(4===e)r=new Int32Array(n);else{var i=t.width*t.height;r=new Int32Array(i*e);for(var o=0;o<i;o++)for(var s=0;s<e;++s)r[o*e+s]=n[4*o+s]}var u=[t.height,t.width,e];return m.tensor3d(r,u,"int32")},t.prototype.read=function(t){return r(this,void 0,void 0,function(){return i(this,function(e){return[2,this.readSync(t)]})})},t.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;if("complex64"===n){var i=r.real.dataSync(),o=r.imag.dataSync();return P.mergeRealAndImagArrays(i,o)}return this.data.get(t).values},t.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},t.prototype.time=function(t){return r(this,void 0,void 0,function(){var e,n;return i(this,function(r){return e=S.now(),t(),n=S.now()-e,[2,{kernelMs:n}]})})},t.prototype.memory=function(){return{unreliable:!0}},t.prototype.complex=function(t,e){var n=b.Tensor.make(t.shape,{},"complex64"),r=this.data.get(n.dataId);return r.complexTensors={real:a.ENV.engine.keep(t.clone()),imag:a.ENV.engine.keep(e.clone())},n},t.prototype.real=function(t){var e=this.data.get(t.dataId);return e.complexTensors.real.clone()},t.prototype.imag=function(t){var e=this.data.get(t.dataId);return e.complexTensors.imag.clone()},t.prototype.assertNotComplex=function(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&w.assert("complex64"!==t.dtype,e+" does not support complex64 tensors.")})},t.prototype.slice=function(t,e,n){this.assertNotComplex(t,"slice");for(var r=d.buffer(n,t.dtype),i=0;i<r.size;++i){var o=r.indexToLoc(i),a=o.map(function(t,n){return t+e[n]});r.set.apply(r,[t.get.apply(t,a)].concat(o))}return r.toTensor()},t.prototype.stridedSlice=function(t,e,n,r,i,o,a,s,u){this.assertNotComplex(t,"stridedSlice");var l=v.getStridedSlicedInfo(t.shape,e,n,r,i,o,a,s,u),c=l[0],p=l[1],h=l[2],f=p.filter(function(t,e){return h.indexOf(e)===-1});if(f.some(function(t){return 0===t}))return d.tensor([],f);for(var m=d.buffer(p,t.dtype),y=0;y<m.size;y++){for(var g=m.indexToLoc(y),b=new Array(g.length),_=0;_<b.length;_++)b[_]=g[_]*r[_]+c[_];m.set.apply(m,[t.get.apply(t,b)].concat(g))}return m.toTensor().reshape(f)},t.prototype.reverse=function(t,e){this.assertNotComplex(t,"reverse");for(var n=d.buffer(t.shape,t.dtype),r=t.buffer(),i=function(i){var o=n.indexToLoc(i),a=o.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},t.prototype.concat=function(t,e){this.assertNotComplex(t,"concat");var n=t.map(function(t){var n=w.sizeFromShape(t.shape.slice(e));return t.as2D(-1,n)}),r=p.computeOutShape(n.map(function(t){return t.shape}),1),i=d.buffer(r,t[0].dtype).values;if(1===n[0].shape[0]){var o=0;n.forEach(function(t){i.set(t.dataSync(),o),o+=t.size})}else{var a=0;n.forEach(function(t){for(var e=t.dataSync(),n=0,o=0;o<t.shape[0];++o)for(var s=o*r[1]+a,u=0;u<t.shape[1];++u)i[s+u]=e[n++];a+=t.shape[1]})}var s=p.computeOutShape(t.map(function(t){return t.shape}),e);return m.tensor(i,s,t[0].dtype)},t.prototype.neg=function(t){return this.assertNotComplex(t,"neg"),this.multiply(d.scalar(-1),t)},t.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,_.upcastType(t.dtype,e.dtype),function(t,e){return t+e})},t.prototype.addN=function(t){this.assertNotComplex(t,"addN");for(var e=t.map(function(t){return t.dataSync()}),n=d.buffer(t[0].shape,t[0].dtype),r=n.values,i=0;i<t.length;i++)for(var o=e[i],a=0;a<r.length;a++)r[a]+=o[a];return n.toTensor()},t.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,_.upcastType(t.dtype,e.dtype),function(t,e){return t-e})},t.prototype.pow=function(t,e){return this.assertNotComplex([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},t.prototype.batchMatMul=function(t,e,n,r){this.assertNotComplex([t,e],"matMul");for(var i=n?t.shape[1]:t.shape[2],o=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=t.dataSync(),l=e.dataSync(),c=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],p=c[0],h=c[1],f=c[2],m=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],y=m[0],g=m[1],v=m[2],b=o*a,_=new Float32Array(s*b),w=this.blockSize,S=0;S<s;S++)for(var x=0;x<o;x+=w)for(var T=0;T<a;T+=w)for(var P=0;P<i;P+=w)for(var E=Math.min(x+w,o),A=Math.min(T+w,a),N=Math.min(P+w,i),O=x;O<E;O++)for(var k=T;k<A;k++){for(var I=0,C=P;C<N;C++)I+=u[S*p+O*h+C*f]*l[C*y+k*g+S*v];_[S*b+(O*a+k)]+=I}return d.tensor3d(_,[s,o,a])},t.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,_.upcastType(t.dtype,e.dtype),function(t,e){return t*e})},t.prototype.realDivide=function(t,e){this.assertNotComplex([t,e],"realDivide");var n=function(t,e){return t/e},r="float32";return this.broadcastedBinaryOp(t,e,r,n)},t.prototype.floorDiv=function(t,e){this.assertNotComplex([t,e],"floorDiv");var n=function(t,e){return Math.floor(t/e)},r="int32";return this.broadcastedBinaryOp(t,e,r,n)},t.prototype.sum=function(t,e){this.assertNotComplex(t,"sum"),l.assertAxesAreInnerMostDims("sum",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=_.upcastType(t.dtype,"int32"),a=d.zeros(r,o),s=w.sizeFromShape(i),u=a.dataSync(),c=t.dataSync(),p=0;p<u.length;++p){for(var h=p*s,f=0,m=0;m<s;++m)f+=c[h+m];u[p]=f}return a},t.prototype.prod=function(t,e){this.assertNotComplex(t,"sum");for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=_.upcastType(t.dtype,"int32"),a=d.zeros(r,o),s=w.sizeFromShape(i),u=a.dataSync(),c=t.dataSync(),p=0;p<u.length;++p){for(var h=p*s,f=1,m=0;m<s;++m)f*=c[h+m];u[p]=f}return a},t.prototype.unsortedSegmentSum=function(t,e,n){this.assertNotComplex(t,"unsortedSegmentSum");for(var r=[],i=t.rank-e.rank,o=0;o<i;++o)e=e.expandDims(o+1);for(var o=0;o<n;++o){var a=d.scalar(o,"int32"),s=d.equal(a,e).asType("float32"),u=s.mul(t).sum(0);r.push(u)}return d.stack(r)},t.prototype.argMin=function(t,e){this.assertNotComplex(t,"argMin");var n=[e];l.assertAxesAreInnerMostDims("argMin",n,t.rank);for(var r=l.computeOutAndReduceShapes(t.shape,n),i=r[0],o=r[1],a=d.zeros(i,"int32"),s=w.sizeFromShape(o),u=a.dataSync(),c=t.dataSync(),p=0;p<u.length;++p){for(var h=p*s,f=c[h],m=0,y=0;y<s;++y){var g=c[h+y];g<f&&(f=g,m=y)}u[p]=m}return a},t.prototype.argMax=function(t,e){this.assertNotComplex(t,"argMax");var n=[e];l.assertAxesAreInnerMostDims("argMax",n,t.rank);for(var r=l.computeOutAndReduceShapes(t.shape,n),i=r[0],o=r[1],a=d.zeros(i,"int32"),s=w.sizeFromShape(o),u=a.dataSync(),c=t.dataSync(),p=0;p<u.length;++p){for(var h=p*s,f=c[h],m=0,y=0;y<s;++y){var g=c[h+y];g>f&&(f=g,m=y)}u[p]=m}return a},t.prototype.cumsum=function(t,e,n,r){if(this.assertNotComplex(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var i=_.upcastType(t.dtype,"int32"),o=d.zeros(t.shape,i),a=o.dataSync(),s=t.dataSync(),u=t.shape[t.rank-1],l=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},c=0;c<s.length;c+=u)for(var p=0;p<u;p++){var h=l(c,p);if(0===p)a[h]=n?0:s[h];else{var f=l(c,p-1);a[h]=n?s[f]+a[f]:s[h]+a[f]}}return o},t.prototype.equal=function(t,e){return this.assertNotComplex([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},t.prototype.notEqual=function(t,e){return this.assertNotComplex([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},t.prototype.less=function(t,e){return this.assertNotComplex([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},t.prototype.lessEqual=function(t,e){return this.assertNotComplex([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},t.prototype.greater=function(t,e){return this.assertNotComplex([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},t.prototype.greaterEqual=function(t,e){return this.assertNotComplex([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},t.prototype.logicalNot=function(t){this.assertNotComplex(t,"logicalNot");for(var e=t.dataSync(),n=new Int32Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return b.Tensor.make(t.shape,{values:n},"bool")},t.prototype.logicalAnd=function(t,e){return this.assertNotComplex([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},t.prototype.logicalOr=function(t,e){return this.assertNotComplex([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},t.prototype.select=function(t,e,n){this.assertNotComplex([t,e,n],"select");for(var r=t.dataSync(),i=e.dataSync(),o=n.dataSync(),a=d.zeros(e.shape,_.upcastType(e.dtype,n.dtype)),s=a.dataSync(),u=0,l=0===t.rank||t.rank>1||1===e.rank?1:e.shape[1],c=0;c<r.length;c++)for(var p=0;p<l;p++)1===r[c]?s[u++]=i[c]:s[u++]=o[c];return a},t.prototype.where=function(t){this.assertNotComplex([t],"where");var e=t.dataSync();return O.whereImpl(t.shape,e)},t.prototype.topk=function(t,e,n){this.assertNotComplex(t,"topk");var r=t.dataSync();return N.topkImpl(r,t.shape,t.dtype,e,n)},t.prototype.min=function(t,e){this.assertNotComplex(t,"min"),l.assertAxesAreInnerMostDims("min",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),a=w.sizeFromShape(i),s=o.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],f=0;f<a;++f){var m=u[p+f];m<h&&(h=m)}s[c]=h}return o},t.prototype.minimum=function(t,e){return this.assertNotComplex([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},t.prototype.mod=function(t,e){return this.assertNotComplex([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},t.prototype.max=function(t,e){this.assertNotComplex(t,"max"),l.assertAxesAreInnerMostDims("max",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),a=w.sizeFromShape(i),s=o.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],f=0;f<a;++f){var m=u[p+f];m>h&&(h=m)}s[c]=h}return o},t.prototype.maximum=function(t,e){return this.assertNotComplex([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},t.prototype.all=function(t,e){this.assertNotComplex(t,"all"),l.assertAxesAreInnerMostDims("all",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),a=w.sizeFromShape(i),s=o.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],f=0;f<a;++f){var m=u[p+f];h=h&&m}s[c]=h}return o},t.prototype.any=function(t,e){this.assertNotComplex(t,"any"),l.assertAxesAreInnerMostDims("any",e,t.rank);for(var n=l.computeOutAndReduceShapes(t.shape,e),r=n[0],i=n[1],o=d.zeros(r,t.dtype),a=w.sizeFromShape(i),s=o.dataSync(),u=t.dataSync(),c=0;c<s.length;++c){for(var p=c*a,h=u[p],f=0;f<a;++f){var m=u[p+f];h=h||m}s[c]=h}return o},t.prototype.squaredDifference=function(t,e){return this.assertNotComplex([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},t.prototype.ceil=function(t){this.assertNotComplex(t,"ceil");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return b.Tensor.make(t.shape,{values:n})},t.prototype.floor=function(t){this.assertNotComplex(t,"floor");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return b.Tensor.make(t.shape,{values:n})},t.prototype.sign=function(t){this.assertNotComplex(t,"x");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return b.Tensor.make(t.shape,{values:n})},t.prototype.round=function(t){this.assertNotComplex(t,"round");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=Math.floor(e[r]);e[r]-i<.5?n[r]=Math.floor(e[r]):e[r]-i>.5?n[r]=Math.ceil(e[r]):i%2===0?n[r]=i:n[r]=i+1}return b.Tensor.make(t.shape,{values:n})},t.prototype.exp=function(t){this.assertNotComplex(t,"exp");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return b.Tensor.make(t.shape,{values:n})},t.prototype.expm1=function(t){this.assertNotComplex(t,"expm1");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return b.Tensor.make(t.shape,{values:n})},t.prototype.log=function(t){this.assertNotComplex(t,"log");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log(i)}return b.Tensor.make(t.shape,{values:n})},t.prototype.log1p=function(t){this.assertNotComplex(t,"log1p");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.log1p(i)}return b.Tensor.make(t.shape,{values:n})},t.prototype.sqrt=function(t){this.assertNotComplex(t,"sqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=Math.sqrt(i)}return b.Tensor.make(t.shape,{values:n})},t.prototype.rsqrt=function(t){this.assertNotComplex(t,"rsqrt");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=1/Math.sqrt(i)}return b.Tensor.make(t.shape,{values:n})},t.prototype.square=function(t){this.assertNotComplex(t,"square");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r){var i=e[r];n[r]=i*i}return b.Tensor.make(t.shape,{values:n})},t.prototype.reciprocal=function(t){this.assertNotComplex(t,"reciprocal");for(var e=t.dataSync(),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return b.Tensor.make(t.shape,{values:n})},t.prototype.relu=function(t){this.assertNotComplex(t,"relu");for(var e=d.zeros(t.shape,t.dtype),n=e.dataSync(),r=t.dataSync(),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return e},t.prototype.elu=function(t){this.assertNotComplex(t,"elu");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r){var i=n[r];i>=0?e[r]=i:e[r]=Math.exp(i)-1}return b.Tensor.make(t.shape,{values:e})},t.prototype.eluDer=function(t,e){this.assertNotComplex([t,e],"eluDer");for(var n=new Float32Array(e.size),r=e.dataSync(),i=t.dataSync(),o=0;o<r.length;++o){var a=r[o];a>=1?n[o]=i[o]:n[o]=i[o]*(a+1)}return b.Tensor.make(e.shape,{values:n})},t.prototype.selu=function(t){this.assertNotComplex(t,"selu");for(var e=g.SELU_SCALEALPHA,n=g.SELU_SCALE,r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var a=i[o];a>=0?r[o]=n*a:r[o]=e*(Math.exp(a)-1)}return b.Tensor.make(t.shape,{values:r})},t.prototype.clip=function(t,e,n){this.assertNotComplex(t,"clip");for(var r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var a=i[o];r[o]=a>n?n:a<e?e:a}return b.Tensor.make(t.shape,{values:r})},t.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<t.size;++r){var i=n[2*r],o=n[2*r+1];e[r]=Math.sqrt(i*i+o*o)}return b.Tensor.make(t.shape,{values:e})},t.prototype.int=function(t){this.assertNotComplex(t,"int");for(var e=new Int32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=n[r];return b.Tensor.make(t.shape,{values:e},"int32")},t.prototype.sigmoid=function(t){this.assertNotComplex(t,"sigmoid");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return b.Tensor.make(t.shape,{values:e})},t.prototype.softplus=function(t){this.assertNotComplex(t,"softplus");for(var e=1.1920928955078125e-7,n=Math.log(e)+2,r=new Float32Array(t.size),i=t.dataSync(),o=0;o<i.length;++o){var a=i[o]>-n,s=i[o]<n,u=Math.exp(i[o]),l=void 0;l=s?u:a?i[o]:Math.log(1+u),r[o]=l}return b.Tensor.make(t.shape,{values:r})},t.prototype.sin=function(t){this.assertNotComplex(t,"sin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.cos=function(t){this.assertNotComplex(t,"cos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.tan=function(t){this.assertNotComplex(t,"tan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.asin=function(t){this.assertNotComplex(t,"asin");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.acos=function(t){this.assertNotComplex(t,"acos");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.atan=function(t){this.assertNotComplex(t,"atan");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.atan2=function(t,e){return this.assertNotComplex([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},t.prototype.sinh=function(t){this.assertNotComplex(t,"sinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.cosh=function(t){this.assertNotComplex(t,"cosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.tanh=function(t){this.assertNotComplex(t,"tanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=w.tanh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.asinh=function(t){this.assertNotComplex(t,"asinh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.acosh=function(t){this.assertNotComplex(t,"acosh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.atanh=function(t){this.assertNotComplex(t,"atanh");for(var e=new Float32Array(t.size),n=t.dataSync(),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return b.Tensor.make(t.shape,{values:e})},t.prototype.erf=function(t){this.assertNotComplex(t,"erf");for(var e=new Float32Array(t.size),n=t.dataSync(),r=h.ERF_P,i=h.ERF_A1,o=h.ERF_A2,a=h.ERF_A3,s=h.ERF_A4,u=h.ERF_A5,l=0;l<n.length;++l){var c=n[l],p=1/(1+r*c);e[l]=1-((((u*p+s)*p+a)*p+o)*p+i)*p*Math.exp(-c*c)}return b.Tensor.make(t.shape,{values:e})},t.prototype.step=function(t,e){void 0===e&&(e=0),this.assertNotComplex(t,"step");for(var n=new Float32Array(t.size),r=t.dataSync(),i=0;i<r.length;++i){var o=r[i];isNaN(o)?n[i]=NaN:n[i]=o>0?1:e}return b.Tensor.make(t.shape,{values:n})},t.prototype.conv2d=function(t,e,n){this.assertNotComplex([t,e],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=d.buffer(n.outShape,t.dtype),c=t.dataSync(),p=e.dataSync(),h=l.values,f=0;f<n.batchSize;++f)for(var m=f*t.strides[0],y=f*l.strides[0],g=0;g<n.outHeight;++g)for(var v=y+g*l.strides[1],b=g*n.strideHeight-s,_=0;_<r;_++){var w=b+_*o;if(!(w<0||w>=n.inHeight))for(var S=_*e.strides[0],x=m+w*t.strides[1],T=0;T<n.outWidth;++T)for(var P=v+T*n.outChannels,E=T*n.strideWidth-u,A=0;A<i;A++){var N=E+A*a;if(!(N<0||N>=n.inWidth))for(var O=S+A*e.strides[1],k=x+N*n.inChannels,I=O,C=0;C<n.inChannels;++C){for(var M=c[k+C],R=0;R<n.outChannels;++R)h[P+R]+=M*p[I+R];I+=n.outChannels}}}return l.toTensor()},t.prototype.conv2dDerInput=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerInput");for(var r=d.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=t.dataSync(),c=t.strides,p=c[0],h=c[1],f=c[2],m=e.dataSync(),y=e.strides,g=y[0],v=y[1],b=y[2],_=n.batchSize,w=n.filterHeight,S=n.filterWidth,x=n.inChannels,T=n.inHeight,P=n.inWidth,E=n.outChannels,A=n.outHeight,N=n.outWidth,O=n.strideHeight,k=n.strideWidth,I=w-1-n.padInfo.top,C=S-1-n.padInfo.left,M=0;M<_;++M)for(var R=0;R<x;++R)for(var D=0;D<T;++D)for(var L=D-I,F=Math.max(0,Math.ceil(L/O)),z=Math.min(A,(w+L)/O),q=0;q<P;++q){for(var V=q-C,B=Math.max(0,Math.ceil(V/k)),j=Math.min(N,(S+V)/k),U=0,G=F;G<z;++G)for(var W=G*O-L,H=B;H<j;++H)for(var Q=H*k-V,K=p*M+h*G+f*H,Y=g*(w-1-W)+v*(S-1-Q)+b*R,X=0;X<E;++X){var $=l[K+X],J=m[Y+X];U+=$*J}i[a*M+s*D+u*q+R]=U}return r.toTensor()},t.prototype.conv2dDerFilter=function(t,e,n){this.assertNotComplex([t,e],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=d.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=0;c<o;++c)for(var p=Math.max(0,Math.ceil((l-c)/r)),h=Math.min(n.outHeight,(n.inHeight+l-c)/r),f=0;f<a;++f)for(var m=Math.max(0,Math.ceil((u-f)/i)),y=Math.min(n.outWidth,(n.inWidth+u-f)/i),g=0;g<n.inChannels;++g)for(var v=0;v<n.outChannels;++v){for(var b=0,_=0;_<n.batchSize;++_)for(var w=p;w<h;++w)for(var S=c+w*r-l,x=m;x<y;++x){var T=f+x*i-u;b+=t.get(_,S,T,g)*e.get(_,w,x,v)}s.set(b,c,f,g,v)}return s.toTensor()},t.prototype.depthwiseConv2D=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,l=n.outChannels/n.inChannels,c=d.buffer(n.outShape,t.dtype),p=t.dataSync(),h=e.dataSync(),f=c.values,m=0;m<n.batchSize;++m)for(var y=m*t.strides[0],g=m*c.strides[0],v=0;v<n.outHeight;++v)for(var b=g+v*c.strides[1],_=v*n.strideHeight-s,w=0;w<r;++w){var S=_+w*o;if(!(S<0||S>=n.inHeight))for(var x=w*e.strides[0],T=y+S*t.strides[1],P=0;P<n.outWidth;++P)for(var E=b+P*c.strides[2],A=P*n.strideWidth-u,N=0;N<i;++N){var O=A+N*a;if(!(O<0||O>=n.inWidth))for(var k=x+N*e.strides[1],I=T+O*n.inChannels,C=E,M=k,R=0;R<n.inChannels;++R){for(var D=p[I+R],L=0;L<l;++L)f[C+L]+=D*h[M+L];C+=l,M+=l}}}return c.toTensor()},t.prototype.depthwiseConv2DDerInput=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerInput");for(var r=d.buffer(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],l=t.dataSync(),c=t.strides,p=c[0],h=c[1],f=c[2],m=e.dataSync(),y=e.strides,g=y[0],v=y[1],b=y[2],_=n.batchSize,w=n.filterHeight,S=n.filterWidth,x=n.inChannels,T=n.inHeight,P=n.inWidth,E=n.outChannels,A=n.outHeight,N=n.outWidth,O=n.strideHeight,k=n.strideWidth,I=w-1-n.padInfo.top,C=S-1-n.padInfo.left,M=E/x,R=0;R<_;++R)for(var D=0;D<x;++D)for(var L=0;L<T;++L)for(var F=L-I,z=Math.max(0,Math.ceil(F/O)),q=Math.min(A,(w+F)/O),V=0;V<P;++V){for(var B=V-C,j=Math.max(0,Math.ceil(B/k)),U=Math.min(N,(S+B)/k),G=0,W=z;W<q;++W)for(var H=W*O-F,Q=j;Q<U;++Q)for(var K=Q*k-B,Y=p*R+h*W+f*Q,X=g*(w-1-H)+v*(S-1-K)+b*D,$=0;$<M;++$){var J=D*M+$,Z=l[Y+J],tt=m[X+$];G+=Z*tt}i[a*R+s*L+u*V+D]=G}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){this.assertNotComplex([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=d.buffer(n.filterShape,"float32"),u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,p=0;p<o;++p)for(var h=Math.max(0,Math.ceil((l-p)/r)),f=Math.min(n.outHeight,(n.inHeight+l-p)/r),m=0;m<a;++m)for(var y=Math.max(0,Math.ceil((u-m)/i)),g=Math.min(n.outWidth,(n.inWidth+u-m)/i),v=0;v<n.outChannels;++v){for(var b=Math.trunc(v/c),_=v%c,w=0,S=0;S<n.batchSize;++S)for(var x=h;x<f;++x)for(var T=p+x*r-l,P=y;P<g;++P){var E=m+P*i-u;w+=t.get(S,T,E,b)*e.get(S,x,P,v)}s.set(w,p,m,b,_)}return s.toTensor()},t.prototype.tile=function(t,e){this.assertNotComplex(t,"tile");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];for(var i=d.buffer(n,t.dtype),o=t.buffer(),r=0;r<i.values.length;++r){for(var a=i.indexToLoc(r),s=new Array(t.rank),u=0;u<s.length;u++)s[u]=a[u]%t.shape[u];var l=o.locToIndex(s);i.values[r]=o.values[l]}return i.toTensor()},t.prototype.pad=function(t,e,n){this.assertNotComplex(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),i=e.map(function(t){return t[0]}),o=t.buffer(),a=d.buffer(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=o.indexToLoc(s),l=u.map(function(t,e){return t+i[e]});a.set.apply(a,[t.get.apply(t,u)].concat(l))}return a.toTensor()},t.prototype.transpose=function(t,e){this.assertNotComplex(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];for(var i=t.dataSync(),o=m.buffer(n,t.dtype),a=t.buffer(),r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),l=0;l<u.length;l++)u[l]=s[e[l]];var c=o.locToIndex(u);o.values[c]=i[r]}return o.toTensor()},t.prototype.gather=function(t,e,n){this.assertNotComplex([t,e],"gather");var r=t.shape.slice(),i=e.dataSync();r[n]=i.length;for(var o=m.buffer(r,t.dtype),a=t.buffer(),s=0;s<o.size;++s){var u=o.indexToLoc(s),l=u.slice();l[n]=i[u[n]];var c=a.locToIndex(l);o.values[s]=a.values[c]}return o.toTensor()},t.prototype.batchToSpaceND=function(t,e,n){this.assertNotComplex([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),i=u.getReshaped(t.shape,e,r),o=u.getPermuted(i.length,e.length),a=u.getReshapedPermuted(t.shape,e,r),s=u.getSliceBeginCoords(n,e.length),l=u.getSliceSize(a,n,e.length);return t.reshape(i).transpose(o).reshape(a).slice(s,l)},t.prototype.spaceToBatchND=function(t,e,n){this.assertNotComplex([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),i=[[0,0]];i.push.apply(i,n);for(var o=1+e.length;o<t.shape.length;++o)i.push([0,0]);var a=t.pad(i),s=u.getReshaped(a.shape,e,r,!1),l=u.getPermuted(s.length,e.length,!1),c=u.getReshapedPermuted(a.shape,e,r,!1);return a.reshape(s).transpose(l).reshape(c)},t.prototype.pool=function(t,e,n){this.assertNotComplex(t,"pool");for(var r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=t.dataSync(),f=d.buffer(e.outShape,t.dtype),m=f.values,y=e.outShape[1]*e.outShape[2]*e.outShape[3],g=e.outShape[2]*e.outShape[3],v=e.outShape[3],b=0;b<e.batchSize;++b)for(var _=b*y,w=b*t.strides[0],S=0;S<e.inChannels;++S)for(var x=0;x<e.outHeight;++x)for(var T=x*r-l,P=Math.max(0,T),E=Math.min(e.inHeight,s+T),A=_+x*g,N=0;N<e.outWidth;++N){for(var O=N*i-c,k=Math.max(0,O),I=Math.min(e.inWidth,u+O),C=p,M=0,R=0,D=P;D<E;D+=o){for(var L=w+D*t.strides[1],F=k;F<I;F+=a){var z=L+F*t.strides[2],q=h[z+S];"max"===n&&q>C?C=q:"avg"===n&&(M+=q,R++)}if(isNaN(C))break}var V=A+N*v+S;m[V]="avg"===n?M/R:C}return f.toTensor()},t.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},t.prototype.maxPoolPositions=function(t,e){for(var n=d.buffer(e.outShape,"int32"),r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,l=e.padInfo.top,c=e.padInfo.left,p=0;p<e.batchSize;++p)for(var h=0;h<e.inChannels;++h)for(var f=0;f<e.outHeight;++f){for(var m=f*r-l,y=m;y<0;)y+=o;for(var g=Math.min(e.inHeight,s+m),v=0;v<e.outWidth;++v){for(var b=v*i-c,_=b;_<0;)_+=a;for(var w=Math.min(e.inWidth,u+b),S=Number.NEGATIVE_INFINITY,x=-1,T=y;T<g;T+=o)for(var P=T-m,E=_;E<w;E+=a){var A=E-b,N=t.get(p,T,E,h);N>S&&(S=N,x=P*u+A)}n.set(x,p,f,v,h)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(t,e,n,r){this.assertNotComplex([e,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(e,r),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=c-1-r.padInfo.left,h=l-1-r.padInfo.top,f=d.buffer(e.shape,"float32"),m=0;m<r.batchSize;++m)for(var y=0;y<r.inChannels;++y)for(var g=0;g<r.inHeight;++g)for(var v=0;v<r.inWidth;++v){for(var b=g-h,_=v-p,w=0,S=0;S<l;S+=s){var x=(b+S)/o;if(!(x<0||x>=r.outHeight||Math.floor(x)!==x))for(var T=0;T<c;T+=u){var P=(_+T)/a;if(!(P<0||P>=r.outWidth||Math.floor(P)!==P)){var E=l*c-1-i.get(m,x,P,y),A=S*c+T,N=E===A?1:0;if(0!==N){var O=t.get(m,x,P,y);w+=O*N}}}}f.set(w,m,g,v,y)}return f.toTensor()},t.prototype.avgPoolBackprop=function(t,e,n){this.assertNotComplex([t,e],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,p=c-1-n.padInfo.left,h=l-1-n.padInfo.top,f=d.buffer(e.shape,"float32"),m=1/(o*a),y=0;y<n.batchSize;++y)for(var g=0;g<n.inChannels;++g)for(var v=0;v<n.inHeight;++v)for(var b=0;b<n.inWidth;++b){for(var _=v-h,w=b-p,S=0,x=0;x<l;x+=s){var T=(_+x)/r;if(!(T<0||T>=n.outHeight||Math.floor(T)!==T))for(var P=0;P<c;P+=u){var E=(w+P)/i;if(!(E<0||E>=n.outWidth||Math.floor(E)!==E)){var A=t.get(y,T,E,g);S+=A}}}f.set(S*m,y,v,b,g)}return f.toTensor()},t.prototype.cast=function(t,e){return T.castTensor(t,e,this)},t.prototype.reshape=function(t,e){return T.reshapeTensor(t,e)},t.prototype.avgPool=function(t,e){return this.assertNotComplex(t,"avgPool"),this.pool(t,e,"avg").toFloat()},t.prototype.resizeBilinear=function(t,e,n,r){this.assertNotComplex(t,"resizeBilinear");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=t.dataSync(),c=new Float32Array(w.sizeFromShape([o,e,n,u])),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,m=p[0]/h[0],y=p[1]/h[1],g=0;g<o;g++)for(var v=0;v<e;v++)for(var b=m*v,_=Math.floor(b),S=b-_,x=Math.min(a-1,Math.ceil(b)),T=g*t.strides[0]+_*t.strides[1],P=g*t.strides[0]+x*t.strides[1],E=0;E<n;E++)for(var A=y*E,N=Math.floor(A),O=A-N,k=Math.min(s-1,Math.ceil(A)),I=T+N*t.strides[2],C=P+N*t.strides[2],M=T+ +k*t.strides[2],R=P+k*t.strides[2],D=0;D<u;D++){var L=l[I+D],F=l[C+D],z=l[M+D],q=l[R+D],V=L+(z-L)*O,B=F+(q-F)*O,j=V+(B-V)*S;c[f++]=j}return d.tensor(c,[o,e,n,u])},t.prototype.resizeBilinearBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeBilinearBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(i*o*a*s),h=[n&&l>1?o-1:o,n&&c>1?a-1:a],f=[n&&l>1?l-1:l,n&&c>1?c-1:c],m=h[0]/f[0],y=h[1]/f[1],g=t.dataSync(),v=0,b=0;b<i;b++)for(var _=b*e.strides[0],w=0;w<l;w++)for(var S=w*m,x=Math.floor(S),T=Math.min(Math.ceil(S),o-1),P=_+x*e.strides[1],E=_+T*e.strides[1],A=S-x,N=1-A,O=0;O<c;O++)for(var k=O*y,I=Math.floor(k),C=Math.min(Math.ceil(k),a-1),M=k-I,R=1-M,D=P+I*e.strides[2],L=P+C*e.strides[2],F=E+I*e.strides[2],z=E+C*e.strides[2],q=N*R,V=N*M,B=A*R,j=A*M,U=0;U<s;U++){var G=g[v++];p[D+U]+=G*q,p[L+U]+=G*V,p[F+U]+=G*B,p[z+U]+=G*j}return d.tensor4d(p,[i,a,o,s],e.dtype)},t.prototype.resizeNearestNeighbor=function(t,e,n,r){this.assertNotComplex(t,"resizeNearestNeighbor");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=t.dataSync(),c=new Float32Array(o*e*n*u),p=[r&&e>1?a-1:a,r&&n>1?s-1:s],h=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=p[0]/h[0],m=p[1]/h[1],y=0,g=0;g<o;g++)for(var v=g*t.strides[0],b=0;b<e;b++)for(var _=f*b,w=Math.min(a-1,r?Math.round(_):Math.floor(_)),S=v+w*t.strides[1],x=0;x<n;x++)for(var T=m*x,P=Math.min(s-1,r?Math.round(T):Math.floor(T)),E=S+P*t.strides[2],A=0;A<u;A++){var N=l[E+A];c[y++]=N}return d.tensor(c,[o,e,n,u],t.dtype)},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){this.assertNotComplex([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=t.shape,l=u[1],c=u[2],p=new Float32Array(i*o*a*s),h=t.dataSync(),f=[n&&l>1?o-1:o,n&&c>1?a-1:a],m=[n&&l>1?l-1:l,n&&c>1?c-1:c],y=f[0]/m[0],g=f[1]/m[1],v=1/y,b=1/g,_=2*Math.ceil(v)+2,w=2*Math.ceil(b)+2,S=0;S<i;S++)for(var x=S*e.strides[0],T=0;T<o;T++)for(var P=x+T*e.strides[1],E=Math.floor(T*v),A=Math.floor(E-_/2),N=0;N<a;N++)for(var O=P+N*e.strides[2],k=Math.floor(N*b),I=Math.floor(k-w/2),C=0;C<s;C++){
for(var M=0,R=0;R<_;R++){var D=R+A;if(!(D<0||D>=l)){var L=x+D*t.strides[1],F=D*y,z=Math.min(o-1,n?Math.round(F):Math.floor(F));if(T===z)for(var q=0;q<w;q++){var V=q+I;if(!(V<0||V>=c)){var B=L+V*t.strides[2],j=V*g,U=Math.min(a-1,n?Math.round(j):Math.floor(j));N===U&&(M+=h[B+C])}}}}p[O+C]=M}return d.tensor4d(p,e.shape,e.dtype)},t.prototype.batchNormalization=function(t,e,n,r,i,o){this.assertNotComplex([t,e,n,i,o],"batchNormalization");for(var a=t.dataSync(),s=e.dataSync(),u=n.dataSync(),l=i?i.dataSync():new Float32Array([1]),c=o?o.dataSync():new Float32Array([0]),p=new Float32Array(a.length),h=c.length,f=l.length,d=u.length,y=s.length,g=0,v=0,b=0,_=0,w=0;w<a.length;++w)p[w]=c[g++]+(a[w]-s[v++])*l[b++]/Math.sqrt(u[_++]+r),g>=h&&(g=0),v>=y&&(v=0),b>=f&&(b=0),_>=d&&(_=0);return m.tensor4d(p,t.shape)},t.prototype.localResponseNormalization4D=function(t,e,n,r,i){function o(t){for(var n=t%a,r=t-n+Math.max(0,n-e),i=t-n+Math.min(n+e,s),o=0;r<=i;r++){var l=u[r];o+=l*l}return o}this.assertNotComplex(t,"localResponseNormalization4D");for(var a=t.shape[3],s=a-1,u=t.dataSync(),l=w.sizeFromShape(t.shape),c=new Float32Array(l),p=0;p<l;p++){var h=o(p),f=u[p]*Math.pow(n+r*h,-i);c[p]=f}return d.tensor4d(c,t.shape)},t.prototype.LRNGrad=function(t,e,n,r,i,o,a){this.assertNotComplex(t,"LRNGrad");for(var s=t.shape[3],u=t.dataSync(),l=e.dataSync(),c=n.dataSync(),p=new Float32Array(w.sizeFromShape(t.shape)),h=w.sizeFromShape(t.shape),f=0;f<h;f++){for(var m=f%s,y=f-m+Math.max(0,m-r),g=f-m+Math.min(s,m+r+1),v=0,b=y;b<g;b++)v+=Math.pow(l[b],2);v=o*v+i;for(var b=y;b<g;b++){var _=-2*o*a*l[b]*c[f]/v;f===b&&(_+=Math.pow(v,-a)),_*=u[f],p[b]+=_}}return d.tensor4d(p,t.shape)},t.prototype.multinomial=function(t,e,n,r){this.assertNotComplex(t,"multinomial");for(var i=e?t:d.softmax(t),a=i.shape[0],s=i.shape[1],u=d.zeros([a,n],"int32"),l=u.dataSync(),c=i.dataSync(),p=0;p<a;++p){var h=p*s,f=new Float32Array(s-1);f[0]=c[h];for(var m=1;m<f.length;++m)f[m]=f[m-1]+c[h+m];for(var y=o.alea(r.toString()),g=p*n,v=0;v<n;++v){var b=y();l[g+v]=f.length;for(var _=0;_<f.length;_++)if(b<f[_]){l[g+v]=_;break}}}return u},t.prototype.oneHot=function(t,e,n,r){this.assertNotComplex(t,"oneHot");var i=new Float32Array(t.size*e);i.fill(r);for(var o=0;o<t.size;++o)t.get(o)>=0&&t.get(o)<e&&(i[o*e+t.get(o)]=n);return d.tensor2d(i,[t.size,e],"int32")},t.prototype.nonMaxSuppression=function(t,e,n,r,i){this.assertNotComplex(t,"nonMaxSuppression");var o=t.dataSync(),a=e.dataSync();return E.nonMaxSuppressionImpl(o,a,n,r,i)},t.prototype.fft=function(t){if(1!==t.shape[0])throw new Error("tf.fft() on CPU only supports vectors.");var e=!1;return this.fftImpl(t,e)},t.prototype.ifft=function(t){if(1!==t.shape[0])throw new Error("tf.ifft() on CPU only supports vectors.");var e=!0;return this.fftImpl(t,e)},t.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(i=d.complex(d.real(i).div(m.scalar(r)),d.imag(i).div(m.scalar(r)))),i}var o=t.dataSync(),a=this.fourierTransformByMatmul(o,r,e),s=P.splitRealAndImagArrays(a);return d.complex(s.real,s.imag).as2D(t.shape[0],t.shape[1])},t.prototype.isExponentOf2=function(t){return 0===(t&t-1)},t.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=t.dataSync(),i=e/2,o=P.complexWithEvenIndex(r),a=d.complex(o.real,o.imag).as1D(),s=P.complexWithOddIndex(r),u=d.complex(s.real,s.imag).as1D();a=this.fftRadix2(a,i,n),u=this.fftRadix2(u,i,n);var l=P.exponents(e,n),c=d.complex(l.real,l.imag).mul(u),p=a.add(c),h=a.sub(c),f=d.real(p).concat(d.real(h)),m=d.imag(p).concat(d.imag(h));return d.complex(f,m).as1D()},t.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),i=0;i<e;i++){for(var o=0,a=0,s=0;s<e;s++){var u=P.exponent(i*s,e,n),l=P.getComplexWithIndex(t,s);o+=l.real*u.real-l.imag*u.imag,a+=l.real*u.imag+l.imag*u.real}n&&(o/=e,a/=e),P.assignToTypedArray(r,o,a,i)}return r},t.prototype.depthToSpace=function(t,e,n){w.assert("NHWC"===n,"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n),w.assert(e>1,"blockSize should be > 1 for depthToSpace, but was: "+e);for(var r=t.shape[0],i=t.shape[1],o=t.shape[2],a=t.shape[3],s=i*e,u=o*e,l=a/(e*e),c=t.dataSync(),p=new Float32Array(r*s*u*l),h=0,f=0;f<r;++f)for(var m=0;m<s;++m)for(var y=Math.floor(m/e),g=m%e,v=0;v<u;++v)for(var b=Math.floor(v/e),_=v%e,S=(g*e+_)*l,x=0;x<l;++x){var T=x+S,P=T+a*(b+o*(y+i*f));p[h++]=c[P]}return d.tensor4d(p,[r,s,u,l])},t.prototype.broadcastedBinaryOp=function(t,e,n,r){var i=c.assertAndGetBroadcastShape(t.shape,e.shape),o=d.buffer(i,n),a=t.dataSync(),s=e.dataSync(),u=c.getBroadcastDims(t.shape,i),l=c.getBroadcastDims(e.shape,i),p=o.values;if(u.length+l.length===0)for(var h=0;h<p.length;++h)p[h]=r(a[h%a.length],s[h%s.length]);else for(var f=t.buffer(),m=e.buffer(),y=function(n){var i=o.indexToLoc(n),c=i.slice(-t.rank);u.forEach(function(t){return c[t]=0});var h=f.locToIndex(c),d=i.slice(-e.rank);l.forEach(function(t){return d[t]=0});var y=m.locToIndex(d);p[n]=r(a[h],s[y])},h=0;h<p.length;++h)y(h);return o.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=c.assertAndGetBroadcastShape(t.shape,e.shape),i=d.buffer(r,"float32"),o=d.buffer(r,"float32"),a=t.dataSync(),s=e.dataSync(),u=c.getBroadcastDims(t.shape,r),l=c.getBroadcastDims(e.shape,r),p=i.values,h=o.values;if(u.length+l.length===0)for(var f=0;f<p.length;f++){var m=f%a.length,y=f%s.length,g=n(a[2*m],a[2*m+1],s[2*y],s[2*y+1]);p[f]=g.real,h[f]=g.imag}else for(var v=this.data.get(t.dataId).complexTensors.real.buffer(),b=this.data.get(e.dataId).complexTensors.real.buffer(),_=function(r){var o=i.indexToLoc(r),c=o.slice(-t.rank);u.forEach(function(t){return c[t]=0});var f=v.locToIndex(c),d=o.slice(-e.rank);l.forEach(function(t){return d[t]=0});var m=b.locToIndex(d),y=n(a[2*f],a[2*f+1],s[2*m],s[2*m+1]);p[r]=y.real,h[r]=y.imag},f=0;f<p.length;f++)_(f);return this.complex(i.toTensor(),o.toTensor())},t.prototype.split=function(t,e,n){return A.split(t,e,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.cropAndResize=function(t,e,n,r,i,o){for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],p=e.shape[0],h=r[0],f=r[1],m=d.buffer([p,h,f,c]),y=e.dataSync(),g=n.dataSync(),v=t.dataSync(),b=t.strides,_=m.strides,w=0;w<p;w++){var S=4*w,x=y[S],T=y[S+1],P=y[S+2],E=y[S+3],A=g[w];if(!(A>=s))for(var N=h>1?(P-x)*(u-1)/(h-1):0,O=f>1?(E-T)*(l-1)/(f-1):0,k=0;k<h;k++){var I=h>1?x*(u-1)+k*N:.5*(x+P)*(u-1);if(I<0||I>u-1)for(var C=0;C<f;C++)for(var M=0;M<c;M++){var R=M+C*_[2]+k*_[1]+w*_[0];m.values[R]=o}else if("bilinear"===i)for(var D=Math.floor(I),L=Math.ceil(I),F=I-D,C=0;C<f;C++){var z=f>1?T*(l-1)+C*O:.5*(T+E)*(l-1);if(z<0||z>l-1)for(var M=0;M<c;M++){var R=M+C*_[2]+k*_[1]+w*_[0];m.values[R]=o}else for(var q=Math.floor(z),V=Math.ceil(z),B=z-q,M=0;M<c;M++){var R=M+q*b[2]+D*b[1]+A*b[0],j=v[R];R=M+V*b[2]+D*b[1]+A*b[0];var U=v[R];R=M+q*b[2]+L*b[1]+A*b[0];var G=v[R];R=M+V*b[2]+L*b[1]+A*b[0];var W=v[R],H=j+(U-j)*B,Q=G+(W-G)*B;R=M+C*_[2]+k*_[1]+w*_[0],m.values[R]=H+(Q-H)*F}}else for(var C=0;C<f;++C){var z=f>1?T*(l-1)+C*O:.5*(T+E)*(l-1);if(z<0||z>l-1)for(var M=0;M<c;M++){var R=M+C*_[2]+k*_[1]+w*_[0];m.values[R]=o}else for(var K=Math.round(z),Y=Math.round(I),M=0;M<c;M++){var X=M+K*b[2]+Y*b[1]+A*b[0],$=M+C*_[2]+k*_[1]+w*_[0];m.values[$]=v[X]}}}}return m.toTensor()},t.prototype.sparseToDense=function(t,e,n,r){var i=y.calculateShapes(e,t,n),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=!1;return this.scatter(t,e,n,l,s,a,o,u,r,c)},t.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],i=f.prepareAndValidate(t,e),o=i[0],a=i[1],s=i[2],u=i[3];if(0===a)return m.tensor([],o,t.dtype);for(var l=new b.TensorBuffer([a,s],t.dtype),c=e.dataSync(),p=t.dataSync(),h=0;h<a;h++){for(var d=[],y=0,g=0;g<r;g++){var v=c[h*r+g];y+=v*u[g],d.push(v)}if(y<0||y>=t.size/s)throw new Error("Invalid indices: "+d+" does not index into "+t.shape);for(var _=0;_<s;_++)l.values[h*s+_]=p[y*s+_]}return l.toTensor().reshape(o)},t.prototype.scatterND=function(t,e,n){var r=y.calculateShapes(e,t,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,l=m.scalar(0),c=!0;return this.scatter(t,e,n,u,a,o,i,s,l,c)},t.prototype.scatter=function(t,e,n,r,i,o,a,s,u,l){var c=[r/i,i],p=t.dataSync(),h=e.dataSync();if(0===r)return m.tensor([],n,e.dtype);var f=new b.TensorBuffer(c,e.dtype);f.values.fill(u.dataSync()[0]);for(var d=0;d<o;d++){for(var y=[],g=0,v=0;v<a;v++){var _=p[d*a+v];y.push(_),g+=_*s[v]}if(g<0||g>=r/i)throw new Error("Invalid indices: "+y+" does not index into "+n);for(var w=0;w<i;w++)l?f.values[g*i+w]+=h[d*i+w]:f.values[g*i+w]=0===e.rank?h[0]:h[d*i+w]}return f.toTensor().reshape(n)},t}();e.MathBackendCPU=k,a.ENV.registerBackend("cpu",function(){return new k},1,b.setTensorTracker)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["A"];var r=t.windowSize,i=t.batchSize,o=t.inSize,a=Math.ceil(o/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "}return t}();e.ArgMinMaxProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,l=s-1-t.padInfo.top,c=u-1-t.padInfo.left,p=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+l+", "+c+");\n      const float avgMultiplier = float("+p+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+o+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.AvgPool2DBackpropProgram=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(25),i=function(){function t(t,e,n,i,o,a){this.outputShape=[],this.supportsBroadcasting=!0,this.variableNames=["x","mean","variance"],r.assertAndGetBroadcastShape(t,e),r.assertAndGetBroadcastShape(t,n);var s="0.0";null!=i&&(r.assertAndGetBroadcastShape(t,i),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=o&&(r.assertAndGetBroadcastShape(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+s+";\n        float scale = "+u+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "}return t}();e.BatchNormProgram=i},function(t,e,n){"use strict";function r(t,e){var n="get"+t.charAt(0).toUpperCase()+t.slice(1);return 1===e?"\n      vec4 "+t+"Sample = "+n+"(rc.w);\n      vec4 "+t+" = vec4("+t+"Sample.xy, "+t+"Sample.xy);\n    ":"vec4 "+t+" = "+n+"(rc.x, rc.y, rc.z, rc.w)"}Object.defineProperty(e,"__esModule",{value:!0});var i=n(25),o=function(){function t(t,e,n,o,a,s){this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],i.assertAndGetBroadcastShape(t,e),i.assertAndGetBroadcastShape(t,n);var u=r("mean",e.length),l=r("variance",n.length),c="vec4 offset = vec4(0.0)";null!=o&&(i.assertAndGetBroadcastShape(t,o),this.variableNames.push("offset"),c=r("offset",o.length));var p="vec4 scale = vec4(1.0)";null!=a&&(i.assertAndGetBroadcastShape(t,a),this.variableNames.push("scale"),p=r("scale",a.length)),this.outputShape=t,this.userCode="\n      void main() {\n        ivec4 rc = getOutputCoords();\n\n        "+c+";\n        "+p+";\n\n        vec4 x = getX(rc.x, rc.y, rc.z, rc.w);\n        "+u+";\n        "+l+";\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+s+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "}return t}();e.BatchNormPackedProgram=o},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      void main() {\n        float value = getAAtOutCoords();\n        if (isNaN(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, float("+e+"), float("+n+")));\n      }\n    "}return t}();e.ClipProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float real = getRealAtOutCoords();\n        float imag = getImagAtOutCoords();\n        vec2 v = vec2(real, imag);\n\n        setOutput(sqrt(dot(v, v)));\n      }\n    "}return t}();e.ComplexAbsProgram=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(58),i=function(){function t(t,e){this.variableNames=["A","B"],this.outputShape=[],this.outputShape=r.computeOutShape([t,e],1),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        float value = 0.0;\n        if (yC < "+t[1]+") {\n          value = getA(yR, yC);\n        } else {\n          yC -= "+t[1]+";\n          value = getB(yR, yC);\n        }\n\n        setOutput(value);\n      }\n    "}return t}();e.ConcatProgram=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.Conv2DDerFilterProgram=n;var r=function(){function t(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, d2);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.Conv2DDerInputProgram=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+o+" + dm;\n\n        float dotProd = 0.0;\n\n        // TODO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+i+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.DepthwiseConv2DDerFilterProgram=n;var r=function(){function t(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,i=t.strideWidth,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+i+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TODO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.DepthwiseConv2DDerInputProgram=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.top,n=t.padInfo.left,r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.filterHeight,u=t.filterWidth,l=4*Math.floor(t.inChannels/4),c=t.inChannels%4;this.userCode="\n      const ivec2 strides = ivec2("+r+", "+i+");\n      const ivec2 pads = ivec2("+e+", "+n+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+"; wR++) {\n          int xR = xRCorner + wR * "+o+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+u+"; wC++) {\n            int xC = xCCorner + wC * "+a+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+l+"; d1 += 4) {\n              vec4 xValues = vec4(\n                getX(batch, xR, xC, d1),\n                getX(batch, xR, xC, d1 + 1),\n                getX(batch, xR, xC, d1 + 2),\n                getX(batch, xR, xC, d1 + 3)\n              );\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              dotProd += dot(xValues, wValues);\n            }\n\n            if ("+(1===c)+") {\n              dotProd +=\n                getX(batch, xR, xC, "+l+") *\n                getW(wR, wC, "+l+", d2);\n            } else if ("+(2===c)+") {\n              vec2 xValues = vec2(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1)\n              );\n              vec2 wValues = vec2(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            } else if ("+(3===c)+") {\n              vec3 xValues = vec3(\n                getX(batch, xR, xC, "+l+"),\n                getX(batch, xR, xC, "+l+" + 1),\n                getX(batch, xR, xC, "+l+" + 2)\n              );\n              vec3 wValues = vec3(\n                getW(wR, wC, "+l+", d2),\n                getW(wR, wC, "+l+" + 1, d2),\n                getW(wR, wC, "+l+" + 2, d2)\n              );\n              dotProd += dot(xValues, wValues);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.Conv2DProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.inHeight,n=t.inWidth,r=t.padInfo.top,i=t.padInfo.left,o=t.strideHeight,a=t.strideWidth,s=t.dilationHeight,u=t.dilationWidth,l=t.filterHeight,c=t.filterWidth,p=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 strides = ivec2("+o+", "+a+");\n      const ivec2 pads = ivec2("+r+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+s+";\n\n          if (xR < 0 || xR >= "+e+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+c+"; wC++) {\n            int xC = xCCorner + wC * "+u+";\n\n            if (xC < 0 || xC >= "+n+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.DepthwiseConv2DProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=t[0],a=t[1],s=t[2],u=t[3],l=e[0],c=n[0],p=n[1];this.outputShape=[l,c,p,u];var h="bilinear"===r?1:0,f=[a-1+".0",s-1+".0"],d=f[0],m=f[1],y=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+d+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+d],g=y[0],v=y[1],b=y[2],_=p>1?[""+(s-1)/(p-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=_[0],S=_[1],x=_[2];this.userCode="\n      const float height_ratio = float("+g+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+v+";\n        float width_scale = "+S+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+d+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+x+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexRC = vec2(in_y,in_x);\n        if("+h+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n          ivec2 sourceCeilRC = ivec2(ceil(sourceFracIndexRC));\n\n          float topLeft = getImage(b, sourceFloorRC.x, sourceFloorRC.y, d);\n          float bottomLeft = getImage(b, sourceCeilRC.x, sourceFloorRC.y, d);\n          float topRight = getImage(b, sourceFloorRC.x, sourceCeilRC.y, d);\n          float bottomRight = getImage(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n          vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n          float top = topLeft + (topRight - topLeft) * fracRC.y;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n          float newValue = top + (bottom - top) * fracRC.x;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestRC = ivec2(floor(\n            sourceFracIndexRC + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestRC.x, sourceNearestRC.y, d);\n          setOutput(newValue);\n        }\n      }\n    "}return t}();e.CropAndResizeProgram=n},function(t,e,n){"use strict";function r(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}function i(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}Object.defineProperty(e,"__esModule",{value:!0});var o=n(14),a=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=t;var a=t.length,s=t[t.length-1],u=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+s+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+o.getCoordsDataType(a)+" coords = getOutputCoords();\n        int end = "+i(a,"coords")+";\n        float val = 0.0;\n        for (int i = "+s+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+u+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+i(a,"coords")+" = idx;\n          val += getX("+r(a,"coords")+");\n        }\n        setOutput(val);\n      }\n    "}return t}();e.CumSumProgram=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}();e.DepthToSpaceProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      const float FLOAT_MAX = 1.70141184e38;\n      const float FLOAT_MIN = 1.17549435e-38;\n\n      lowp vec4 encode_float(highp float v) {\n        if (isNaN(v)) {\n          return vec4(255, 255, 255, 255);\n        }\n\n        highp float av = abs(v);\n\n        if(av < FLOAT_MIN) {\n          return vec4(0.0, 0.0, 0.0, 0.0);\n        } else if(v > FLOAT_MAX) {\n          return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n        } else if(v < -FLOAT_MAX) {\n          return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n        }\n\n        highp vec4 c = vec4(0,0,0,0);\n\n        highp float e = floor(log2(av));\n        highp float m = exp2(fract(log2(av))) - 1.0;\n\n        c[2] = floor(128.0 * m);\n        m -= c[2] / 128.0;\n        c[1] = floor(32768.0 * m);\n        m -= c[1] / 32768.0;\n        c[0] = floor(8388608.0 * m);\n\n        highp float ebias = e + 127.0;\n        c[3] = floor(ebias / 2.0);\n        ebias -= c[3] * 2.0;\n        c[2] += floor(ebias) * 128.0;\n\n        c[3] += 128.0 * step(0.0, -v);\n\n        return c / 255.0;\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        gl_FragColor = encode_float(x);\n      }\n    ";
}return t}();e.EncodeFloatProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["A"];var e=t[0],n=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+n+".0, "+e+".0);\n\n        vec4 values = texture2D(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "}return t}();e.FromPixelsProgram=n},function(t,e,n){"use strict";function r(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<t.length;o++)o===e?i.push("int(getIndices("+r[o]+"))"):i.push(""+r[o]);return i.join()}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),o=function(){function t(t,e,n){this.variableNames=["A","indices"];var o=t.slice();o[n]=e,this.outputShape=o,this.rank=o.length;var a=i.getCoordsDataType(this.rank),s=r(t,n);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "}return t}();e.GatherProgram=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var i=r.getCoordsDataType(e.length),o=r.getCoordsDataType(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+i+" strides = "+i+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "}return t}();e.GatherNDProgram=i},function(t,e,n){"use strict";function r(t,e,n,r){for(var i=e.userCode,o=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked};return{name:e.variableNames[n],shapeInfo:r}}),a=o.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked},l=u.makeShader(o,s,i,e.supportsBroadcasting===!0,e.usesPackedTextures),c=t.createProgram(l),p={},h=0;h<e.variableNames.length;h++){var f=e.variableNames[h],d=!1;p[f]=t.getUniformLocation(c,f,d)}return{program:e,source:l,webGLProgram:c,uniformLocations:p,gpgpu:t,inShapeInfos:a,outShapeInfo:s}}function i(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but "+("was executed with "+e.length+" inputs"));t.forEach(function(t,n){var r=t.logicalShape,i=e[n],o=i.shape;if(!s.arraysEqual(r,o))throw Error("Binary was compiled with different shapes than "+("the current args. Shapes "+r+" and "+o+" must match"));if(!t.isUniform||!i.isUniform){var a=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!s.arraysEqual(a,u))throw Error("Binary was compiled with different texture shapes than the"+(" current args. Shape "+a+" and "+u+" must match"))}})}function o(t,e,n,r){i(t.inShapeInfos,e),i([t.outShapeInfo],[n]);var o=n.texData.texture,a=n.texData.texShape,u=t.gpgpu;n.texData.isPacked?u.setOutputPackedMatrixTexture(o,a[0],a[1]):u.setOutputMatrixTexture(o,a[0],a[1]),u.setProgram(t.webGLProgram),e.forEach(function(e,n){var r=t.program.variableNames[n],i=t.uniformLocations[r];if(null!=i){if(e.isUniform){if(1===s.sizeFromShape(e.shape))u.gl.uniform1f(i,e.uniformValues[0]);else{var o=e.uniformValues;o instanceof Float32Array||(o=new Float32Array(o)),u.gl.uniform1fv(i,o)}return}var a=e.texData.texture;u.setInputMatrixTexture(a,i,n)}}),null!=r&&r(u,t.webGLProgram),u.executeProgram()}function a(t,e,n){var r="";e.concat(n).forEach(function(t){r+=t.shape+"_"+(t.isUniform?"uniform":t.texData.texShape)});var i=t.userCode,o=(t.supportsBroadcasting===!0).toString(),a=t.constructor.name;return a+="_"+o+"_"+r+"_"+i}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),u=n(14);e.compileProgram=r,e.runProgram=o,e.makeShaderKey=a},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["A"],this.outputShape=t;var r=n.filterWidth,i=n.inChannels,o=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,l=n.dilationWidth,c=n.dilationHeight,p=s.left,h=s.top,f=i*r;this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            int blockIndex = rc.y + col;\n            int pos = rc.x + row;\n\n            if(blockIndex >= "+t[1]+" || pos >= "+t[0]+") continue;\n\n            int offsetY = int(blockIndex / ("+u+")) * "+a+" - "+h+";\n            int d0 = offsetY + "+c+" * (pos / "+f+");\n\n            if(d0 >= "+e[0]+" || d0 < 0) continue;\n\n            int offsetX = int(mod(float(blockIndex), "+u+".) * "+o+". - "+p+".);\n            int d1 = offsetX + "+l+" * (int(mod(float(pos), "+f+".) / "+i+".));\n\n            if(d1 >= "+e[1]+" || d1 < 0) continue;\n\n            result[row * 2 + col] = getA(d0, d1, int(mod(float(pos), "+i+".)));\n          }\n        }\n\n        gl_FragColor = result;\n      }\n    "}return t}();e.Im2ColProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r,i){this.variableNames=["x"],this.outputShape=[];var o=e,a=t[3]-1;this.outputShape=t;var s,u="float("+n+") + float("+r+") * sum";s=.5===i?"inversesqrt("+u+")":1===i?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+s+";\n        setOutput(val);\n      }\n    "}return t}();e.LRNProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "}return t}();e.LRNGradProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,a=i-1-t.padInfo.top,s=o-1-t.padInfo.left,u=i*o-1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+i+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+o+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+o+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "}return t}();e.MaxPool2DBackpropProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),this.variableNames=["matrixA","matrixB"];var i=t[0],o=n?t[2]:t[1],a=r?e[1]:e[2],s=n?t[1]:t[2];this.outputShape=[i,o,a];var u=function(t,e){return n?"batch, "+e+" + "+t+", aRow":"batch, aRow, "+e+" + "+t},l=function(t,e){return r?"batch, bCol, "+e+" + "+t:"batch, "+e+" + "+t+", bCol"},c=4*Math.floor(s/4),p=s%4;this.userCode=" float dotARowBCol(int batch, int aRow, int bCol) {\n      float result = 0.0;\n      for (int i = 0; i < "+c+"; i += 4) {\n        vec4 a = vec4(\n          getMatrixA("+u(0,"i")+"),\n          getMatrixA("+u(1,"i")+"),\n          getMatrixA("+u(2,"i")+"),\n          getMatrixA("+u(3,"i")+")\n        );\n        vec4 b = vec4(\n          getMatrixB("+l(0,"i")+"),\n          getMatrixB("+l(1,"i")+"),\n          getMatrixB("+l(2,"i")+"),\n          getMatrixB("+l(3,"i")+")\n        );\n\n        result += dot(a, b);\n      }\n\n      if ("+(1===p)+") {\n        result += getMatrixA("+u(0,c)+") *\n          getMatrixB("+l(0,c)+");\n      } else if ("+(2===p)+") {\n        vec2 a = vec2(\n          getMatrixA("+u(0,c)+"),\n          getMatrixA("+u(1,c)+")\n        );\n        vec2 b = vec2(\n          getMatrixB("+l(0,c)+"),\n          getMatrixB("+l(1,c)+")\n        );\n        result += dot(a, b);\n      } else if ("+(3===p)+") {\n        vec3 a = vec3(\n          getMatrixA("+u(0,c)+"),\n          getMatrixA("+u(1,c)+"),\n          getMatrixA("+u(2,c)+")\n        );\n        vec3 b = vec3(\n          getMatrixB("+l(0,c)+"),\n          getMatrixB("+l(1,c)+"),\n          getMatrixB("+l(2,c)+")\n        );\n        result += dot(a, b);\n      }\n\n      return result;\n    }\n\n    void main() {\n      ivec3 resBRC = getOutputCoords();\n      setOutput(dotARowBCol(resBRC.x, resBRC.y, resBRC.z));\n    }\n    "}return t}();e.MatMulProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=n;var o=r?t[0]:t[1],a=Math.ceil(o/2),s=r?"i * 2, rc.x":"rc.x, i * 2",u=i?"rc.y, i * 2":"i * 2, rc.y",l=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],c=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];this.userCode="\n      const float sharedDimension = "+a+".0;\n\n      vec4 dot2x2ARowBCol(ivec2 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+a+"; i++) {\n          vec4 a = getMatrixA("+s+");\n          vec4 b = getMatrixB("+u+");\n\n          result += ("+l[0]+" * "+c[0]+") + ("+l[1]+" * "+c[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec2 rc = getOutputCoords();\n        setOutput(dot2x2ARowBCol(rc));\n      }\n    "}return t}();e.MatMulPackedProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}();e.MultinomialProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "}return t}();e.OneHotProgram=n},function(t,e,n){"use strict";function r(t,e){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var o=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),a=2;a<t;a++)o=e[e.length-1-a]+","+o;n.push(o)}return n}function i(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",i=t-2;i<t;i++)r+=n[i]+" >= "+e[i],i<t-1&&(r+="||");return r}function o(t,e,n,r){if(1===t)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}function a(t,e){var n=t.length,i=r(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+i[0]+"),\n          cEdge ? 0. : getA("+i[1]+"),\n          rEdge ? 0. : getA("+i[2]+"),\n          rEdge || cEdge ? 0. : getA("+i[3]+")"}Object.defineProperty(e,"__esModule",{value:!0});var s=n(119),u=n(14),l=function(){function t(t){this.variableNames=["A"],this.outputShape=t;var e=t.length,n=s.getChannels("rc",e),r=u.getCoordsDataType(e),l=i(e,t,n),c=o(e,t[t.length-1],t[t.length-2],n),p=a(t,n);this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n\n        if("+l+") {\n          gl_FragColor = vec4(0);\n        } else {\n          "+c+"\n\n          setOutput(vec4("+p+"));\n        }\n      }\n    "}return t}();e.PackProgram=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var i=t.length,o=r.getCoordsDataType(i),a=e.map(function(t){return t[0]}).join(","),s=e.map(function(e,n){return e[0]+t[n]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,i);return 1===i?void(this.userCode="\n        int start = "+a+";\n        int end = "+s+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "):void(this.userCode="\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+s+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+u+"));\n        }\n      }\n    ")}return t}();e.PadProgram=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var h="avg"===e,f="0.0";if(h||(f="-1.0 / 0.0"),n){var d=">=";return void(this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+c+", "+p+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+l+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value "+d+" currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+l+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}var m="max",y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var g=4*Math.floor(r/4),v=r%4,b="\n      if ("+h+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = "+m+"(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+c+", "+p+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+b+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+b+"\n          } else if ("+(2===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+b+"\n          } else if ("+(3===v)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+b+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}return t}();e.Pool2DProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 0.0",s="min"):"max"===e&&(a="-1.0 / 0.0",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var l=4*Math.floor(n/4),c=n%4,p="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",h="vec4";"all"===e?(a="1.0",p="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",h="bvec4"):"any"===e&&(a="0.0",p="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",h="bvec4");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          "+h+" values = "+h+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "}return t}();e.ReduceProgram=n},function(t,e,n){"use strict";function r(t){var e=a.dotify(["coords.x","coords.y","coords.z"],o.computeStrides(t).map(function(t){return t.toString()}).concat(["1."]));return"\n    int getFlatIndex(ivec3 coords) {\n      return round("+e+");\n    }\n  "}function i(t){var e=a.getLogicalCoordinatesFromFlatIndex(["r","c","d"],t);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+e+"\n      return ivec3(r, c, d);\n    }\n  "}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),a=n(127),s=function(){function t(t,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;for(var n="",o=0;o<4;o++){var a="thisRC = rc;";o%2===1&&(a+="thisRC.z += 1;"),o>1&&(a+="thisRC.y += 1;"),n+="\n        "+a+"\n        "+(o>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+o+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(o>0?"}":"")+"\n      "}this.userCode="\n      "+i(e)+"\n      "+r(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "}return t}();e.ReshapePackedProgram=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return t}();e.ResizeBilinearBackpropProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "}return t}();e.ResizeBilinearProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=t.shape,s=a[1],u=a[2],l=[n&&s>1?i-1:i,n&&u>1?o-1:o],c=[n&&s>1?s-1:s,n&&u>1?u-1:u],p=l[0]/c[0],h=l[1]/c[1],f=1/p,d=1/h,m=2*Math.ceil(f)+2,y=2*Math.ceil(d)+2;
this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+p+");\n        const float widthScale = float("+h+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+d+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+y+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+l[0]+") *\n                (float(dyR) / float("+c[0]+"));\n\n            float sourceFracCol =\n                float("+l[1]+") *\n                  (float(dyC) / float("+c[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "}return t}();e.ResizeNearestNeigborBackpropProgram=n},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var i=t[0],o=t[1],a=t[2],s=t[3];this.outputShape=[i,e,n,s];var u=[r&&e>1?o-1:o,r&&n>1?a-1:a],l=[r&&e>1?e-1:e,r&&n>1?n-1:n],c=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/l[0]+",\n          "+u[1]/l[1]+");\n      const vec2 inputShapeRC = vec2("+o+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+c+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "}return t}();e.ResizeNearestNeighborProgram=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1===n)return void(this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      ");var i=function(n){return e.indexOf(n)!==-1&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"},o=t.map(function(t,e){return i(e)}).join(","),a=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+o+"));\n      }\n    "}return t}();e.ReverseProgram=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e,n,i,o,a,s){void 0===s&&(s=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var u=r.getCoordsDataType(o.length),l=r.getCoordsDataType(a.length),c="";1===n?c="i":2===n&&(c="i, j");var p="getIndices("+c+")",h="";1===i?h="i":2===i&&(h="i, coords[1]");var f="getUpdates("+h+")",d=e>1?"strides[j]":"strides";this.userCode="\n        "+u+" strides = "+u+"("+o+");\n\n        void main() {\n          "+l+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+p+");\n              flattenedIndex += index * "+d+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+f+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "}return t}();e.ScatterProgram=i},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,i=t.inSize,o=t.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s="0.0",u="sumValue",l=4*Math.floor(n/4),c=n%4,p="\n        sumValue += dot(values, filter);\n    ",h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var f="";i%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = "+s+";\n\n      float getValue(int batch, int inIdx) {\n        "+h+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+f+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+l+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+p+"\n        }\n\n        int inIdx = inOffset + "+l+";\n        if ("+(1===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+p+"\n        } else if ("+(2===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+p+"\n        } else if ("+(3===c)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 filter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+p+"\n        }\n        setOutput("+u+");\n      }\n    "}return t}();e.SegmentOpProgram=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e,n){this.variableNames=["c","a","b"],this.outputShape=e;var i,o;if(n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",i="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],l=0;l<e.length;l++)u.push(""+a[l]),l<t&&s.push(""+a[l]);i=s.join(),o=u.join()}var c=r.getCoordsDataType(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+i+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "}return t}();e.SelectProgram=i},function(t,e,n){"use strict";function r(t){if(1===t)return"sourceLoc";if(2===t)return"sourceLoc.x, sourceLoc.y";if(3===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z";if(4===t)return"sourceLoc.x, sourceLoc.y, sourceLoc.z, sourceLoc.w";throw Error("Slicing for rank "+t+" is not yet supported")}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),o=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e=i.getCoordsDataType(this.rank),n=r(this.rank);this.userCode="\n      uniform "+e+" start;\n\n      void main() {\n        "+e+" sourceLoc = start + getOutputCoords();\n        setOutput(getSource("+n+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the "+("length of start ("+t.length+")"));return function(n,r){if(null!=e.startLoc||(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null!=e.startLoc))if(1===e.rank)n.gl.uniform1i(e.startLoc,t[0]);else if(2===e.rank)n.gl.uniform2i(e.startLoc,t[0],t[1]);else if(3===e.rank)n.gl.uniform3i(e.startLoc,t[0],t[1],t[2]);else{if(4!==e.rank)throw Error("Slicing for rank "+e.rank+" is not yet supported");n.gl.uniform4i(e.startLoc,t[0],t[1],t[2],t[3])}}},t}();e.SliceProgram=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(14),i=function(){function t(t,e,n,i){this.variableNames=["x"];var o=n.filter(function(t,e){return i.indexOf(e)===-1});this.outputShape=o;var a=n.length,s=r.getCoordsDataType(n.length),u=r.getCoordsDataType(o.length),l="";if(1===a)l="coords * strides + begin";else{var c=0;l=n.map(function(t,e){return i.indexOf(e)===-1?(c++,1===o.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(c-1)+"] * strides["+e+"] + begin["+e+"]"):"begin["+e+"]"}).join(",")}this.userCode="\n      "+s+" begin = "+s+"("+t+");\n      "+s+" strides = "+s+"("+e+");\n\n      void main() {\n        "+u+" coords = getOutputCoords();\n        setOutput(getX("+l+"));\n      }\n    "}return t}();e.StridedSliceProgram=i},function(t,e,n){"use strict";function r(t,e){if(e)return o.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?a.PhysicalTextureType.PACKED_2X2_FLOAT32:a.PhysicalTextureType.PACKED_2X2_FLOAT16;if(t===a.TextureUsage.DOWNLOAD||t===a.TextureUsage.PIXELS)return a.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE;if(t===a.TextureUsage.UPLOAD)return a.PhysicalTextureType.UNPACKED_FLOAT32;if(t===a.TextureUsage.RENDER)return o.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")?a.PhysicalTextureType.UNPACKED_FLOAT32:a.PhysicalTextureType.UNPACKED_FLOAT16;throw new Error("Unknown logical texture type "+t)}function i(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),a=n(56),s=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var o=r(e,n),s=i(t,o,n);if(s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]),this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var u=this.freeTextures[s].shift();return this.usedTextures[s].push(u),u}this.numUsedTextures++,this.log();var l;return o===a.PhysicalTextureType.PACKED_2X2_FLOAT32?l=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===a.PhysicalTextureType.PACKED_2X2_FLOAT16?l=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===a.PhysicalTextureType.UNPACKED_FLOAT32?l=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===a.PhysicalTextureType.UNPACKED_FLOAT16?l=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===a.PhysicalTextureType.PACKED_4X1_UNSIGNED_BYTE&&(l=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[s].push(l),l},t.prototype.releaseTexture=function(t,e,n,o){if(null!=this.freeTextures){var a=r(n,o),s=i(e,a,o);s in this.freeTextures||(this.freeTextures[s]=[]),this.freeTextures[s].push(t),this.numFreeTextures++,this.numUsedTextures--;var u=this.usedTextures[s],l=u.indexOf(t);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(l,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();e.TextureManager=s},function(t,e,n){"use strict";function r(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<t.length;i++)r.push("imod("+n[i]+", "+t[i]+")");return r.join()}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),o=function(){function t(t,e){this.variableNames=["A"];for(var n=new Array(t.length),o=0;o<n.length;o++)n[o]=t[o]*e[o];this.outputShape=n,this.rank=n.length;var a=i.getCoordsDataType(this.rank),s=r(t);this.userCode="\n      void main() {\n        "+a+" resRC = getOutputCoords();\n        setOutput(getA("+s+"));\n      }\n    "}return t}();e.TileProgram=o},function(t,e,n){"use strict";function r(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),i=0;i<t.length;i++)r[t[i]]=n[i];return r.join()}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),o=function(){function t(t,e){this.variableNames=["A"];for(var n=new Array(t.length),o=0;o<n.length;o++)n[o]=t[e[o]];this.outputShape=n,this.rank=n.length;var a=i.getCoordsDataType(this.rank),s=r(e);this.userCode="\n    void main() {\n      "+a+" resRC = getOutputCoords();\n      setOutput(getA("+s+"));\n    }\n    "}return t}();e.TransposeProgram=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(119),i=n(14),o=function(){function t(t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=t;var e=t.length,n=r.getChannels("rc",e),o=i.getCoordsDataType(e),a=r.getSourceCoords(e,n),s=n.slice(-2),u=1===e?"rc":"vec2("+s.join(",")+")";this.userCode="\n      void main() {\n        "+o+" rc = getOutputCoords();\n        vec4 packedInput = getA("+a+");\n\n        setOutput(getChannel(packedInput, "+u+"));\n      }\n    "}return t}();e.UnpackProgram=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(293);e.confusionMatrix=r.confusionMatrix},function(t,e,n){"use strict";function r(t,n,r,i,o,a){void 0===i&&(i=.001);var s,u=l.convertToTensor(t,"x","batchNormalization"),p=l.convertToTensor(n,"mean","batchNormalization"),h=l.convertToTensor(r,"variance","batchNormalization");null!=o&&(s=l.convertToTensor(o,"scale","batchNormalization"));var f;return null!=a&&(f=l.convertToTensor(a,"offset","batchNormalization")),c.assert(2===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+(u.rank+".")),c.assert(2===p.rank||1===p.rank,"Error in batchNormalization2D: mean must be rank 2 or rank 1 but "+("got rank "+p.rank+".")),c.assert(2===h.rank||1===h.rank,"Error in batchNormalization2D: variance must be rank 2 or rank 1 "+("but got rank "+h.rank+".")),null!=s&&c.assert(2===s.rank||1===s.rank,"Error in batchNormalization2D: scale must be rank 2 or rank 1 "+("but got rank "+s.rank+".")),null!=f&&c.assert(2===f.rank||1===f.rank,"Error in batchNormalization2D: offset must be rank 2 or rank 1 "+("but got rank "+f.rank+".")),e.batchNormalization(u,p,h,i,s,f)}function i(t,n,r,i,o,a){void 0===i&&(i=.001);var s,u=l.convertToTensor(t,"x","batchNormalization"),p=l.convertToTensor(n,"mean","batchNormalization"),h=l.convertToTensor(r,"variance","batchNormalization");null!=o&&(s=l.convertToTensor(o,"scale","batchNormalization"));var f;return null!=a&&(f=l.convertToTensor(a,"offset","batchNormalization")),c.assert(3===u.rank,"Error in batchNormalization3D: x must be rank 3 but got rank "+(u.rank+".")),c.assert(3===p.rank||1===p.rank,"Error in batchNormalization3D: mean must be rank 3 or rank 1 but "+("got rank "+p.rank+".")),c.assert(3===h.rank||1===h.rank,"Error in batchNormalization3D: variance must be rank 3 or rank 1 "+("but got rank "+h.rank+".")),null!=s&&c.assert(3===s.rank||1===s.rank,"Error in batchNormalization3D: scale must be rank 3 or rank 1 "+("but got rank "+s.rank+".")),null!=f&&c.assert(3===f.rank||1===f.rank,"Error in batchNormalization3D: offset must be rank 3 or rank 1 "+("but got rank "+f.rank+".")),e.batchNormalization(u,p,h,i,s,f)}function o(t,n,r,i,o,a){void 0===i&&(i=.001);var s,u=l.convertToTensor(t,"x","batchNormalization"),p=l.convertToTensor(n,"mean","batchNormalization"),h=l.convertToTensor(r,"variance","batchNormalization");null!=o&&(s=l.convertToTensor(o,"scale","batchNormalization"));var f;return null!=a&&(f=l.convertToTensor(a,"offset","batchNormalization")),c.assert(4===u.rank,"Error in batchNormalization4D: x must be rank 4 but got rank "+(u.rank+".")),c.assert(4===p.rank||1===p.rank,"Error in batchNormalization4D: mean must be rank 4 or rank 1 but "+("got rank "+p.rank+".")),c.assert(4===h.rank||1===h.rank,"Error in batchNormalization4D: variance must be rank 4 or rank 1 "+("but got rank "+h.rank+".")),null!=s&&c.assert(4===s.rank||1===s.rank,"Error in batchNormalization4D: scale must be rank 4 or rank 1 "+("but got rank "+s.rank+".")),null!=f&&c.assert(4===f.rank||1===f.rank,"Error in batchNormalization4D: offset must be rank 4 or rank 1 "+("but got rank "+f.rank+".")),e.batchNormalization(u,p,h,i,s,f)}function a(t,e,n,r,i,o){void 0===r&&(r=.001);var a,f=l.convertToTensor(t,"x","batchNormalization"),y=l.convertToTensor(e,"mean","batchNormalization"),g=l.convertToTensor(n,"variance","batchNormalization");null!=i&&(a=l.convertToTensor(i,"scale","batchNormalization"));var v;null!=o&&(v=l.convertToTensor(o,"offset","batchNormalization")),c.assert(y.rank===g.rank,"Batch normalization gradient requires mean and variance to have equal ranks."),c.assert(null==v||y.rank===v.rank,"Batch normalization gradient requires mean and offset to have equal ranks."),c.assert(null==a||y.rank===a.rank,"Batch normalization gradient requires mean and scale to have equal ranks.");var b;b=0===f.rank||1===f.rank?f.as4D(1,1,1,f.size):2===f.rank?f.as4D(1,1,f.shape[0],f.shape[1]):3===f.rank?f.as4D(1,f.shape[0],f.shape[1],f.shape[2]):f;var _=function(t){var e=null==a?d.scalar(1):a,n=h.getReductionAxes(y.shape,b.shape),i=[];if(1===y.rank){for(var o=0;o<b.shape.length-1;++o)i.push(b.shape[o]);i.push(1)}var s=f.sub(y),u=t.mul(e),l=m.rsqrt(g.add(d.scalar(r))),c=l.mul(l).mul(l).mul(d.scalar(-.5)),v=function(){return 1===y.rank?t.mul(p.tile(l.as4D(1,1,1,y.shape[0]),i)).mul(e).reshape(f.shape):t.mul(l).mul(e).reshape(f.shape)},_=function(){var t=l.mul(d.scalar(-1)).mul(u);return 1===y.rank&&(t=t.sum(n)),t.reshape(y.shape)},w=function(){var t=c.mul(s).mul(u);return 1===y.rank&&(t=t.sum(n)),t.reshape(y.shape)},S=function(){var e=s.mul(l),r=t.mul(e);return 1===y.rank&&(r=r.sum(n)),r.reshape(y.shape)},x=function(){var e=t;return 1===y.rank&&(e=e.sum(n)),e.reshape(y.shape)};return{$x:v,$mean:_,$variance:w,$scale:S,$offset:x}},w=u.ENV.engine.runKernel(function(t){return t.batchNormalization(b,s(y),s(g),r,s(a),s(v))},{$x:f,$mean:y,$variance:g,$scale:a,$offset:v},_);return w.reshape(f.shape)}function s(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(6),c=n(2),p=n(33),h=n(25),f=n(5),d=n(9),m=n(85);e.batchNormalization2d=f.op({batchNormalization2d_:r}),e.batchNormalization3d=f.op({batchNormalization3d_:i}),e.batchNormalization4d=f.op({batchNormalization4d_:o}),e.batchNormalization=f.op({batchNormalization_:a})},function(t,e,n){"use strict";function r(t,e,n){var r=i.convertToTensor(t,"label","confusionMatrix","int32"),s=i.convertToTensor(e,"label","confusionMatrix","int32");o.assert(null==n||n>0&&Number.isInteger(n),"If provided, numClasses must be a positive integer, but got "+n),o.assert(1===r.rank,"Expected the rank of labels to be 1, but got "+r.rank),o.assert(1===s.rank,"Expected the rank of predictions to be 1, but got "+s.rank),o.assert(r.shape[0]===s.shape[0],"Mismatch in the number of examples: "+(r.shape[0]+" vs. "+s.shape[0]+". ")+"Labels and predictions should have the same number of elements."),o.assert(n>0&&Number.isInteger(n),"numClasses is required to be a positive integer, but got "+n);var u=a.oneHot(r.asType("int32"),n),l=a.oneHot(s.asType("int32"),n);return u.transpose().matMul(l).asType("int32")}Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),o=n(2),a=n(33),s=n(5);e.confusionMatrix_=r,e.confusionMatrix=s.op({confusionMatrix_:r})},function(t,e,n){"use strict";function r(t,n,r,i,o,a,s){void 0===o&&(o="NWC"),void 0===a&&(a=1);var u=f.convertToTensor(t,"x","conv1d"),l=f.convertToTensor(n,"filter","conv1d"),c=u,p=!1;2===u.rank&&(p=!0,c=u.as3D(1,u.shape[0],u.shape[1])),d.assert(3===c.rank,"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."),d.assert(3===l.rank,"Error in conv1d: filter must be rank 3, but got rank "+(l.rank+".")),null!=s&&d.assert(d.isInt(i),"Error in conv1d: pad must be an integer when using, "+("dimRoundingMode "+s+" but got pad "+i+".")),d.assert(c.shape[2]===l.shape[1],"Error in conv1d: depth of input ("+c.shape[2]+") must match "+("input depth for filter "+l.shape[1]+".")),d.assert(m.eitherStridesOrDilationsAreOne(r,a),"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+r+" and dilation '"+a+"'")),d.assert("NWC"===o,"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported.");var h=l.as4D(1,l.shape[0],l.shape[1],l.shape[2]),y=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),g=[1,r],v=[1,a],b="NHWC",_=e.conv2d(y,h,g,i,b,v,s);return p?_.as2D(_.shape[2],_.shape[3]):_.as3D(_.shape[0],_.shape[2],_.shape[3])}function i(t,e,n,r,i,s,u){void 0===i&&(i="NHWC"),void 0===s&&(s=[1,1]);var l=f.convertToTensor(t,"x","conv2d"),c=f.convertToTensor(e,"filter","conv2d"),p=l,g=!1;3===l.rank&&(g=!0,p=l.as4D(1,l.shape[0],l.shape[1],l.shape[2])),d.assert(4===p.rank,"Error in conv2d: input must be rank 4, but got rank "+p.rank+"."),d.assert(4===c.rank,"Error in conv2d: filter must be rank 4, but got rank "+(c.rank+".")),null!=u&&d.assert(d.isInt(r),"Error in conv2d: pad must be an integer when using, "+("dimRoundingMode "+u+" but got pad "+r+".")),d.assert(p.shape[3]===c.shape[2],"Error in conv2d: depth of input ("+p.shape[3]+") must match "+("input depth for filter "+c.shape[2]+".")),d.assert(m.eitherStridesOrDilationsAreOne(n,s),"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+n+" and dilations '"+s+"'")),d.assert("NHWC"===i,"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported.");var v,b=m.computeConv2DInfo(p.shape,c.shape,n,s,r,u);if(1!==b.filterHeight||1!==b.filterWidth||1!==b.dilationHeight||1!==b.dilationWidth||1!==b.strideHeight||1!==b.strideWidth||"SAME"!==b.padInfo.type&&"VALID"!==b.padInfo.type){var _=function(t){return d.assert(m.tupleValuesAreOne(s),"Error in gradient of conv2D: dilation rates greater than 1 are not"+("yet supported in gradients. Got dilations '"+s+"'")),{x:function(){return o(p.shape,t,c,n,r)},$filter:function(){return a(p,t,c.shape,n,r)}}};v=h.ENV.engine.runKernel(function(t){return t.conv2d(p,c,b)},{x:p,$filter:c},_)}else{var w=p.reshape([-1,b.inChannels]),S=c.reshape([b.inChannels,b.outChannels]);v=y.matMul(w,S).reshape(b.outShape)}return g?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function o(t,n,r,i,o,a){d.assert(t.length===n.rank,"Length of inShape "+("("+t.length+") and rank of dy ("+n.rank+") must match"));var s=t,u=n,l=!1;3===n.rank&&(l=!0,u=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]),s=[1,t[0],t[1],t[2]]);var c=s[3],p=u.shape[3];d.assert(4===s.length,"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")),d.assert(4===u.rank,"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank),d.assert(4===r.rank,"Error in conv2dDerInput: filter must be rank 4, but got rank "+r.rank),d.assert(c===r.shape[2],"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+r.shape[2]+".")),d.assert(p===r.shape[3],"Error in conv2dDerInput: depth of output ("+p+") must "+("match output depth for filter "+r.shape[3]+".")),null!=a&&d.assert(d.isInt(o),"Error in conv2dDerInput: pad must be an integer when using, "+("dimRoundingMode "+a+" but got pad "+o+"."));var f=1,y=function(t){var n="NHWC";return{dy4D:function(){return e.conv2d(t,r,i,o,n,f,a)},filter:function(){return e.conv2dDerFilter(t,u,r.shape,i,o,a)}}},g=m.computeConv2DInfo(s,r.shape,i,f,o,a),v=h.ENV.engine.runKernel(function(t){return t.conv2dDerInput(u,r,g)},{dy4D:u,filter:r},y);return l?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}function a(t,e,n,r,i,o){var a=t;3===t.rank&&(a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var s=e;3===s.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),d.assert(4===a.rank,"Error in conv2dDerFilter: input must be rank 4, but got shape "+(a.shape+".")),d.assert(4===s.rank,"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(s.shape+".")),d.assert(4===n.length,"Error in conv2dDerFilter: filterShape must be length 4, but got "+(n+".")),d.assert(a.shape[3]===n[2],"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must "+("match input depth in filter ("+n[2]+".")),d.assert(s.shape[3]===n[3],"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must "+("match output depth for filter ("+n[3]+").")),null!=o&&d.assert(d.isInt(i),"Error in conv2dDerFilter: pad must be an integer when using, "+("dimRoundingMode "+o+" but got pad "+i+"."));var u=1,l=m.computeConv2DInfo(a.shape,n,r,u,i,o);return h.ENV.engine.runKernel(function(t){return t.conv2dDerFilter(a,s,l)},{x4D:a,dy4D:s})}function s(t,e,n,r,i,a){var s=f.convertToTensor(t,"x","conv2dTranspose"),u=f.convertToTensor(e,"filter","conv2dTranspose");return o(n,s,u,r,i,a)}function u(t,e,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=f.convertToTensor(t,"x","depthwiseConv2d"),u=f.convertToTensor(e,"filter","depthwiseConv2d"),l=s,y=!1;3===s.rank&&(y=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),d.assert(4===l.rank,"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")),d.assert(4===u.rank,"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")),d.assert(l.shape[3]===u.shape[2],"Error in depthwiseConv2d: number of input channels "+("("+l.shape[3]+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")),null==o&&(o=[1,1]),d.assert(m.eitherStridesOrDilationsAreOne(n,o),"Error in depthwiseConv2d: Either strides or dilations must be 1. "+("Got strides "+n+" and dilations '"+o+"'")),null!=a&&d.assert(d.isInt(r),"Error in depthwiseConv2d: pad must be an integer when using, "+("dimRoundingMode "+a+" but got pad "+r+"."));var g=m.computeConv2DInfo(l.shape,u.shape,n,o,r,a,!0),v=function(t){return d.assert(m.tupleValuesAreOne(o),"Error in gradient of depthwiseConv2d: dilation rates greater than "+("1 are not yet supported. Got dilations '"+o+"'")),{x:function(){return c(l.shape,t,u,g)},$filter:function(){return p(l,t,u.shape,g)}}},b=h.ENV.engine.runKernel(function(t){return t.depthwiseConv2D(l,u,g)},{x:l,$filter:u},v);return y?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function l(t,n,r,i,o,a,s){void 0===a&&(a=[1,1]),void 0===s&&(s="NHWC");var u=f.convertToTensor(t,"x","separableConv2d"),l=f.convertToTensor(n,"depthwiseFilter","separableConv2d"),c=f.convertToTensor(r,"pointwiseFilter","separableConv2d"),p=u,h=!1;if(3===u.rank&&(h=!0,p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),"NCHW"===s)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");d.assert(4===p.rank,"Error in separableConv2d: input must be rank 4, but got "+("rank "+p.rank+".")),d.assert(4===l.rank,"Error in separableConv2d: depthwise filter must be rank 4, but got "+("rank "+l.rank+".")),d.assert(4===c.rank,"Error in separableConv2d: pointwise filter must be rank 4, but got "+("rank "+l.rank+".")),d.assert(1===c.shape[0],"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+c.shape[0]+".")),d.assert(1===c.shape[1],"Error in separableConv2d: the second dimension of pointwise filter "+(" must be 1, but got "+c.shape[1]+"."));var m=l.shape[2],y=l.shape[3];d.assert(c.shape[2]===m*y,"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+m*y+", ")+("but got "+c.shape[2]+"."));var g=e.depthwiseConv2d(p,l,i,o,s,a),v=1,b=e.conv2d(g,c,v,"valid",s);return h?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}function c(t,e,n,r){var i=e,o=!1;3===e.rank&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=h.ENV.engine.runKernel(function(t){return t.depthwiseConv2DDerInput(i,n,r)},{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}function p(t,e,n,r){var i=t;3===t.rank&&(i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var o=e;return 3===o.rank&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),h.ENV.engine.runKernel(function(t){return t.depthwiseConv2DDerFilter(i,o,r)},{x4D:i,dy4D:o})}Object.defineProperty(e,"__esModule",{value:!0});var h=n(3),f=n(6),d=n(2),m=n(132),y=n(136),g=n(5);e.conv1d=g.op({conv1d_:r}),e.conv2d=g.op({conv2d_:i}),e.conv2dDerFilter=g.op({conv2dDerFilter_:a}),e.depthwiseConv2d=g.op({depthwiseConv2d_:u}),e.separableConv2d=g.op({separableConv2d_:l}),e.conv2dTranspose=g.op({conv2dTranspose_:s})},function(t,e,n){"use strict";function r(t,e){var n=o.convertToTensor(e,"indices","gatherND","int32"),r=o.convertToTensor(t,"x","gatherND");return i.ENV.engine.runKernel(function(t){return t.gatherND(r,n)},{$x:r,$indices:n})}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(5);e.gatherND=a.op({gatherND_:r})},function(t,e,n){"use strict";function r(t,e,n){void 0===n&&(n=!1);var r=f.convertToTensor(t,"images","resizeBilinear");
d.assert(3===r.rank||4===r.rank,"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+r.rank+".")),d.assert(2===e.length,"Error in resizeBilinear: new shape must 2D, but got shape "+(e+"."));var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=function(t,e){return t.resizeBilinear(i,a,s,n)},l=function(t,e){return{batchImages:function(){return p.ENV.engine.runKernel(function(e){return e.resizeBilinearBackprop(t,i,n)},{})}}},c=p.ENV.engine.runKernel(u,{batchImages:i},l);return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function i(t,e,n){void 0===n&&(n=!1);var r=f.convertToTensor(t,"images","resizeNearestNeighbor");d.assert(3===r.rank||4===r.rank,"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+r.rank+".")),d.assert(2===e.length,"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")),d.assert("float32"===r.dtype||"int32"===r.dtype,"`images` must have `int32` or `float32` as dtype");var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=function(t,e){return t.resizeNearestNeighbor(i,a,s,n)},l=function(t,e){return{batchImages:function(){return p.ENV.engine.runKernel(function(e){return e.resizeNearestNeighborBackprop(t,i,n)},{})}}},c=p.ENV.engine.runKernel(u,{batchImages:i},l);return o?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function o(t,e,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=f.convertToTensor(t,"boxes","nonMaxSuppression"),a=f.convertToTensor(e,"scores","nonMaxSuppression"),u=s(o,a,n,r,i);return n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,p.ENV.engine.runKernel(function(t){return t.nonMaxSuppression(o,a,n,r,i)},{$boxes:o})}function a(t,e,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),l(this,void 0,void 0,function(){var o,a,u,l,p,d;return c(this,function(c){switch(c.label){case 0:return o=f.convertToTensor(t,"boxes","nonMaxSuppressionAsync"),a=f.convertToTensor(e,"scores","nonMaxSuppressionAsync"),u=s(o,a,n,r,i),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,[4,o.data()];case 1:return l=c.sent(),[4,a.data()];case 2:return p=c.sent(),d=h.nonMaxSuppressionImpl(l,p,n,r,i),o!==t&&o.dispose(),a!==e&&a.dispose(),[2,d]}})})}function s(t,e,n,r,i){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY);var o=t.shape[0];return n=Math.min(n,o),d.assert(0<=r&&r<=1,"iouThreshold must be in [0, 1], but was '"+r+"'"),d.assert(2===t.rank,"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"),d.assert(4===t.shape[1],"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]),d.assert(1===e.rank,"scores must be a 1D tensor"),d.assert(e.shape[0]===o,"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i}}function u(t,e,n,r,i,o){var a=f.convertToTensor(t,"image","cropAndResize","float32"),s=f.convertToTensor(e,"boxes","cropAndResize","float32"),u=f.convertToTensor(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];d.assert(4===a.rank,"Error in cropAndResize: image must be rank 4,"+("but got rank "+a.rank+".")),d.assert(2===s.rank&&4===s.shape[1],"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")),d.assert(1===u.rank&&u.shape[0]===l,"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")),d.assert("int32"===u.dtype,"Error in cropAndResize: boxInd must be of dtype int32, but got dtype "+(u.dtype+".")),d.assert(2===r.length,"Error in cropAndResize: cropSize must be of length 2, but got length "+(r.length+".")),d.assert(r[0]>=1&&r[1]>=1,"cropSize must be atleast [1,1], but was "+r),d.assert("bilinear"===i||"nearest"===i,"method must be bilinear or nearest, but was "+i);var c=function(t,e){return t.cropAndResize(a,s,u,r,i,o)},h=p.ENV.engine.runKernel(c,{$image:a,$boxes:s});return h}var l=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=2&n[0]?o.return:n[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var p=n(3),h=n(77),f=n(6),d=n(2),m=n(5);e.resizeBilinear=m.op({resizeBilinear_:r}),e.resizeNearestNeighbor=m.op({resizeNearestNeighbor_:i}),e.nonMaxSuppression=m.op({nonMaxSuppression_:o}),e.nonMaxSuppressionAsync=a,e.cropAndResize=u},function(t,e,n){"use strict";function r(t){var e;if(Array.isArray(t)){e=!1,u.assert(null!=t&&t.length>0,"Gram-Schmidt process: input must not be null, undefined, or empty");for(var n=t[0].shape[0],r=1;r<t.length;++r)u.assert(t[r].shape[0]===n,"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+t[r].shape[0]+" vs. "+n+")"))}else e=!0,t=c.split(t,t.shape[0],0).map(function(t){return l.squeeze(t,[0])});u.assert(t.length<=t[0].shape[0],"Gram-Schmidt: Number of vectors ("+t.length+") exceeds "+("number of dimensions ("+t[0].shape[0]+")."));for(var i=[],o=t,s=function(t){i.push(a.ENV.engine.tidy(function(){var e=o[t];if(t>0)for(var n=0;n<t;++n){var r=f.sum(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(p.norm(e,"euclidean"))}))},r=0;r<t.length;++r)s(r);return e?l.stack(i,0):i}function i(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return o(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=l.unstack(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],a=[];r.forEach(function(t){var n=o(t,e),r=n[0],s=n[1];i.push(r),a.push(s)});var s=l.stack(i,0).reshape(t.shape),u=l.stack(a,0).reshape(t.shape);return[s,u]}function o(t,e){return void 0===e&&(e=!1),a.ENV.engine.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],i=l.eye(n),o=t.clone(),u=d.tensor2d([[1]],[1,1]),c=u.clone(),p=n>=r?r:n,h=function(t){var e,l=o,p=c,h=i;e=a.ENV.engine.tidy(function(){var e=o.slice([t,t],[n-t,1]),a=e.norm(),s=o.slice([t,t],[1,1]),l=s.sign().neg(),p=s.sub(l.mul(a)),h=e.div(p);c=1===h.shape[0]?u.clone():u.concat(h.slice([1,0],[h.shape[0]-1,h.shape[1]]),0);var f=l.matMul(p).div(a).neg(),d=o.slice([t,0],[n-t,r]),m=f.mul(c);o=0===t?d.sub(m.matMul(c.transpose().matMul(d))):o.slice([0,0],[t,r]).concat(d.sub(m.matMul(c.transpose().matMul(d))),0);var y=i.slice([0,t],[n,i.shape[1]-t]);return i=0===t?y.sub(y.matMul(c).matMul(m.transpose())):i.slice([0,0],[n,t]).concat(y.sub(y.matMul(c).matMul(m.transpose())),1),[c,o,i]}),c=e[0],o=e[1],i=e[2],s.dispose([l,p,h])},f=0;f<p;++f)h(f);return!e&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]})}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),s=n(17),u=n(2),l=n(33),c=n(80),p=n(137),h=n(5),f=n(139),d=n(9);e.gramSchmidt=h.op({gramSchmidt_:r}),e.qr=h.op({qr_:i})},function(t,e,n){"use strict";function r(t,e,n,r,s){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===s&&(s=.5);var u=o.convertToTensor(t,"x","localResponseNormalization");a.assert(4===u.rank||3===u.rank,"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+u.rank+"."),a.assert(a.isInt(e),"Error in localResponseNormalization: depthRadius must be an integer\n                     but got depthRadius "+e+".");var l=u,c=!1;3===u.rank&&(c=!0,l=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]));var p=function(t,o){var a=o[0];return{x4D:function(){return i.ENV.engine.runKernel(function(i){return i.LRNGrad(t,l,a,e,n,r,s)},{})}}},h=i.ENV.engine.runKernel(function(t,i){return i(t.localResponseNormalization4D(l,e,n,r,s))},{x4D:l},p);return c?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(2),s=n(5);e.localResponseNormalization=s.op({localResponseNormalization_:r})},function(t,e,n){"use strict";function r(t,e,n,r){for(var i=o.convertToTensor(e,"data","multiRNNCell"),a=o.convertToTensorArray(n,"c","multiRNNCell"),s=o.convertToTensorArray(r,"h","multiRNNCell"),u=i,l=[],c=0;c<t.length;c++){var p=t[c](u,a[c],s[c]);l.push(p[0]),l.push(p[1]),u=p[1]}for(var h=[],f=[],c=0;c<l.length;c+=2)h.push(l[c]),f.push(l[c+1]);return[h,f]}function i(t,e,n,r,i,a){var s=o.convertToTensor(t,"forgetBias","basicLSTMCell"),u=o.convertToTensor(e,"lstmKernel","basicLSTMCell"),l=o.convertToTensor(n,"lstmBias","basicLSTMCell"),c=o.convertToTensor(r,"data","basicLSTMCell"),p=o.convertToTensor(i,"c","basicLSTMCell"),h=o.convertToTensor(a,"h","basicLSTMCell"),f=c.concat(h,1),d=f.matMul(u),m=d.add(l),y=m.shape[0],g=m.shape[1]/4,v=[y,g],b=m.slice([0,0],v),_=m.slice([0,g],v),w=m.slice([0,2*g],v),S=m.slice([0,3*g],v),x=b.sigmoid().mulStrict(_.tanh()).addStrict(p.mulStrict(s.add(w).sigmoid())),T=x.tanh().mulStrict(S.sigmoid());return[x,T]}Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),a=n(5);e.basicLSTMCell=a.op({basicLSTMCell_:i}),e.multiRNNCell=a.op({multiRNNCell_:r})},function(t,e,n){"use strict";function r(t,e,n,r,u){void 0===u&&(u=!0);var c=o.convertToTensor(t,"v","movingAverage"),p=o.convertToTensor(e,"x","movingAverage"),h=o.convertToTensor(n,"decay","movingAverage");i.assertTypesMatch(c,p),a.assert(a.arraysEqual(c.shape,p.shape),"Shape mismatch in v and x");var f=l.scalar(1),d=f.sub(h),m=p.sub(c).mul(d);if(u){a.assert(null!=r,"When using zeroDebias: true, step is required.");var y=o.convertToTensor(r,"step","movingAverage");m=m.div(f.sub(s.pow(h,y)))}return c.add(m)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(49),o=n(6),a=n(2),s=n(48),u=n(5),l=n(9);e.movingAverage=u.op({movingAverage_:r})},function(t,e,n){"use strict";function r(t,e,n,r,i,o){var a=f.convertToTensor(t,"x","maxPool"),s=a,l=!1;3===a.rank&&(l=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),d.assert(4===s.rank,"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."),d.assert(y.eitherStridesOrDilationsAreOne(n,r),"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+n+" and dilations '"+r+"'")),null!=o&&d.assert(d.isInt(i),"Error in maxPool: pad must be an integer when using, "+("dimRoundingMode "+o+" but got pad "+i+"."));var c=y.computePool2DInfo(s.shape,e,n,r,i,o),p=function(t,o){var a=o[0];return{x:function(){return u(t,s,a,e,n,r,i)}}},m=h.ENV.engine.runKernel(function(t,e){return e(t.maxPool(s,c))},{x:s},p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function i(t,e,n,i,o){return r(t,e,n,1,i,o)}function o(t,e,n,r,i,o){var a=f.convertToTensor(t,"x","avgPool");d.assert("float32"===a.dtype,"The input dtype to avgPool must be float32"),null==r&&(r=[1,1]),d.assert(y.eitherStridesOrDilationsAreOne(n,r),"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+n+" and dilations '"+r+"'"));var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),d.assert(4===s.rank,"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."),null!=o&&d.assert(d.isInt(i),"Error in avgPool: pad must be an integer when using, "+("dimRoundingMode "+o+" but got pad "+i+"."));var c=y.computePool2DInfo(s.shape,e,n,r,i),p=function(t){return{x:function(){return l(t,s,e,n,r,i)}}},m=h.ENV.engine.runKernel(function(t){return t.avgPool(s,c)},{x:s},p);return m=m.cast(a.dtype),u?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function a(t,e,n,r,i){return o(t,e,n,1,r,i)}function s(t,e,n,i,a,s){null==a&&(a=[1,1]),null==s&&(s=1),0===i&&(i="valid");var u=f.convertToTensor(t,"x","maxPool"),l=u,h=!1;3===u.rank&&(h=!0,l=u.as4D(1,u.shape[0],u.shape[1],u.shape[2])),d.assert(y.eitherStridesOrDilationsAreOne(s,a),"Error in pool: Either strides or dilations must be 1. "+("Got strides "+s+" and dilations '"+a+"'"));var g,v=y.computePool2DInfo(l.shape,e,s,a,i),b=[v.dilationHeight,v.dilationWidth];g="same"===i?p([v.filterHeight,v.filterWidth],b):[[0,0],[0,0]];var _=1===b[0]&&1===b[1],w=c([v.inHeight,v.inWidth],b,g),S=w[0],x=w[1],T=_?i:"valid",P=_?l:m.spaceToBatchND(l,b,S),E="avg"===n?function(){return o(P,e,s,1,T)}:function(){return r(P,e,s,1,T)},A=E(),N=_?A:m.batchToSpaceND(A,b,x);return h?N.as3D(N.shape[1],N.shape[2],N.shape[3]):N}function u(t,e,n,r,i,o,a,s){var u=f.convertToTensor(t,"dy","maxPoolBackprop"),l=f.convertToTensor(e,"input","maxPoolBackprop"),c=f.convertToTensor(n,"output","maxPoolBackprop");d.assert(l.rank===u.rank,"Rank of input ("+l.rank+") does not match rank of dy ("+u.rank+")"),null==o&&(o=[1,1]),d.assert(y.eitherStridesOrDilationsAreOne(i,o),"Error in maxPoolBackProp: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+o+"'")),d.assert(4===u.rank,"Error in maxPoolBackprop: dy must be rank 4 but got rank "+(u.rank+".")),d.assert(4===l.rank,"Error in maxPoolBackprop: input must be rank 4 but got rank "+(l.rank+".")),null!=s&&d.assert(d.isInt(a),"Error in maxPoolBackprop: pad must be an integer when using, "+("dimRoundingMode "+s+" but got pad "+a+"."));var p=y.computePool2DInfo(l.shape,r,i,o,a,s),m=h.ENV.engine.runKernel(function(t){return t.maxPoolBackprop(u,l,c,p)},{$dy:u,$input:l});return m}function l(t,e,n,r,i,o){var a=f.convertToTensor(t,"dy","avgPoolBackprop"),s=f.convertToTensor(e,"input","avgPoolBackprop");d.assert(s.rank===a.rank,"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"),null==i&&(i=[1,1]),d.assert(y.eitherStridesOrDilationsAreOne(r,i),"Error in avgPoolBackprop: Either strides or dilations must be 1. "+("Got strides "+r+" and dilations '"+i+"'"));var u=s,l=a,c=!1;3===s.rank&&(c=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),l=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),d.assert(4===l.rank,"Error in avgPoolBackprop: dy must be rank 4 but got rank "+(l.rank+".")),d.assert(4===u.rank,"Error in avgPoolBackprop: input must be rank 4 but got rank "+(u.rank+"."));var p=y.computePool2DInfo(u.shape,n,r,i,o),m=h.ENV.engine.runKernel(function(t){return t.avgPoolBackprop(l,u,p)},{dy4D:l,input4D:u});return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}function c(t,e,n){var r=n.map(function(t){return t[0]}),i=n.map(function(t){return t[1]}),o=t.concat(r,i),a=e.map(function(t,e){return(t-o[e]%t)%t}),s=i.map(function(t,e){return t+a[e]}),u=e.map(function(t,e){return[r[e],s[e]]}),l=e.map(function(t,e){return[0,a[e]]});return[u,l]}function p(t,e){var n=t.map(function(t,n){return t+(t-1)*(e[n]-1)}),r=n.map(function(t){return t-1}),i=r.map(function(t){return Math.floor(t/2)}),o=r.map(function(t,e){return t-i[e]});return r.map(function(t,e){return[i[e],o[e]]})}Object.defineProperty(e,"__esModule",{value:!0});var h=n(3),f=n(6),d=n(2),m=n(33),y=n(132),g=n(5);e.maxPool=g.op({maxPool_:i}),e.avgPool=g.op({avgPool_:a}),e.pool=g.op({pool_:s})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(154),i=function(){function t(t,e,n,i,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o?o:Math.random();this.random=r.alea(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do i=2*this.random()-1,o=2*this.random()-1,a=i*i+o*o;while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}();e.MPRandGauss=i},function(t,e,n){"use strict";function r(t){var e=l.convertToTensor(t,"x","relu");if("bool"===e.dtype)return e.toInt();var n=function(t){var n=e.step();return{$x:function(){return t.mulStrict(n.toFloat())}}};return u.ENV.engine.runKernel(function(t){return t.relu(e)},{$x:e},n)}function i(t){var e=l.convertToTensor(t,"x","elu"),n=function(t,e){var n=e[0];return{$x:function(){return u.ENV.engine.runKernel(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}};return u.ENV.engine.runKernel(function(t,n){return n(t.elu(e))},{$x:e},n)}function o(t){var e=l.convertToTensor(t,"x","selu"),n=function(t){return{$x:function(){var n=e.greater(d.scalar(0)),r=d.scalar(f.SELU_SCALEALPHA),i=d.scalar(f.SELU_SCALE),o=t.mul(i),a=t.mul(r).mul(e.toFloat().exp());return p.where(n,o,a)}}};return u.ENV.engine.runKernel(function(t){return t.selu(e)},{$x:e},n)}function a(t,e){void 0===e&&(e=.2);var n=l.convertToTensor(t,"x","leakyRelu");return c.maximum(d.scalar(e).mul(n),n)}function s(t,e){var n=l.convertToTensor(t,"x","prelu"),r=l.convertToTensor(e,"alpha","prelu"),i=d.scalar(0);return c.maximum(i,n).add(r.mul(c.minimum(i,n)))}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(6),c=n(48),p=n(81),h=n(5),f=n(83),d=n(9);e.elu=h.op({elu_:i}),e.leakyRelu=h.op({leakyRelu_:a}),e.prelu=h.op({prelu_:s}),e.relu=h.op({relu_:r}),e.selu=h.op({selu_:o})},function(t,e,n){"use strict";function r(t){var n=l.convertToTensor(t,"x","reverse");return c.assert(1===n.rank,"Error in reverse1D: x must be rank 1 but got\n             rank "+n.rank+"."),e.reverse(n,0)}function i(t,n){var r=l.convertToTensor(t,"x","reverse");return c.assert(2===r.rank,"Error in reverse2D: x must be rank 2 but got\n             rank "+r.rank+"."),e.reverse(r,n)}function o(t,n){var r=l.convertToTensor(t,"x","reverse");return c.assert(3===r.rank,"Error in reverse3D: x must be rank 3 but got\n             rank "+r.rank+"."),e.reverse(r,n)}function a(t,n){var r=l.convertToTensor(t,"x","reverse");return c.assert(4===r.rank,"Error in reverse4D: x must be rank 4 but got\n             rank "+r.rank+"."),e.reverse(r,n)}function s(t,e){var n=l.convertToTensor(t,"x","reverse");if(0===n.rank)return n.clone();var r=p.parseAxisParam(e,n.shape),i=function(t){return{$x:function(){return t.reverse(r)}}},o=u.ENV.engine.runKernel(function(t){return t.reverse(n,r)},{$x:n},i);return o.reshapeAs(n)}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(6),c=n(2),p=n(24),h=n(5);e.reverse=h.op({reverse_:s}),e.reverse1d=h.op({reverse1d_:r}),e.reverse2d=h.op({reverse2d_:i}),e.reverse3d=h.op({reverse3d_:o}),e.reverse4d=h.op({reverse4d_:a})},function(t,e,n){"use strict";function r(t,e,n){var r=o.convertToTensor(t,"indices","scatterND","int32"),a=o.convertToTensor(e,"updates","scatterND");return s.validateInput(a,r,n),i.ENV.engine.runKernel(function(t){return t.scatterND(r,a,n)},{$indices:r,$updates:a})}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(5),s=n(82);e.scatterND=a.op({scatterND_:r})},function(t,e,n){"use strict";function r(t,e,n){var r=l.convertToTensor(t,"x","unsortedSegmentSum"),i=l.convertToTensor(e,"segmentIds","unsortedSegmentSum","int32");c.assert("int32"===i.dtype,"segmentIds must be of dtype `int32`"),c.assert(c.isInt(n),"numSegments must be of dtype int");var o=function(t){var e=function(){return s(t,i)};return{$x:e}};return u.ENV.engine.runKernel(function(t){return t.unsortedSegmentSum(r,i,n)},{$x:r},o)}function i(t,n,r){void 0===r&&(r=0);var i=l.convertToTensor(t,"x","gather"),s=l.convertToTensor(n,"indices","gather","int32");c.assert("int32"===s.dtype,"Indices must be of dtype `int32`"),r=h.parseAxisParam(r,i.shape)[0];var p=function(t){var n=function(){if(0===r)return e.unsortedSegmentSum(t,s,i.shape[r]);var n=i.shape,u=s.size,l=n.slice(0,r),c=l.length,p=n.slice(r,n.length).slice(1),f=p.length,d=o(0,c),m=o(c+1,c+1+f),y=a([l,[u],p]),g=t.reshape(y),v=s.reshape([u]),b=a([[c],d,m]),_=g.transpose(b),w=e.unsortedSegmentSum(_,v,i.shape[r]),S=h.getUndoAxesPermutation(b);return w=w.transpose(S)};return{$x:n}};return u.ENV.engine.runKernel(function(t){return t.gather(i,s,r)},{$x:i},p)}function o(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function a(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}function s(t,n){for(var r=f.maximum(n,g.zerosLike(n)),i=e.gather(t,r),o=d.greaterEqual(n,g.scalar(0,"int32")),a=i.rank-o.rank,s=0;s<a;++s)o=p.expandDims(o,s+1);o=m.logicalAnd(o,g.ones(i.shape,"bool"));var u=g.zerosLike(i);return m.where(o,i,u)}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(6),c=n(2),p=n(33),h=n(24),f=n(48),d=n(131),m=n(81),y=n(5),g=n(9);e.gather=y.op({gather_:i}),e.unsortedSegmentSum=y.op({unsortedSegmentSum_:r})},function(t,e,n){"use strict";function r(t,e){var n,r=!1;for(t<=a.PARALLELIZE_THRESHOLD?(n=t,r=!0):n=o.nearestDivisor(t,Math.floor(Math.sqrt(t)));!r;){if(n>e||n===t){r=!0;break}n=o.nearestDivisor(t,n+1)}return n}function i(t,e,n){for(var r=[],i=t.length,o=0;o<i;o++)o!==e?r.push(t[o]):r.push(n);return r}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),a=n(138);e.segOpComputeOptimalWindowSize=r,e.computeOutShape=i},function(t,e,n){"use strict";function r(t,n,r){var i=l.convertToTensor(t,"x","slice1d");return c.assert(1===i.rank,"slice1d expects a rank-1 tensor, but got a rank-"+i.rank+" tensor"),e.slice(i,[n],[r])}function i(t,n,r){var i=l.convertToTensor(t,"x","slice2d");return c.assert(2===i.rank,"slice2d expects a rank-2 tensor, but got a rank-"+i.rank+" tensor"),e.slice(i,n,r)}function o(t,n,r){var i=l.convertToTensor(t,"x","slice3d");return c.assert(3===i.rank,"slice3d expects a rank-3 tensor, but got a rank-"+i.rank+" tensor"),e.slice(i,n,r)}function a(t,n,r){var i=l.convertToTensor(t,"x","slice4d");return c.assert(4===i.rank,"slice4d expects a rank-4 tensor, but got a rank-"+i.rank+" tensor"),e.slice(i,n,r)}function s(t,e,n){var r=l.convertToTensor(t,"x","slice");if(0===r.rank)throw new Error("Slicing scalar is not possible");var i;i="number"==typeof e?[e].concat(new Array(r.rank-1).fill(0)):e.length<r.rank?e.concat(new Array(r.rank-e.length).fill(0)):e.slice();var o;o=null==n?new Array(r.rank).fill(-1):"number"==typeof n?[n].concat(new Array(r.rank-1).fill(-1)):n.length<r.rank?n.concat(new Array(r.rank-n.length).fill(-1)):n,o=o.map(function(t,e){return t>=0?t:(c.assert(t===-1,"Bad value in size"),r.shape[e]-i[e])}),h.assertParamsValid(r,i,o);var a=r.shape,s=function(t){for(var e=[],n=0;n<t.rank;n++)e.push([i[n],a[n]-i[n]-o[n]]);return{$x:function(){return t.pad(e)}}};return u.ENV.engine.runKernel(function(t){return t.slice(r,i,o)},{$x:r},s)}Object.defineProperty(e,"__esModule",{value:!0});var u=n(3),l=n(6),c=n(2),p=n(5),h=n(84);e.slice=p.op({slice_:s}),e.slice1d=p.op({slice1d_:r}),e.slice2d=p.op({slice2d_:i}),e.slice3d=p.op({slice3d_:o}),e.slice4d=p.op({slice4d_:a})},function(t,e,n){"use strict";function r(t,e,n,r){var s=a.convertToTensor(t,"sparseIndices","sparseToDense","int32"),u=a.convertToTensor(e,"sparseValues","sparseToDense"),l=a.convertToTensor(r,"defaultValue","sparseToDense",u.dtype);return o.validateInput(s,u,n,l),i.ENV.engine.runKernel(function(t){return t.sparseToDense(s,u,n,l)},{$sparseIndices:s,$sparseValues:u,$defaultValue:l})}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(310),a=n(6),s=n(5);e.sparseToDense=s.op({sparseToDense_:r})},function(t,e){"use strict";function n(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+t.dtype+"."));if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+t.shape+"."));var i=t.rank>0?t.shape[0]:1,o=t.rank>1?t.shape[1]:1;if(n.length!==o)throw new Error("outputShape has incorrect number of elements:,"+(" "+n.length+", should be: "+o+"."));var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==i))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+i+"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}Object.defineProperty(e,"__esModule",{value:!0}),e.validateInput=n},function(t,e,n){"use strict";function r(t,e,n,r,a,s,u,l,c){if(void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0),0!==u)throw new Error("ellipsis mask is not yet supported");if(0!==l)throw new Error("new axis mask is not yet supported");var p=o.convertToTensor(t,"x","stridedSlice");return i.ENV.engine.runKernel(function(t){return t.stridedSlice(p,e,n,r,a,s,u,l,c)},{$x:p})}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(5);e.stridedSlice=a.op({stridedSlice_:r})},function(t,e,n){"use strict";function r(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=o.convertToTensor(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+e);var s=i.ENV.engine.runKernel(function(t){return t.topk(r,e,n)},{$x:r}),u=s[0],l=s[1];return{values:u,indices:l}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(5);e.topk=a.op({topk_:r})},function(t,e,n){"use strict";function r(t,e){var n=o.convertToTensor(t,"x","transpose");if(null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),a.assert(n.rank===e.length,"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")),e.forEach(function(t){a.assert(t>=0&&t<n.rank,"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e))}),n.rank<=1)return n.clone();var r=function(t){var n=s.getUndoAxesPermutation(e);return{$x:function(){return t.transpose(n)}}};return i.ENV.engine.runKernel(function(t){return t.transpose(n,e)},{$x:n},r)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(6),a=n(2),s=n(24),u=n(5);e.transpose=u.op({transpose_:r})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(86),i=n(87),o=n(88),a=n(89),s=n(90),u=n(91),l=n(59),c=function(){function t(){}return t.sgd=function(t){return new l.SGDOptimizer(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new s.MomentumOptimizer(t,e,n)},t.rmsprop=function(t,e,n,r,i){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new u.RMSPropOptimizer(t,e,n,r,i)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new o.AdamOptimizer(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new r.AdadeltaOptimizer(t,e,n)},t.adamax=function(t,e,n,r,i){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new a.AdamaxOptimizer(t,e,n,r,i)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new i.AdagradOptimizer(t,e)},t}();e.OptimizerConstructors=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),i=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new o)}return t.prototype.profileKernel=function(t,e){var n,i=this,o=function(){n=e()},a=this.backendTimer.time(o),s=Array.isArray(n)?n:[n];return s.forEach(function(e){var n=e.dataSync();r.checkComputationForNaN(n,e.dtype,t),a.then(function(r){var o="";null!=r.getExtraProfileInfo&&(o=r.getExtraProfileInfo()),i.logger.logKernelProfile(t,e,n,r.kernelMs,o)})}),n},t}();e.Profiler=i;var o=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,i,o){var a=r.rightPad(i+"ms",9),s=r.rightPad(t,25),u=e.rank,l=e.size,c=r.rightPad(e.shape.toString(),14);console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+c+"\t%c"+l+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},t}();e.Logger=o},function(t,e,n){"use strict";function r(t,e,n){for(var r={},i={},o=0;o<e.length;o++)r[e[o].id]=!0;for(var o=0;o<t.length;o++){var a=t[o],s=a.inputs;for(var u in s){for(var l=s[u],c=!1,p=0;p<e.length;p++)if(r[l.id]){a.outputs.forEach(function(t){return r[t.id]=!0}),c=!0,i[a.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;for(var f={},o=t.length-1;o>=0;o--)for(var a=t[o],s=a.inputs,p=0;p<a.outputs.length;p++)if(h[a.outputs[p].id]){for(var u in s)h[s[u].id]=!0,f[a.id]=!0;break}for(var d=[],o=0;o<t.length;o++){var a=t[o];if(i[a.id]&&f[a.id]){var m={};for(var u in a.inputs){var y=a.inputs[u];r[y.id]&&(m[u]=y)}var g=Object.assign({},a);g.inputs=m,g.outputs=a.outputs,d.push(g)}}return d}function i(t,e){for(var n=(function(n){var r=e[n],i=[];if(r.outputs.forEach(function(e){var n=t[e.id];if(null!=n)i.push(n);else{var r=o.Tensor.make(e.shape,{values:a.makeZerosTypedArray(e.size,e.dtype)},e.dtype);i.push(r)}}),null==r.gradient)throw new Error("Cannot compute gradient: gradient function not found "+("for "+r.name+"."));var s=r.gradient(1===r.outputs.length?i[0]:i);for(var u in r.inputs){if(!(u in s))throw new Error("Cannot backprop through input "+u+". "+("Available gradients found: "+Object.keys(s)+"."));var l=s[u](),c=r.inputs[u];if(!a.arraysEqual(l.shape,c.shape))throw new Error("Error in gradient for op "+r.name+". The gradient of input "+("'"+u+"' has shape '"+l.shape+"', which does not match ")+("the shape of the input '"+c.shape+"'"));if(null==t[c.id])t[c.id]=l;else{var p=t[c.id];t[c.id]=p.add(l),p.dispose()}}}),r=e.length-1;r>=0;r--)n(r)}Object.defineProperty(e,"__esModule",{value:!0});var o=n(15),a=n(2);e.getFilteredNodesXToY=r,e.backpropagateGradients=i},function(t,e,n){"use strict";function r(t,e,n,r){var o=u.computeStrides(e),s=i(t,e,n,o),l=e.length,c=a(t,e,n,o,s),p=["Tensor"];return r&&(p.push("  dtype: "+n),p.push("  rank: "+l),p.push("  shape: ["+e+"]"),p.push("  values:")),p.push(c.map(function(t){return"    "+t}).join("\n")),p.join("\n")}function i(t,e,n,r){var i=u.sizeFromShape(e),a=r[r.length-1],l=new Array(a).fill(0),c=e.length,p="complex64"===n?s(t):t;if(c>1)for(var h=0;h<i/a;h++)for(var f=h*a,d=0;d<a;d++)l[d]=Math.max(l[d],o(p[f+d],0).length);return l}function o(t,e){var n;return n=Array.isArray(t)?parseFloat(t[0].toFixed(p))+" + "+(parseFloat(t[1].toFixed(p))+"j"):parseFloat(t.toFixed(p)).toString(),u.rightPad(n,e)}function a(t,e,n,r,i,u){void 0===u&&(u=!0);var p="complex64"===n?2:1,h=e[0],f=e.length;if(0===f){if("complex64"===n){var d=s(t);return[o(d[0],0)]}return[t[0].toString()]}if(1===f){if(h>l){var m=c*p,y=Array.from(t.subarray(0,m)),g=Array.from(t.subarray(h-c*p,h));return"complex64"===n&&(y=s(y),g=s(g)),["["+y.map(function(t,e){return o(t,i[e])}).join(", ")+", ..., "+g.map(function(t,e){return o(t,i[h-c+e])}).join(", ")+"]"]}var v="complex64"===n?s(t):Array.from(t);return["["+v.map(function(t,e){return o(t,i[e])}).join(", ")+"]"]}var b=e.slice(1),_=r.slice(1),w=r[0]*p,S=[];if(h>l){for(var x=0;x<c;x++){var T=x*w,P=T+w;S.push.apply(S,a(t.subarray(T,P),b,n,_,i,!1))}S.push("...");for(var x=h-c;x<h;x++){var T=x*w,P=T+w;S.push.apply(S,a(t.subarray(T,P),b,n,_,i,x===h-1))}}else for(var x=0;x<h;x++){var T=x*w,P=T+w;S.push.apply(S,a(t.subarray(T,P),b,n,_,i,x===h-1))}var E=2===f?",":"";S[0]="["+S[0]+E;for(var x=1;x<S.length-1;x++)S[x]=" "+S[x]+E;for(var A=",\n",x=2;x<f;x++)A+="\n";
return S[S.length-1]=" "+S[S.length-1]+"]"+(u?"":A),S}function s(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}Object.defineProperty(e,"__esModule",{value:!0});var u=n(2),l=20,c=3,p=7;e.tensorToString=r},function(t,e,n){"use strict";function r(t,e,n){if(null==n&&(n=c.ENV.get("TEST_EPSILON")),t instanceof p.Tensor||e instanceof p.Tensor){if(t instanceof p.Tensor&&e instanceof p.Tensor){if(t.dtype!==e.dtype)throw new Error("Arrays are of different type actual: "+t.dtype+" "+("vs expected: "+e.dtype+"."));if(!h.arraysEqual(t.shape,e.shape))throw new Error("Arrays are of different shape actual: "+t.shape+" "+("vs expected: "+e.shape+"."))}}else{var r=t.constructor.name,i=e.constructor.name;if(r!==i)throw new Error("Arrays are of different type actual: "+r+" vs expected: "+i)}var o,a;if(o=t instanceof p.Tensor?t.dataSync():t,a=e instanceof p.Tensor?e.dataSync():e,o.length!==a.length)throw new Error("Arrays have different lengths actual: "+o.length+" vs "+("expected: "+a.length+".\n")+("Actual:   "+o+".\n")+("Expected: "+a+"."));for(var u=0;u<a.length;++u){var l=o[u],f=a[u];if(!s(l,Number(f),n))throw new Error("Arrays differ: actual["+u+"] = "+l+", expected["+u+"] = "+f+".\n"+("Actual:   "+o+".\n")+("Expected: "+a+"."))}}function i(t,e){t().then(function(){return e.fail()},function(){return e()})}function o(t,e){return r(t,e,0)}function a(t,e,n){if(null==n&&(n=c.ENV.get("TEST_EPSILON")),!s(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)}function s(t,e,n){return!(!isNaN(t)||!isNaN(e))||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}function u(t,e,n){var r;r=t instanceof p.Tensor?t.dataSync():t;for(var i=0;i<r.length;i++)if(r[i]<e||r[i]>n)throw new Error("Value out of range:"+r[i]+" low: "+e+", high: "+n)}function l(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}Object.defineProperty(e,"__esModule",{value:!0});var c=n(3),p=n(15),h=n(2);e.WEBGL_ENVS={HAS_WEBGL:!0},e.NODE_ENVS={IS_NODE:!0},e.CHROME_ENVS={IS_CHROME:!0},e.BROWSER_ENVS={IS_BROWSER:!0},e.CPU_ENVS={HAS_WEBGL:!1},e.BROWSER_CPU_ENVS={BACKEND:"test-cpu"},e.ALL_ENVS={},e.expectArraysClose=r,e.expectPromiseToFail=i,e.expectArraysEqual=o,e.expectNumbersClose=a,e.expectValuesInRange=u,e.expectArrayBuffersEqual=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(86),i=n(87),o=n(88),a=n(89),s=n(90),u=n(314),l=n(91),c=n(59);[s.MomentumOptimizer,c.SGDOptimizer,r.AdadeltaOptimizer,i.AdagradOptimizer,l.RMSPropOptimizer,a.AdamaxOptimizer,o.AdamOptimizer],e.train={sgd:u.OptimizerConstructors.sgd,momentum:u.OptimizerConstructors.momentum,adadelta:u.OptimizerConstructors.adadelta,adagrad:u.OptimizerConstructors.adagrad,rmsprop:u.OptimizerConstructors.rmsprop,adamax:u.OptimizerConstructors.adamax,adam:u.OptimizerConstructors.adam}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="0.13.11";e.version=n},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(126);e.gpgpu_util=r;var i=n(57);e.webgl_util=i;var o=n(117);e.MathBackendWebGL=o.MathBackendWebGL;var a=n(125);e.GPGPUContext=a.GPGPUContext},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(50),o=n(62),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.model=null,e}return r(e,t),e.prototype.setModel=function(t){if(!(t instanceof o.Model))throw new Error("model must be a Model, not some other Container");this.model=t},e}(i.BaseCallback);e.Callback=a},function(t,e,n){"use strict";function r(t,e,n,r){if(!n.startsWith("2."))throw new c.ValueError("Unsupported Keras version in weights being loaded: "+n);return e}function i(t,e,n){var r=h.stringToDType(t);return u.Tensor.make(e,{values:0===e.length?n:u.util.flatten(n)},r)}function o(t,e,n){void 0===n&&(n=!1);for(var o=t.keras_version,a=t.backend,s=e.map(function(t){return t.name}),l={},p=0,h=e;p<h.length;p++){var f=h[p];null!=f.name&&(null==l[f.name]&&(l[f.name]=[]),l[f.name].push(f))}for(var d=t.weights,y=[],g=0;g<s.length;++g){var v=s[g],b=d[v];null==b&&(b=[]);for(var _=[],w=0;w<b.length;++w){var S=b[w];_.push(new m.LayerVariable(i(S.dtype,S.shape,S.value)))}for(var x=0,T=l[v];x<T.length;x++){var f=T[x],P=f.weights;if(_=r(f,_,o,a),_.length!==P.length){if(!n)throw new c.ValueError("Layer #"+g+' (named "'+f.name+'") expects '+(P.length+" weight(s), but the saved weights ")+("have "+_.length+" element(s)."));console.warn("Skipping loading of weights of layer "+f.name+" "+("due to mismatch in number of weights: ("+_.length+" ")+("vs "+P.length+")."))}for(var E=0;E<_.length;++E)!n||u.util.arraysEqual(P[E].shape,_[E].shape)?y.push([P[E],_[E].read()]):console.warn("Skipping loading of weights for layer "+f.name+" due "+("to mismatch in shape ("+P[E].shape+" vs ")+(_[E].shape+")"))}}m.batchSetValue(y)}function a(t,e,n){void 0===n&&(n=!0);for(var r={},i=0,o=0,a=e;o<a.length;o++)for(var s=a[o],u=0,l=s.weights;u<l.length;u++){var p=l[u];if(null!=r[p.originalName])throw new c.ValueError("Duplicate weight name: "+p.originalName);r[p.originalName]=p,i++}var h=[];for(var f in t){if(null!=r[f])h.push([r[f],t[f]]);else if(n)throw new c.ValueError("Provided weight data has no target variable: "+f);delete r[f]}if(n){var d=[];for(var y in r)d.push(y);if(d.length>0)throw new c.ValueError(d.length+" of "+i+" weights are not set: "+d)}m.batchSetValue(h)}var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=n(8),c=n(7),p=n(63),h=n(10),f=n(145),d=n(16),m=n(64),y=n(147),g=n(51),v=n(12);e.loadWeightsFromJson=o,e.loadWeightsFromNamedTensorMap=a;var b=function(t){function e(n){var r=t.call(this,{})||this;if(r.containerNodes=new Set,r.name=n.name,null==r.name){var i=r.getClassName().toLowerCase();r.name=l.getUid(i)}if(r.supportsMasking=!1,r.trainable=!0,r.updatable=!0,Array.isArray(n.inputs)?r.inputs=n.inputs.slice():r.inputs=[n.inputs],Array.isArray(n.outputs)?r.outputs=n.outputs.slice():r.outputs=[n.outputs],h.unique(r.inputs).length!==r.inputs.length)throw new c.ValueError("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+r.inputs.map(function(t){return t.name}));h.unique(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+r.outputs.map(function(t){return t.name})),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[];for(var o=0,a=r.outputs;o<a.length;o++){var s=a[o],u=s.sourceLayer,p=s.nodeIndex,f=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(p),r.outputLayersTensorIndices.push(f)}for(var d=0,m=r.inputs;d<m.length;d++){var s=m[d],u=s.sourceLayer,p=s.nodeIndex,f=s.tensorIndex;h.assert(0===p,"input layer has >1 nodes"),h.assert(0===f,"input layer has >1 tensors"),r.inputLayers.push(u),r.inputLayersNodeIndices.push(p),r.inputLayersTensorIndices.push(f)}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var y=0;y<r.inputLayers.length;y++){var u=r.inputLayers[y];if(!(u instanceof g.InputLayer))throw new TypeError("Input layers to a Model must be InputLayer objects. "+("Received inputs: "+n.inputs+". ")+("Input "+y+" (0-based) originates ")+("from layer type "+u.getClassName()+"."));r.inputNames.push(u.name),r.feedInputShapes.push(u.batchInputShape),r.feedInputNames.push(u.name)}for(var b=0,_=r.outputLayers;b<_.length;b++){var u=_[b];r.outputNames.push(u.name)}r.internalInputShapes=r.inputs.map(function(t){return t.shape}),r.internalOutputShapes=r.outputs.map(function(t){return t.shape});for(var w={},S={},x={},T={},P={},E=[],A=(function(t,n,i,o,a,s){null!=o&&null!=a&&null!=s||(o=t.sourceLayer,a=t.nodeIndex,s=t.tensorIndex);var u=o.inboundNodes[a];if(i.indexOf(u)!==-1)throw new c.RuntimeError("The tensor "+t.name+' at layer "'+o.name+'" is part of a cycle.');if(n.indexOf(u)===-1){r.containerNodes.add(e.nodeKey(o,a)),o.id in P||(P[o.id]=Object.keys(P).length),i.indexOf(u)===-1&&i.push(u);for(var l=u.inboundLayers.length,p=0;p<l;p++){var h=u.inputTensors[p],f=u.inboundLayers[p],d=u.nodeIndices[p],m=u.tensorIndices[p];A(h,n,i,f,d,m)}for(n.push(u);i.indexOf(u)>=0;)i.splice(i.indexOf(u),1);E.push(u)}}),N=[],O=[],k=0,I=r.outputs;k<I.length;k++){var s=I[k];A(s,N,O)}for(var C=E.slice().reverse(),M=0,R=C;M<R.length;M++){var D=R[M];S[D.id]=D,D.id in w||(w[D.id]=0);var L=w[D.id],F=null==x[D.outboundLayer.id]?0:x[D.outboundLayer.id];L=Math.max(L,F),x[D.outboundLayer.id]=L,T[D.outboundLayer.id]=D.outboundLayer,w[D.id]=L;for(var y=0;y<D.inboundLayers.length;y++){var z=D.inboundLayers[y],p=D.nodeIndices[y],q=z.inboundNodes[p],V=null==w[q.id]?0:w[q.id];w[q.id]=Math.max(L+1,V),S[q.id]=q}}var B={};for(var j in w){var L=w[j];L in B||(B[L]=[]),B[L].push(S[j])}var U={};for(var G in x){var L=x[G];L in U||(U[L]=[]),U[L].push(T[G])}var W=Object.keys(U).map(function(t){return parseInt(t,10)}).sort(h.reverseNumberCompare);r.layers=[];for(var H=0,Q=W;H<Q.length;H++){var L=Q[H],K=U[L];K.sort(function(t,e){var n=P[t.id],r=P[e.id];return n<r?-1:n>r?1:0});for(var Y=0,X=K;Y<X.length;Y++){var u=X[Y];r.layers.push(u)}}r.layersByDepth=U,W=Object.keys(B).map(function(t){return parseInt(t,10)}).sort(h.reverseNumberCompare);for(var $=r.inputs.slice(),J=[],Z=0,tt=W;Z<tt.length;Z++)for(var L=tt[Z],et=0,nt=B[L];et<nt.length;et++){var D=nt[et],u=D.outboundLayer;if(null!=u){for(var rt=0,it=D.inputTensors;rt<it.length;rt++){var s=it[rt];if($.indexOf(s)===-1)throw new c.RuntimeError("Graph disconnected: cannot obtain value for tensor "+s+(' at layer "'+u.name+'". ')+"The following previous layers were accessed without issue: "+J)}for(var ot=0,at=D.outputTensors;ot<at.length;ot++){var s=at[ot];$.push(s)}J.push(u.name)}}r.nodesByDepth=B;for(var st=r.layers.map(function(t){return t.name}),ut=function(t){var e=st.filter(function(e){return e===t}).length;if(1!==e)throw new c.RuntimeError('The name "'+t+'" is used '+e+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(st))},lt=0,ct=st;lt<ct.length;lt++){var pt=ct[lt];ut(pt)}return r.outboundNodes=[],r.inboundNodes=[],new v.Node({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map(function(t){return null}),outputMasks:r.outputs.map(function(t){return null}),inputShapes:r.inputs.map(function(t){return t.shape}),outputShapes:r.outputs.map(function(t){return t.shape})}),r.built=!0,r._refCount=1,r}return s(e,t),e.prototype.assertNotDisposed=function(){if(0===this._refCount)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){this.assertNotDisposed();var t={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount)for(var e=0,n=this.layers;e<n.length;e++){var r=n[e];t.numDisposedVariables+=r.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){if(this._trainableWeights.length>0)throw new c.ValueError("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t=t.concat(r.trainableWeights)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){for(var t=[],e=0,n=this.layers;e<n.length;e++){var r=n[e];t.push.apply(t,r.nonTrainableWeights)}if(!this.trainable){for(var i=[],o=0,a=this.layers;o<a.length;o++){var r=a[o];i.push.apply(i,r.trainableWeights)}return i.concat(t)}return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===r&&(r=!0),n?a(t,this.layers,r):o(t,this.layers,e)},e.prototype.updatedConfig=function(){var t=this.getConfig(),e={className:this.getClassName(),config:t,kerasVersion:"tfjs-layers "+y.version,backend:"TensorFlow.js"};return e},e.prototype.toJSON=function(t,e){void 0===e&&(e=!0);var n=f.convertTsToPythonic(this.updatedConfig());return e?JSON.stringify(n):n},e.prototype.call=function(t,e){var n=this;return u.tidy(function(){t=h.toList(t);var r;return r="mask"in e?h.toList(e.mask):h.pyListRepeat(null,t.length),n.runInternalGraph(t,r)[0]})},e.prototype.computeMask=function(t,e){var n=this;return u.tidy(function(){t=h.toList(t);var r;return r=null==e?h.pyListRepeat(null,t.length):h.toList(e),n.runInternalGraph(t,r)[1]})},e.prototype.computeOutputShape=function(t){var e=d.normalizeShapeList(t);if(e.length!==this.inputLayers.length)throw new c.ValueError("Invalid inputShape argument "+t+": "+("model has "+this.inputLayers.length+" tensor inputs."));for(var n={},r=0;r<e.length;r++){var i=this.inputLayers[r],o=e[r],a=i.name+"_0_0";n[a]=o}var s=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(h.reverseNumberCompare);if(s.length>1)for(var u=0,l=s;u<l.length;u++)for(var p=l[u],f=this.nodesByDepth[p],m=0,y=f;m<y.length;m++){var g=y[m],i=g.outboundLayer;if(this.inputLayers.map(function(t){return t.id}).indexOf(i.id)===-1){for(var v=[],b=0;b<g.inboundLayers.length;b++){var _=g.inboundLayers[b],w=g.nodeIndices[b],S=g.tensorIndices[b],a=_.name+"_"+w+"_"+S,x=n[a];v.push(x)}for(var T=i.computeOutputShape(h.singletonOrArray(v)),P=d.normalizeShapeList(T),E=i.inboundNodes.indexOf(g),b=0;b<P.length;b++){var a=i.name+"_"+E+"_"+b;n[a]=P[b]}}}for(var A=[],N=[],r=0;r<this.outputLayers.length;r++){var i=this.outputLayers[r],E=this.outputLayersNodeIndices[r],S=this.outputLayersTensorIndices[r],a=i.name+"_"+E+"_"+S;N.push(a)}for(var r=0;r<N.length;r++){var O=N[r];h.assert(O in n),A.push(n[O])}return h.singletonOrArray(A)},e.prototype.runInternalGraph=function(t,e){null==e&&(e=h.pyListRepeat(null,t.length));for(var n={},r=0;r<this.inputs.length;++r){var i=this.inputs[r],o=t[r],a=e[r];n[i.id]=[o,a]}for(var s=Object.keys(this.nodesByDepth).map(function(t){return parseInt(t,10)}).sort(h.reverseNumberCompare),u=0,l=s;u<l.length;u++)for(var p=l[u],f=this.nodesByDepth[p],d=0,m=f;d<m.length;d++){for(var y=m[d],g=y.outboundLayer,v=y.inputTensors,b=y.outputTensors,_=new Array,w=0,S=v;w<S.length;w++){var i=S[w];i.id in n&&_.push(n[i.id])}if(_.length===v.length){var x={},T=void 0,P=void 0,E=void 0,A=void 0;if(null!=y.callArgs&&(x=y.callArgs),1===_.length){var N=_[0],O=N[0],k=N[1];null==x.mask&&(x.mask=k),E=h.toList(g.call(O,x)),A=h.toList(g.computeMask(O,k)),T=[O],P=[k]}else T=_.map(function(t){return t[0]}),P=_.map(function(t){return t[1]}),null==x.mask&&(x.mask=P),E=h.toList(g.call(T,x)),A=h.toList(g.computeMask(T,P));if(g.activityRegularizer)throw new c.NotImplementedError("Model invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var r=0;r<b.length;++r){var i=b[r],o=E[r],a=A[r];n[i.id]=[o,a]}}}for(var I=[],C=[],M=[],R=0,D=this.outputs;R<D.length;R++){var i=D[R];h.assert(i.id in n,"Could not compute output "+i.name+" : "+i.id);var L=n[i.id],F=L[0],a=L[1];M.push(F.shape),I.push(F),C.push(a)}return[I,C,M]},e.prototype.buildNodeConversionMap=function(t){for(var n,r={},i=0,o=this.layers;i<o.length;i++){var a=o[i];n=a instanceof e?1:0;for(var s=0;s<a.inboundNodes.length;s++){var u=e.nodeKey(a,s);this.containerNodes.has(u)&&(r[u]=n,n+=1)}}return r},e.prototype.getLayer=function(t,e){if(null!=e){if(this.layers.length<=e)throw new c.ValueError("Was asked to retrieve layer at index "+e+", but model only "+("has "+this.layers.length+" layer(s)."));return this.layers[e]}if(null==t)throw new c.ValueError("Provide either a layer name or layer index");for(var n=0,r=this.layers;n<r.length;n++){var i=r[n];if(i.name===t)return i}throw new c.ValueError("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return u.tidy(function(){for(var n=[],r=0,i=t.layers;r<i.length;r++)for(var o=i[r],a=0;a<o.inboundNodes.length;++a){var s=e.nodeKey(o,a);t.containerNodes.has(s)&&n.push.apply(n,o.calculateLosses())}return n})},e.prototype.getConfig=function(){for(var t={name:this.name},n=this.buildNodeConversionMap(this.layers),r=[],i=0,o=this.layers;i<o.length;i++){for(var a=o[i],s=a.getClassName(),u=a.getConfig(),l=[],c=0;c<a.inboundNodes.length;c++){var p=a.inboundNodes[c],h=e.nodeKey(a,c),f={};if(this.containerNodes.has(h)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch(t){console.warn("Layer "+a.name+" was passed non-serializable keyword arguments: "+(p.callArgs+". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),f={}}if(p.inboundLayers.length>0){for(var d=[],m=0;m<p.inboundLayers.length;m++){var y=p.inboundLayers[m],g=p.nodeIndices[m],v=p.tensorIndices[m],b=e.nodeKey(y,g),_=n[b];null==_&&(_=0),d.push([y.name,_,v,f])}l.push(d)}}}r.push({name:a.name,className:s,config:u,inboundNodes:l})}t.layers=r;for(var w=[],m=0;m<this.inputLayers.length;m++){var a=this.inputLayers[m],g=this.inputLayersNodeIndices[m],h=e.nodeKey(a,g);if(this.containerNodes.has(h)){var _=n[h];null!==_&&void 0!==_||(_=0);var v=this.inputLayersTensorIndices[m];w.push([a.name,_,v])}}t.inputLayers=w;for(var S=[],m=0;m<this.outputLayers.length;m++){var a=this.outputLayers[m],g=this.outputLayersNodeIndices[m],h=e.nodeKey(a,g);if(this.containerNodes.has(h)){var _=n[h];null!==_&&void 0!==_||(_=0);var v=this.outputLayersTensorIndices[m];S.push([a.name,_,v])}}return t.outputLayers=S,t},e.fromConfig=function(t,e){function n(t,e){t.name in a?a[t.name].push(e):a[t.name]=[e]}function r(t,e){for(var r,i=[],a=0,s=e;a<s.length;a++){var u=s[a],l=u[0],p=u[1],f=u[2];if(3===u.length)r={};else{if(4!==u.length)throw new c.ValueError("Improperly formatted model config for layer "+JSON.stringify(t)+": "+JSON.stringify(u));r=u[3]}if(!(l in o))return void n(t,e);var d=o[l];if(d.inboundNodes.length<=p)return void n(t,e);var m=d.inboundNodes[p];i.push(m.outputTensors[f])}i.length>0&&t.apply(h.singletonOrArray(i),r)}function i(t){var r=t.name,i=p.deserialize(t,null!=e.customObjects?e.customObjects:{});o[r]=i;for(var a=t.inboundNodes,s=0,u=a;s<u.length;s++){var l=u[s];if(!(l instanceof Array))throw new c.ValueError("Corrupted configuration, expected array for nodeData: "+l);n(i,l)}}for(var o={},a={},s=e.name,u=e.layers,l=0,f=u;l<f.length;l++){var d=f[l];i(d)}for(;!h.isObjectEmpty(a);)for(var m=0,y=u;m<y.length;m++){var d=y[m],g=o[d.name];if(g.name in a){var v=a[g.name];delete a[g.name];for(var b=0,_=v;b<_.length;b++){var w=_[b];r(g,w)}}}for(var S=[],x=[],T=e.inputLayers,P=0,E=T;P<E.length;P++){var d=E[P],A=d[0],N=d[1],O=d[2];h.assert(A in o);var g=o[A],k=g.inboundNodes[N].outputTensors;S.push(k[O])}for(var I=e.outputLayers,C=0,M=I;C<M.length;C++){var d=M[C],A=d[0],N=d[1],O=d[2];h.assert(A in o);var g=o[A],k=g.inboundNodes[N].outputTensors;x.push(k[O])}return new t({inputs:S,outputs:x,name:s})},Object.defineProperty(e.prototype,"stateful",{get:function(){if(this._stateful)throw new c.ValueError("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(var t=0,e=this.layers;t<e.length;t++){var n=e[t];if(n.stateful)return!0}return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;u.tidy(function(){t.layers.forEach(function(t){t.stateful&&t.resetStates()})})},e}(v.Layer);e.Container=b},function(t,e,n){"use strict";function r(t,e){if(null!=t.shape){if(t.shape.length!==e.shape.length)throw new u.ValueError("The rank of feed ("+e.shape.length+") does not match the rank of "+("the key ("+t.shape.length+")."));for(var n=0;n<t.shape.length;++n)if(null!=t.shape[n]&&t.shape[n]!==e.shape[n])throw new u.ValueError("The "+n+"-th dimension of the feed ("+e.shape[n]+") is "+("incompatible with that of the key ("+t.shape[n]+")."))}if(null==t.dtype||t.dtype===e.dtype)return e;try{return s.cast(e,t.dtype)}catch(n){throw new u.ValueError("The dtype of the feed ("+e.dtype+") can not be cast to the dtype "+("of the key '"+t.name+"' ("+t.dtype+")."))}}function i(t,e,n){for(var r=Array.isArray(t),i=r?t:[t],a=[],s=new c(e),u=0,l=i;u<l.length;u++){var p=l[u];a.push(o(p,s,n))}return r?a:a[0]}function o(t,e,n){if(e.hasKey(t))return e.getValue(t);if(t.sourceLayer instanceof l.InputLayer)throw new u.ValueError("Missing a feed value for SymbolicTensor from InputLayer "+("'"+l.InputLayer.name+"'"));for(var r=t.inputs,i=[],s=0,c=r;s<c.length;s++){var p=c[s],h=o(p,e,n);i.push(h)}var f=t.sourceLayer.apply(i,n);Array.isArray(f)||(f=[f]);for(var d=a(t),m=Array.isArray(d)?d:[d],y=0;y<m.length;++y)e.add(m[y],f[y]);return 1===f.length?f[0]:f[t.outputTensorIndex]}function a(t){var e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{for(var n=null,r=0;r<t.sourceLayer.inboundNodes.length;++r)for(var i=0,o=t.sourceLayer.inboundNodes[r].outputTensors;i<o.length;i++){var a=o[i];if(a.id===t.id){n=r;break}}e=t.sourceLayer.getOutputAt(n)}return e}Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(7),l=n(51),c=function(){function t(e){if(this.id2Value={},e instanceof t)for(var n in e.id2Value)this.id2Value[n]=e.id2Value[n];else{if(null==e)return;for(var r=0,i=e;r<i.length;r++){var o=i[r];this.add(o.key,o.value)}}}return t.prototype.add=function(t,e){if(null!=this.id2Value[t.id])throw new u.ValueError("Duplicate key: name="+t.name+", id="+t.id);return this.id2Value[t.id]=r(t,e),this},t.prototype.addFeed=function(t){this.add(t.key,t.value)},t.prototype.hasKey=function(t){return null!=this.id2Value[t.id]},t.prototype.getValue=function(t){if(null==this.id2Value[t.id])throw new u.ValueError("Nonexistent key: "+JSON.stringify(t));return this.id2Value[t.id]},t}();e.FeedDict=c,e.execute=i},function(t,e,n){"use strict";function r(t,e){if(t.outputs.length>1)throw new d.NotImplementedError("Support for training a model with multiple output tensors with a dataset object is not implemented yet.");p.util.assert(Array.isArray(e)&&2===e.length,"Dataset iterator for fitDataset() is expected to generate an Array of length 2: `[xs, ys]`, but instead generates "+e),e=e;var n=e[1],r=e[0];if(r instanceof p.Tensor)return p.util.assert(1===t.inputs.length,"Model has multiple "+t.inputs.length+" inputs, hence it expects the input dataset to generate a dictionary of tensors "+(" (with keys "+JSON.stringify(t.inputNames)+", ")+"but received a single tensor."),p.util.assert(r.shape[0]===n.shape[0],"Mismatch in batch size between x and y tensors ("+r.shape[0]+" vs. "+(n.shape[0]+")")),[r,n];var i=void 0;r=r;for(var o=[],a=0,s=t.inputNames;a<s.length;a++){var u=s[a];if(null==r[u])throw new d.ValueError("The feature data generated by the dataset lacks the required "+("input key '"+u+"'."));o.push(r[u]),null==i?i=r[u].shape[0]:p.util.assert(r[u].shape[0]===i,"Mismatch in batch size between x and y tensors "+("("+r[u].shape[0]+" vs. "+n.shape[0]+")"))}return o.concat(n)}function i(t){if(3===t.length)throw new d.NotImplementedError("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}function o(t,e,n){return l(this,void 0,void 0,function(){var o,s,u,l,h,d,v,b,_,w,S,x,T,P,E,A,N,O,k,I,C,M,R,D,L,F,M;return c(this,function(c){switch(c.label){case 0:if(o=null!=n.batchesPerEpoch,p.util.assert(null!=t.optimizer,"You must compile a model before training/testing. Use Model.compile(modelCompileConfig)."),p.util.assert(null!=n,"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),p.util.assert(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),"For fitDataset(), config.epochs is expected to be a positive integer, but got "+n.epochs),p.util.assert(!o||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got "+n.batchesPerEpoch),p.util.assert(null==n.validationSplit,"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,c.label=1;case 1:return c.trys.push([1,,21,22]),s=null!=n.validationData,u=void 0,l=void 0,s&&(a(n.validationData)?p.util.assert(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got "+n.validationBatches):(h=i(n.validationData),u=h.xs,l=h.ys)),d=t.makeTrainFunction(),v=t.getDedupedMetricsNames(),b=void 0,b=s?v.slice().concat(v.map(function(t){return"val_"+t})):v.slice(),_=f.standardizeCallbacks(n.callbacks),w=f.configureCallbacks(_,n.yieldEvery,n.verbose,n.epochs,null,null,n.batchesPerEpoch,null,s,b),S=w.callbackList,x=w.history,t.history=x,[4,S.onTrainBegin()];case 2:return c.sent(),T=null==n.initialEpoch?0:n.initialEpoch,P={},[4,e.iterator()];case 3:E=c.sent(),c.label=4;case 4:return T<n.epochs?[4,S.onEpochBegin(T)]:[3,18];case 5:return c.sent(),A=0,N=0,o?[3,7]:[4,e.iterator()];case 6:E=c.sent(),c.label=7;case 7:return!o||A<n.batchesPerEpoch?[4,E.next()]:[3,16];case 8:if(O=c.sent(),o&&O.done)return console.warn("You provided `batchesPerEpoch` as "+(n.batchesPerEpoch+", ")+"but your dataset iterator ran out of data after "+(A+" batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+(n.batchesPerEpoch*n.epochs+" batches). ")+"You may need to use the repeat() function when building your dataset."),[3,16];if(null==O.value)return[3,10];for(k=r(t,O.value),I={},I.batch=N,I.size=k[0].shape[0],S.onBatchBegin(N,I),C=d(k),p.dispose(k),M=0;M<v.length;++M)R=v[M],D=C[M],I[R]=D,p.keep(D);return[4,S.onBatchEnd(N,I)];case 9:c.sent(),m.disposeTensorsInLogs(I),N++,A++,c.label=10;case 10:return(o?A>=n.batchesPerEpoch:O.done)?s?(L=void 0,a(n.validationData)?(F=y.toList,[4,t.evaluateDataset(n.validationData,{batches:n.validationBatches})]):[3,12]):[3,14]:[3,15];case 11:return L=F.apply(void 0,[c.sent()]),[3,13];case 12:L=y.toList(t.evaluate(u,l,{batchSize:null==n.validationBatchSize?g:n.validationBatchSize,verbose:0})),c.label=13;case 13:for(M=0;M<t.metricsNames.length;++M)P["val_"+t.metricsNames[M]]=L[M];c.label=14;case 14:return[3,16];case 15:return t.stopTraining_?[3,16]:[3,7];case 16:return[4,S.onEpochEnd(T,P)];case 17:return c.sent(),T++,t.stopTraining_?[3,18]:[3,4];case 18:return[4,S.onTrainEnd()];case 19:return c.sent(),[4,t.history.syncData()];case 20:return c.sent(),[2,t.history];case 21:return t.isTraining=!1,[7];case 22:return[2]}})})}function a(t){return"function"==typeof t.iterator}function s(t){return"function"==typeof t.next}function u(t,e,n){return l(this,void 0,void 0,function(){var i,o,a,u,l,f,m,g,v,b,_;return c(this,function(w){switch(w.label){case 0:if(i=null!=n.batches,o=t.testFunction,a=[],n.verbose>0)throw new d.NotImplementedError("Verbose mode is not implemented yet.");return p.util.assert(!i||n.batches>0&&Number.isInteger(n.batches),"Test loop expects `batches` to be a positive integer, but received "+JSON.stringify(n.batches)),s(e)?(l=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:l=w.sent(),w.label=3;case 3:u=l,f=0,m=0,g=function(){var e,s,l,d,y,g,d;return c(this,function(c){switch(c.label){case 0:return[4,u.next()];case 1:if(e=c.sent(),e.value){if(s=r(t,e.value),l=p.tidy(function(){return o(s)}),p.dispose(s),0===m)for(d=0;d<l.length;++d)a.push(h.getScalar(0));for(y=s[0].shape[0],g=function(t){var e=l[t],n=a[t];a[t]=p.tidy(function(){return p.add(a[t],p.mul(h.getScalar(y),e))}),m>0&&p.dispose(n)},d=0;d<l.length;++d)g(d);p.dispose(l),f+=y,++m}return e.done?(i&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+("batches (in this case, "+n.batches+" batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},w.label=4;case 4:return!i||m<n.batches?[5,g()]:[3,6];case 5:return v=w.sent(),"break"===v?[3,6]:[3,4];case 6:for(b=function(t){var e=a[t];a[t]=p.tidy(function(){return p.div(a[t],h.getScalar(f))}),p.dispose(e)},_=0;_<a.length;++_)b(_);return[2,y.singletonOrArray(a)]}})})}var l=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},c=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var p=n(1),h=n(8),f=n(50),d=n(7),m=n(94),y=n(10),g=32;e.fitDataset=o,e.evaluateDataset=u},function(t,e,n){"use strict";function r(t){f.util.assert(t>0&&Number.isInteger(t),"batchSize is required to be a positive integer, but got "+t)}function i(t,e,n){return null==t?[null]:Array.isArray(t)?t.map(function(t){return m.sliceAlongFirstAxis(t,e,n-e)}):m.sliceAlongFirstAxis(t,e,n-e)}function o(t,e){return f.tidy(function(){return null==t?null:Array.isArray(t)?t.map(function(t){return o(t,e)}):m.gather(t,"int32"===e.dtype?e:e.toInt())})}function a(t,e){for(var n=[],r=0,i=null;r<t;)i=r+e,i>=t&&(i=t),n.push([r,i]),r=i;return n}function s(t,e,n,r,i,s,u,l,c,_,w,S,x,T,P,E){return p(this,void 0,void 0,function(){var p,A,N,O,k,I,C,M,R;return h(this,function(D){switch(D.label){case 0:if(null==i&&(i=32),null==s&&(s=1),null==w&&(w=!0),null==x&&(x=0),p=!1,null!=c&&null!=_&&(p=!0),null!=P&&(p=!0,null==T))throw new g.ValueError("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return A=t.checkNumSamples(n,i,T,"steps_per_epoch"),null!=A&&(N=b.range(0,A)),null==u&&(u=1),O=y.configureCallbacks(l,E,u,s,x,A,T,i,p,S),k=O.callbackList,I=O.history,k.setModel(t),t.history=I,[4,k.onTrainBegin()];case 1:D.sent(),t.stopTraining_=!1,C=function(s){var u,l,y,b,S,x;return h(this,function(P){switch(P.label){case 0:return[4,k.onEpochBegin(s)];case 1:
if(P.sent(),u={},null==T)return[3,2];throw new g.NotImplementedError("stepsPerEpoch mode is not implemented yet.");case 2:if("batch"===w)throw new g.NotImplementedError("batch shuffling is not implemneted yet");w&&d.util.shuffle(N),l=d.tensor1d(N),y=a(A,i),b=function(a){var s;return h(this,function(h){switch(h.label){case 0:return s={},[4,k.onBatchBegin(a,s)];case 1:return h.sent(),f.tidy(function(){var h=y[a][0],d=y[a][1],g=m.sliceAlongFirstAxis(l,h,d-h);s.batch=a,s.size=d-h;for(var v=o(n,g),b=e(v),w=0;w<r.length;++w){var S=r[w],x=b[w];s[S]=x,f.keep(x)}if(a===y.length-1&&p)for(var T=t.testLoop(c,_,i),w=0;w<r.length;++w){var S=r[w],x=T[w];f.keep(x),u["val_"+S]=x}}),[4,k.onBatchEnd(a,s)];case 2:return h.sent(),v.disposeTensorsInLogs(s),t.stopTraining_?[2,"break"]:[2]}})},S=0,P.label=3;case 3:return S<y.length?[5,b(S)]:[3,6];case 4:if(x=P.sent(),"break"===x)return[3,6];P.label=5;case 5:return++S,[3,3];case 6:l.dispose(),P.label=7;case 7:return[4,k.onEpochEnd(s,u)];case 8:return P.sent(),t.stopTraining_?[2,"break"]:[2]}})},M=x,D.label=2;case 2:return M<s?[5,C(M)]:[3,5];case 3:if(R=D.sent(),"break"===R)return[3,5];D.label=4;case 4:return++M,[3,2];case 5:return[4,k.onTrainEnd()];case 6:return D.sent(),[4,t.history.syncData()];case 7:return D.sent(),[2,t.history]}})})}function u(t,e,n,o){return void 0===o&&(o={}),p(this,void 0,void 0,function(){var a,u,l,p,f,d,m,v,b,_,w,S,x,T,P,E,A,N,O,k;return h(this,function(h){switch(h.label){case 0:if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0,h.label=1;case 1:if(h.trys.push([1,,3,4]),m=null==o.batchSize?32:o.batchSize,r(m),v=t.standardizeUserData(e,n,!1,m),a=v[0],u=v[1],b=!1,_=void 0,null!=o.validationData&&o.validationData.length>0){if(b=!0,2!==o.validationData.length)throw 3===o.validationData.length?new g.NotImplementedError("validationData including sample weights is not supported yet."):new g.ValueError("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+(o.validationData+" is invalid."));l=o.validationData[0],p=o.validationData[1],w=t.standardizeUserData(l,p,!0,m),f=w[0],d=w[1],_=f.concat(d)}else null!=o.validationSplit&&o.validationSplit>0&&o.validationSplit<1?(b=!0,S=Math.floor(a[0].shape[0]*(1-o.validationSplit)),x=a[0].shape[0],f=i(a,S,x),a=i(a,0,S),d=i(u,S,x),u=i(u,0,S),_=f.concat(d)):null!=o.validationSteps&&(b=!0);return T=a.concat(u),t.checkTrainableWeightsConsistency(),P=t.makeTrainFunction(),E=t.getDedupedMetricsNames(),A=void 0,N=void 0,b?(t.makeTestFunction(),A=t.testFunction,N=E.slice().concat(E.map(function(t){return"val_"+t}))):(A=null,_=[],N=E.slice()),O=y.standardizeCallbacks(o.callbacks),[4,s(t,P,T,E,m,o.epochs,o.verbose,O,A,_,o.shuffle,N,o.initialEpoch,null,null,o.yieldEvery)];case 2:return k=h.sent(),t.isTraining=!1,[2,k];case 3:return t.isTraining=!1,c(a,e),c(u,n),c(f,l),c(d,p),[7];case 4:return[2]}})})}function l(t){var e=[];t instanceof d.Tensor&&(t=[t]);for(var n=0;n<t.length;++n){var r=t[n];if(1===r.rank)e.push(m.expandDims(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function c(t,e){if(null!=t){var n=[];if(e instanceof d.Tensor)n.push(e.id);else if(Array.isArray(e))e.forEach(function(t){return n.push(t.id)});else if(null!=e)for(var r in e){var i=e[r];n.push(i.id)}var o=[];if(t instanceof d.Tensor)n.indexOf(t.id)===-1&&o.push(t);else if(Array.isArray(t))t.forEach(function(t){n.indexOf(t.id)===-1&&o.push(t)});else if(null!=t)for(var a in t){var s=t[a];n.indexOf(s.id)===-1&&o.push(s)}o.forEach(function(t){t.isDisposed||t.dispose()})}}var p=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})},h=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,o=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(a=u.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){u.label=n[1];break}if(6===n[0]&&u.label<a[1]){u.label=a[1],a=n;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(n);break}a[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,s,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var f=n(1),d=n(1),m=n(13),y=n(50),g=n(7),v=n(94),b=n(28);e.checkBatchSize=r,e.sliceArrays=i,e.sliceArraysByIndices=o,e.makeBatches=a,e.fitTensors=u,e.ensureTensorsRank2OrHigher=l,e.disposeNewTensors=c},function(t,e,n){"use strict";function r(t){return new s.MaxNorm(t)}function i(t){return new s.UnitNorm(t)}function o(){return new s.NonNeg}function a(t){return new s.MinMaxNorm(t)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(35);e.maxNorm=r,e.unitNorm=i,e.nonNeg=o,e.minMaxNorm=a},function(t,e,n){"use strict";function r(){return new y.Zeros}function i(){return new y.Ones}function o(t){return new y.Constant(t)}function a(t){return new y.RandomUniform(t)}function s(t){return new y.RandomNormal(t)}function u(t){return new y.TruncatedNormal(t)}function l(t){return new y.Identity(t)}function c(t){return new y.VarianceScaling(t)}function p(t){return new y.GlorotUniform(t)}function h(t){return new y.GlorotNormal(t)}function f(t){return new y.HeNormal(t)}function d(t){return new y.LeCunNormal(t)}function m(t){return new y.Orthogonal(t)}Object.defineProperty(e,"__esModule",{value:!0});var y=n(36);e.zeros=r,e.ones=i,e.constant=o,e.randomUniform=a,e.randomNormal=s,e.truncatedNormal=u,e.identity=l,e.varianceScaling=c,e.glorotUniform=p,e.glorotNormal=h,e.heNormal=f,e.leCunNormal=d,e.orthogonal=m},function(t,e,n){"use strict";function r(t){return new et.InputLayer(t)}function i(t){return new it.ELU(t)}function o(t){return new it.ReLU(t)}function a(t){return new it.LeakyReLU(t)}function s(t){return new it.Softmax(t)}function u(t){return new it.ThresholdedReLU(t)}function l(t){return new ot.Conv1D(t)}function c(t){return new ot.Conv2D(t)}function p(t){return new ot.Conv2DTranspose(t)}function h(t){return new ot.SeparableConv2D(t)}function f(t){return new ot.Cropping2D(t)}function d(t){return new ot.UpSampling2D(t)}function m(t){return new at.DepthwiseConv2D(t)}function y(t){return new st.Activation(t)}function g(t){return new st.Dense(t)}function v(t){return new st.Dropout(t)}function b(t){return new st.Flatten(t)}function _(t){return new st.RepeatVector(t)}function w(t){return new st.Reshape(t)}function S(t){return new st.Permute(t)}function x(t){return new ut.Embedding(t)}function T(t){return new lt.Add(t)}function P(t){return new lt.Average(t)}function E(t){return new lt.Concatenate(t)}function A(t){return new lt.Maximum(t)}function N(t){return new lt.Minimum(t)}function O(t){return new lt.Multiply(t)}function k(t){return new lt.Dot(t)}function I(t){return new ct.BatchNormalization(t)}function C(t){return new pt.ZeroPadding2D(t)}function M(t){return new ht.AveragePooling1D(t)}function R(t){return M(t)}function D(t){return M(t)}function L(t){return new ht.AveragePooling2D(t)}function F(t){return L(t)}function z(t){return L(t)}function q(t){return new ht.GlobalAveragePooling1D(t)}function V(t){return new ht.GlobalAveragePooling2D(t)}function B(t){return new ht.GlobalMaxPooling1D(t)}function j(t){return new ht.GlobalMaxPooling2D(t)}function U(t){return new ht.MaxPooling1D(t)}function G(t){return new ht.MaxPooling2D(t)}function W(t){return new ft.GRU(t)}function H(t){return new ft.GRUCell(t)}function Q(t){return new ft.LSTM(t)}function K(t){return new ft.LSTMCell(t)}function Y(t){return new ft.SimpleRNN(t)}function X(t){return new ft.SimpleRNNCell(t)}function $(t){return new ft.RNN(t)}function J(t){return new ft.StackedRNNCells(t)}function Z(t){return new dt.Bidirectional(t)}function tt(t){return new dt.TimeDistributed(t)}Object.defineProperty(e,"__esModule",{value:!0});var et=n(51),nt=n(12);e.Layer=nt.Layer;var rt=n(142);e.input=rt.input;var it=n(333),ot=n(92),at=n(334),st=n(335),ut=n(336),lt=n(337),ct=n(338),pt=n(339),ht=n(340),ft=n(93);e.RNN=ft.RNN,e.RNNCell=ft.RNNCell;var dt=n(341);e.inputLayer=r,e.elu=i,e.reLU=o,e.leakyReLU=a,e.softmax=s,e.thresholdedReLU=u,e.conv1d=l,e.conv2d=c,e.conv2dTranspose=p,e.separableConv2d=h,e.cropping2D=f,e.upSampling2d=d,e.depthwiseConv2d=m,e.activation=y,e.dense=g,e.dropout=v,e.flatten=b,e.repeatVector=_,e.reshape=w,e.permute=S,e.embedding=x,e.add=T,e.average=P,e.concatenate=E,e.maximum=A,e.minimum=N,e.multiply=O,e.dot=k,e.batchNormalization=I,e.zeroPadding2d=C,e.averagePooling1d=M,e.avgPool1d=R,e.avgPooling1d=D,e.averagePooling2d=L,e.avgPool2d=F,e.avgPooling2d=z,e.globalAveragePooling1d=q,e.globalAveragePooling2d=V,e.globalMaxPooling1d=B,e.globalMaxPooling2d=j,e.maxPooling1d=U,e.maxPooling2d=G,e.gru=W,e.gruCell=H,e.lstm=Q,e.lstmCell=K,e.simpleRNN=Y,e.simpleRNNCell=X,e.rnn=$,e.stackedRNNCells=J,e.bidirectional=Z,e.timeDistributed=tt,e.globalMaxPool1d=B,e.globalMaxPool2d=j,e.maxPool1d=U,e.maxPool2d=G},function(t,e,n){"use strict";function r(t,e){return v.binaryAccuracy(t,e)}function i(t,e){return v.binaryCrossentropy(t,e)}function o(t,e){return v.categoricalAccuracy(t,e)}function a(t,e){return v.categoricalCrossentropy(t,e)}function s(t,e){return v.precision(t,e)}function u(t,e){return v.recall(t,e)}function l(t,e){return g.cosineProximity(t,e)}function c(t,e){return g.meanAbsoluteError(t,e)}function p(t,e){return g.meanAbsolutePercentageError(t,e)}function h(t,e){return g.meanAbsolutePercentageError(t,e)}function f(t,e){return g.meanAbsolutePercentageError(t,e)}function d(t,e){return g.meanSquaredError(t,e)}function m(t,e){return g.meanSquaredError(t,e)}function y(t,e){return g.meanSquaredError(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var g=n(52),v=n(144);e.binaryAccuracy=r,e.binaryCrossentropy=i,e.categoricalAccuracy=o,e.categoricalCrossentropy=a,e.precision=s,e.recall=u,e.cosineProximity=l,e.meanAbsoluteError=c,e.meanAbsolutePercentageError=p,e.MAPE=h,e.mape=f,e.meanSquaredError=d,e.MSE=m,e.mse=y},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(95);e.modelFromJSON=r.modelFromJSON},function(t,e,n){"use strict";function r(t){return new s.L1L2(t)}function i(t){return a.l1(t)}function o(t){return a.l2(t)}Object.defineProperty(e,"__esModule",{value:!0});var a=n(30),s=n(30);e.l1l2=r,e.l1=i,e.l2=o},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(61),a=n(13),s=n(12),u=n(8),l=n(7),c=n(16),p=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.supportsMasking=!0,null!=e&&(n.maxValue=e.maxValue),n}return r(e,t),e.prototype.call=function(t,e){t=c.getExactlyOneTensor(t);var n=i.relu(t);return null!=this.maxValue&&(n=i.clipByValue(n,0,this.maxValue)),n},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={maxValue:this.maxValue},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ReLU",e}(s.Layer);e.ReLU=p,i.serialization.registerClass(p);var h=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_ALPHA=.3,null==e&&(e={}),n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return r(e,t),e.prototype.call=function(t,e){var n=c.getExactlyOneTensor(t);return i.leakyRelu(n,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="LeakyReLU",e}(s.Layer);e.LeakyReLU=h,i.serialization.registerClass(h);var f=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;if(n.DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==n.DEFAULT_ALPHA)throw new l.NotImplementedError("Non-default alpha value ("+e.alpha+") is not supported by the ELU layer yet.");return n.alpha=null==e.alpha?n.DEFAULT_ALPHA:e.alpha,n}return r(e,t),e.prototype.call=function(t,e){var n=c.getExactlyOneTensor(t);return i.elu(n)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={alpha:this.alpha},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ELU",e}(s.Layer);e.ELU=f,i.serialization.registerClass(f);var d=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_THETA=1,null==e&&(e={}),n.theta=null==e.theta?n.DEFAULT_THETA:e.theta,n.thetaTensor=u.getScalar(n.theta),n}return r(e,t),e.prototype.call=function(t,e){var n=c.getExactlyOneTensor(t);return n.mul(a.cast(n.greater(this.thetaTensor),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={theta:this.theta},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ThresholdedReLU",e}(s.Layer);e.ThresholdedReLU=d,i.serialization.registerClass(d);var m=function(t){function e(e){var n=t.call(this,null==e?{}:e)||this;return n.DEFAULT_AXIS=1,null==e&&(e={}),n.softmax=(new o.Softmax).apply,n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n}return r(e,t),e.prototype.call=function(t,e){var n=c.getExactlyOneTensor(t);return this.softmax(n,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Softmax",e}(s.Layer);e.Softmax=m,i.serialization.registerClass(m)},function(t,e,n){"use strict";function r(t,e,n,r,i,u){return void 0===n&&(n=[1,1]),void 0===r&&(r="valid"),a.tidy(function(){null==i&&(i=s.imageDataFormat()),l.checkDataFormat(i);var a=y.preprocessConv2DInput(t,i);if(4!==t.rank)throw new p.ValueError("Input for depthwiseConv2d is required to be 4-D, but is instead "+(t.rank+"-D"));if(4!==e.rank)throw new p.ValueError("depthwiseKernel is required to be 4-D, but is instead "+(e.rank+"-D"));return a=o.depthwiseConv2d(a,e,n,"same"===r?"same":"valid","NHWC",u),"channelsFirst"===i&&(a=o.transpose(a,[0,3,1,2])),a})}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(1),s=n(29),u=n(13),l=n(27),c=n(35),p=n(7),h=n(36),f=n(30),d=n(96),m=n(16),y=n(92);e.depthwiseConv2d=r;var g=function(t){function e(e){var n=t.call(this,2,e)||this;return n.depthwiseKernel=null,n.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,n.depthwiseInitializer=h.getInitializer(e.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=c.getConstraint(e.depthwiseConstraint),n.depthwiseRegularizer=f.getRegularizer(e.depthwiseRegularizer),n}return i(e,t),e.prototype.build=function(t){if(t=m.getExactlyOneShape(t),t.length<4)throw new p.ValueError("Inputs to DepthwiseConv2D should have rank 4. "+("Received input shape: "+JSON.stringify(t)+"."));var e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new p.ValueError("The channel dimension of the inputs to DepthwiseConv2D should "+("be defined, but is not ("+t[e]+")."));var n=t[e],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,e){var n=this;return a.tidy(function(){t=m.getExactlyOneTensor(t);var e=r(t,n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(e=u.biasAdd(e,n.bias.read(),n.dataFormat)),null!=n.activation&&(e=n.activation.apply(e)),e})},e.prototype.computeOutputShape=function(t){t=m.getExactlyOneShape(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],r="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=d.convOutputLength(e,this.kernelSize[0],this.padding,this.strides[0]),o=d.convOutputLength(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],r,i,o]:[t[0],i,o,r]},e.prototype.getConfig=function(){var e=t.prototype.getConfig.call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=h.serializeInitializer(this.depthwiseInitializer),e.depthwiseRegularizer=f.serializeRegularizer(this.depthwiseRegularizer),e.depthwiseConstraint=c.serializeConstraint(this.depthwiseRegularizer),e},e.className="DepthwiseConv2D",e}(y.BaseConv);e.DepthwiseConv2D=g,a.serialization.registerClass(g)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(61),a=n(8),s=n(13),u=n(35),l=n(12),c=n(7),p=n(36),h=n(30),f=n(28),d=n(16),m=function(t){function e(e){var n=t.call(this,e)||this;if(n.rate=Math.max(Math.min(e.rate,1),0),n.rateScalar=a.getScalar(n.rate),n.noiseShape=e.noiseShape,n.seed=e.seed,null!=n.seed)throw new c.NotImplementedError("Non-default seed is not implemented in Dropout layer yet: "+n.seed);return n.supportsMasking=!0,n}return r(e,t),e.prototype.getNoiseShape=function(t){if(null==this.noiseShape)return this.noiseShape;for(var e=t.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?e[r]:this.noiseShape[r]);return n},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){n.invokeCallHook(t,e);var r=d.getExactlyOneTensor(t);if(null!=n.noiseShape&&!i.util.arraysEqual(r.shape,n.noiseShape))throw new c.NotImplementedError("Non-default noise shape is not implemented in Dropout layer yet: "+JSON.stringify(n.noiseShape));if(0<n.rate&&n.rate<1){var o=null!=e.training&&e.training,a=n.getNoiseShape(r),u=s.inTrainPhase(function(){return s.dropout(r,n.rateScalar,a,n.seed)},function(){return r},o);return u}return t})},e.prototype.getConfig=function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dropout",e}(l.Layer);e.Dropout=m,i.serialization.registerClass(m);var y=function(t){function e(e){var n=t.call(this,e)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var r=null;null!=e.batchSize&&(r=e.batchSize),n.batchInputShape=[r,e.inputDim]}return n.units=e.units,n.activation=o.getActivation(e.activation),null!=e.useBias&&(n.useBias=e.useBias),n.kernelInitializer=p.getInitializer(e.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=p.getInitializer(e.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=u.getConstraint(e.kernelConstraint),n.biasConstraint=u.getConstraint(e.biasConstraint),n.kernelRegularizer=h.getRegularizer(e.kernelRegularizer),n.biasRegularizer=h.getRegularizer(e.biasRegularizer),n.activityRegularizer=h.getRegularizer(e.activityRegularizer),n.inputSpec=[{minNDim:2}],n}return r(e,t),e.prototype.build=function(t){t=d.getExactlyOneShape(t);var e=t[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=e,n)}],this.built=!0;var n},e.prototype.computeOutputShape=function(t){t=d.getExactlyOneShape(t);var e=t.slice();return e[e.length-1]=this.units,e},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){n.invokeCallHook(t,e);var r=d.getExactlyOneTensor(t),i=s.dot(r,n.kernel.read());return null!=n.bias&&(i=s.biasAdd(i,n.bias.read())),null!=n.activation&&(i=n.activation.apply(i)),i})},e.prototype.getConfig=function(){var e={units:this.units,activation:o.serializeActivation(this.activation),useBias:this.useBias,kernelInitializer:p.serializeInitializer(this.kernelInitializer),biasInitializer:p.serializeInitializer(this.biasInitializer),kernelRegularizer:h.serializeRegularizer(this.kernelRegularizer),biasRegularizer:h.serializeRegularizer(this.biasRegularizer),activityRegularizer:h.serializeRegularizer(this.activityRegularizer),kernelConstraint:u.serializeConstraint(this.kernelConstraint),biasConstraint:u.serializeConstraint(this.biasConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dense",e}(l.Layer);e.Dense=y,i.serialization.registerClass(y);var g=function(t){function e(e){var n=t.call(this,e||{})||this;return n.inputSpec=[{minNDim:3}],n}return r(e,t),e.prototype.computeOutputShape=function(t){t=d.getExactlyOneShape(t);for(var e=0,n=t.slice(1);e<n.length;e++){var r=n[e];if(null==r)throw new c.ValueError('The shape of the input to "Flatten" is not fully defined '+("(got "+t.slice(1)+"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}return[t[0],f.arrayProd(t,1)]},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){return n.invokeCallHook(t,e),s.batchFlatten(d.getExactlyOneTensor(t))})},e.className="Flatten",e}(l.Layer);e.Flatten=g,i.serialization.registerClass(g);var v=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n.activation=o.getActivation(e.activation),n}return r(e,t),e.prototype.call=function(t,e){var n=this;return i.tidy(function(){n.invokeCallHook(t,e);var r=d.getExactlyOneTensor(t);return n.activation.apply(r)})},e.prototype.getConfig=function(){var e={activation:o.serializeActivation(this.activation)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Activation",e}(l.Layer);e.Activation=v,i.serialization.registerClass(v);var b=function(t){function e(e){var n=t.call(this,e)||this;return n.n=e.n,n.inputSpec=[{ndim:2}],n}return r(e,t),e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){return t=d.getExactlyOneTensor(t),s.repeat(t,n.n)})},e.prototype.getConfig=function(){var e={n:this.n},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="RepeatVector",e}(l.Layer);e.RepeatVector=b,i.serialization.registerClass(b);var _=function(t){function e(e){var n=t.call(this,e)||this;n.targetShape=e.targetShape;for(var r=0;r<n.targetShape.length;++r)n.isUnknown(n.targetShape[r])&&(n.targetShape[r]=null);return n}return r(e,t),e.prototype.isUnknown=function(t){return t<0||null==t},e.prototype.fixUnknownDimension=function(t,e){for(var n="Total size of new array must be unchanged.",r=e.slice(),i=1,o=null,a=0;a<r.length;++a){var s=r[a];if(this.isUnknown(s)){if(null!==o)throw new c.ValueError("Can only specifiy one unknown dimension.");o=a}else i*=s}var u=f.arrayProd(t);if(null!==o){if(0===i||u%i!==0)throw new c.ValueError(n);r[o]=u/i}else if(u!==i)throw new c.ValueError(n);return r},e.prototype.computeOutputShape=function(t){for(var e=!1,n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){n.invokeCallHook(t,e);var r=d.getExactlyOneTensor(t),i=r.shape,o=i.slice(0,1).concat(n.fixUnknownDimension(i.slice(1),n.targetShape));return r.reshape(o)})},e.prototype.getConfig=function(){var e={targetShape:this.targetShape},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Reshape",e}(l.Layer);e.Reshape=_,i.serialization.registerClass(_);var w=function(t){function e(e){var n=t.call(this,e)||this;if(null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+(e.dims+" instead."));var r=f.range(1,e.dims.length+1);if(!i.util.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=e.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new l.InputSpec({ndim:n.dims.length+1})],n}return r(e,t),e.prototype.computeOutputShape=function(t){t=d.getExactlyOneShape(t);var e=t.slice();return this.dims.forEach(function(n,r){e[r+1]=t[n]}),e},e.prototype.call=function(t,e){return i.transpose(d.getExactlyOneTensor(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var e={dims:this.dims},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Permute",e}(l.Layer);e.Permute=w,i.serialization.registerClass(w)},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(13),a=n(35),s=n(12),u=n(7),l=n(36),c=n(30),p=n(10),h=n(16),f=function(t){function e(e){var n=t.call(this,e)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var r=null;null!=e.batchSize&&(r=e.batchSize),null==e.inputLength?n.batchInputShape=[r,null]:n.batchInputShape=[r].concat(p.toList(e.inputLength))}return n.inputDim=e.inputDim,n.outputDim=e.outputDim,n.embeddingsInitializer=l.getInitializer(e.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=c.getRegularizer(e.embeddingsRegularizer),n.activityRegularizer=c.getRegularizer(e.activityRegularizer),n.embeddingsConstraint=a.getConstraint(e.embeddingsConstraint),n.maskZero=e.maskZero,n.inputLength=e.inputLength,n}return r(e,t),e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,e){throw new u.NotImplementedError("computeMask has not been implemented for Embedding yet")},e.prototype.computeOutputShape=function(t){if(t=h.getExactlyOneShape(t),null==this.inputLength)return t.concat([this.outputDim]);var e=p.toList(this.inputLength);if(e.length!==t.length-1)throw new u.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);for(var n=0,r=0;r<e.length;++r){var i=e[r],o=t[r+1];if(null!=i&&null!=o&&i!==o)throw new u.ValueError('"inputLength" is '+this.inputLength+", but received input shape has shape "+t);null==i&&(e[n]=o),n++}return[t[0]].concat(e,[this.outputDim])},e.prototype.call=function(t,e){var n=this;return i.tidy(function(){n.invokeCallHook(t,e);var r=h.getExactlyOneTensor(t);"int32"!==r.dtype&&(r=o.cast(r,"int32"));var i=o.gather(n.embeddings.read(),r.as1D());return i.reshape(h.getExactlyOneShape(n.computeOutputShape(r.shape)))})},e.prototype.getConfig=function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:l.serializeInitializer(this.embeddingsInitializer),embeddingsRegularizer:c.serializeRegularizer(this.embeddingsRegularizer),activityRegularizer:c.serializeRegularizer(this.activityRegularizer),embeddingsConstraint:a.serializeConstraint(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Embedding",e}(s.Layer);e.Embedding=f,i.serialization.registerClass(f)},function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){var e=new x({});return e.apply(t)}return new x(t)}function i(t){if(Array.isArray(t)){var e=new T({});return e.apply(t)}return new T(t)}function o(t){if(Array.isArray(t)){var e=new P({});return e.apply(t)}return new P(t)}function a(t){if(Array.isArray(t)){var e=new E({});return e.apply(t)}return new E(t)}function s(t){if(Array.isArray(t)){var e=new A({});return e.apply(t)}return new A(t)}function u(t){if(Array.isArray(t)){var e=new N({});return e.apply(t)}return new N(t)}function l(t,e){for(;t<0;)t+=e;return t}function c(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new g.NotImplementedError("batchDot is not implemented for tensors of 4D or higher rank yet");if(h.util.assert(t.shape.length>=2,"batchDot requires the rank of x to be >= 2, but got "+t.shape.length),h.util.assert(t.shape.length>=2,"batchDot requires the rank of y to be >= 2, but got "+e.shape.length),"number"==typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new g.NotImplementedError("batchDot is not implemented for complex64-type Tensors yet.");var r=t.shape.length,i=e.shape.length;null==n&&(n=[r-1,i-2]);var o=n;return h.tidy(function(){var n;if(r>i){n=r-i;for(var a=[],s=0;s<n;++s)a.push(1);e=e.reshape(e.shape.concat(a))}else if(i>r){n=i-r;for(var a=[],s=0;s<n;++s)a.push(1);t=t.reshape(t.shape.concat(a))}else n=0;var u;if(2===t.shape.length&&2===e.shape.length)u=o[0]===o[1]?t.mulStrict(e).sum(o[0]):t.transpose([1,0]).mulStrict(e).sum(o[1]);else{var l=o[0]!==t.shape.length-1||null,c=o[1]===e.shape.length-1||null;u=t.matMul(e,l,c)}if(n>0){var p=void 0;p=r>i?r+i-3:r-1;for(var h=[],s=p;s<p+n;++s)h.push(s);u=u.squeeze(h)}return 1===u.shape.length&&(u=u.expandDims(1)),u})}var p=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var h=n(1),f=n(1),d=n(8),m=n(13),y=n(12),g=n(7),v=n(52),b=n(10),_=n(28),w=n(16),S=function(t){function e(e){var n=t.call(this,e||{})||this;return n.supportsMasking=!0,n}return p(e,t),e.prototype.mergeFunction=function(t){throw new g.NotImplementedError},e.prototype.computeElementwiseOpOutputShape=function(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;for(var n=t.slice(0,t.length-e.length),r=0;r<e.length;++r){var i=t[t.length-e.length+r],o=e[r];if(null==i||null==o||i<0||o<0)n.push(null);else if(1===i)n.push(o);else if(1===o)n.push(i);else{if(i!==o)throw new g.ValueError("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));
n.push(i)}}return n},e.prototype.build=function(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[w.getExactlyOneShape(t)]),t=t,t.length<2)throw new g.ValueError("A merge layer should be called on an Array of at least 2 inputs."+(" Got "+t.length+" input(s)."));for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];null!=i&&null!==i[0]&&e.push(i[0])}if(e=b.unique(e),e.length>1)throw new g.ValueError("Can not merge tensors with different batch sizes. "+("Got tensors with shapes: "+JSON.stringify(t)+"."));for(var o=null==t[0]?null:t[0].slice(1),a=1;a<t.length;++a){var i=null==t[a]?null:t[a].slice(1);o=this.computeElementwiseOpOutputShape(o,i)}var s=t.map(function(t){return t.length});t.indexOf(null)===-1&&1===b.unique(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,e){var n=this;return f.tidy(function(){if(t=t,n.reshapeRequired){var e=[],r=t.map(function(t){return t.rank});if(r.indexOf(null)===-1){for(var i=_.max(r),o=0,a=t;o<a.length;o++){for(var s=a[o],u=s.rank,l=0;l<i-u;++l)s=m.expandDims(s,1);e.push(s)}return n.mergeFunction(e)}for(var c=!1,p=0,f=t;p<f.length;p++){var s=f[p],u=s.rank;if(null==u){var d=s.shape,y=d[0],g=d.slice(1).concat([y]),v=s.reshape([y].concat(_.arrayProd(d.slice(1))));v=h.transpose(v,[1,0]),v=v.reshape(g),e.push(v),c=!0}else if(u>1){var b=_.range(1,u).concat([0]);e.push(h.transpose(s,b)),c=!0}else e.push(s)}var w=n.mergeFunction(e),S=w.rank;if(c)if(null==S){var x=w.shape,T=x.length,y=x[T-1],g=[y].concat(x.slice(0,x.length-1));w=h.transpose(w.reshape([-1,y]),[1,0]).reshape(g)}else if(S>1){var b=[S-1].concat(_.range(0,S-1));w=h.transpose(w,b)}return w}return n.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){t=t;var e;e=null==t[0]?null:t[0].slice(1);for(var n=1;n<t.length;++n){var r=null==t[n]?null:t[n].slice(1);e=this.computeElementwiseOpOutputShape(e,r)}for(var i=[],o=0,a=t;o<a.length;o++){var r=a[o];null!=r&&null!==r[0]&&i.push(r[0])}return i=b.unique(i),e=1===i.length?i.concat(e):[null].concat(e)},e.prototype.computeMask=function(t,e){throw new g.NotImplementedError("computeMask has not been implemented for Merge yet")},e}(y.Layer);e.Merge=S;var x=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.mergeFunction=function(t){return f.tidy(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=h.add(e,t[n]);return e})},e.className="Add",e}(S);e.Add=x,f.serialization.registerClass(x),e.add=r;var T=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.mergeFunction=function(t){return f.tidy(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=h.mul(e,t[n]);return e})},e.className="Multiply",e}(S);e.Multiply=T,f.serialization.registerClass(T),e.multiply=i;var P=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.mergeFunction=function(t){return f.tidy(function(){for(var e=t[0].clone(),n=1;n<t.length;++n)e=h.add(e,t[n]);return h.mul(d.getScalar(1/t.length),e)})},e.className="Average",e}(S);e.Average=P,f.serialization.registerClass(P),e.average=o;var E=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.mergeFunction=function(t){return f.tidy(function(){for(var e=t[0],n=1;n<t.length;++n)e=h.maximum(e,t[n]);return e})},e.className="Maximum",e}(S);e.Maximum=E,f.serialization.registerClass(E),e.maximum=a;var A=function(t){function e(e){return t.call(this,e)||this}return p(e,t),e.prototype.mergeFunction=function(t){return f.tidy(function(){for(var e=t[0],n=1;n<t.length;++n)e=h.minimum(e,t[n]);return e})},e.className="Minimum",e}(S);e.Minimum=A,f.serialization.registerClass(A),e.minimum=s;var N=function(t){function e(e){var n=t.call(this,e)||this;return n.DEFAULT_AXIS=-1,null==e&&(e={}),n.axis=null==e.axis?n.DEFAULT_AXIS:e.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return p(e,t),e.prototype.build=function(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new g.ValueError("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;for(var e=!0,n=0,r=t;n<r.length;n++){var i=r[n];if(null!=i){e=!1;break}}if(!e){for(var o=[],a=0;a<t.length;++a){var s=t[a].slice();s.splice(this.axis,1);for(var u=!1,l=0,c=o;l<c.length;l++){var i=c[l];if(f.util.arraysEqual(i,s)){u=!0;break}}u||o.push(s)}if(o.length>1)throw new g.ValueError("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var e=this;return f.tidy(function(){return m.concatenate(t,e.axis)})},e.prototype.computeOutputShape=function(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new g.ValueError("A `Concatenate` layer should be called on a list of inputs.");for(var e=t,n=e[0].slice(),r=this.axis<0?n.length+this.axis:this.axis,i=0,o=e.slice(1);i<o.length;i++){var a=o[i];if(null==n[r]||null==a[r]){n[r]=null;break}n[r]+=a[r]}return n},e.prototype.computeMask=function(t,e){throw new g.NotImplementedError("computeMask has not been implemented for Concatenate yet")},e.prototype.getConfig=function(){var e={axis:this.axis},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Concatenate",e}(S);e.Concatenate=N,f.serialization.registerClass(N),e.concatenate=u;var O=function(t){function e(e){var n=t.call(this,e)||this;return n.axes=e.axes,n.normalize=null!=e.normalize&&e.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return p(e,t),e.prototype.build=function(t){h.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),"A `Dot` layer should be called on a list of exactly 2 inputs.");var e=t[0],n=t[1];if(e.length>3||n.length>3)throw new g.NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);if(e[r[0]]!==n[r[1]])throw new g.ValueError("Dimension incompatibility: "+(e[r[0]]+" !== "+n[r[1]]))},e.prototype.mergeFunction=function(t){if(2!==t.length)throw new g.ValueError("A `Dot` layer must be called on exactly 2 inputs, "+("but received "+t.length+" input(s)."));var e,n=t[0],r=t[1];return e=Array.isArray(this.axes)?this.axes.map(function(e,n){return l(e,t[n].shape.length)}):[l(this.axes,n.shape.length),l(this.axes,r.shape.length)],this.normalize&&(n=v.l2Normalize(n,e[0]),r=v.l2Normalize(r,e[1])),c(n,r,e)},e.prototype.interpretAxes=function(t,e){var n;return n=Array.isArray(this.axes)?this.axes:[l(this.axes,t.length),l(this.axes,e.length)]},e.prototype.computeOutputShape=function(t){h.util.assert(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),"A `Dot` layer should be called on a list of exactly 2 inputs.");var e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new g.NotImplementedError("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(e,n);e.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var i=e.concat(n);return 1===i.length&&i.push(1),i},e.prototype.computeMask=function(t,e){throw new g.NotImplementedError("computeMask has not been implemented for Dot yet")},e.prototype.getConfig=function(){var e={axes:this.axes,normalize:this.normalize},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="Dot",e}(S);e.Dot=O,f.serialization.registerClass(O)},function(t,e,n){"use strict";function r(t,e,n,r,i,o){void 0===o&&(o=.001);var a;if(2===t.rank)a=u.batchNormalization2d(t,e,n,o,i,r);else if(3===t.rank)a=u.batchNormalization3d(t,e,n,o,i,r);else{if(4!==t.rank)throw new f.NotImplementedError("batchNormalization is not implemented for array of rank "+t.rank+" yet");a=u.batchNormalization4d(t,e,n,o,i,r)}return a}function i(t,e,n,i,o){return void 0===o&&(o=.001),l.tidy(function(){var a=u.moments(t,i),s=a.mean,l=a.variance,c=r(t,s,l,n,e,o);return[c,s,l]})}function o(t,e,n,i,o){return void 0===o&&(o=.001),l.tidy(function(){for(var a=u.moments(t,i),s=a.mean,l=a.variance,c=[],p=0,h=g.range(0,t.rank);p<h.length;p++){var f=h[p];i.indexOf(f)!==-1?c.push(1):c.push(t.shape[f])}var d=s.reshape(c),m=l.reshape(c),y=null==e?null:e.reshape(c),v=null==n?null:n.reshape(c),b=r(t,d,m,v,y,o);return[b,s,l]})}function a(t,e,n,r,a){return void 0===a&&(a=.001),l.util.arraysEqual(r.slice().sort(),g.range(0,t.rank-1))?i(t,e,n,r,a):o(t,e,n,r,a)}var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var u=n(1),l=n(1),c=n(35),p=n(12),h=n(8),f=n(7),d=n(36),m=n(30),y=n(10),g=n(28),v=n(16);e.batchNormalization=r,e.normalizeBatchInTraining=a;var b=function(t){function e(e){var n=this;return null==e&&(e={}),n=t.call(this,e)||this,n.supportsMasking=!0,n.axis=null==e.axis?-1:e.axis,n.momentum=null==e.momentum?.99:e.momentum,n.epsilon=null==e.epsilon?.001:e.epsilon,n.center=null==e.center||e.center,n.scale=null==e.scale||e.scale,n.betaInitializer=d.getInitializer(e.betaInitializer||"zeros"),n.gammaInitializer=d.getInitializer(e.gammaInitializer||"ones"),n.movingMeanInitializer=d.getInitializer(e.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=d.getInitializer(e.movingVarianceInitializer||"ones"),n.betaConstraint=c.getConstraint(e.betaConstraint),n.gammaConstraint=c.getConstraint(e.gammaConstraint),n.betaRegularizer=m.getRegularizer(e.betaRegularizer),n.gammaRegularizer=m.getRegularizer(e.gammaRegularizer),n.stepCount=0,n}return s(e,t),e.prototype.build=function(t){t=v.getExactlyOneShape(t);var e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new f.ValueError("Axis "+e+" of input tensor should have a defined dimension but the layer received an input with shape "+(JSON.stringify(t)+"."));this.inputSpec=[new p.InputSpec({ndim:t.length,axes:(i={},i[e]=n,i)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0;var i},e.prototype.call=function(t,e){var n=this;return l.tidy(function(){var i=null!=e.training&&e.training,o=v.getExactlyOneTensor(t),s=o.shape,c=s.length,p=g.range(0,c),f=n.axis>=0?n.axis:n.axis+c;p.splice(f,1);var d=y.pyListRepeat(1,c);d[f]=s[f];var m=p.slice();m.sort();var b=!l.util.arraysEqual(m,g.range(0,c).slice(0,c-1)),_=function(){if(b){var t=n.movingMean.read().reshape(d),e=n.movingVariance.read().reshape(d),i=n.center?n.beta.read().reshape(d):null,a=n.scale?n.gamma.read().reshape(d):null;return r(o,t,e,i,a,n.epsilon)}return r(o,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)};if(!i)return _();var w=a(o,n.gamma.read(),n.beta.read(),p,n.epsilon),S=w[0],x=w[1],T=w[2],P=g.arrayProd(p.map(function(t){return o.shape[t]})),E=T.mul(h.getScalar(P/(P-(1+n.epsilon)))),A=function(){n.stepCount++;var t=u.movingAverage(n.movingMean.read(),x,n.momentum,n.stepCount);n.movingMean.write(t);var e=u.movingAverage(n.movingVariance.read(),E,n.momentum,n.stepCount);n.movingVariance.write(e)};return A(),S})},e.prototype.getConfig=function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:d.serializeInitializer(this.betaInitializer),gammaInitializer:d.serializeInitializer(this.gammaInitializer),movingMeanInitializer:d.serializeInitializer(this.movingMeanInitializer),movingVarianceInitializer:d.serializeInitializer(this.movingVarianceInitializer),betaRegularizer:m.serializeRegularizer(this.betaRegularizer),gammaRegularizer:m.serializeRegularizer(this.gammaRegularizer),betaConstraint:c.serializeConstraint(this.betaConstraint),gammaConstraint:c.serializeConstraint(this.gammaConstraint)},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="BatchNormalization",e}(p.Layer);e.BatchNormalization=b,l.serialization.registerClass(b)},function(t,e,n){"use strict";function r(t,e){return s.tidy(function(){if(3!==t.rank)throw new c.ValueError("temporalPadding expects input tensor to be 3-D, but received a "+(t.rank+"-D tensor."));if(null==e&&(e=[1,1]),2!==e.length)throw new c.ValueError("temporalPadding expects input padding pattern to be a length-2 "+("array, but received a length-"+e.length+" array."));var n=[[0,0],e,[0,0]];return a.pad(t,n)})}function i(t,e,n){return s.tidy(function(){if(4!==t.rank)throw new c.ValueError("temporalPadding expects input tensor to be 4-D, but received a "+(t.rank+"-D tensor."));if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new c.ValueError("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n=u.imageDataFormat()),"channelsLast"!==n&&"channelsFirst"!==n)throw new c.ValueError("Unknown data format: "+n+". Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],a.pad(t,r)})}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var a=n(1),s=n(1),u=n(29),l=n(12),c=n(7),p=n(16);e.temporalPadding=r,e.spatial2dPadding=i;var h=function(t){function e(e){var n=this;if(null==e&&(e={}),n=t.call(this,e)||this,n.dataFormat=null==e.dataFormat?u.imageDataFormat():e.dataFormat,null==e.padding)n.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)n.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new c.ValueError("ZeroPadding2D expects padding to be a length-2 array, but "+("received a length-"+e.padding.length+" array."));var r=void 0,i=void 0;if("number"==typeof e.padding[0])r=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new c.ValueError("ZeroPadding2D expects height padding to be a length-2 array, "+("but received a length-"+e.padding[0].length+" array."));if(r=e.padding[0],2!==e.padding[1].length)throw new c.ValueError("ZeroPadding2D expects width padding to be a length-2 array, "+("but received a length-"+e.padding[1].length+" array."));i=e.padding[1]}n.padding=[r,i]}return n.inputSpec=[new l.InputSpec({ndim:4})],n}return o(e,t),e.prototype.computeOutputShape=function(t){t=p.getExactlyOneShape(t);var e,n;return"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])},e.prototype.call=function(t,e){var n=this;return s.tidy(function(){return i(p.getExactlyOneTensor(t),n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={padding:this.padding,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.className="ZeroPadding2D",e}(l.Layer);e.ZeroPadding2D=h,s.serialization.registerClass(h)},function(t,e,n){"use strict";function r(t,e,n,r,i,u){return a.tidy(function(){l.checkDataFormat(i),l.checkPoolMode(u),l.checkPaddingMode(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==i&&(i=s.imageDataFormat()),null==u&&(u="max"),t=m.preprocessConv2DInput(t,i);var a,c="same"===r?"same":"valid";return a="max"===u?o.maxPool(t,e,n,c):o.avgPool(t,e,n,c),"channelsFirst"===i&&(a=o.transpose(a,[0,3,1,2])),a})}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(1),s=n(29),u=n(13),l=n(27),c=n(12),p=n(12),h=n(7),f=n(96),d=n(16),m=n(92);e.pool2d=r;var y=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=2),n=t.call(this,e)||this,"number"==typeof e.poolSize)n.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new h.ValueError("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.poolSize));n.poolSize=e.poolSize}if(null==e.strides)n.strides=n.poolSize;else if("number"==typeof e.strides)n.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new h.ValueError("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+JSON.stringify(e.strides));n.strides=e.strides}return n.padding=null==e.padding?"valid":e.padding,l.checkPaddingMode(n.padding),n.inputSpec=[new c.InputSpec({ndim:3})],n}return i(e,t),e.prototype.computeOutputShape=function(t){t=d.getExactlyOneShape(t);var e=f.convOutputLength(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]},e.prototype.call=function(t,e){var n=this;return a.tidy(function(){n.invokeCallHook(t,e),t=u.expandDims(d.getExactlyOneTensor(t),2);var r=n.poolingFunction(d.getExactlyOneTensor(t),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return o.squeeze(r,[2])})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(p.Layer);e.Pooling1D=y;var g=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(t,e,n,i,o){return l.checkDataFormat(o),l.checkPaddingMode(i),r(t,e,n,i,o,"max")},e.className="MaxPooling1D",e}(y);e.MaxPooling1D=g,a.serialization.registerClass(g);var v=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(t,e,n,i,o){return l.checkDataFormat(o),l.checkPaddingMode(i),r(t,e,n,i,o,"avg")},e.className="AveragePooling1D",e}(y);e.AveragePooling1D=v,a.serialization.registerClass(v);var b=function(t){function e(e){var n=this;if(null==e.poolSize&&(e.poolSize=[2,2]),n=t.call(this,e)||this,n.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)n.strides=n.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new h.ValueError("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+(e.strides.length+"."));n.strides=e.strides}else n.strides=[e.strides,e.strides];return n.padding=null==e.padding?"valid":e.padding,n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,l.checkDataFormat(n.dataFormat),l.checkPaddingMode(n.padding),n.inputSpec=[new c.InputSpec({ndim:4})],n}return i(e,t),e.prototype.computeOutputShape=function(t){t=d.getExactlyOneShape(t);var e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=f.convOutputLength(e,this.poolSize[0],this.padding,this.strides[0]),n=f.convOutputLength(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]},e.prototype.call=function(t,e){var n=this;return a.tidy(function(){return n.invokeCallHook(t,e),n.poolingFunction(d.getExactlyOneTensor(t),n.poolSize,n.strides,n.padding,n.dataFormat)})},e.prototype.getConfig=function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(p.Layer);e.Pooling2D=b;var _=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(t,e,n,i,o){return l.checkDataFormat(o),l.checkPaddingMode(i),r(t,e,n,i,o,"max")},e.className="MaxPooling2D",e}(b);e.MaxPooling2D=_,a.serialization.registerClass(_);var w=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.poolingFunction=function(t,e,n,i,o){return l.checkDataFormat(o),l.checkPaddingMode(i),r(t,e,n,i,o,"avg")},e.className="AveragePooling2D",e}(b);e.AveragePooling2D=w,a.serialization.registerClass(w);var S=function(t){function e(e){var n=t.call(this,e)||this;return n.inputSpec=[new c.InputSpec({ndim:3})],n}return i(e,t),e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,e){throw new h.NotImplementedError},e}(p.Layer);e.GlobalPooling1D=S;var x=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.call=function(t,e){return a.tidy(function(){var e=d.getExactlyOneTensor(t);return o.mean(e,1)})},e.className="GlobalAveragePooling1D",e}(S);e.GlobalAveragePooling1D=x,a.serialization.registerClass(x);var T=function(t){function e(e){return t.call(this,e)||this}return i(e,t),e.prototype.call=function(t,e){return a.tidy(function(){var e=d.getExactlyOneTensor(t);return o.max(e,1)})},e.className="GlobalMaxPooling1D",e}(S);e.GlobalMaxPooling1D=T,a.serialization.registerClass(T);var P=function(t){function e(e){var n=t.call(this,e)||this;return n.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,l.checkDataFormat(n.dataFormat),n.inputSpec=[new c.InputSpec({ndim:4})],n}return i(e,t),e.prototype.computeOutputShape=function(t){return t=t,"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,e){throw new h.NotImplementedError},e.prototype.getConfig=function(){var e={dataFormat:this.dataFormat},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e}(p.Layer);e.GlobalPooling2D=P;var E=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.call=function(t,e){var n=this;return a.tidy(function(){var e=d.getExactlyOneTensor(t);return"channelsLast"===n.dataFormat?o.mean(e,[1,2]):o.mean(e,[2,3])})},e.className="GlobalAveragePooling2D",e}(P);e.GlobalAveragePooling2D=E,a.serialization.registerClass(E);var A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.call=function(t,e){var n=this;return a.tidy(function(){var e=d.getExactlyOneTensor(t);return"channelsLast"===n.dataFormat?o.max(e,[1,2]):o.max(e,[2,3])})},e.className="GlobalMaxPooling2D",e}(P);e.GlobalMaxPooling2D=A,a.serialization.registerClass(A)},function(t,e,n){"use strict";function r(t){h.checkStringTypeUnionValue(e.VALID_BIDIRECTIONAL_MERGE_MODES,"BidirectionalMergeMode",t)}var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),a=n(1),s=n(8),u=n(13),l=n(27),c=n(12),p=n(7),h=n(10),f=n(16),d=n(93),m=n(63),y=function(t){function e(e){var n=t.call(this,e)||this;return n.layer=e.layer,n}return i(e,t),e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return null!=this.layer&&this.layer.trainable},set:function(t){null!=this.layer&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e,n){void 0===n&&(n={});var r=e.layer,i=m.deserialize(r,n);delete e.layer;var o={layer:i};return Object.assign(o,e),new t(o)},e}(c.Layer);e.Wrapper=y;var g=function(t){function e(e){var n=t.call(this,e)||this;return n.supportsMasking=!0,n}return i(e,t),e.prototype.build=function(e){if(e=f.getExactlyOneShape(e),e.length<3)throw new p.ValueError("TimeDistributed layer expects an input shape >= 3D, but received input shape "+JSON.stringify(e));this.inputSpec=[{shape:e}];var n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),t.prototype.build.call(this,e)},e.prototype.computeOutputShape=function(t){t=f.getExactlyOneShape(t);var e=[t[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),r=t[1];return[n[0],r].concat(n.slice(1))},e.prototype.call=function(t,e){var n=this;return a.tidy(function(){t=f.getExactlyOneTensor(t);var r=function(t,r){var i=f.getExactlyOneTensor(n.layer.call(t,e));return[i,[]]},i=d.rnn(r,t,[],!1,null,null,!1,!0),o=i[1];return o})},e.className="TimeDistributed",e}(y);e.TimeDistributed=g,a.serialization.registerClass(g),e.VALID_BIDIRECTIONAL_MERGE_MODES=["sum","mul","concat","ave"],e.checkBidirectionalMergeMode=r;var v=function(t){function e(e){var n=t.call(this,e)||this,i=e.layer.getConfig();if(n.forwardLayer=m.deserialize({className:e.layer.getClassName(),config:i}),i.goBackwards=i.goBackwards!==!0,n.backwardLayer=m.deserialize({className:e.layer.getClassName(),config:i}),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,r(e.mergeMode),n.mergeMode=e.mergeMode,e.weights)throw new p.NotImplementedError("weights support is not implemented for Bidirectional layer yet.");return n._stateful=e.layer.stateful,n.returnSequences=e.layer.returnSequences,n.returnState=e.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=e.layer.inputSpec,n.numConstants=null,n}return i(e,t),Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))},e.prototype.computeOutputShape=function(t){var e=this.forwardLayer.computeOutputShape(t);Array.isArray(e)&&Array.isArray(e[0])||(e=[e]),e=e;var n,r,i;return this.returnState?(i=e.slice(1),n=e[0]):n=e[0],n=n,"concat"===this.mergeMode?(n[n.length-1]*=2,r=[n]):r=null==this.mergeMode?[n,n.slice()]:[n],this.returnState?null==this.mergeMode?r.concat(i).concat(i.slice()):[n].concat(i).concat(i.slice()):h.singletonOrArray(r)},e.prototype.apply=function(e,n){var r=null==n?null:n.initialState,i=null==n?null:n.constants;null==n&&(n={});var o=d.standardizeArgs(e,r,i,this.numConstants);if(e=o.inputs,r=o.initialState,i=o.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==i)return t.prototype.apply.call(this,e,n);var a=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new p.ValueError("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=r,a.push.apply(a,r);var l=r.map(function(t){return new c.InputSpec({shape:t.shape})});this.forwardLayer.stateSpec=l.slice(0,u/2),this.backwardLayer.stateSpec=l.slice(u/2),s.push.apply(s,l)}if(null!=i)throw new p.NotImplementedError("Support for constants in Bidirectional layers is not implemented yet.");for(var h=a[0]instanceof c.SymbolicTensor,f=0,m=a;f<m.length;f++){var y=m[f];if(y instanceof c.SymbolicTensor!==h)throw new p.ValueError("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(h){var g=[e].concat(a),v=this.inputSpec.concat(s),b=this.inputSpec;this.inputSpec=v;var _=t.prototype.apply.call(this,g,n);return this.inputSpec=b,_}return t.prototype.apply.call(this,e,n)},e.prototype.call=function(t,e){var n=this;return a.tidy(function(){if(null!=e.mask)throw new p.NotImplementedError("The support for masking is not implemented for Bidirectional layers yet.");var r,i,a=e.initialState;if(null==a)r=n.forwardLayer.call(t,e),i=n.backwardLayer.call(t,e);else{var l=a.slice(0,a.length/2),c=a.slice(a.length/2);r=n.forwardLayer.call(t,Object.assign(e,{initialState:l})),i=n.backwardLayer.call(t,Object.assign(e,{initialState:c}))}var h;n.returnState&&(Array.isArray(r)&&(h=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),n.returnSequences&&(i=o.reverse(i,1));var f;return"concat"===n.mergeMode?f=u.concatenate([r,i]):"sum"===n.mergeMode?f=o.add(r,i):"ave"===n.mergeMode?f=o.mul(s.getScalar(.5),o.add(r,i)):"mul"===n.mergeMode?f=o.mul(r,i):null==n.mergeMode&&(f=[r,i]),n.returnState?null==n.mergeMode?f.concat(h):[f].concat(h):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var e=this;l.nameScope(this.forwardLayer.name,function(){e.forwardLayer.build(t)}),l.nameScope(this.backwardLayer.name,function(){e.backwardLayer.build(t)}),this.built=!0},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var e={mergeMode:this.mergeMode},n=t.prototype.getConfig.call(this);return Object.assign(e,n),e},e.fromConfig=function(t,e){var n=m.deserialize(e.layer);if(delete e.layer,null!=e.numConstants)throw new p.NotImplementedError("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=e;return r.layer=n,new t(r)},e.className="Bidirectional",e}(y);e.Bidirectional=v,a.serialization.registerClass(v)},function(t,e,n){"use strict";function r(t){var e={Adagrad:function(){return i.train.adagrad(.01)},Adadelta:function(){return i.train.adadelta(1,.95,o.epsilon())},Adam:function(){return i.train.adam(.001,.9,.999,o.epsilon())},Adamax:function(){return i.train.adamax(.002,.9,.999,o.epsilon(),0)},RMSProp:function(){return i.train.rmsprop(.001,.9,0,o.epsilon())},SGD:function(){return i.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new a.ValueError("Unknown Optimizer "+t)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),o=n(29),a=n(7);e.getOptimizer=r},function(t,e,n){"use strict";function r(t,e,n,r){void 0===r&&(r=console.log);var c=o(t),p=["Layer (type)","Output shape","Param #"];c?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map(function(t){return Math.floor(e*t)}));var h;if(!c){p.push("Receives inputs"),h=[];for(var f in t.nodesByDepth)h.push.apply(h,t.nodesByDepth[f])}r("_".repeat(e)),a(p,n,r),r("=".repeat(e));for(var d=t.layers,m=0;m<d.length;++m)c?s(d[m],n,r):u(d[m],n,h,r),r((m===d.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();
var y=i(t),g=l.countParamsInWeights(t.nonTrainableWeights);r("Total params: "+(y+g)),r("Trainable params: "+y),r("Non-trainable params: "+g),r("_".repeat(e))}function i(t){var e;return e=null!=t.collectedTrainableWeights?l.countParamsInWeights(t.collectedTrainableWeights):l.countParamsInWeights(t.trainableWeights)}function o(t){var e=!0,n=[],r=[];for(var i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(var o=0,a=n;o<a.length;o++){var s=a[o];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){e=!1;break}r.push.apply(r,s)}if(e)for(var u=0,l=t.layers;u<l.length;u++){for(var c=l[u],p=!1,h=0,f=c.inboundNodes;h<f.length;h++){var d=f[h];if(r.indexOf(d)!==-1){if(p){e=!1;break}p=!0}}if(!e)break}return e}function a(t,e,n){void 0===n&&(n=console.log);for(var r="",i=0;i<t.length;++i)i>0&&(r=r.slice(0,r.length-1)+" "),r+=t[i],r=r.slice(0,e[i]),r+=" ".repeat(e[i]-r.length);n(r)}function s(t,e,n){var r;try{r=JSON.stringify(t.outputShape)}catch(t){r="multiple"}var i=t.name,o=t.getClassName(),s=[i+" ("+o+")",r,t.countParams().toString()];a(s,e,n)}function u(t,e,n,r){var i;try{i=JSON.stringify(t.outputShape)}catch(t){i="multiple"}for(var o=[],s=0,u=t.inboundNodes;s<u.length;s++){var l=u[s];if(!(null!=n&&n.length>0&&n.indexOf(l)===-1))for(var c=0;c<l.inboundLayers.length;++c){var p=l.inboundLayers[c].name,h=l.nodeIndices[c],f=l.tensorIndices[c];o.push(p+"["+h+"]["+f+"]")}}var d=t.name,m=t.getClassName(),y=0===o.length?"":o[0],g=[d+" ("+m+")",i,t.countParams().toString(),y];a(g,e,r);for(var c=1;c<o.length;++c)a(["","","",o[c]],e,r)}Object.defineProperty(e,"__esModule",{value:!0});var l=n(146);e.printSummary=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n="0.13.5";e.version=n},function(t,e){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");n===-1&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function r(t){var e=n(t),r=e[0],i=e[1];return 3*(r+i)/4-i}function i(t,e,n){return 3*(e+n)/4-n}function o(t){for(var e,r=n(t),o=r[0],a=r[1],s=new p(i(t,o,a)),u=0,l=a>0?o-4:o,h=0;h<l;h+=4)e=c[t.charCodeAt(h)]<<18|c[t.charCodeAt(h+1)]<<12|c[t.charCodeAt(h+2)]<<6|c[t.charCodeAt(h+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;return 2===a&&(e=c[t.charCodeAt(h)]<<2|c[t.charCodeAt(h+1)]>>4,s[u++]=255&e),1===a&&(e=c[t.charCodeAt(h)]<<10|c[t.charCodeAt(h+1)]<<4|c[t.charCodeAt(h+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e),s}function a(t){return l[t>>18&63]+l[t>>12&63]+l[t>>6&63]+l[63&t]}function s(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(a(r));return i.join("")}function u(t){for(var e,n=t.length,r=n%3,i=[],o=16383,a=0,u=n-r;a<u;a+=o)i.push(s(t,a,a+o>u?u:a+o));return 1===r?(e=t[n-1],i.push(l[e>>2]+l[e<<4&63]+"==")):2===r&&(e=(t[n-2]<<8)+t[n-1],i.push(l[e>>10]+l[e>>4&63]+l[e<<2&63]+"=")),i.join("")}e.byteLength=r,e.toByteArray=o,e.fromByteArray=u;for(var l=[],c=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,d=h.length;f<d;++f)l[f]=h[f],c[h.charCodeAt(f)]=f;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(t,e,n){e=t.exports=n(65)(),e.push([t.id,'@font-face{font-family:icons;src:url("https://gweb-musiclab-site.appspot.com/static/fonts/icons/icons.eot");src:url("https://gweb-musiclab-site.appspot.com/static/fonts/icons/icons.eot?#iefix") format("eot"),url("https://gweb-musiclab-site.appspot.com/static/fonts/icons/icons.woff") format("woff"),url("https://gweb-musiclab-site.appspot.com/static/fonts/icons/icons.ttf") format("truetype"),url("https://gweb-musiclab-site.appspot.com/static/fonts/icons/icons.svg#icons") format("svg")}.icon-svg_808:before,.icon-svg_back_arrow:before,.icon-svg_bird:before,.icon-svg_close-button:before,.icon-svg_computer:before,.icon-svg_facebook:before,.icon-svg_fast_man:before,.icon-svg_flute:before,.icon-svg_frowny_face:before,.icon-svg_go_arrow:before,.icon-svg_gplus:before,.icon-svg_hamburger_menu:before,.icon-svg_hand:before,.icon-svg_harp:before,.icon-svg_horn:before,.icon-svg_left_arrow:before,.icon-svg_man:before,.icon-svg_metronome:before,.icon-svg_no_record:before,.icon-svg_pause:before,.icon-svg_piano:before,.icon-svg_play:before,.icon-svg_record:before,.icon-svg_right_arrow:before,.icon-svg_rotate_phone:before,.icon-svg_slow_man:before,.icon-svg_twitter:before,.icon-svg_wave_form:before,.icon-svg_wine_glass:before{font-family:icons;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-style:normal;font-variant:normal;font-weight:400;text-decoration:none;text-transform:none}.icon-svg_808:before{content:"\\E001"}.icon-svg_back_arrow:before{content:"\\E002"}.icon-svg_bird:before{content:"\\E003"}.icon-svg_close-button:before{content:"\\E004"}.icon-svg_computer:before{content:"\\E005"}.icon-svg_facebook:before{content:"\\E006"}.icon-svg_fast_man:before{content:"\\E007"}.icon-svg_flute:before{content:"\\E008"}.icon-svg_frowny_face:before{content:"\\E009"}.icon-svg_go_arrow:before{content:"\\E00A"}.icon-svg_gplus:before{content:"\\E00B"}.icon-svg_hamburger_menu:before{content:"\\E00C"}.icon-svg_hand:before{content:"\\E00D"}.icon-svg_harp:before{content:"\\E00E"}.icon-svg_horn:before{content:"\\E00F"}.icon-svg_left_arrow:before{content:"\\E010"}.icon-svg_man:before{content:"\\E011"}.icon-svg_metronome:before{content:"\\E012"}.icon-svg_no_record:before{content:"\\E013"}.icon-svg_pause:before{content:"\\E014"}.icon-svg_piano:before{content:"\\E015"}.icon-svg_play:before{content:"\\E016"}.icon-svg_record:before{content:"\\E017"}.icon-svg_right_arrow:before{content:"\\E018"}.icon-svg_rotate_phone:before{content:"\\E019"}.icon-svg_slow_man:before{content:"\\E01A"}.icon-svg_twitter:before{content:"\\E01B"}.icon-svg_wave_form:before{content:"\\E01C"}.icon-svg_wine_glass:before{content:"\\E01D"}#Bottom{height:100px;width:100%;position:absolute;bottom:0;left:0;background-color:#f2f2f2;box-shadow:inset 0 10px 10px -10px rgba(0,0,0,.4)}#Bottom #Controls{max-width:500px;width:100%;position:relative;margin-left:auto;margin-right:auto;height:100%}#Bottom #Controls .Button{position:absolute;bottom:20px;width:60px;height:60px;line-height:60px;text-align:center;border-radius:50%;cursor:pointer;box-shadow:0 0 3px 1px rgba(0,0,0,.2);transition:transform .05s}#Bottom #Controls .Button:active{transform:scale(1.1)}#Bottom #Controls #PlayButton{left:15px;background-color:#16a8f0;font-size:60px;color:#fff}#Bottom #Controls #MLButton.passive{left:90px;background-color:#fff;font-size:60px;color:grey}#Bottom #Controls #MLButton.active{left:90px;background-color:#ffc234;font-size:60px;color:#fff}#Bottom #Controls #Harmony{position:absolute;left:165px;background-color:#fff;background-image:url('+n(391)+");background-size:100% 100%}#Bottom #Controls #Harmony.right{background-image:url("+n(392)+");background-color:#ffc234;background-size:100% 100%}#Bottom #Controls #SliderContainer{width:calc(100% - 310px);position:absolute;right:35px;top:40%}#Bottom #Controls #SliderContainer .Slider #Handle,#Bottom #Controls #SliderContainer .Slider #Rail #Fill{background-color:#16a8f0}#Bottom #Controls #SliderContainer #manual-tempo{background:none;border:none;color:#16a8f0;display:block;font-size:21px;margin:0;position:absolute;right:-93px;text-decoration:none;top:-4px;width:57px}@media screen and (max-width:767px){#Bottom #Controls #SliderContainer #manual-tempo{display:none}}#Bottom #Controls #SliderContainer #Hare,#Bottom #Controls #SliderContainer #Tortoise{top:-20px;position:absolute;height:60px;width:15px;font-size:60px;line-height:60px;pointer-events:none;color:#646464}#Bottom #Controls #SliderContainer #Hare{right:0}#Bottom #Controls #SliderContainer #Tortoise{left:-43px}",""])},function(t,e,n){e=t.exports=n(65)(),e.push([t.id,"#Grid{height:calc(100% - 100px)}#Grid,#Grid canvas{width:100%;position:absolute;top:0;left:0}#Grid canvas{height:100%;cursor:pointer}",""])},function(t,e,n){e=t.exports=n(65)(),e.push([t.id,"@import url(https://fonts.googleapis.com/css?family=Poppins);",""]),e.push([t.id,"body,html{width:100%;height:100%;position:fixed;top:0;left:0;margin:0;overflow:hidden;-webkit-touch-callout:none;-webkit-tap-highlight-color:transparent;font-family:Poppins,sans-serif}body #iOSTap,html #iOSTap{width:100%;height:100%;top:0;left:0;position:absolute;background-color:#fff;z-index:100000}",""])},function(t,e,n){e=t.exports=n(65)(),e.push([t.id,".Slider{height:28px;top:-5px;cursor:pointer}.Slider,.Slider #Rail{width:100%;position:absolute}.Slider #Rail{background-color:#ccc;height:8px;left:0;top:50%;margin-top:-4px;pointer-events:none;border-radius:4px}.Slider #Rail #Fill{border-top-left-radius:4px;border-bottom-left-radius:4px;left:0;width:50%;height:100%}.Slider #Handle,.Slider #Rail #Fill{position:absolute;top:0;background-color:#16a8f0}.Slider #Handle{left:50%;border-radius:14px;width:28px;height:28px;pointer-events:none}.Slider #Range{width:100%;margin:0;height:28px;position:absolute;top:0;left:0;opacity:0;cursor:pointer}",""])},function(t,e,n){"use strict";function r(t,e,n){var r,i,o=t.length,a=e.arrayArgs.length,s=e.indexArgs.length>0,u=[],l=[],c=0,p=0;for(r=0;r<o;++r)l.push(["i",r,"=0"].join(""));for(i=0;i<a;++i)for(r=0;r<o;++r)p=c,c=t[r],0===r?l.push(["d",i,"s",r,"=t",i,"p",c].join("")):l.push(["d",i,"s",r,"=(t",i,"p",c,"-s",p,"*t",i,"p",p,")"].join(""));for(l.length>0&&u.push("var "+l.join(",")),r=o-1;r>=0;--r)c=t[r],u.push(["for(i",r,"=0;i",r,"<s",c,";++i",r,"){"].join(""));for(u.push(n),r=0;r<o;++r){for(p=c,c=t[r],i=0;i<a;++i)u.push(["p",i,"+=d",i,"s",r].join(""));s&&(r>0&&u.push(["index[",p,"]-=s",p].join("")),u.push(["++index[",c,"]"].join(""))),u.push("}")}return u.join("\n")}function i(t,e,n,i){for(var o=e.length,a=n.arrayArgs.length,s=n.blockSize,u=n.indexArgs.length>0,l=[],c=0;c<a;++c)l.push(["var offset",c,"=p",c].join(""));for(var c=t;c<o;++c)l.push(["for(var j"+c+"=SS[",e[c],"]|0;j",c,">0;){"].join("")),l.push(["if(j",c,"<",s,"){"].join("")),l.push(["s",e[c],"=j",c].join("")),l.push(["j",c,"=0"].join("")),l.push(["}else{s",e[c],"=",s].join("")),l.push(["j",c,"-=",s,"}"].join("")),u&&l.push(["index[",e[c],"]=j",c].join(""));for(var c=0;c<a;++c){for(var p=["offset"+c],h=t;h<o;++h)p.push(["j",h,"*t",c,"p",e[h]].join(""));l.push(["p",c,"=(",p.join("+"),")"].join(""))}l.push(r(e,n,i));for(var c=t;c<o;++c)l.push("}");return l.join("\n")}function o(t){for(var e=0,n=t[0].length;e<n;){for(var r=1;r<t.length;++r)if(t[r][e]!==t[0][e])return e;++e}return e}function a(t,e,n){for(var r=t.body,i=[],o=[],a=0;a<t.args.length;++a){var s=t.args[a];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),l="",c=e.arrayArgs.indexOf(a);switch(e.argTypes[a]){case"offset":var p=e.offsetArgIndex.indexOf(a),h=e.offsetArgs[p];c=h.array,l="+q"+p;case"array":l="p"+c+l;var f="l"+a,d="a"+c;if(0===e.arrayBlockIndices[c])1===s.count?"generic"===n[c]?s.lvalue?(i.push(["var ",f,"=",d,".get(",l,")"].join("")),r=r.replace(u,f),o.push([d,".set(",l,",",f,")"].join(""))):r=r.replace(u,[d,".get(",l,")"].join("")):r=r.replace(u,[d,"[",l,"]"].join("")):"generic"===n[c]?(i.push(["var ",f,"=",d,".get(",l,")"].join("")),r=r.replace(u,f),s.lvalue&&o.push([d,".set(",l,",",f,")"].join(""))):(i.push(["var ",f,"=",d,"[",l,"]"].join("")),r=r.replace(u,f),s.lvalue&&o.push([d,"[",l,"]=",f].join("")));else{for(var m=[s.name],y=[l],g=0;g<Math.abs(e.arrayBlockIndices[c]);g++)m.push("\\s*\\[([^\\]]+)\\]"),y.push("$"+(g+1)+"*t"+c+"b"+g);if(u=new RegExp(m.join(""),"g"),l=y.join("+"),"generic"===n[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[d,"[",l,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+e.scalarArgs.indexOf(a));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[i.join("\n"),r,o.join("\n")].join("\n").trim()}function s(t){for(var e=new Array(t.length),n=!0,r=0;r<t.length;++r){var i=t[r],o=i.match(/\d+/);o=o?o[0]:"",0===i.charAt(0)?e[r]="u"+i.charAt(1)+o:e[r]=i.charAt(0)+o,r>0&&(n=n&&e[r]===e[r-1])}return n?e[0]:e.join("")}function u(t,e){for(var n=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,u=new Array(t.arrayArgs.length),c=new Array(t.arrayArgs.length),p=0;p<t.arrayArgs.length;++p)c[p]=e[2*p],u[p]=e[2*p+1];for(var h=[],f=[],d=[],m=[],y=[],p=0;p<t.arrayArgs.length;++p){t.arrayBlockIndices[p]<0?(d.push(0),m.push(n),h.push(n),f.push(n+t.arrayBlockIndices[p])):(d.push(t.arrayBlockIndices[p]),m.push(t.arrayBlockIndices[p]+n),h.push(0),f.push(t.arrayBlockIndices[p]));for(var g=[],v=0;v<u[p].length;v++)d[p]<=u[p][v]&&u[p][v]<m[p]&&g.push(u[p][v]-d[p]);y.push(g)}for(var b=["SS"],_=["'use strict'"],w=[],v=0;v<n;++v)w.push(["s",v,"=SS[",v,"]"].join(""));for(var p=0;p<t.arrayArgs.length;++p){b.push("a"+p),b.push("t"+p),b.push("p"+p);for(var v=0;v<n;++v)w.push(["t",p,"p",v,"=t",p,"[",d[p]+v,"]"].join(""));for(var v=0;v<Math.abs(t.arrayBlockIndices[p]);++v)w.push(["t",p,"b",v,"=t",p,"[",h[p]+v,"]"].join(""))}for(var p=0;p<t.scalarArgs.length;++p)b.push("Y"+p);if(t.shapeArgs.length>0&&w.push("shape=SS.slice(0)"),t.indexArgs.length>0){for(var S=new Array(n),p=0;p<n;++p)S[p]="0";w.push(["index=[",S.join(","),"]"].join(""))}for(var p=0;p<t.offsetArgs.length;++p){for(var x=t.offsetArgs[p],T=[],v=0;v<x.offset.length;++v)0!==x.offset[v]&&(1===x.offset[v]?T.push(["t",x.array,"p",v].join("")):T.push([x.offset[v],"*t",x.array,"p",v].join("")));0===T.length?w.push("q"+p+"=0"):w.push(["q",p,"=",T.join("+")].join(""))}var P=l([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));w=w.concat(P),w.length>0&&_.push("var "+w.join(","));for(var p=0;p<t.arrayArgs.length;++p)_.push("p"+p+"|=0");t.pre.body.length>3&&_.push(a(t.pre,t,c));var E=a(t.body,t,c),A=o(y);A<n?_.push(i(A,y[0],t,E)):_.push(r(y[0],t,E)),t.post.body.length>3&&_.push(a(t.post,t,c)),t.debug&&console.log("-----Generated cwise routine for ",e,":\n"+_.join("\n")+"\n----------");var N=[t.funcName||"unnamed","_cwise_loop_",u[0].join("s"),"m",A,s(c)].join(""),O=new Function(["function ",N,"(",b.join(","),"){",_.join("\n"),"} return ",N].join(""));return O()}var l=n(157);t.exports=u},function(t,e,n){"use strict";function r(t){var e=["'use strict'","var CACHED={}"],n=[],r=t.funcName+"_cwise_thunk";e.push(["return function ",r,"(",t.shimArgs.join(","),"){"].join(""));for(var o=[],a=[],s=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],u=[],l=[],c=0;c<t.arrayArgs.length;++c){var p=t.arrayArgs[c];n.push(["t",p,"=array",p,".dtype,","r",p,"=array",p,".order"].join("")),o.push("t"+p),o.push("r"+p),a.push("t"+p),a.push("r"+p+".join()"),s.push("array"+p+".data"),s.push("array"+p+".stride"),s.push("array"+p+".offset|0"),c>0&&(u.push("array"+t.arrayArgs[0]+".shape.length===array"+p+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[c]))),l.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+p+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[c])+"]"))}t.arrayArgs.length>1&&(e.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex-->0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}"));for(var c=0;c<t.scalarArgs.length;++c)s.push("scalar"+t.scalarArgs[c]);n.push(["type=[",a.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),e.push("var "+n.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",o.join(","),"])}","return proc(",s.join(","),")}"].join("")),t.debug&&console.log("-----Generated thunk:\n"+e.join("\n")+"\n----------");var h=new Function("compile",e.join("\n"));return h(i.bind(void 0,t))}var i=n(350);t.exports=r},function(t,e,n){(function(e){"use strict";function r(t,e,n){this.name=t,this.lvalue=e,this.rvalue=n,this.count=0}function i(t,e,n,r){this.body=t,this.args=e,this.thisVars=n,this.localVars=r}function o(t){if("eval"===t)throw new Error("cwise-parser: eval() not allowed");return"undefined"!=typeof window?t in window:"undefined"!=typeof e?t in e:"undefined"!=typeof self&&t in self}function a(t){for(var e=t.body[0].expression.callee.params,n=new Array(e.length),r=0;r<e.length;++r)n[r]=e[r].name;return n}function s(t){function e(t){var e=y+t.replace(/\_/g,"__");return S.push(e),e}function n(t){var e="this_"+t.replace(/\_/g,"__");return x.push(e),e}function s(t,e){for(var n=t.range[0],r=t.range[1],i=n+1;i<r;++i)_[i]="";_[n]=e}function p(t){return"'"+t.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'"}function h(t){return _.slice(t.range[0],t.range[1]).join("")}function f(t){return"AssignmentExpression"===t.parent.type&&t.parent.left===t?"="===t.parent.operator?T:T|P:"UpdateExpression"===t.parent.type?T|P:P}for(var d=["(",t,")()"].join(""),m=u.parse(d,{range:!0}),y="_inline_"+c++ +"_",g=a(m),v=new Array(g.length),b=0;b<g.length;++b)v[b]=new r([y,"arg",b,"_"].join(""),!1,!1);for(var _=new Array(d.length),b=0,w=d.length;b<w;++b)_[b]=d.charAt(b);var S=[],x=[],T=1,P=2;!function t(r,i){if(r.parent=i,"MemberExpression"===r.type)r.computed?(t(r.object,r),t(r.property,r)):"ThisExpression"===r.object.type?s(r,n(r.property.name)):t(r.object,r);else{if("ThisExpression"===r.type)throw new Error("cwise-parser: Computed this is not allowed");if("Identifier"===r.type){var a=r.name,u=g.indexOf(a);if(u>=0){var l=v[u],c=f(r);c&T&&(l.lvalue=!0),c&P&&(l.rvalue=!0),++l.count,s(r,l.name)}else o(a)||s(r,e(a))}else if("Literal"===r.type)"string"==typeof r.value&&s(r,p(r.value));else{if("WithStatement"===r.type)throw new Error("cwise-parser: with() statements not allowed");for(var h=Object.keys(r),d=0,m=h.length;d<m;++d)if("parent"!==h[d]){var y=r[h[d]];if(y)if(y instanceof Array)for(var b=0;b<y.length;++b)y[b]&&"string"==typeof y[b].type&&t(y[b],r);else"string"==typeof y.type&&t(y,r)}}}}(m.body[0].expression.callee.body,void 0),l(S),l(x);var E=new i(h(m.body[0].expression.callee.body),v,x,S);return E}var u=n(353),l=n(157),c=0;t.exports=s}).call(e,function(){return this}())},function(t,e,n){var r,i,o;!function(n,a){"use strict";i=[e],r=a,o="function"==typeof r?r.apply(e,i):r,!(void 0!==o&&(t.exports=o))}(this,function(t){"use strict";function e(t,e){if(!t)throw new Error("ASSERT: "+e)}function n(t){return t>=48&&t<=57}function r(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function i(t){return"01234567".indexOf(t)>=0}function o(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function a(t){return 10===t||13===t||8232===t||8233===t}function s(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||92===t||t>=128&&oe.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function u(t){return 36===t||95===t||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||92===t||t>=128&&oe.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function l(t){switch(t){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function c(t){switch(t){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function p(t){return"eval"===t||"arguments"===t}function h(t){if(ue&&c(t))return!0;switch(t.length){case 2:return"if"===t||"in"===t||"do"===t;case 3:return"var"===t||"for"===t||"new"===t||"try"===t||"let"===t;case 4:return"this"===t||"else"===t||"case"===t||"void"===t||"with"===t||"enum"===t;case 5:return"while"===t||"break"===t||"catch"===t||"throw"===t||"const"===t||"yield"===t||"class"===t||"super"===t;case 6:return"return"===t||"typeof"===t||"delete"===t||"switch"===t||"export"===t||"import"===t;case 7:return"default"===t||"finally"===t||"extends"===t;case 8:return"function"===t||"continue"===t||"debugger"===t;case 10:return"instanceof"===t;default:return!1}}function f(t,n,r,i,o){var a;e("number"==typeof r,"Comment must have valid position"),me.lastCommentStart>=r||(me.lastCommentStart=r,a={type:t,value:n},ye.range&&(a.range=[r,i]),ye.loc&&(a.loc=o),ye.comments.push(a),ye.attachComment&&(ye.leadingComments.push(a),ye.trailingComments.push(a)))}function d(t){var e,n,r,i;for(e=le-t,n={start:{line:ce,column:le-pe-t}};le<he;)if(r=se.charCodeAt(le),++le,a(r))return ye.comments&&(i=se.slice(e+t,le-1),n.end={line:ce,column:le-pe-1},f("Line",i,e,le-1,n)),13===r&&10===se.charCodeAt(le)&&++le,++ce,void(pe=le);ye.comments&&(i=se.slice(e+t,le),n.end={line:ce,column:le-pe},f("Line",i,e,le,n))}function m(){var t,e,n,r;for(ye.comments&&(t=le-2,e={start:{line:ce,column:le-pe-2}});le<he;)if(n=se.charCodeAt(le),a(n))13===n&&10===se.charCodeAt(le+1)&&++le,++ce,++le,pe=le,le>=he&&B({},ie.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===se.charCodeAt(le+1))return++le,++le,void(ye.comments&&(r=se.slice(t+2,le-2),e.end={line:ce,column:le-pe},f("Block",r,t,le,e)));++le}else++le;B({},ie.UnexpectedToken,"ILLEGAL")}function y(){var t,e;for(e=0===le;le<he;)if(t=se.charCodeAt(le),o(t))++le;else if(a(t))++le,13===t&&10===se.charCodeAt(le)&&++le,++ce,pe=le,e=!0;else if(47===t)if(t=se.charCodeAt(le+1),47===t)++le,++le,d(2),e=!0;else{if(42!==t)break;++le,++le,m()}else if(e&&45===t){if(45!==se.charCodeAt(le+1)||62!==se.charCodeAt(le+2))break;le+=3,d(3)}else{if(60!==t)break;if("!--"!==se.slice(le+1,le+4))break;++le,++le,++le,++le,d(4)}}function g(t){var e,n,i,o=0;for(n="u"===t?4:2,e=0;e<n;++e){if(!(le<he&&r(se[le])))return"";i=se[le++],o=16*o+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(o)}function v(){var t,e;for(t=se.charCodeAt(le++),e=String.fromCharCode(t),92===t&&(117!==se.charCodeAt(le)&&B({},ie.UnexpectedToken,"ILLEGAL"),++le,t=g("u"),t&&"\\"!==t&&s(t.charCodeAt(0))||B({},ie.UnexpectedToken,"ILLEGAL"),e=t);le<he&&(t=se.charCodeAt(le),u(t));)++le,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==se.charCodeAt(le)&&B({},ie.UnexpectedToken,"ILLEGAL"),++le,t=g("u"),t&&"\\"!==t&&u(t.charCodeAt(0))||B({},ie.UnexpectedToken,"ILLEGAL"),e+=t);return e}function b(){var t,e;for(t=le++;le<he;){if(e=se.charCodeAt(le),92===e)return le=t,v();if(!u(e))break;++le}return se.slice(t,le)}function _(){var t,e,n;return t=le,e=92===se.charCodeAt(le)?v():b(),n=1===e.length?Zt.Identifier:h(e)?Zt.Keyword:"null"===e?Zt.NullLiteral:"true"===e||"false"===e?Zt.BooleanLiteral:Zt.Identifier,{type:n,value:e,lineNumber:ce,lineStart:pe,start:t,end:le}}function w(){var t,e,n,r,i=le,o=se.charCodeAt(le),a=se[le];switch(o){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++le,ye.tokenize&&(40===o?ye.openParenToken=ye.tokens.length:123===o&&(ye.openCurlyToken=ye.tokens.length)),{type:Zt.Punctuator,value:String.fromCharCode(o),lineNumber:ce,lineStart:pe,start:i,end:le};default:if(t=se.charCodeAt(le+1),61===t)switch(o){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return le+=2,{type:Zt.Punctuator,value:String.fromCharCode(o)+String.fromCharCode(t),lineNumber:ce,lineStart:pe,start:i,end:le};case 33:case 61:return le+=2,61===se.charCodeAt(le)&&++le,{type:Zt.Punctuator,value:se.slice(i,le),lineNumber:ce,lineStart:pe,start:i,end:le}}}return r=se.substr(le,4),">>>="===r?(le+=4,{type:Zt.Punctuator,value:r,lineNumber:ce,lineStart:pe,start:i,end:le}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(le+=3,{type:Zt.Punctuator,value:n,lineNumber:ce,lineStart:pe,start:i,end:le}):(e=n.substr(0,2),a===e[1]&&"+-<>&|".indexOf(a)>=0||"=>"===e?(le+=2,{type:Zt.Punctuator,value:e,lineNumber:ce,lineStart:pe,start:i,end:le}):"<>=!+-*%&|^/".indexOf(a)>=0?(++le,{type:Zt.Punctuator,value:a,lineNumber:ce,lineStart:pe,start:i,end:le}):void B({},ie.UnexpectedToken,"ILLEGAL")))}function S(t){for(var e="";le<he&&r(se[le]);)e+=se[le++];return 0===e.length&&B({},ie.UnexpectedToken,"ILLEGAL"),s(se.charCodeAt(le))&&B({},ie.UnexpectedToken,"ILLEGAL"),{type:Zt.NumericLiteral,value:parseInt("0x"+e,16),lineNumber:ce,lineStart:pe,start:t,end:le}}function x(t){for(var e="0"+se[le++];le<he&&i(se[le]);)e+=se[le++];return(s(se.charCodeAt(le))||n(se.charCodeAt(le)))&&B({},ie.UnexpectedToken,"ILLEGAL"),{type:Zt.NumericLiteral,value:parseInt(e,8),octal:!0,lineNumber:ce,lineStart:pe,start:t,end:le}}function T(){var t,e;for(t=le+1;t<he;++t){if(e=se[t],"8"===e||"9"===e)return!1;if(!i(e))return!0}return!0}function P(){var t,r,o;if(o=se[le],e(n(o.charCodeAt(0))||"."===o,"Numeric literal must start with a decimal digit or a decimal point"),r=le,t="","."!==o){if(t=se[le++],o=se[le],"0"===t){if("x"===o||"X"===o)return++le,S(r);if(i(o)&&T())return x(r)}for(;n(se.charCodeAt(le));)t+=se[le++];o=se[le]}if("."===o){for(t+=se[le++];n(se.charCodeAt(le));)t+=se[le++];o=se[le]}if("e"===o||"E"===o)if(t+=se[le++],o=se[le],"+"!==o&&"-"!==o||(t+=se[le++]),n(se.charCodeAt(le)))for(;n(se.charCodeAt(le));)t+=se[le++];else B({},ie.UnexpectedToken,"ILLEGAL");return s(se.charCodeAt(le))&&B({},ie.UnexpectedToken,"ILLEGAL"),{type:Zt.NumericLiteral,value:parseFloat(t),lineNumber:ce,lineStart:pe,start:r,end:le}}function E(){var t,n,r,o,s,u,l,c,p="",h=!1;for(l=ce,c=pe,t=se[le],e("'"===t||'"'===t,"String literal must starts with a quote"),n=le,++le;le<he;){if(r=se[le++],r===t){t="";break}if("\\"===r)if(r=se[le++],r&&a(r.charCodeAt(0)))++ce,"\r"===r&&"\n"===se[le]&&++le,pe=le;else switch(r){case"u":case"x":u=le,s=g(r),s?p+=s:(le=u,p+=r);break;case"n":p+="\n";break;case"r":p+="\r";break;case"t":p+="\t";break;case"b":p+="\b";break;case"f":p+="\f";break;case"v":p+="\v";break;default:i(r)?(o="01234567".indexOf(r),0!==o&&(h=!0),le<he&&i(se[le])&&(h=!0,o=8*o+"01234567".indexOf(se[le++]),"0123".indexOf(r)>=0&&le<he&&i(se[le])&&(o=8*o+"01234567".indexOf(se[le++]))),p+=String.fromCharCode(o)):p+=r}else{if(a(r.charCodeAt(0)))break;p+=r}}return""!==t&&B({},ie.UnexpectedToken,"ILLEGAL"),{type:Zt.StringLiteral,value:p,octal:h,startLineNumber:l,startLineStart:c,lineNumber:ce,lineStart:pe,start:n,end:le}}function A(t,e){var n;try{n=new RegExp(t,e)}catch(t){B({},ie.InvalidRegExp)}return n}function N(){var t,n,r,i,o;for(t=se[le],e("/"===t,"Regular expression literal must start with a slash"),n=se[le++],r=!1,i=!1;le<he;)if(t=se[le++],n+=t,"\\"===t)t=se[le++],a(t.charCodeAt(0))&&B({},ie.UnterminatedRegExp),n+=t;else if(a(t.charCodeAt(0)))B({},ie.UnterminatedRegExp);else if(r)"]"===t&&(r=!1);else{if("/"===t){i=!0;break}"["===t&&(r=!0)}return i||B({},ie.UnterminatedRegExp),o=n.substr(1,n.length-2),{value:o,literal:n}}function O(){var t,e,n,r;for(e="",n="";le<he&&(t=se[le],u(t.charCodeAt(0)));)if(++le,"\\"===t&&le<he)if(t=se[le],"u"===t){if(++le,r=le,t=g("u"))for(n+=t,e+="\\u";r<le;++r)e+=se[r];else le=r,n+="u",e+="\\u";j({},ie.UnexpectedToken,"ILLEGAL")}else e+="\\",j({},ie.UnexpectedToken,"ILLEGAL");else n+=t,e+=t;return{value:n,literal:e}}function k(){var t,e,n,r;return de=null,y(),t=le,e=N(),n=O(),r=A(e.value,n.value),ye.tokenize?{type:Zt.RegularExpression,value:r,lineNumber:ce,lineStart:pe,start:t,end:le}:{literal:e.literal+n.literal,value:r,start:t,end:le}}function I(){var t,e,n,r;return y(),t=le,e={start:{line:ce,column:le-pe}},n=k(),e.end={line:ce,column:le-pe},ye.tokenize||(ye.tokens.length>0&&(r=ye.tokens[ye.tokens.length-1],r.range[0]===t&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||ye.tokens.pop())),ye.tokens.push({type:"RegularExpression",value:n.literal,range:[t,le],loc:e})),n}function C(t){return t.type===Zt.Identifier||t.type===Zt.Keyword||t.type===Zt.BooleanLiteral||t.type===Zt.NullLiteral}function M(){var t,e;if(t=ye.tokens[ye.tokens.length-1],!t)return I();if("Punctuator"===t.type){if("]"===t.value)return w();if(")"===t.value)return e=ye.tokens[ye.openParenToken-1],!e||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?w():I();if("}"===t.value){if(ye.tokens[ye.openCurlyToken-3]&&"Keyword"===ye.tokens[ye.openCurlyToken-3].type){if(e=ye.tokens[ye.openCurlyToken-4],!e)return w()}else{if(!ye.tokens[ye.openCurlyToken-4]||"Keyword"!==ye.tokens[ye.openCurlyToken-4].type)return w();if(e=ye.tokens[ye.openCurlyToken-5],!e)return I()}return ee.indexOf(e.value)>=0?w():I()}return I()}return"Keyword"===t.type&&"this"!==t.value?I():w()}function R(){var t;return y(),le>=he?{type:Zt.EOF,lineNumber:ce,lineStart:pe,start:le,end:le}:(t=se.charCodeAt(le),s(t)?_():40===t||41===t||59===t?w():39===t||34===t?E():46===t?n(se.charCodeAt(le+1))?P():w():n(t)?P():ye.tokenize&&47===t?M():w())}function D(){var t,e,n;return y(),t={start:{line:ce,column:le-pe}},e=R(),t.end={line:ce,column:le-pe},e.type!==Zt.EOF&&(n=se.slice(e.start,e.end),ye.tokens.push({type:te[e.type],value:n,range:[e.start,e.end],loc:t})),e}function L(){var t;return t=de,le=t.end,ce=t.lineNumber,pe=t.lineStart,de="undefined"!=typeof ye.tokens?D():R(),le=t.end,ce=t.lineNumber,pe=t.lineStart,t}function F(){var t,e,n;t=le,e=ce,n=pe,de="undefined"!=typeof ye.tokens?D():R(),le=t,ce=e,pe=n}function z(t,e){this.line=t,this.column=e}function q(t,e,n,r){this.start=new z(t,e),this.end=new z(n,r)}function V(){var t,e,n,r;return t=le,e=ce,n=pe,y(),r=ce!==e,le=t,ce=e,pe=n,r}function B(t,n){var r,i=Array.prototype.slice.call(arguments,2),o=n.replace(/%(\d)/g,function(t,n){return e(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof t.lineNumber?(r=new Error("Line "+t.lineNumber+": "+o),r.index=t.start,r.lineNumber=t.lineNumber,r.column=t.start-pe+1):(r=new Error("Line "+ce+": "+o),r.index=le,r.lineNumber=ce,r.column=le-pe+1),r.description=o,r}function j(){try{B.apply(null,arguments)}catch(t){if(!ye.errors)throw t;ye.errors.push(t)}}function U(t){if(t.type===Zt.EOF&&B(t,ie.UnexpectedEOS),t.type===Zt.NumericLiteral&&B(t,ie.UnexpectedNumber),t.type===Zt.StringLiteral&&B(t,ie.UnexpectedString),t.type===Zt.Identifier&&B(t,ie.UnexpectedIdentifier),t.type===Zt.Keyword){if(l(t.value))B(t,ie.UnexpectedReserved);else if(ue&&c(t.value))return void j(t,ie.StrictReservedWord);B(t,ie.UnexpectedToken,t.value)}B(t,ie.UnexpectedToken,t.value)}function G(t){var e=L();e.type===Zt.Punctuator&&e.value===t||U(e)}function W(t){var e=L();e.type===Zt.Keyword&&e.value===t||U(e)}function H(t){return de.type===Zt.Punctuator&&de.value===t}function Q(t){return de.type===Zt.Keyword&&de.value===t}function K(){var t;return de.type===Zt.Punctuator&&(t=de.value,"="===t||"*="===t||"/="===t||"%="===t||"+="===t||"-="===t||"<<="===t||">>="===t||">>>="===t||"&="===t||"^="===t||"|="===t)}function Y(){var t,e=le,n=ce,r=pe,i=de;return 59===se.charCodeAt(le)||H(";")?void L():(t=ce,y(),ce!==t?(le=e,ce=n,pe=r,void(de=i)):void(de.type===Zt.EOF||H("}")||U(de)))}function X(t){return t.type===ne.Identifier||t.type===ne.MemberExpression}function $(){var t,e=[];for(t=de,G("[");!H("]");)H(",")?(L(),e.push(null)):(e.push(yt()),H("]")||G(","));return L(),fe.markEnd(fe.createArrayExpression(e),t)}function J(t,e){var n,r,i;return n=ue,i=de,r=Ut(),e&&ue&&p(t[0].name)&&j(e,ie.StrictParamName),ue=n,fe.markEnd(fe.createFunctionExpression(null,t,[],r),i)}function Z(){var t,e;return e=de,t=L(),t.type===Zt.StringLiteral||t.type===Zt.NumericLiteral?(ue&&t.octal&&j(t,ie.StrictOctalLiteral),fe.markEnd(fe.createLiteral(t),e)):fe.markEnd(fe.createIdentifier(t.value),e)}function tt(){var t,e,n,r,i,o;return t=de,o=de,t.type===Zt.Identifier?(n=Z(),"get"!==t.value||H(":")?"set"!==t.value||H(":")?(G(":"),r=yt(),fe.markEnd(fe.createProperty("init",n,r),o)):(e=Z(),G("("),t=de,t.type!==Zt.Identifier?(G(")"),j(t,ie.UnexpectedToken,t.value),r=J([])):(i=[_t()],G(")"),r=J(i,t)),fe.markEnd(fe.createProperty("set",e,r),o)):(e=Z(),G("("),G(")"),r=J([]),fe.markEnd(fe.createProperty("get",e,r),o))):t.type!==Zt.EOF&&t.type!==Zt.Punctuator?(e=Z(),G(":"),r=yt(),fe.markEnd(fe.createProperty("init",e,r),o)):void U(t)}function et(){var t,e,n,r,i,o=[],a={},s=String;for(i=de,G("{");!H("}");)t=tt(),e=t.key.type===ne.Identifier?t.key.name:s(t.key.value),r="init"===t.kind?re.Data:"get"===t.kind?re.Get:re.Set,n="$"+e,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===re.Data?ue&&r===re.Data?j({},ie.StrictDuplicateProperty):r!==re.Data&&j({},ie.AccessorDataProperty):r===re.Data?j({},ie.AccessorDataProperty):a[n]&r&&j({},ie.AccessorGetSet),
a[n]|=r):a[n]=r,o.push(t),H("}")||G(",");return G("}"),fe.markEnd(fe.createObjectExpression(o),i)}function nt(){var t;return G("("),t=gt(),G(")"),t}function rt(){var t,e,n,r;if(H("("))return nt();if(H("["))return $();if(H("{"))return et();if(t=de.type,r=de,t===Zt.Identifier)n=fe.createIdentifier(L().value);else if(t===Zt.StringLiteral||t===Zt.NumericLiteral)ue&&de.octal&&j(de,ie.StrictOctalLiteral),n=fe.createLiteral(L());else if(t===Zt.Keyword){if(Q("function"))return Ht();Q("this")?(L(),n=fe.createThisExpression()):U(L())}else t===Zt.BooleanLiteral?(e=L(),e.value="true"===e.value,n=fe.createLiteral(e)):t===Zt.NullLiteral?(e=L(),e.value=null,n=fe.createLiteral(e)):H("/")||H("/=")?(n="undefined"!=typeof ye.tokens?fe.createLiteral(I()):fe.createLiteral(k()),F()):U(L());return fe.markEnd(n,r)}function it(){var t=[];if(G("("),!H(")"))for(;le<he&&(t.push(yt()),!H(")"));)G(",");return G(")"),t}function ot(){var t,e;return e=de,t=L(),C(t)||U(t),fe.markEnd(fe.createIdentifier(t.value),e)}function at(){return G("."),ot()}function st(){var t;return G("["),t=gt(),G("]"),t}function ut(){var t,e,n;return n=de,W("new"),t=ct(),e=H("(")?it():[],fe.markEnd(fe.createNewExpression(t,e),n)}function lt(){var t,e,n,r,i=me.allowIn;for(r=de,me.allowIn=!0,t=Q("new")?ut():rt();;){if(H("."))n=at(),t=fe.createMemberExpression(".",t,n);else if(H("("))e=it(),t=fe.createCallExpression(t,e);else{if(!H("["))break;n=st(),t=fe.createMemberExpression("[",t,n)}fe.markEnd(t,r)}return me.allowIn=i,t}function ct(){var t,n,r;for(e(me.allowIn,"callee of new expression always allow in keyword."),r=de,t=Q("new")?ut():rt();H(".")||H("[");)H("[")?(n=st(),t=fe.createMemberExpression("[",t,n)):(n=at(),t=fe.createMemberExpression(".",t,n)),fe.markEnd(t,r);return t}function pt(){var t,e,n=de;return t=lt(),de.type===Zt.Punctuator&&(!H("++")&&!H("--")||V()||(ue&&t.type===ne.Identifier&&p(t.name)&&j({},ie.StrictLHSPostfix),X(t)||j({},ie.InvalidLHSInAssignment),e=L(),t=fe.markEnd(fe.createPostfixExpression(e.value,t),n))),t}function ht(){var t,e,n;return de.type!==Zt.Punctuator&&de.type!==Zt.Keyword?e=pt():H("++")||H("--")?(n=de,t=L(),e=ht(),ue&&e.type===ne.Identifier&&p(e.name)&&j({},ie.StrictLHSPrefix),X(e)||j({},ie.InvalidLHSInAssignment),e=fe.createUnaryExpression(t.value,e),e=fe.markEnd(e,n)):H("+")||H("-")||H("~")||H("!")?(n=de,t=L(),e=ht(),e=fe.createUnaryExpression(t.value,e),e=fe.markEnd(e,n)):Q("delete")||Q("void")||Q("typeof")?(n=de,t=L(),e=ht(),e=fe.createUnaryExpression(t.value,e),e=fe.markEnd(e,n),ue&&"delete"===e.operator&&e.argument.type===ne.Identifier&&j({},ie.StrictDelete)):e=pt(),e}function ft(t,e){var n=0;if(t.type!==Zt.Punctuator&&t.type!==Zt.Keyword)return 0;switch(t.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=e?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function dt(){var t,e,n,r,i,o,a,s,u,l;if(t=de,u=ht(),r=de,i=ft(r,me.allowIn),0===i)return u;for(r.prec=i,L(),e=[t,de],a=ht(),o=[u,r,a];(i=ft(de,me.allowIn))>0;){for(;o.length>2&&i<=o[o.length-2].prec;)a=o.pop(),s=o.pop().value,u=o.pop(),n=fe.createBinaryExpression(s,u,a),e.pop(),t=e[e.length-1],fe.markEnd(n,t),o.push(n);r=L(),r.prec=i,o.push(r),e.push(de),n=ht(),o.push(n)}for(l=o.length-1,n=o[l],e.pop();l>1;)n=fe.createBinaryExpression(o[l-1].value,o[l-2],n),l-=2,t=e.pop(),fe.markEnd(n,t);return n}function mt(){var t,e,n,r,i;return i=de,t=dt(),H("?")&&(L(),e=me.allowIn,me.allowIn=!0,n=yt(),me.allowIn=e,G(":"),r=yt(),t=fe.createConditionalExpression(t,n,r),fe.markEnd(t,i)),t}function yt(){var t,e,n,r,i;return t=de,i=de,r=e=mt(),K()&&(X(e)||j({},ie.InvalidLHSInAssignment),ue&&e.type===ne.Identifier&&p(e.name)&&j(t,ie.StrictLHSAssignment),t=L(),n=yt(),r=fe.markEnd(fe.createAssignmentExpression(t.value,e,n),i)),r}function gt(){var t,e=de;if(t=yt(),H(",")){for(t=fe.createSequenceExpression([t]);le<he&&H(",");)L(),t.expressions.push(yt());fe.markEnd(t,e)}return t}function vt(){for(var t,e=[];le<he&&!H("}")&&(t=Qt(),"undefined"!=typeof t);)e.push(t);return e}function bt(){var t,e;return e=de,G("{"),t=vt(),G("}"),fe.markEnd(fe.createBlockStatement(t),e)}function _t(){var t,e;return e=de,t=L(),t.type!==Zt.Identifier&&U(t),fe.markEnd(fe.createIdentifier(t.value),e)}function wt(t){var e,n,r=null;return n=de,e=_t(),ue&&p(e.name)&&j({},ie.StrictVarName),"const"===t?(G("="),r=yt()):H("=")&&(L(),r=yt()),fe.markEnd(fe.createVariableDeclarator(e,r),n)}function St(t){var e=[];do{if(e.push(wt(t)),!H(","))break;L()}while(le<he);return e}function xt(){var t;return W("var"),t=St(),Y(),fe.createVariableDeclaration(t,"var")}function Tt(t){var e,n;return n=de,W(t),e=St(t),Y(),fe.markEnd(fe.createVariableDeclaration(e,t),n)}function Pt(){return G(";"),fe.createEmptyStatement()}function Et(){var t=gt();return Y(),fe.createExpressionStatement(t)}function At(){var t,e,n;return W("if"),G("("),t=gt(),G(")"),e=jt(),Q("else")?(L(),n=jt()):n=null,fe.createIfStatement(t,e,n)}function Nt(){var t,e,n;return W("do"),n=me.inIteration,me.inIteration=!0,t=jt(),me.inIteration=n,W("while"),G("("),e=gt(),G(")"),H(";")&&L(),fe.createDoWhileStatement(t,e)}function Ot(){var t,e,n;return W("while"),G("("),t=gt(),G(")"),n=me.inIteration,me.inIteration=!0,e=jt(),me.inIteration=n,fe.createWhileStatement(t,e)}function kt(){var t,e,n;return n=de,t=L(),e=St(),fe.markEnd(fe.createVariableDeclaration(e,t.value),n)}function It(){var t,e,n,r,i,o,a,s=me.allowIn;return t=e=n=null,W("for"),G("("),H(";")?L():(Q("var")||Q("let")?(me.allowIn=!1,t=kt(),me.allowIn=s,1===t.declarations.length&&Q("in")&&(L(),r=t,i=gt(),t=null)):(me.allowIn=!1,t=gt(),me.allowIn=s,Q("in")&&(X(t)||j({},ie.InvalidLHSInForIn),L(),r=t,i=gt(),t=null)),"undefined"==typeof r&&G(";")),"undefined"==typeof r&&(H(";")||(e=gt()),G(";"),H(")")||(n=gt())),G(")"),a=me.inIteration,me.inIteration=!0,o=jt(),me.inIteration=a,"undefined"==typeof r?fe.createForStatement(t,e,n,o):fe.createForInStatement(r,i,o)}function Ct(){var t,e=null;return W("continue"),59===se.charCodeAt(le)?(L(),me.inIteration||B({},ie.IllegalContinue),fe.createContinueStatement(null)):V()?(me.inIteration||B({},ie.IllegalContinue),fe.createContinueStatement(null)):(de.type===Zt.Identifier&&(e=_t(),t="$"+e.name,Object.prototype.hasOwnProperty.call(me.labelSet,t)||B({},ie.UnknownLabel,e.name)),Y(),null!==e||me.inIteration||B({},ie.IllegalContinue),fe.createContinueStatement(e))}function Mt(){var t,e=null;return W("break"),59===se.charCodeAt(le)?(L(),me.inIteration||me.inSwitch||B({},ie.IllegalBreak),fe.createBreakStatement(null)):V()?(me.inIteration||me.inSwitch||B({},ie.IllegalBreak),fe.createBreakStatement(null)):(de.type===Zt.Identifier&&(e=_t(),t="$"+e.name,Object.prototype.hasOwnProperty.call(me.labelSet,t)||B({},ie.UnknownLabel,e.name)),Y(),null!==e||me.inIteration||me.inSwitch||B({},ie.IllegalBreak),fe.createBreakStatement(e))}function Rt(){var t=null;return W("return"),me.inFunctionBody||j({},ie.IllegalReturn),32===se.charCodeAt(le)&&s(se.charCodeAt(le+1))?(t=gt(),Y(),fe.createReturnStatement(t)):V()?fe.createReturnStatement(null):(H(";")||H("}")||de.type===Zt.EOF||(t=gt()),Y(),fe.createReturnStatement(t))}function Dt(){var t,e;return ue&&(y(),j({},ie.StrictModeWith)),W("with"),G("("),t=gt(),G(")"),e=jt(),fe.createWithStatement(t,e)}function Lt(){var t,e,n,r=[];for(n=de,Q("default")?(L(),t=null):(W("case"),t=gt()),G(":");le<he&&!(H("}")||Q("default")||Q("case"));)e=jt(),r.push(e);return fe.markEnd(fe.createSwitchCase(t,r),n)}function Ft(){var t,e,n,r,i;if(W("switch"),G("("),t=gt(),G(")"),G("{"),e=[],H("}"))return L(),fe.createSwitchStatement(t,e);for(r=me.inSwitch,me.inSwitch=!0,i=!1;le<he&&!H("}");)n=Lt(),null===n.test&&(i&&B({},ie.MultipleDefaultsInSwitch),i=!0),e.push(n);return me.inSwitch=r,G("}"),fe.createSwitchStatement(t,e)}function zt(){var t;return W("throw"),V()&&B({},ie.NewlineAfterThrow),t=gt(),Y(),fe.createThrowStatement(t)}function qt(){var t,e,n;return n=de,W("catch"),G("("),H(")")&&U(de),t=_t(),ue&&p(t.name)&&j({},ie.StrictCatchVariable),G(")"),e=bt(),fe.markEnd(fe.createCatchClause(t,e),n)}function Vt(){var t,e=[],n=null;return W("try"),t=bt(),Q("catch")&&e.push(qt()),Q("finally")&&(L(),n=bt()),0!==e.length||n||B({},ie.NoCatchOrFinally),fe.createTryStatement(t,[],e,n)}function Bt(){return W("debugger"),Y(),fe.createDebuggerStatement()}function jt(){var t,e,n,r,i=de.type;if(i===Zt.EOF&&U(de),i===Zt.Punctuator&&"{"===de.value)return bt();if(r=de,i===Zt.Punctuator)switch(de.value){case";":return fe.markEnd(Pt(),r);case"(":return fe.markEnd(Et(),r)}if(i===Zt.Keyword)switch(de.value){case"break":return fe.markEnd(Mt(),r);case"continue":return fe.markEnd(Ct(),r);case"debugger":return fe.markEnd(Bt(),r);case"do":return fe.markEnd(Nt(),r);case"for":return fe.markEnd(It(),r);case"function":return fe.markEnd(Wt(),r);case"if":return fe.markEnd(At(),r);case"return":return fe.markEnd(Rt(),r);case"switch":return fe.markEnd(Ft(),r);case"throw":return fe.markEnd(zt(),r);case"try":return fe.markEnd(Vt(),r);case"var":return fe.markEnd(xt(),r);case"while":return fe.markEnd(Ot(),r);case"with":return fe.markEnd(Dt(),r)}return t=gt(),t.type===ne.Identifier&&H(":")?(L(),n="$"+t.name,Object.prototype.hasOwnProperty.call(me.labelSet,n)&&B({},ie.Redeclaration,"Label",t.name),me.labelSet[n]=!0,e=jt(),delete me.labelSet[n],fe.markEnd(fe.createLabeledStatement(t,e),r)):(Y(),fe.markEnd(fe.createExpressionStatement(t),r))}function Ut(){var t,e,n,r,i,o,a,s,u,l=[];for(u=de,G("{");le<he&&de.type===Zt.StringLiteral&&(e=de,t=Qt(),l.push(t),t.expression.type===ne.Literal);)n=se.slice(e.start+1,e.end-1),"use strict"===n?(ue=!0,r&&j(r,ie.StrictOctalLiteral)):!r&&e.octal&&(r=e);for(i=me.labelSet,o=me.inIteration,a=me.inSwitch,s=me.inFunctionBody,me.labelSet={},me.inIteration=!1,me.inSwitch=!1,me.inFunctionBody=!0;le<he&&!H("}")&&(t=Qt(),"undefined"!=typeof t);)l.push(t);return G("}"),me.labelSet=i,me.inIteration=o,me.inSwitch=a,me.inFunctionBody=s,fe.markEnd(fe.createBlockStatement(l),u)}function Gt(t){var e,n,r,i,o,a,s=[];if(G("("),!H(")"))for(i={};le<he&&(n=de,e=_t(),o="$"+n.value,ue?(p(n.value)&&(r=n,a=ie.StrictParamName),Object.prototype.hasOwnProperty.call(i,o)&&(r=n,a=ie.StrictParamDupe)):t||(p(n.value)?(t=n,a=ie.StrictParamName):c(n.value)?(t=n,a=ie.StrictReservedWord):Object.prototype.hasOwnProperty.call(i,o)&&(t=n,a=ie.StrictParamDupe)),s.push(e),i[o]=!0,!H(")"));)G(",");return G(")"),{params:s,stricted:r,firstRestricted:t,message:a}}function Wt(){var t,e,n,r,i,o,a,s,u,l=[];return u=de,W("function"),n=de,t=_t(),ue?p(n.value)&&j(n,ie.StrictFunctionName):p(n.value)?(o=n,a=ie.StrictFunctionName):c(n.value)&&(o=n,a=ie.StrictReservedWord),i=Gt(o),l=i.params,r=i.stricted,o=i.firstRestricted,i.message&&(a=i.message),s=ue,e=Ut(),ue&&o&&B(o,a),ue&&r&&j(r,a),ue=s,fe.markEnd(fe.createFunctionDeclaration(t,l,[],e),u)}function Ht(){var t,e,n,r,i,o,a,s,u=null,l=[];return s=de,W("function"),H("(")||(t=de,u=_t(),ue?p(t.value)&&j(t,ie.StrictFunctionName):p(t.value)?(n=t,r=ie.StrictFunctionName):c(t.value)&&(n=t,r=ie.StrictReservedWord)),i=Gt(n),l=i.params,e=i.stricted,n=i.firstRestricted,i.message&&(r=i.message),a=ue,o=Ut(),ue&&n&&B(n,r),ue&&e&&j(e,r),ue=a,fe.markEnd(fe.createFunctionExpression(u,l,[],o),s)}function Qt(){if(de.type===Zt.Keyword)switch(de.value){case"const":case"let":return Tt(de.value);case"function":return Wt();default:return jt()}if(de.type!==Zt.EOF)return jt()}function Kt(){for(var t,e,n,r,i=[];le<he&&(e=de,e.type===Zt.StringLiteral)&&(t=Qt(),i.push(t),t.expression.type===ne.Literal);)n=se.slice(e.start+1,e.end-1),"use strict"===n?(ue=!0,r&&j(r,ie.StrictOctalLiteral)):!r&&e.octal&&(r=e);for(;le<he&&(t=Qt(),"undefined"!=typeof t);)i.push(t);return i}function Yt(){var t,e;return y(),F(),e=de,ue=!1,t=Kt(),fe.markEnd(fe.createProgram(t),e)}function Xt(){var t,e,n,r=[];for(t=0;t<ye.tokens.length;++t)e=ye.tokens[t],n={type:e.type,value:e.value},ye.range&&(n.range=e.range),ye.loc&&(n.loc=e.loc),r.push(n);ye.tokens=r}function $t(t,e){var n,r,i;n=String,"string"==typeof t||t instanceof String||(t=n(t)),fe=ae,se=t,le=0,ce=se.length>0?1:0,pe=0,he=se.length,de=null,me={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ye={},e=e||{},e.tokens=!0,ye.tokens=[],ye.tokenize=!0,ye.openParenToken=-1,ye.openCurlyToken=-1,ye.range="boolean"==typeof e.range&&e.range,ye.loc="boolean"==typeof e.loc&&e.loc,"boolean"==typeof e.comment&&e.comment&&(ye.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(ye.errors=[]);try{if(F(),de.type===Zt.EOF)return ye.tokens;for(r=L();de.type!==Zt.EOF;)try{r=L()}catch(t){if(r=de,ye.errors){ye.errors.push(t);break}throw t}Xt(),i=ye.tokens,"undefined"!=typeof ye.comments&&(i.comments=ye.comments),"undefined"!=typeof ye.errors&&(i.errors=ye.errors)}catch(t){throw t}finally{ye={}}return i}function Jt(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),fe=ae,se=t,le=0,ce=se.length>0?1:0,pe=0,he=se.length,de=null,me={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},ye={},"undefined"!=typeof e&&(ye.range="boolean"==typeof e.range&&e.range,ye.loc="boolean"==typeof e.loc&&e.loc,ye.attachComment="boolean"==typeof e.attachComment&&e.attachComment,ye.loc&&null!==e.source&&void 0!==e.source&&(ye.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(ye.tokens=[]),"boolean"==typeof e.comment&&e.comment&&(ye.comments=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(ye.errors=[]),ye.attachComment&&(ye.range=!0,ye.comments=[],ye.bottomRightStack=[],ye.trailingComments=[],ye.leadingComments=[]));try{n=Yt(),"undefined"!=typeof ye.comments&&(n.comments=ye.comments),"undefined"!=typeof ye.tokens&&(Xt(),n.tokens=ye.tokens),"undefined"!=typeof ye.errors&&(n.errors=ye.errors)}catch(t){throw t}finally{ye={}}return n}var Zt,te,ee,ne,re,ie,oe,ae,se,ue,le,ce,pe,he,fe,de,me,ye;Zt={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},te={},te[Zt.BooleanLiteral]="Boolean",te[Zt.EOF]="<end>",te[Zt.Identifier]="Identifier",te[Zt.Keyword]="Keyword",te[Zt.NullLiteral]="Null",te[Zt.NumericLiteral]="Numeric",te[Zt.Punctuator]="Punctuator",te[Zt.StringLiteral]="String",te[Zt.RegularExpression]="RegularExpression",ee=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],ne={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},re={Data:1,Get:2,Set:4},ie={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},oe={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")},ae={name:"SyntaxTree",processComment:function(t){var e,n;if(!(t.type===ne.Program&&t.body.length>0)){for(ye.trailingComments.length>0?ye.trailingComments[0].range[0]>=t.range[1]?(n=ye.trailingComments,ye.trailingComments=[]):ye.trailingComments.length=0:ye.bottomRightStack.length>0&&ye.bottomRightStack[ye.bottomRightStack.length-1].trailingComments&&ye.bottomRightStack[ye.bottomRightStack.length-1].trailingComments[0].range[0]>=t.range[1]&&(n=ye.bottomRightStack[ye.bottomRightStack.length-1].trailingComments,delete ye.bottomRightStack[ye.bottomRightStack.length-1].trailingComments);ye.bottomRightStack.length>0&&ye.bottomRightStack[ye.bottomRightStack.length-1].range[0]>=t.range[0];)e=ye.bottomRightStack.pop();e?e.leadingComments&&e.leadingComments[e.leadingComments.length-1].range[1]<=t.range[0]&&(t.leadingComments=e.leadingComments,delete e.leadingComments):ye.leadingComments.length>0&&ye.leadingComments[ye.leadingComments.length-1].range[1]<=t.range[0]&&(t.leadingComments=ye.leadingComments,ye.leadingComments=[]),n&&(t.trailingComments=n),ye.bottomRightStack.push(t)}},markEnd:function(t,e){return ye.range&&(t.range=[e.start,le]),ye.loc&&(t.loc=new q(void 0===e.startLineNumber?e.lineNumber:e.startLineNumber,e.start-(void 0===e.startLineStart?e.lineStart:e.startLineStart),ce,le-pe),this.postProcess(t)),ye.attachComment&&this.processComment(t),t},postProcess:function(t){return ye.source&&(t.loc.source=ye.source),t},createArrayExpression:function(t){return{type:ne.ArrayExpression,elements:t}},createAssignmentExpression:function(t,e,n){return{type:ne.AssignmentExpression,operator:t,left:e,right:n}},createBinaryExpression:function(t,e,n){var r="||"===t||"&&"===t?ne.LogicalExpression:ne.BinaryExpression;return{type:r,operator:t,left:e,right:n}},createBlockStatement:function(t){return{type:ne.BlockStatement,body:t}},createBreakStatement:function(t){return{type:ne.BreakStatement,label:t}},createCallExpression:function(t,e){return{type:ne.CallExpression,callee:t,arguments:e}},createCatchClause:function(t,e){return{type:ne.CatchClause,param:t,body:e}},createConditionalExpression:function(t,e,n){return{type:ne.ConditionalExpression,test:t,consequent:e,alternate:n}},createContinueStatement:function(t){return{type:ne.ContinueStatement,label:t}},createDebuggerStatement:function(){return{type:ne.DebuggerStatement}},createDoWhileStatement:function(t,e){return{type:ne.DoWhileStatement,body:t,test:e}},createEmptyStatement:function(){return{type:ne.EmptyStatement}},createExpressionStatement:function(t){return{type:ne.ExpressionStatement,expression:t}},createForStatement:function(t,e,n,r){return{type:ne.ForStatement,init:t,test:e,update:n,body:r}},createForInStatement:function(t,e,n){return{type:ne.ForInStatement,left:t,right:e,body:n,each:!1}},createFunctionDeclaration:function(t,e,n,r){return{type:ne.FunctionDeclaration,id:t,params:e,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(t,e,n,r){return{type:ne.FunctionExpression,id:t,params:e,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(t){return{type:ne.Identifier,name:t}},createIfStatement:function(t,e,n){return{type:ne.IfStatement,test:t,consequent:e,alternate:n}},createLabeledStatement:function(t,e){return{type:ne.LabeledStatement,label:t,body:e}},createLiteral:function(t){return{type:ne.Literal,value:t.value,raw:se.slice(t.start,t.end)}},createMemberExpression:function(t,e,n){return{type:ne.MemberExpression,computed:"["===t,object:e,property:n}},createNewExpression:function(t,e){return{type:ne.NewExpression,callee:t,arguments:e}},createObjectExpression:function(t){return{type:ne.ObjectExpression,properties:t}},createPostfixExpression:function(t,e){return{type:ne.UpdateExpression,operator:t,argument:e,prefix:!1}},createProgram:function(t){return{type:ne.Program,body:t}},createProperty:function(t,e,n){return{type:ne.Property,key:e,value:n,kind:t}},createReturnStatement:function(t){return{type:ne.ReturnStatement,argument:t}},createSequenceExpression:function(t){return{type:ne.SequenceExpression,expressions:t}},createSwitchCase:function(t,e){return{type:ne.SwitchCase,test:t,consequent:e}},createSwitchStatement:function(t,e){return{type:ne.SwitchStatement,discriminant:t,cases:e}},createThisExpression:function(){return{type:ne.ThisExpression}},createThrowStatement:function(t){return{type:ne.ThrowStatement,argument:t}},createTryStatement:function(t,e,n,r){return{type:ne.TryStatement,block:t,guardedHandlers:e,handlers:n,finalizer:r}},createUnaryExpression:function(t,e){return"++"===t||"--"===t?{type:ne.UpdateExpression,operator:t,argument:e,prefix:!0}:{type:ne.UnaryExpression,operator:t,argument:e,prefix:!0}},createVariableDeclaration:function(t,e){return{type:ne.VariableDeclaration,declarations:t,kind:e}},createVariableDeclarator:function(t,e){return{type:ne.VariableDeclarator,id:t,init:e}},createWhileStatement:function(t,e){return{type:ne.WhileStatement,test:t,body:e}},createWithStatement:function(t,e){return{type:ne.WithStatement,object:t,body:e}}},t.version="1.2.5",t.tokenize=$t,t.parse=Jt,t.Syntax=function(){var t,e={};"function"==typeof Object.create&&(e=Object.create(null));for(t in ne)ne.hasOwnProperty(t)&&(e[t]=ne[t]);return"function"==typeof Object.freeze&&Object.freeze(e),e}()})},function(t,e,n){"use strict";function r(t){for(var e in t)a.indexOf(e)<0&&s.indexOf(e)<0&&console.warn("cwise: Unknown argument '"+e+"' passed to expression compiler");for(var n=0;n<a.length;++n)if(!t[a[n]])throw new Error("cwise: Missing argument: "+a[n]);return o({args:t.args,pre:i(t.pre||function(){}),body:i(t.body),post:i(t.post||function(){}),debug:!!t.printCode,funcName:t.funcName||t.body.name||"cwise",blockSize:t.blockSize||64})}var i=n(352),o=n(150),a=["args","body"],s=["pre","post","printCode","funcName","blockSize"];t.exports=r},function(t,e,n){/*!
	  * domready (c) Dustin Diaz 2014 - License MIT
	  */
!function(e,n){t.exports=n()}("domready",function(){var t,e=[],n=document,r=n.documentElement.doScroll,i="DOMContentLoaded",o=(r?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);return o||n.addEventListener(i,t=function(){for(n.removeEventListener(i,t),o=1;t=e.shift();)t()}),function(t){o?setTimeout(t,0):e.push(t)}})},function(t,e){"use strict";function n(t,e,r){var i=0|t[r];if(i<=0)return[];var o,a=new Array(i);if(r===t.length-1)for(o=0;o<i;++o)a[o]=e;else for(o=0;o<i;++o)a[o]=n(t,e,r+1);return a}function r(t,e){var n,r;for(n=new Array(t),r=0;r<t;++r)n[r]=e;return n}function i(t,e){switch("undefined"==typeof e&&(e=0),typeof t){case"number":if(t>0)return r(0|t,e);break;case"object":if("number"==typeof t.length)return n(t,e,0)}return[]}t.exports=i},function(t,e){"use strict";function n(t){if(this.size=0|t,this.size<=1||0!==(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=t<<1;for(var e=new Array(2*this.size),n=0;n<e.length;n+=2){const r=Math.PI*n/this.size;e[n]=Math.cos(r),e[n+1]=-Math.sin(r)}this.table=e;for(var i=0,o=1;this.size>o;o<<=1)i++;this._width=i%2===0?i-1:i,this._bitrev=new Array(1<<this._width);for(var a=0;a<this._bitrev.length;a++){this._bitrev[a]=0;for(var s=0;s<this._width;s+=2){var u=this._width-s-2;this._bitrev[a]|=(a>>>s&3)<<u}}this._out=null,this._data=null,this._inv=0}t.exports=n,n.prototype.fromComplexArray=function(t,e){for(var n=e||new Array(t.length>>>1),r=0;r<t.length;r+=2)n[r>>>1]=t[r];return n},n.prototype.createComplexArray=function(){const t=new Array(this._csize);for(var e=0;e<t.length;e++)t[e]=0;return t},n.prototype.toComplexArray=function(t,e){for(var n=e||this.createComplexArray(),r=0;r<n.length;r+=2)n[r]=t[r>>>1],n[r+1]=0;return n},n.prototype.completeSpectrum=function(t){for(var e=this._csize,n=e>>>1,r=2;r<n;r+=2)t[e-r]=t[r],t[e-r+1]=-t[r+1]},n.prototype.transform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._transform4(),this._out=null,this._data=null},n.prototype.realTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=0,this._realTransform4(),this._out=null,this._data=null},n.prototype.inverseTransform=function(t,e){if(t===e)throw new Error("Input and output buffers must be different");this._out=t,this._data=e,this._inv=1,this._transform4();for(var n=0;n<t.length;n++)t[n]/=this.size;this._out=null,this._data=null},n.prototype._transform4=function(){var t,e,n=this._out,r=this._csize,i=this._width,o=1<<i,a=r/o<<1,s=this._bitrev;if(4===a)for(t=0,e=0;t<r;t+=a,e++){const u=s[e];this._singleTransform2(t,u,o)}else for(t=0,e=0;t<r;t+=a,e++){const u=s[e];this._singleTransform4(t,u,o)}var l=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){a=r/o<<1;var p=a>>>2;for(t=0;t<r;t+=a)for(var h=t+p,f=t,d=0;f<h;f+=2,d+=o){const m=f,y=m+p,g=y+p,v=g+p,b=n[m],_=n[m+1],w=n[y],S=n[y+1],x=n[g],T=n[g+1],P=n[v],E=n[v+1],A=b,N=_,O=c[d],k=l*c[d+1],I=w*O-S*k,C=w*k+S*O,M=c[2*d],R=l*c[2*d+1],D=x*M-T*R,L=x*R+T*M,F=c[3*d],z=l*c[3*d+1],q=P*F-E*z,V=P*z+E*F,B=A+D,j=N+L,U=A-D,G=N-L,W=I+q,H=C+V,Q=l*(I-q),K=l*(C-V),Y=B+W,X=j+H,$=B-W,J=j-H,Z=U+K,tt=G-Q,et=U-K,nt=G+Q;n[m]=Y,n[m+1]=X,n[y]=Z,n[y+1]=tt,n[g]=$,n[g+1]=J,n[v]=et,n[v+1]=nt}}},n.prototype._singleTransform2=function(t,e,n){const r=this._out,i=this._data,o=i[e],a=i[e+1],s=i[e+n],u=i[e+n+1],l=o+s,c=a+u,p=o-s,h=a-u;r[t]=l,r[t+1]=c,r[t+2]=p,r[t+3]=h},n.prototype._singleTransform4=function(t,e,n){const r=this._out,i=this._data,o=this._inv?-1:1,a=2*n,s=3*n,u=i[e],l=i[e+1],c=i[e+n],p=i[e+n+1],h=i[e+a],f=i[e+a+1],d=i[e+s],m=i[e+s+1],y=u+h,g=l+f,v=u-h,b=l-f,_=c+d,w=p+m,S=o*(c-d),x=o*(p-m),T=y+_,P=g+w,E=v+x,A=b-S,N=y-_,O=g-w,k=v-x,I=b+S;r[t]=T,r[t+1]=P,r[t+2]=E,r[t+3]=A,r[t+4]=N,r[t+5]=O,r[t+6]=k,r[t+7]=I},n.prototype._realTransform4=function(){var t,e,n=this._out,r=this._csize,i=this._width,o=1<<i,a=r/o<<1,s=this._bitrev;if(4===a)for(t=0,e=0;t<r;t+=a,e++){const u=s[e];this._singleRealTransform2(t,u>>>1,o>>>1)}else for(t=0,e=0;t<r;t+=a,e++){const u=s[e];this._singleRealTransform4(t,u>>>1,o>>>1)}var l=this._inv?-1:1,c=this.table;for(o>>=2;o>=2;o>>=2){a=r/o<<1;var p=a>>>1,h=p>>>1,f=h>>>1;for(t=0;t<r;t+=a)for(var d=0,m=0;d<=f;d+=2,m+=o){var y=t+d,g=y+h,v=g+h,b=v+h,_=n[y],w=n[y+1],S=n[g],x=n[g+1],T=n[v],P=n[v+1],E=n[b],A=n[b+1],N=_,O=w,k=c[m],I=l*c[m+1],C=S*k-x*I,M=S*I+x*k,R=c[2*m],D=l*c[2*m+1],L=T*R-P*D,F=T*D+P*R,z=c[3*m],q=l*c[3*m+1],V=E*z-A*q,B=E*q+A*z,j=N+L,U=O+F,G=N-L,W=O-F,H=C+V,Q=M+B,K=l*(C-V),Y=l*(M-B),X=j+H,$=U+Q,J=G+Y,Z=W-K;if(n[y]=X,n[y+1]=$,n[g]=J,n[g+1]=Z,0!==d){if(d!==f){var tt=G,et=-W,nt=j,rt=-U,it=-l*Y,ot=-l*K,at=-l*Q,st=-l*H,ut=tt+it,lt=et+ot,ct=nt+st,pt=rt-at,ht=t+h-d,ft=t+p-d;n[ht]=ut,n[ht+1]=lt,n[ft]=ct,n[ft+1]=pt}}else{var dt=j-H,mt=U-Q;n[v]=dt,n[v+1]=mt}}}},n.prototype._singleRealTransform2=function(t,e,n){const r=this._out,i=this._data,o=i[e],a=i[e+n],s=o+a,u=o-a;r[t]=s,r[t+1]=0,r[t+2]=u,r[t+3]=0},n.prototype._singleRealTransform4=function(t,e,n){const r=this._out,i=this._data,o=this._inv?-1:1,a=2*n,s=3*n,u=i[e],l=i[e+n],c=i[e+a],p=i[e+s],h=u+c,f=u-c,d=l+p,m=o*(l-p),y=h+d,g=f,v=-m,b=h-d,_=f,w=m;r[t]=y,r[t+1]=0,r[t+2]=g,r[t+3]=v,r[t+4]=b,r[t+5]=0,r[t+6]=_,r[t+7]=w}},function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,p=n?i-1:0,h=n?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+p],p+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+t[e+p],p+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:(f?-1:1)*(1/0);a+=Math.pow(2,r),o-=l}return(f?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),e+=a+p>=1?h/u:h*Math.pow(2,1-p),e*u>=2&&(a++,u/=2),a+p>=c?(s=0,a=c):a+p>=1?(s=(e*u-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[n+f]=255&a,f+=d,a/=256,l-=8);t[n+f-d]|=128*m}},function(t,e){"use strict";function n(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=n;return e}t.exports=n},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function r(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}/*!
	 * Determine if an object is a Buffer
	 *
	 * @author   Feross Aboukhadijeh <https://feross.org>
	 * @license  MIT
	 */
t.exports=function(t){return null!=t&&(n(t)||r(t)||!!t._isBuffer)}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){!function(e,n){t.exports=n()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}([function(t,e,n){"use strict";n.d(e,"a",function(){return r}),n.d(e,"b",function(){return i}),n.d(e,"c",function(){return o});var r=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],i=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","ethnic","percussive","sound effects"],o={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},function(t,e,n){"use strict";function r(t){return t.replace(/\u0000/g,"")}function i(t,e){return 60/e.bpm*(t/e.PPQ)}function o(t){return"number"==typeof t}function a(t){return"string"==typeof t}function s(t){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][t%12]+(Math.floor(t/12)-1)}e.b=r,e.a=i,e.c=o,n.d(e,"d",function(){return u}),e.e=s,n.d(e,"f",function(){return l});var u=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i;return function(e){return a(e)&&t.test(e)}}(),l=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=t.exec(n),i=r[1],o=r[2];return e[i.toLowerCase()]+12*(parseInt(o)+1)}}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return c});var i=n(11),o=(n.n(i),n(10)),a=(n.n(o),n(1)),s=n(9),u=n(5),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(){function t(){r(this,t),this.header={bpm:120,timeSignature:[4,4],PPQ:480},this.tracks=[]}return l(t,null,[{key:"fromJSON",value:function(e){var n=new t;return n.header=e.header,e.tracks.forEach(function(t){var e=s.a.fromJSON(t);n.tracks.push(e)}),n}}]),l(t,[{key:"load",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";return new Promise(function(i,o){var a=new XMLHttpRequest;a.open(r,t),a.responseType="arraybuffer",a.addEventListener("load",function(){4===a.readyState&&200===a.status?i(e.decode(a.response)):o(a.status)}),a.addEventListener("error",o),a.send(n)}).catch(function(t){console.log(t)})}},{key:"decode",value:function(t){var e=this;if(t instanceof ArrayBuffer){var r=new Uint8Array(t);t=String.fromCharCode.apply(null,r)}var o=i(t);return this.header=n.i(u.a)(o),this.tracks=[],o.tracks.forEach(function(t,n){var r=new s.a;r.id=n,e.tracks.push(r);var i=0;t.forEach(function(t){i+=a.a(t.deltaTime,e.header),"meta"===t.type&&"trackName"===t.subtype?r.name=a.b(t.text):"noteOn"===t.subtype?(r.noteOn(t.noteNumber,i,t.velocity/127),-1===r.channelNumber&&(r.channelNumber=t.channel)):"noteOff"===t.subtype?r.noteOff(t.noteNumber,i):"controller"===t.subtype&&t.controllerType?r.cc(t.controllerType,i,t.value/127):"meta"===t.type&&"instrumentName"===t.subtype?r.instrument=t.text:"channel"===t.type&&"programChange"===t.subtype&&(r.patch(t.programNumber),r.channelNumber=t.channel)}),e.header.name||r.length||!r.name||(e.header.name=r.name)}),this}},{key:"encode",value:function(){var t=this,e=new o.File({ticks:this.header.PPQ}),n=this.tracks.filter(function(t){return!t.length})[0];return!this.header.name||n&&n.name===this.header.name||e.addTrack().addEvent(new o.MetaEvent({time:0,type:o.MetaEvent.TRACK_NAME,data:this.header.name})),this.tracks.forEach(function(n){var r=e.addTrack();r.setTempo(t.bpm),n.name&&r.addEvent(new o.MetaEvent({time:0,type:o.MetaEvent.TRACK_NAME,data:n.name})),n.encode(r,t.header)}),e.toBytes()}},{key:"toArray",value:function(){for(var t=this.encode(),e=new Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}},{key:"toJSON",value:function(){var t={header:this.header,startTime:this.startTime,duration:this.duration,tracks:(this.tracks||[]).map(function(t){return t.toJSON()})};return t.header.name||(t.header.name=""),t}},{key:"track",value:function(t){var e=new s.a(t);return this.tracks.push(e),e}},{key:"get",value:function(t){return a.c(t)?this.tracks[t]:this.tracks.find(function(e){return e.name===t})}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=new t;return r.header=this.header,r.tracks=this.tracks.map(function(t){return t.slice(e,n)}),r}},{key:"startTime",get:function(){var t=this.tracks.map(function(t){return t.startTime});return t.length?Math.min.apply(Math,t)||0:0}},{key:"bpm",get:function(){return this.header.bpm},set:function(t){var e=this.header.bpm;this.header.bpm=t;var n=e/t;this.tracks.forEach(function(t){return t.scale(n)})}},{key:"timeSignature",get:function(){return this.header.timeSignature},set:function(t){this.header.timeSignature=t}},{key:"duration",get:function(){var t=this.tracks.map(function(t){return t.duration});return t.length?Math.max.apply(Math,t)||0:0}}]),t}()},function(t,e,n){"use strict";function r(t,e){var n=0,r=t.length,i=r;if(r>0&&t[r-1].time<=e)return r-1;for(;n<i;){var o=Math.floor(n+(i-n)/2),a=t[o],s=t[o+1];if(a.time===e){for(var u=o;u<t.length;u++)t[u].time===e&&(o=u);return o}if(a.time<e&&s.time>e)return o;a.time>e?i=o:a.time<e&&(n=o+1)}return-1}function i(t,e){if(t.length){var n=r(t,e.time);t.splice(n+1,0,e)}else t.push(e)}n.d(e,"a",function(){return i})},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoContro"},a=function(){function t(e,n,i){r(this,t),this.number=e,this.time=n,this.value=i}return i(t,[{key:"name",get:function(){if(o.hasOwnProperty(this.number))return o[this.number]}}]),t}()},function(t,e,n){"use strict";function r(t){for(var e={PPQ:t.header.ticksPerBeat},n=0;n<t.tracks.length;n++)for(var r=t.tracks[n],i=0;i<r.length;i++){var o=r[i];"meta"===o.type&&("timeSignature"===o.subtype?e.timeSignature=[o.numerator,o.denominator]:"setTempo"===o.subtype&&(e.bpm||(e.bpm=6e7/o.microsecondsPerBeat)))}return e.bpm=e.bpm||120,e}n.d(e,"a",function(){return r})},function(t,e,n){"use strict";function r(t,e){for(var n=0;n<t.length;n++){var r=t[n],i=e[n];if(r.length>i)return!0}return!1}function i(t,e,n){for(var r=0,i=1/0,o=0;o<t.length;o++){var a=t[o],s=e[o];a[s]&&a[s].time<i&&(r=o,i=a[s].time)}n[r](t[r][e[r]]),e[r]+=1}function o(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var o=e.filter(function(t,e){return e%2==0}),a=new Uint32Array(o.length),s=e.filter(function(t,e){return e%2==1});r(o,a);)i(o,a,s)}n.d(e,"a",function(){return o})},function(t,e,n){"use strict";function r(t){return(new s.a).decode(t)}function i(t,e){var n=(new s.a).load(t);return e&&n.then(e),n}function o(){return new s.a}function a(t){return s.a.fromJSON(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.parse=r,e.load=i,e.create=o,e.fromJSON=a;var s=n(2),u=n(0);n.d(e,"instrumentByPatchID",function(){return u.a}),n.d(e,"instrumentFamilyByID",function(){return u.b}),n.d(e,"drumKitByPatchID",function(){return u.c})},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var i=n(1),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(r(this,t),i.c(e))this.midi=e;else{if(!i.d(e))throw new Error("the midi value must either be in Pitch Notation (e.g. C#4) or a midi value");this.name=e}this.time=n,this.duration=o,this.velocity=a}return o(t,null,[{key:"fromJSON",value:function(e){return new t(e.midi,e.time,e.duration,e.velocity)}}]),o(t,[{key:"match",value:function(t){return i.c(t)?this.midi===t:i.d(t)?this.name.toLowerCase()===t.toLowerCase():void 0}},{key:"toJSON",value:function(){return{name:this.name,midi:this.midi,time:this.time,velocity:this.velocity,duration:this.duration}}},{key:"name",get:function(){return i.e(this.midi)},set:function(t){this.midi=i.f(t)}},{key:"noteOn",get:function(){return this.time},set:function(t){this.time=t}},{key:"noteOff",get:function(){return this.time+this.duration},set:function(t){this.duration=t-this.time}}]),t}()},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return c});var i=n(3),o=n(4),a=n(6),s=n(8),u=n(0),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;r(this,t),this.name=e,this.channelNumber=i,this.notes=[],this.controlChanges={},this.instrumentNumber=n}return l(t,null,[{key:"fromJSON",value:function(e){var n=new t(e.name,e.instrumentNumber,e.channelNumber);return n.id=e.id,e.notes&&e.notes.forEach(function(t){var e=s.a.fromJSON(t);n.notes.push(e)}),e.controlChanges&&(n.controlChanges=e.controlChanges),n}}]),l(t,[{key:"note",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=new s.a(t,e,r,o);return n.i(i.a)(this.notes,a),this}},{key:"noteOn",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=new s.a(t,e,0,r);return n.i(i.a)(this.notes,o),this}},{key:"noteOff",value:function(t,e){for(var n=0;n<this.notes.length;n++){var r=this.notes[n];if(r.match(t)&&0===r.duration){r.noteOff=e;break}}return this}},{key:"cc",value:function(t,e,r){this.controlChanges.hasOwnProperty(t)||(this.controlChanges[t]=[]);var a=new o.a(t,e,r);return n.i(i.a)(this.controlChanges[t],a),this}},{key:"patch",value:function(t){return this.instrumentNumber=t,this}},{key:"channel",value:function(t){return this.channelNumber=t,this}},{key:"scale",value:function(t){return this.notes.forEach(function(e){e.time*=t,e.duration*=t}),this}},{key:"slice",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=Math.max(this.notes.findIndex(function(t){return t.time>=e}),0),i=this.notes.findIndex(function(t){return t.noteOff>=n})+1,o=new t(this.name);return o.notes=this.notes.slice(r,i),o.notes.forEach(function(t){return t.time=t.time-e}),o}},{key:"encode",value:function(t,e){function r(t){var e=Math.floor(i*t),n=Math.max(e-o,0);return o=e,n}var i=e.PPQ/(60/e.bpm),o=0,s=Math.max(0,this.channelNumber);-1!==this.instrumentNumber&&t.instrument(s,this.instrumentNumber),n.i(a.a)(this.noteOns.sort(function(t,e){return t.time-e.time}),function(e){t.addNoteOn(s,e.name,r(e.time),Math.floor(127*e.velocity))},this.noteOffs.sort(function(t,e){return t.time-e.time}),function(e){t.addNoteOff(s,e.name,r(e.time))})}},{key:"toJSON",value:function(){var t={startTime:this.startTime,duration:this.duration,length:this.length,notes:[],controlChanges:{}};return void 0!==this.id&&(t.id=this.id),t.name=this.name,-1!==this.instrumentNumber&&(t.instrumentNumber=this.instrumentNumber,t.instrument=this.instrument,t.instrumentFamily=this.instrumentFamily),-1!==this.channelNumber&&(t.channelNumber=this.channelNumber,t.isPercussion=this.isPercussion),this.notes.length&&(t.notes=this.notes.map(function(t){return t.toJSON()})),Object.keys(this.controlChanges).length&&(t.controlChanges=this.controlChanges),t}},{key:"noteOns",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOn,midi:e.midi,name:e.name,velocity:e.velocity})}),t}},{key:"noteOffs",get:function(){var t=[];return this.notes.forEach(function(e){t.push({time:e.noteOff,midi:e.midi,name:e.name})}),t}},{key:"length",get:function(){return this.notes.length}},{key:"startTime",get:function(){return this.notes.length?this.notes[0].noteOn:0}},{key:"duration",get:function(){return this.notes.length?this.notes[this.notes.length-1].noteOff:0}},{key:"instrument",get:function(){return this.isPercussion?u.c[this.instrumentNumber]:u.a[this.instrumentNumber]},set:function(t){var e=u.a.indexOf(t);-1!==e&&(this.instrumentNumber=e)}},{key:"isPercussion",get:function(){return[9,10].includes(this.channelNumber)}},{key:"instrumentFamily",get:function(){return this.isPercussion?"drums":u.b[Math.floor(this.instrumentNumber/8)]}}]),t}()},function(t,e,n){(function(t){var n={};!function(t){var e=t.DEFAULT_VOLUME=90,n=(t.DEFAULT_DURATION=128,t.DEFAULT_CHANNEL=0,{midi_letter_pitches:{a:21,b:23,c:12,d:14,e:16,f:17,g:19},midiPitchFromNote:function(t){var e=/([a-g])(#+|b+)?([0-9]+)$/i.exec(t),r=e[1].toLowerCase(),i=e[2]||"";return 12*parseInt(e[3],10)+n.midi_letter_pitches[r]+("#"==i.substr(0,1)?1:-1)*i.length},ensureMidiPitch:function(t){return"number"!=typeof t&&/[^0-9]/.test(t)?n.midiPitchFromNote(t):parseInt(t,10)},midi_pitches_letter:{12:"c",13:"c#",14:"d",15:"d#",16:"e",17:"f",18:"f#",19:"g",20:"g#",21:"a",22:"a#",23:"b"},midi_flattened_notes:{"a#":"bb","c#":"db","d#":"eb","f#":"gb","g#":"ab"},noteFromMidiPitch:function(t,e){var r,i=0,o=t,e=e||!1;return t>23&&(i=Math.floor(t/12)-1,o=t-12*i),r=n.midi_pitches_letter[o],e&&r.indexOf("#")>0&&(r=n.midi_flattened_notes[r]),r+i},mpqnFromBpm:function(t){var e=Math.floor(6e7/t),n=[];do n.unshift(255&e),e>>=8;while(e);for(;n.length<3;)n.push(0);return n},bpmFromMpqn:function(t){var e=t;if(void 0!==t[0]){e=0;for(var n=0,r=t.length-1;r>=0;++n,--r)e|=t[n]<<r}return Math.floor(6e7/t)},codes2Str:function(t){return String.fromCharCode.apply(null,t)},str2Bytes:function(t,e){if(e)for(;t.length/2<e;)t="0"+t;for(var n=[],r=t.length-1;r>=0;r-=2){var i=0===r?t[r]:t[r-1]+t[r];n.unshift(parseInt(i,16))}return n},translateTickTime:function(t){for(var e=127&t;t>>=7;)e<<=8,e|=127&t|128;for(var n=[];n.push(255&e),128&e;)e>>=8;return n}}),r=function(t){return this?void(!t||null===t.type&&void 0===t.type||null===t.channel&&void 0===t.channel||null===t.param1&&void 0===t.param1||(this.setTime(t.time),this.setType(t.type),this.setChannel(t.channel),this.setParam1(t.param1),this.setParam2(t.param2))):new r(t)};r.NOTE_OFF=128,r.NOTE_ON=144,r.AFTER_TOUCH=160,r.CONTROLLER=176,r.PROGRAM_CHANGE=192,r.CHANNEL_AFTERTOUCH=208,r.PITCH_BEND=224,r.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},r.prototype.setType=function(t){if(t<r.NOTE_OFF||t>r.PITCH_BEND)throw new Error("Trying to set an unknown event: "+t);this.type=t},r.prototype.setChannel=function(t){if(t<0||t>15)throw new Error("Channel is out of bounds.");this.channel=t},r.prototype.setParam1=function(t){this.param1=t},r.prototype.setParam2=function(t){this.param2=t},r.prototype.toBytes=function(){var t=[],e=this.type|15&this.channel;return t.push.apply(t,this.time),t.push(e),t.push(this.param1),void 0!==this.param2&&null!==this.param2&&t.push(this.param2),t};var i=function(t){return this?(this.setTime(t.time),this.setType(t.type),this.setData(t.data),void 0):new i(t)};i.SEQUENCE=0,i.TEXT=1,i.COPYRIGHT=2,i.TRACK_NAME=3,i.INSTRUMENT=4,i.LYRIC=5,i.MARKER=6,i.CUE_POINT=7,i.CHANNEL_PREFIX=32,i.END_OF_TRACK=47,i.TEMPO=81,i.SMPTE=84,i.TIME_SIG=88,i.KEY_SIG=89,i.SEQ_EVENT=127,i.prototype.setTime=function(t){this.time=n.translateTickTime(t||0)},i.prototype.setType=function(t){this.type=t},i.prototype.setData=function(t){this.data=t},i.prototype.toBytes=function(){if(!this.type)throw new Error("Type for meta-event not specified.");var t=[];if(t.push.apply(t,this.time),t.push(255,this.type),Array.isArray(this.data))t.push(this.data.length),t.push.apply(t,this.data);else if("number"==typeof this.data)t.push(1,this.data);else if(null!==this.data&&void 0!==this.data){t.push(this.data.length);var e=this.data.split("").map(function(t){return t.charCodeAt(0)});t.push.apply(t,e)}else t.push(0);return t};var o=function(t){if(!this)return new o(t);var e=t||{};this.events=e.events||[]};o.START_BYTES=[77,84,114,107],o.END_BYTES=[0,255,47,0],o.prototype.addEvent=function(t){return this.events.push(t),this},o.prototype.addNoteOn=o.prototype.noteOn=function(t,i,o,a){return this.events.push(new r({type:r.NOTE_ON,channel:t,param1:n.ensureMidiPitch(i),param2:a||e,time:o||0})),this},o.prototype.addNoteOff=o.prototype.noteOff=function(t,i,o,a){return this.events.push(new r({type:r.NOTE_OFF,channel:t,param1:n.ensureMidiPitch(i),param2:a||e,time:o||0})),this},o.prototype.addNote=o.prototype.note=function(t,e,n,r,i){return this.noteOn(t,e,r,i),n&&this.noteOff(t,e,n,i),this},o.prototype.addChord=o.prototype.chord=function(t,e,n,r){if(!Array.isArray(e)&&!e.length)throw new Error("Chord must be an array of pitches");return e.forEach(function(e){this.noteOn(t,e,0,r)},this),e.forEach(function(e,r){0===r?this.noteOff(t,e,n):this.noteOff(t,e)},this),this},o.prototype.setInstrument=o.prototype.instrument=function(t,e,n){return this.events.push(new r({type:r.PROGRAM_CHANGE,channel:t,param1:e,time:n||0})),this},o.prototype.setTempo=o.prototype.tempo=function(t,e){return this.events.push(new i({type:i.TEMPO,data:n.mpqnFromBpm(t),time:e||0})),this},o.prototype.toBytes=function(){var t=0,e=[],r=o.START_BYTES,i=o.END_BYTES,a=function(n){var r=n.toBytes();t+=r.length,e.push.apply(e,r)};this.events.forEach(a),t+=i.length;var s=n.str2Bytes(t.toString(16),4);return r.concat(s,e,i)};var a=function(t){if(!this)return new a(t);var e=t||{};if(e.ticks){if("number"!=typeof e.ticks)throw new Error("Ticks per beat must be a number!");if(e.ticks<=0||e.ticks>=32768||e.ticks%1!=0)throw new Error("Ticks per beat must be an integer between 1 and 32767!")}this.ticks=e.ticks||128,this.tracks=e.tracks||[]};a.HDR_CHUNKID="MThd",a.HDR_CHUNK_SIZE="\0\0\0",a.HDR_TYPE0="\0\0",a.HDR_TYPE1="\0",a.prototype.addTrack=function(t){return t?(this.tracks.push(t),this):(t=new o,this.tracks.push(t),t)},a.prototype.toBytes=function(){var t=this.tracks.length.toString(16),e=a.HDR_CHUNKID+a.HDR_CHUNK_SIZE;return e+=parseInt(t,16)>1?a.HDR_TYPE1:a.HDR_TYPE0,e+=n.codes2Str(n.str2Bytes(t,2)),e+=String.fromCharCode(this.ticks/256,this.ticks%256),this.tracks.forEach(function(t){e+=n.codes2Str(t.toBytes())}),e},t.Util=n,t.File=a,t.Track=o,t.Event=r,t.MetaEvent=i}(n),void 0!==t&&null!==t?t.exports=n:void 0!==e&&null!==e?e=n:this.Midi=n}).call(e,n(12)(t))},function(t,e){function n(t){function e(t){var e=t.read(4),n=t.readInt32();return{id:e,length:n,data:t.read(n)}}var n;stream=r(t);var i=e(stream);if("MThd"!=i.id||6!=i.length)throw"Bad .mid file - header not found";var o=r(i.data),a=o.readInt16(),s=o.readInt16(),u=o.readInt16();if(32768&u)throw"Expressing time division in SMTPE frames is not supported yet";ticksPerBeat=u;for(var l={formatType:a,trackCount:s,ticksPerBeat:ticksPerBeat},c=[],p=0;p<l.trackCount;p++){c[p]=[];var h=e(stream);if("MTrk"!=h.id)throw"Unexpected chunk - expected MTrk, got "+h.id;for(var f=r(h.data);!f.eof();){var d=function(t){var e={};e.deltaTime=t.readVarInt();var r=t.readInt8();if(240==(240&r)){if(255==r){e.type="meta";var i=t.readInt8(),o=t.readVarInt();switch(i){case 0:if(e.subtype="sequenceNumber",2!=o)throw"Expected length for sequenceNumber event is 2, got "+o;return e.number=t.readInt16(),e;case 1:return e.subtype="text",e.text=t.read(o),e;case 2:return e.subtype="copyrightNotice",e.text=t.read(o),e;case 3:return e.subtype="trackName",e.text=t.read(o),e;case 4:return e.subtype="instrumentName",e.text=t.read(o),e;case 5:return e.subtype="lyrics",e.text=t.read(o),e;case 6:return e.subtype="marker",e.text=t.read(o),e;case 7:return e.subtype="cuePoint",e.text=t.read(o),e;case 32:if(e.subtype="midiChannelPrefix",1!=o)throw"Expected length for midiChannelPrefix event is 1, got "+o;return e.channel=t.readInt8(),e;case 47:if(e.subtype="endOfTrack",0!=o)throw"Expected length for endOfTrack event is 0, got "+o;return e;case 81:if(e.subtype="setTempo",3!=o)throw"Expected length for setTempo event is 3, got "+o;return e.microsecondsPerBeat=(t.readInt8()<<16)+(t.readInt8()<<8)+t.readInt8(),e;case 84:if(e.subtype="smpteOffset",5!=o)throw"Expected length for smpteOffset event is 5, got "+o;var a=t.readInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&a],e.hour=31&a,e.min=t.readInt8(),e.sec=t.readInt8(),e.frame=t.readInt8(),e.subframe=t.readInt8(),e;case 88:if(e.subtype="timeSignature",4!=o)throw"Expected length for timeSignature event is 4, got "+o;return e.numerator=t.readInt8(),e.denominator=Math.pow(2,t.readInt8()),e.metronome=t.readInt8(),e.thirtyseconds=t.readInt8(),e;case 89:if(e.subtype="keySignature",2!=o)throw"Expected length for keySignature event is 2, got "+o;return e.key=t.readInt8(!0),e.scale=t.readInt8(),e;case 127:return e.subtype="sequencerSpecific",e.data=t.read(o),e;default:return e.subtype="unknown",e.data=t.read(o),e}return e.data=t.read(o),e}if(240==r){e.type="sysEx";var o=t.readVarInt();return e.data=t.read(o),e}if(247==r){e.type="dividedSysEx";var o=t.readVarInt();return e.data=t.read(o),e}throw"Unrecognised MIDI event type byte: "+r}var s;0==(128&r)?(s=r,r=n):(s=t.readInt8(),n=r);var u=r>>4;switch(e.channel=15&r,e.type="channel",u){case 8:return e.subtype="noteOff",e.noteNumber=s,e.velocity=t.readInt8(),e;case 9:return e.noteNumber=s,e.velocity=t.readInt8(),0==e.velocity?e.subtype="noteOff":e.subtype="noteOn",e;case 10:return e.subtype="noteAftertouch",e.noteNumber=s,e.amount=t.readInt8(),e;case 11:return e.subtype="controller",e.controllerType=s,e.value=t.readInt8(),e;case 12:return e.subtype="programChange",e.programNumber=s,e;case 13:return e.subtype="channelAftertouch",e.amount=s,e;case 14:return e.subtype="pitchBend",e.value=s+(t.readInt8()<<7),e;default:throw"Unrecognised MIDI event type: "+u}}(f);c[p].push(d)}}return{header:l,tracks:c}}function r(t){function e(e){var n=t.substr(s,e);return s+=e,n}function n(){var e=(t.charCodeAt(s)<<24)+(t.charCodeAt(s+1)<<16)+(t.charCodeAt(s+2)<<8)+t.charCodeAt(s+3);return s+=4,e}function r(){var e=(t.charCodeAt(s)<<8)+t.charCodeAt(s+1);return s+=2,e}function i(e){var n=t.charCodeAt(s);return e&&n>127&&(n-=256),s+=1,n}function o(){return s>=t.length}function a(){for(var t=0;;){var e=i();if(!(128&e))return t+e;t+=127&e,t<<=7}}var s=0;return{eof:o,read:e,readInt32:n,readInt16:r,readInt8:i,readVarInt:a}}t.exports=function(t){return n(t)}},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}}])})},function(t,e,n){"use strict";function r(t,e,n){var r,u,l=e.shape,c=l.length,p=1,h=new Array(c),f=0;for(r=c-1;r>=0;--r)if(h[r]=p,p*=l[r],f=Math.max(f,s.scratchMemory(l[r])),e.shape[r]!==n.shape[r])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var d,m=4*p+f;d="array"===e.dtype||"float64"===e.dtype||"custom"===e.dtype?a.mallocDouble(m):a.mallocFloat(m);var y,g,v,b,_=o(d,l.slice(0),h,0),w=o(d,l.slice(0),h.slice(0),p),S=o(d,l.slice(0),h.slice(0),2*p),x=o(d,l.slice(0),h.slice(0),3*p),T=4*p;for(i.assign(_,e),i.assign(w,n),r=c-1;r>=0&&(s(t,p/l[r],l[r],d,_.offset,w.offset,T),0!==r);--r){for(g=1,v=S.stride,b=x.stride,u=r-1;u<c;++u)b[u]=v[u]=g,g*=l[u];for(u=r-2;u>=0;--u)b[u]=v[u]=g,g*=l[u];i.assign(S,_),i.assign(x,w),y=_,_=S,S=y,y=w,w=x,x=y}i.assign(e,_),i.assign(n,w),a.free(d)}var i=n(98),o=n(99),a=n(156),s=n(364);t.exports=r},function(t,e,n){function r(t,e,n,r,i,u,l){t|=0,e|=0,n|=0,i|=0,u|=0,s.isPow2(n)?o(t,e,n,r,i,u):a(t,e,n,r,i,u,l)}function i(t){return s.isPow2(t)?0:2*t+4*s.nextPow2(2*t+1)}function o(t,e,n,r,i,o){t|=0,e|=0,n|=0,i|=0,o|=0;var a,u,l,c,p,h,f,d,m,y,g,v,b,_,w,S,x,T,P,E,A,N,O,k,I;for(a=n,u=s.log2(a),T=0;T<e;++T){for(f=a>>1,p=0,l=0;l<a-1;l++){for(l<p&&(b=r[i+l],r[i+l]=r[i+p],r[i+p]=b,b=r[o+l],r[o+l]=r[o+p],r[o+p]=b),h=f;h<=p;)p-=h,h>>=1;p+=h}for(g=-1,v=0,y=1,d=0;d<u;d++){for(m=y,y<<=1,S=1,x=0,p=0;p<m;p++){for(l=p;l<a;l+=y)c=l+m,P=r[i+c],E=r[o+c],A=r[i+l],N=r[o+l],O=S*(P+E),k=P*(x-S),I=E*(S+x),_=O-I,w=O+k,r[i+c]=A-_,r[o+c]=N-w,r[i+l]+=_,r[o+l]+=w;O=g*(S+x),k=S*(v-g),I=x*(g+v),S=O-I,x=O+k}v=Math.sqrt((1-g)/2),t<0&&(v=-v),g=Math.sqrt((1+g)/2)}if(t<0){var C=1/a;for(l=0;l<a;l++)r[i+l]*=C,r[o+l]*=C}i+=n,o+=n}}function a(t,e,n,r,i,a,u){t|=0,e|=0,n|=0,i|=0,a|=0,u|=0;var l,c,p,h,f,d,m,y,g,v=s.nextPow2(2*n+1),b=u,_=b+n,w=_+n,S=w+v,x=S+v,T=x+v,P=-t*Math.PI/n;for(g=0;g<n;++g)c=P*(g*g%(2*n)),h=Math.cos(c),f=Math.sin(c),r[x+(v-g)]=r[x+g]=r[b+g]=h,r[T+(v-g)]=r[T+g]=r[_+g]=f;for(g=n;g<=v-n;++g)r[x+g]=0;for(g=n;g<=v-n;++g)r[T+g]=0;for(o(1,1,v,r,x,T),P=t<0?1/n:1,l=0;l<e;++l){for(g=0;g<n;++g)c=r[i+g],p=r[a+g],h=r[b+g],f=-r[_+g],d=h*(c+p),m=c*(f-h),y=p*(h+f),r[w+g]=d-y,r[S+g]=d+m;for(g=n;g<v;++g)r[w+g]=0;for(g=n;g<v;++g)r[S+g]=0;for(o(1,1,v,r,w,S),g=0;g<v;++g)c=r[w+g],p=r[S+g],h=r[x+g],f=r[T+g],d=h*(c+p),m=c*(f-h),y=p*(h+f),r[w+g]=d-y,r[S+g]=d+m;for(o(-1,1,v,r,w,S),g=0;g<n;++g)c=r[w+g],p=r[S+g],h=r[b+g],f=-r[_+g],d=h*(c+p),m=c*(f-h),y=p*(h+f),r[i+g]=P*(d-y),r[a+g]=P*(d+m);i+=n,a+=n}}var s=n(148);t.exports=r,t.exports.scratchMemory=i},function(t,e,n){"use strict";function r(t,e,n,r){"undefined"==typeof n&&(n=-(1/0)),"undefined"==typeof r&&(r=1/0);var s=e.shape,l=t.shape;if(e.shape.length!==t.shape.length)throw new Error("ndarray-resample: input and output arrays should have the same dimensions");var c,p=s.map(function(){return 0});if(1===t.size)return c=a.sum(e)/e.size,c<n&&(c=n),c>r&&(c=r),void t.set.apply(t,p.concat(c));if(1===e.size)return c=e.get.apply(e,p),c<n&&(c=n),c>r&&(c=r),void a.assigns(t,c);for(var h=s.length,f=new Array(h),d=!1,m=0;m<h;m++)f[m]=Math.min(l[m],s[m]),l[m]>s[m]&&(d=!0);var y=o.malloc(s),g=o.malloc(s);a.assign(y,e),a.assigns(g,0),i(1,y,g);var v=y.lo,b=y.hi,_=o.malloc(l),w=o.malloc(l);d&&(a.assigns(_,0),a.assigns(w,0));for(var S=new Array(h),x=new Array(h),T=new Array(h),P=new Array(h),m=0;m<1<<h;++m){for(var E=0;E<h;++E)if(m&1<<E){if(S[E]=f[E]-(f[E]+1>>>1),0===S[E])continue;x[E]=l[E]-S[E],T[E]=s[E]-S[E],P[E]=1&f[E]?0:1}else S[E]=f[E]+1>>>1,x[E]=0,T[E]=0,P[E]=0;a.assign(b.apply(v.apply(_,x),S),b.apply(v.apply(y,T),S)),a.assign(v.apply(b.apply(v.apply(w,x),S),P),v.apply(b.apply(v.apply(g,T),S),P)),a.assigns(b.apply(b.apply(v.apply(w,x),S),P),0)}i(-1,_,w),u(t,_,t.size/e.size,n,r),o.free(y),o.free(g),o.free(_),o.free(w)}var i=n(363),o=n(366),a=n(98),s=n(354),u=s({args:["array","array","scalar","scalar","scalar"],body:function(t,e,n,r,i){var o=e*n;o<r&&(o=r),o>i&&(o=i),t=o}});t.exports=r},function(t,e,n){"use strict";function r(t){var e=t.dtype;"generic"!==e&&"array"!==e||(e="double");var n=p.malloc(t.size,e),r=l(n,t.shape);return c.assign(r,t),r}function i(t,e){e||(e="double");for(var n=1,r=new Array(t.length),i=t.length-1;i>=0;--i)r[i]=n,n*=t[i];return l(p.malloc(n,e),t,r,0)}function o(t){"generic"!==t.dtype&&"array"!==t.dtype&&p.free(t.data)}function a(t,e){e||(e="double");for(var n=1,r=new Array(t.length),i=t.length-1;i>=0;--i)r[i]=n,n*=t[i];for(var o=p.malloc(n,e),i=0;i<n;++i)o[i]=0;return l(o,t,r,0)}function s(t,e){e||(e="double");for(var n=1,r=new Array(t.length),i=t.length-1;i>=0;--i)r[i]=n,n*=t[i];for(var o=p.malloc(n,e),i=0;i<n;++i)o[i]=1;return l(o,t,r,0)}function u(t,e){var n,r;e||(e="double");var i=1,o=new Array(t.length);for(n=t.length-1;n>=0;--n)o[n]=i,i*=t[n];var a=p.malloc(i,e);for(n=0;n<i;++n)a[n]=0;var s=1/0,u=0;for(n=t.length-1;n>=0;n--)u+=o[n],s=Math.min(s,t[n]);for(n=0,r=0;n<s;n++,r+=u)a[r]=1;return l(a,t,o,0)}var l=n(99),c=n(98),p=n(156);e.clone=r,e.malloc=i,e.free=o,e.zeros=a,e.ones=s,e.eye=u},function(t,e,n){"use strict";function r(){i.Reader._configure(i.BufferReader),i.util._configure()}var i=e;i.build="minimal",i.Writer=n(153),i.BufferWriter=n(373),i.Reader=n(152),i.BufferReader=n(368),i.util=n(37),i.rpc=n(370),i.roots=n(369),i.configure=r,i.Writer._configure(i.BufferWriter),r()},function(t,e,n){"use strict";function r(t){i.call(this,t)}t.exports=r;var i=n(152);(r.prototype=Object.create(i.prototype)).constructor=r;var o=n(37);o.Buffer&&(r.prototype._slice=o.Buffer.prototype.slice),r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))}},function(t,e){"use strict";t.exports={}},function(t,e,n){"use strict";var r=e;r.Service=n(371)},function(t,e,n){"use strict";function r(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n);
}t.exports=r;var i=n(37);(r.prototype=Object.create(i.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function t(e,n,r,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return i.asPromise(t,s,e,n,r,o);if(!s.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),function(t,n){if(t)return s.emit("error",t,e),a(t);if(null===n)return void s.end(!0);if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),a(t)}return s.emit("data",n,e),a(null,n)})}catch(t){return s.emit("error",t,e),void setTimeout(function(){a(t)},0)}},r.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,e,n){"use strict";function r(t,e){this.lo=t>>>0,this.hi=e>>>0}t.exports=r;var i=n(37),o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(t){if(0===t)return o;var e=t<0;e&&(t=-t);var n=t>>>0,i=(t-n)/4294967296>>>0;return e&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)},r.from=function(t){if("number"==typeof t)return r.fromNumber(t);if(i.isString(t)){if(!i.Long)return r.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new r(t.low>>>0,t.high>>>0):o},r.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=~this.lo+1>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var s=String.prototype.charCodeAt;r.fromHash=function(t){return t===a?o:new r((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},r.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},r.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},function(t,e,n){"use strict";function r(){o.call(this)}function i(t,e,n){t.length<40?a.utf8.write(t,e,n):e.utf8Write(t,n)}t.exports=r;var o=n(153);(r.prototype=Object.create(o.prototype)).constructor=r;var a=n(37),s=a.Buffer;r.alloc=function(t){return(r.alloc=a._Buffer_allocUnsafe)(t)};var u=s&&s.prototype instanceof Uint8Array&&"set"===s.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]};r.prototype.bytes=function(t){a.isString(t)&&(t=a._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(u,e,t),this},r.prototype.string=function(t){var e=s.byteLength(t);return this.uint32(e),e&&this._push(i,e,t),this}},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){var e=this,n=l();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function s(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new a(t),r=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+1.1102230246251565e-16*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}function l(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){t+=e.charCodeAt(n);var r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)};return e}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.alea=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,r=(t+e)/(1<<21);while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.tychei=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,r=(t+e)/(1<<21);while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.xor128=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){function e(t,e){var n,r,i,o,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),i=0,o=-32;o<u;++o)e&&(r^=e.charCodeAt((o+32)%e.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,n=s[127&o]^=r+a,i=0==n?i+1:0);for(i>=128&&(s[127&(e&&e.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;t.w=a,t.X=s,t.i=i}var n=this;n.next=function(){var t,e,r=n.w,i=n.X,o=n.i;return n.w=r=r+1640531527|0,e=i[o+34&127],t=i[o=o+1&127],e^=e<<13,t^=t<<17,e^=e>>>15,t^=t>>>12,e=i[o]=e^t,n.i=o,e+(r^r>>>16)|0},e(n,t)}function s(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,r=(t+e)/(1<<21);while(0===r);return r},i.int32=n.next,i.quick=i,r&&(r.X&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.xor4096=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){function e(t,e){var n,r,i=[];if(e===(0|e))r=i[0]=e;else for(e=""+e,n=0;n<e.length;++n)i[7&n]=i[7&n]<<15^e.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(r=8==n?i[7]=-1:i[n],t.x=i,t.i=0,n=256;n>0;--n)t.next()}var n=this;n.next=function(){var t,e,r=n.x,i=n.i;return t=r[i],t^=t>>>7,e=t^t<<24,t=r[i+1&7],e^=t^t>>>10,t=r[i+3&7],e^=t^t>>>3,t=r[i+4&7],e^=t^t<<7,t=r[i+7&7],t^=t<<13,e^=t^t<<9,r[i]=e,n.i=i+1&7,e},e(n,t)}function s(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,r=(t+e)/(1<<21);while(0===r);return r},i.int32=n.next,i.quick=i,r&&(r.x&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.xorshift7=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;(function(t){!function(t,i,o){function a(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^(t^t<<1))|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function s(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new a(t),r=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,r=(t+e)/(1<<21);while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&s(r,n),i.state=function(){return s(n,{})}),i}i&&i.exports?i.exports=u:n(19)&&n(43)?(r=function(){return u}.call(e,n,e,i),!(void 0!==r&&(i.exports=r))):this.xorwow=u}(this,"object"==typeof t&&t,n(19))}).call(e,n(44)(t))},function(t,e,n){var r;!function(i,o){function a(t,e,n){var r=[];e=1==e?{entropy:!0}:e||{};var a=c(l(e.entropy?[t,h(i)]:null==t?p():t,3),r),f=new s(r),d=function(){for(var t=f.g(y),e=b,n=0;t<_;)t=(t+n)*m,e*=m,n=f.g(1);for(;t>=w;)t/=2,e/=2,n>>>=1;return(t+n)/e};return d.int32=function(){return 0|f.g(4)},d.quick=function(){return f.g(4)/4294967296},d.double=d,c(h(f.S),i),(e.pass||n||function(t,e,n,r){return r&&(r.S&&u(r,f),t.state=function(){return u(f,{})}),n?(o[v]=t,e):t})(d,a,"global"in e?e.global:this==o,e.state)}function s(t){var e,n=t.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(t=[n++]);i<m;)a[i]=i++;for(i=0;i<m;i++)a[i]=a[o=S&o+t[i%n]+(e=a[i])],a[o]=e;(r.g=function(t){for(var e,n=0,i=r.i,o=r.j,a=r.S;t--;)e=a[i=S&i+1],n=n*m+a[S&(a[i]=a[o=S&o+e])+(a[o]=e)];return r.i=i,r.j=o,n})(m)}function u(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function l(t,e){var n,r=[],i=typeof t;if(e&&"object"==i)for(n in t)try{r.push(l(t[n],e-1))}catch(t){}return r.length?r:"string"==i?t:t+"\0"}function c(t,e){for(var n,r=t+"",i=0;i<r.length;)e[S&i]=S&(n^=19*e[S&i])+r.charCodeAt(i++);return h(e)}function p(){try{var t;return f&&(t=f.randomBytes)?t=t(m):(t=new Uint8Array(m),(d.crypto||d.msCrypto).getRandomValues(t)),h(t)}catch(t){var e=d.navigator,n=e&&e.plugins;return[+new Date,d,n,d.screen,h(i)]}}function h(t){return String.fromCharCode.apply(0,t)}var f,d=this,m=256,y=6,g=52,v="random",b=o.pow(m,y),_=o.pow(2,g),w=2*_,S=m-1;if(o["seed"+v]=a,c(o.random(),i),"object"==typeof t&&t.exports){t.exports=a;try{f=n(415)}catch(t){}}else r=function(){return a}.call(e,n,e,t),!(void 0!==r&&(t.exports=r))}([],Math)},function(t,e,n){(function(t,e){!function(t,n){"use strict";function r(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var r={callback:t,args:e};return m[d]=r,f(d),d++}function i(t){delete m[t]}function o(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}function a(t){if(y)setTimeout(a,0,t);else{var e=m[t];if(e){y=!0;try{o(e)}finally{i(t),y=!1}}}}function s(){f=function(t){e.nextTick(function(){a(t)})}}function u(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}function l(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&a(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),f=function(n){t.postMessage(e+n,"*")}}function c(){var t=new MessageChannel;t.port1.onmessage=function(t){var e=t.data;a(e)},f=function(e){t.port2.postMessage(e)}}function p(){var t=g.documentElement;f=function(e){var n=g.createElement("script");n.onreadystatechange=function(){a(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}function h(){f=function(t){setTimeout(a,0,t)}}if(!t.setImmediate){var f,d=1,m={},y=!1,g=t.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(t);v=v&&v.setTimeout?v:t,"[object process]"==={}.toString.call(t.process)?s():u()?l():t.MessageChannel?c():g&&"onreadystatechange"in g.createElement("script")?p():h(),v.setImmediate=r,v.clearImmediate=i}}("undefined"==typeof self?"undefined"==typeof t?this:t:self)}).call(e,function(){return this}(),n(66))},function(t,e,n){var r,i,o;/**
	 *  StartAudioContext.js
	 *  @author Yotam Mann
	 *  @license http://opensource.org/licenses/MIT MIT License
	 *  @copyright 2016 Yotam Mann
	 */
!function(n,a){i=[],r=a,o="function"==typeof r?r.apply(e,i):r,!(void 0!==o&&(t.exports=o))}(this,function(){function t(t){var e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0),t.resume&&t.resume()}function e(t){return"running"===t.state}function n(t,n){function r(){e(t)?n():(requestAnimationFrame(r),t.resume&&t.resume())}e(t)?n():r()}function r(t,e,n){if(Array.isArray(t)||NodeList&&t instanceof NodeList)for(var i=0;i<t.length;i++)r(t[i],e,n);else if("string"==typeof t)r(document.querySelectorAll(t),e,n);else if(t.jquery&&"function"==typeof t.toArray)r(t.toArray(),e,n);else if(Element&&t instanceof Element){var a=new o(t,n);e.push(a)}}function i(t,e,i){var o=new Promise(function(e){n(t,e)}),a=[];return e||(e=document.body),r(e,a,t),o.then(function(){for(var t=0;t<a.length;t++)a[t].dispose();a=null,i&&i()}),o}var o=function(t,e){this._dragged=!1,this._element=t,this._bindedMove=this._moved.bind(this),this._bindedEnd=this._ended.bind(this,e),t.addEventListener("touchstart",this._bindedEnd),t.addEventListener("touchmove",this._bindedMove),t.addEventListener("touchend",this._bindedEnd),t.addEventListener("mouseup",this._bindedEnd)};return o.prototype._moved=function(t){this._dragged=!0},o.prototype._ended=function(e){this._dragged||t(e),this._dragged=!1},o.prototype.dispose=function(){this._element.removeEventListener("touchstart",this._bindedEnd),this._element.removeEventListener("touchmove",this._bindedMove),this._element.removeEventListener("touchend",this._bindedEnd),this._element.removeEventListener("mouseup",this._bindedEnd),this._bindedMove=null,this._bindedEnd=null,this._element=null},i})},function(t,e,n){var r=n(346);"string"==typeof r&&(r=[[t.id,r,""]]);n(67)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){var r=n(347);"string"==typeof r&&(r=[[t.id,r,""]]);n(67)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){var r=n(348);"string"==typeof r&&(r=[[t.id,r,""]]);n(67)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){var r=n(349);"string"==typeof r&&(r=[[t.id,r,""]]);n(67)(r,{});r.locals&&(t.exports=r.locals)},function(t,e,n){(function(t){function r(t,e){this._id=t,this._clearFn=e}var i="undefined"!=typeof t&&t||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;e.setTimeout=function(){return new r(o.call(setTimeout,i,arguments),clearTimeout)},e.setInterval=function(){return new r(o.call(setInterval,i,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(i,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n(381),e.setImmediate="undefined"!=typeof self&&self.setImmediate||"undefined"!=typeof t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||"undefined"!=typeof t&&t.clearImmediate||this&&this.clearImmediate}).call(e,function(){return this}())},function(t,e,n){"use strict";function r(t,e){if(e)return f(e).intervals.map(a.transpose(t));var n=i(t),r=n[0],o=n[1];return f(o).intervals.map(a.transpose(r))}function i(t){var e=o.tokenize(t);return""===e[0]?["",t]:"A"===e[0]&&"ug"===e[3]?["","aug"]:v.test(e[2])?[e[0]+e[1],e[2]+e[3]]:[e[0]+e[1]+e[2],e[3]]}Object.defineProperty(e,"__esModule",{value:!0});var o=n(42),a=n(102),s=n(101),u=n(68),l=s.chord.names,c=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),p=function(t){var e=s.chord(t);if(!e)return c;var n={intervals:e,name:t};return n.chroma=u.chroma(e),n.setnum=parseInt(n.chroma,2),n.names=s.chord.names(n.chroma),n},h=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}},f=h(p),d=function(t){return f(i(t)[1]).intervals},m=function(t){return void 0!==s.chord(i(t)[1])},y=function(t){if(!d(t).length)return[];var e=u.isSupersetOf(d(t));return s.chord.names().filter(function(t){return e(s.chord(t))})},g=function(t){var e=u.isSubsetOf(d(t));return s.chord.names().filter(function(t){return e(s.chord(t))})},v=/^(6|64|7|9|11|13)$/;e.names=l,e.props=f,e.intervals=d,e.notes=r,e.exists=m,e.supersets=y,e.subsets=g,e.tokenize=i},function(t,e,n){"use strict";function r(t,e){var n=o(t);return e=e||n[1],y(e).map(u.transpose(n[0]))}function i(t){var e=o(t);return void 0!==l.scale(e[1])}function o(t){if("string"!=typeof t)return["",""];var e=t.indexOf(" "),n=a.name(t.substring(0,e))||a.name(t)||"",r=""!==n?t.substring(n.length+1):t;return[n,r.length?r:""]}Object.defineProperty(e,"__esModule",{value:!0});var a=n(42),s=n(68),u=n(102),l=n(101),c=n(100),p=Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}),h=function(t){var e=l.scale(t);if(!e)return p;var n={intervals:e,name:t};return n.chroma=s.chroma(e),n.setnum=parseInt(n.chroma,2),n.names=l.scale.names(n.chroma),Object.freeze(n)},f=function(t,e){return function(n){return e[n]||(e[n]=t(n))}},d=f(h,{}),m=l.scale.names,y=function(t){var e=o(t);return d(e[1]).intervals},g=function(t){var e=y(t),n=r(t);return s.modes(e).map(function(t,r){var i=l.scale.names(t)[0];if(i)return[n[r]||e[r],i]}).filter(function(t){return t})},v=function(t){var e=s.isSubsetOf(y(t));return l.chord.names().filter(function(t){return e(l.chord(t))})},b=function(t){var e=c.compact(t.map(a.pc));if(!e.length)return e;var n=e[0],r=c.unique(e);return c.rotate(r.indexOf(n),r)},_=function(t){if(!y(t).length)return[];var e=s.isSupersetOf(y(t));return l.scale.names().filter(function(t){return e(l.scale(t))})},w=function(t){var e=s.isSubsetOf(y(t));return l.scale.names().filter(function(t){return e(l.scale(t))})};e.props=d,e.names=m,e.intervals=y,e.notes=r,e.exists=i,e.tokenize=o,e.modeNames=g,e.chords=v,e.toScale=b,e.supersets=_,e.subsets=w},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(100),i=n(42),o=n(103),a=n(102),s=n(101),u=n(389),l=n(388),c=n(68),p=a.transpose,h=a.interval,f=i.props,d=i.midi,m=i.freq,y=s.chord,g=s.scale;e.Array=r,e.Note=i,e.Interval=o,e.Distance=a,e.Dictionary=s,e.Scale=u,e.Chord=l,e.PcSet=c,e.transpose=p,e.interval=h,e.note=f,e.midi=d,e.freq=m,e.chord=y,e.scale=g},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACpCAYAAAC74qYsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAhtJREFUeNrs3MFRg0AUgGHiUEA60Q7EDtIFVzvQErhysxO1A+0gJdABeTvD0ZzChl35vpkMNzI8/pAAGQ7zPDdQuoNQESoIFaGCUEGoCBWECkJFqCBUECpCBaEiVBAqCBWhglBBqAgVhApCRaggVIRqCggVhIpQQaggVIQKQgWhIlQQKggVoYJQESoIFYSKUEGoIFSECkIFoSJUECpCBaGCUBEqCBWEilBBqCBUhApCBaEiVBAqQgWhglARKggVhLqxvu/fYzGM4zhlWPcxFk+FbfJPjm1tM++kNMShpCnGELs7v2V6v1PMosuwA9N8PwsL9SVeX1WFGtIn/tlxtXlMOy9TrLvwYAR3j/VoFEIVq1ARq1DFilDFKlTEKlSxIlSxVqU1gr8ttz7fNojVTQFHVEdWoSJWoe4y1sEYhFq633i9GoNQS4/UCZVQRVojl6eu+2jW+QPwsPzmFKlQ1xfBnGNxvnU9cfY+idRXv697oSJSoSJSoYpUqIhUqCJFqCKtmuuodUea1vdd2LZm+SB69lRmOZ89tSdCRaggVIQKQgWhIlQQKggVoYJQQagIFYSKUEGoIFSECkIFoSJUECoIFaGCUBGqUBEqCBWhglBBqAgVhApCRaggVBAqQgWhIlQQKggVoYJQQagIFYQKQkWoIFSECkIFoSJUECoIFaGCUEGoCBWECkJFqCBUhApCBaEiVBAqCJX/4SLAAIzUH77oewIUAAAAAElFTkSuQmCC"},function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKoAAACpCAYAAAC74qYsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAgBJREFUeNrs3MENgjAYgFE0DuAmugG4kSM4AiO4ibqBbuAIbFBL0qvhIL8p+l7SK9r2E4ghrFJKDdRubQkQKggVoYJQQagIFYQKQkWoIFQQKkIFoSJUECoIFaGCUEGoCBWECkJFqCBUhApCBaEiVBAqCBWhglBBqAgVhApCRaggVIQKQgWhIlQQKggVoYJQQagIFYSKUEGoIFSECkIFoSJUECoIFaGCUEGoCBWEilBBqCBUhApChSkbSxDulEefxxBw7G0e+8rme4+Y6yqlFPml92WTatJ9+fOuJaguYAPHY14qW99DmfOizqjjBrVOqs2ubF5ErO5RCYl1aymEKlahIlahihWhilWoiFWoYkWoYhXqjzjlkWYYrViF6swqVMQqVKZj7S2DUGv3yONoGYRae6Rd4ykroYp0eTzh/965mecB4L7cc4pUqCGeZXxqEKlLv8u9UBGpUBGpUEUqVEQqVJEiVJEumv9Rlx3peLxbZXMN+SFGv9KH2HdP/Q2h4h4VhIpQQaggVIQKQgWhIlQQKggVoYJQESoIFYSKUEGoIFSECkIFoSJUECpCBaGCUBEqCBWEilBBqCBUhApCBaEiVBAqQgWhglARKggVhIpQQaggVIQKQkWoIFQQKkIFoYJQESoIFYSKUEGoIFSECkJFqCBUECpCBaGCUPkNLwEGAJsYWNoPx2CkAAAAAElFTkSuQmCC"},function(t,e,n){var r,i;r=[n(4),n(18)],i=function(t){"use strict";return t.Filter=function(){t.call(this);var e=this.optionsObject(arguments,["frequency","type","rolloff"],t.Filter.defaults);this._filters=[],this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(0,t.Type.Cents),this.gain=new t.Signal({value:e.gain,convert:!1}),this.Q=new t.Signal(e.Q),this._type=e.type,this._rolloff=e.rolloff,this.rolloff=e.rolloff,this._readOnly(["detune","frequency","gain","Q"])},t.extend(t.Filter),t.Filter.defaults={type:"lowpass",frequency:350,rolloff:-12,Q:1,gain:0},Object.defineProperty(t.Filter.prototype,"type",{get:function(){return this._type},set:function(t){var e=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];if(e.indexOf(t)===-1)throw new Error("Tone.Filter does not have filter type "+t);this._type=t;for(var n=0;n<this._filters.length;n++)this._filters[n].type=t}}),Object.defineProperty(t.Filter.prototype,"rolloff",{get:function(){return this._rolloff},set:function(t){t=parseInt(t,10);var e=[-12,-24,-48,-96],n=e.indexOf(t);if(n===-1)throw new Error("Filter rolloff can only be -12, -24, -48 or -96");n+=1,this._rolloff=t,this.input.disconnect();for(var r=0;r<this._filters.length;r++)this._filters[r].disconnect(),this._filters[r]=null;this._filters=new Array(n);for(var i=0;i<n;i++){var o=this.context.createBiquadFilter();o.type=this._type,this.frequency.connect(o.frequency),this.detune.connect(o.detune),this.Q.connect(o.Q),this.gain.connect(o.gain),this._filters[i]=o}var a=[this.input].concat(this._filters).concat([this.output]);this.connectSeries.apply(this,a)}}),t.Filter.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e=0;e<this._filters.length;e++)this._filters[e].disconnect(),this._filters[e]=null;return this._filters=null,this._writable(["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.frequency=null,this.Q=null,this.detune.dispose(),this.detune=null,this.gain.dispose(),this.gain=null,this},t.Filter}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(395),n(105)],i=function(t){"use strict";return t.FrequencyEnvelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);t.ScaledEnvelope.call(this,e),e=this.defaultArg(e,t.FrequencyEnvelope.defaults),this._octaves=e.octaves,this.baseFrequency=e.baseFrequency,this.octaves=e.octaves},t.extend(t.FrequencyEnvelope,t.Envelope),t.FrequencyEnvelope.defaults={baseFrequency:200,octaves:4,exponent:2},Object.defineProperty(t.FrequencyEnvelope.prototype,"baseFrequency",{get:function(){return this._scale.min},set:function(t){this._scale.min=this.toFrequency(t)}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"octaves",{get:function(){return this._octaves},set:function(t){this._octaves=t,this._scale.max=this.baseFrequency*Math.pow(2,t)}}),Object.defineProperty(t.FrequencyEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),t.FrequencyEnvelope.prototype.dispose=function(){return t.ScaledEnvelope.prototype.dispose.call(this),this},t.FrequencyEnvelope}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(105),n(409)],i=function(t){"use strict";return t.ScaledEnvelope=function(){var e=this.optionsObject(arguments,["attack","decay","sustain","release"],t.Envelope.defaults);t.Envelope.call(this,e),e=this.defaultArg(e,t.ScaledEnvelope.defaults),this._exp=this.output=new t.Pow(e.exponent),this._scale=this.output=new t.Scale(e.min,e.max),this._sig.chain(this._exp,this._scale)},t.extend(t.ScaledEnvelope,t.Envelope),t.ScaledEnvelope.defaults={min:0,max:1,exponent:1},Object.defineProperty(t.ScaledEnvelope.prototype,"min",{get:function(){return this._scale.min},set:function(t){this._scale.min=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"max",{get:function(){return this._scale.max},set:function(t){this._scale.max=t}}),Object.defineProperty(t.ScaledEnvelope.prototype,"exponent",{get:function(){return this._exp.value},set:function(t){this._exp.value=t}}),t.ScaledEnvelope.prototype.dispose=function(){return t.Envelope.prototype.dispose.call(this),this._scale.dispose(),this._scale=null,this._exp.dispose(),this._exp=null,this},t.ScaledEnvelope}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(163),n(107)],i=function(t){"use strict";return t.Clock=function(){var e=this.optionsObject(arguments,["callback","frequency"],t.Clock.defaults);this.callback=e.callback,this._lookAhead="auto",this._computedLookAhead=1/60,this._threshold=.5,this._nextTick=-1,this._lastUpdate=0,this._loopID=-1,this.frequency=new t.TimelineSignal(e.frequency,t.Type.Frequency),this.ticks=0,this._state=new t.TimelineState(t.State.Stopped),this._boundLoop=this._loop.bind(this),this._readOnly("frequency"),this._loop()},t.extend(t.Clock),t.Clock.defaults={callback:t.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(t.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Object.defineProperty(t.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(t){"auto"===t?this._lookAhead="auto":this._lookAhead=this.toSeconds(t)}}),t.Clock.prototype.start=function(e,n){return e=this.toSeconds(e),this._state.getStateAtTime(e)!==t.State.Started&&this._state.addEvent({state:t.State.Started,time:e,offset:n}),this},t.Clock.prototype.stop=function(e){return e=this.toSeconds(e),this._state.getStateAtTime(e)!==t.State.Stopped&&this._state.setStateAtTime(t.State.Stopped,e),this},t.Clock.prototype.pause=function(e){return e=this.toSeconds(e),this._state.getStateAtTime(e)===t.State.Started&&this._state.setStateAtTime(t.State.Paused,e),this},t.Clock.prototype._loop=function(e){if(this._loopID=requestAnimationFrame(this._boundLoop),"auto"===this._lookAhead){if(!this.isUndef(e)){var n=(e-this._lastUpdate)/1e3;this._lastUpdate=e,n<this._threshold&&(this._computedLookAhead=(9*this._computedLookAhead+n)/10)}}else this._computedLookAhead=this._lookAhead;var r=this.now(),i=2*this._computedLookAhead,o=this._state.getEvent(r+i),a=t.State.Stopped;if(o&&(a=o.state,this._nextTick===-1&&a===t.State.Started&&(this._nextTick=o.time,this.isUndef(o.offset)||(this.ticks=o.offset))),a===t.State.Started)for(;r+i>this._nextTick;){r>this._nextTick+this._threshold&&(this._nextTick=r);var s=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),this.callback(s),this.ticks++}else a===t.State.Stopped&&(this._nextTick=-1,this.ticks=0)},t.Clock.prototype.getStateAtTime=function(t){return this._state.getStateAtTime(t)},t.Clock.prototype.dispose=function(){cancelAnimationFrame(this._loopID),t.TimelineState.prototype.dispose.call(this),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=t.noOp,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},t.Clock}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4)],i=function(t){"use strict";return t.Emitter=function(){this._events={}},t.extend(t.Emitter),t.Emitter.prototype.on=function(t,e){for(var n=t.split(/\W+/),r=0;r<n.length;r++){var i=n[r];this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(e)}return this},t.Emitter.prototype.off=function(e,n){for(var r=e.split(/\W+/),i=0;i<r.length;i++)if(e=r[i],this._events.hasOwnProperty(e))if(t.prototype.isUndef(n))this._events[e]=[];else for(var o=this._events[e],a=0;a<o.length;a++)o[a]===n&&o.splice(a,1);return this},t.Emitter.prototype.trigger=function(t){if(this._events){var e=Array.prototype.slice.call(arguments,1);if(this._events.hasOwnProperty(t))for(var n=this._events[t],r=0,i=n.length;r<i;r++)n[r].apply(this,e)}return this},t.Emitter.mixin=function(e){var n=["on","off","trigger"];e._events={};for(var r=0;r<n.length;r++){var i=n[r],o=t.Emitter.prototype[i];e[i]=o}},t.Emitter.prototype.dispose=function(){return t.prototype.dispose.call(this),this._events=null,this},t.Emitter}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(20)],i=function(t){"use strict";t.IntervalTimeline=function(){this._root=null,this._length=0},t.extend(t.IntervalTimeline),t.IntervalTimeline.prototype.addEvent=function(t){if(this.isUndef(t.time)||this.isUndef(t.duration))throw new Error("events must have time and duration parameters");var n=new e(t.time,t.time+t.duration,t);for(null===this._root?this._root=n:this._root.insert(n),this._length++;null!==n;)n.updateHeight(),n.updateMax(),this._rebalance(n),n=n.parent;return this},t.IntervalTimeline.prototype.removeEvent=function(t){if(null!==this._root){var e=[];this._root.search(t.time,e);for(var n=0;n<e.length;n++){var r=e[n];if(r.event===t){this._removeNode(r),this._length--;break}}}return this},Object.defineProperty(t.IntervalTimeline.prototype,"length",{get:function(){return this._length}}),t.IntervalTimeline.prototype.cancel=function(t){return t=this.toSeconds(t),this.forEachAfter(t,function(t){this.removeEvent(t)}.bind(this)),this},t.IntervalTimeline.prototype._setRoot=function(t){this._root=t,null!==this._root&&(this._root.parent=null)},t.IntervalTimeline.prototype._replaceNodeInParent=function(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)},t.IntervalTimeline.prototype._removeNode=function(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{var e,n,r=t.getBalance();if(r>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent=e.parent,e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),this._rebalance(n)}t.dispose()},t.IntervalTimeline.prototype._rotateLeft=function(t){var e=t.parent,n=t.isLeftChild(),r=t.right;t.right=r.left,r.left=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rotateRight=function(t){var e=t.parent,n=t.isLeftChild(),r=t.left;t.left=r.right,r.right=t,null!==e?n?e.left=r:e.right=r:this._setRoot(r)},t.IntervalTimeline.prototype._rebalance=function(t){var e=t.getBalance();e>1?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))},t.IntervalTimeline.prototype.getEvent=function(t){if(null!==this._root){var e=[];if(this._root.search(t,e),e.length>0){for(var n=e[0],r=1;r<e.length;r++)e[r].low>n.low&&(n=e[r]);return n.event}}return null},t.IntervalTimeline.prototype.forEach=function(t){if(null!==this._root){var e=[];null!==this._root&&this._root.traverse(function(t){e.push(t)});for(var n=0;n<e.length;n++){var r=e[n].event;r&&t(r)}}return this},t.IntervalTimeline.prototype.forEachOverlap=function(t,e){if(t=this.toSeconds(t),null!==this._root){var n=[];this._root.search(t,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;i&&e(i)}}return this},t.IntervalTimeline.prototype.forEachAfter=function(t,e){if(t=this.toSeconds(t),null!==this._root){var n=[];this._root.searchAfter(t,n);for(var r=n.length-1;r>=0;r--){var i=n[r].event;i&&e(i)}}return this},t.IntervalTimeline.prototype.dispose=function(){var t=[];null!==this._root&&this._root.traverse(function(e){t.push(e)});for(var e=0;e<t.length;e++)t[e].dispose();return t=null,this._root=null,this};var e=function(t,e,n){this.event=n,this.low=t,this.high=e,this.max=this.high,this._left=null,this._right=null,this.parent=null,this.height=0};return e.prototype.insert=function(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)},e.prototype.search=function(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>=t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))},e.prototype.searchAfter=function(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)},e.prototype.traverse=function(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)},e.prototype.updateHeight=function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0},e.prototype.updateMax=function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))},e.prototype.getBalance=function(){var t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t},e.prototype.isLeftChild=function(){return null!==this.parent&&this.parent.left===this},Object.defineProperty(e.prototype,"left",{get:function(){return this._left},set:function(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),Object.defineProperty(e.prototype,"right",{get:function(){return this._right},set:function(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}}),e.prototype.dispose=function(){this.parent=null,this._left=null,this._right=null,this.event=null},t.IntervalTimeline}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(23),n(20),n(107)],i=function(t){"use strict";return t.Event=function(){var e=this.optionsObject(arguments,["callback","value"],t.Event.defaults);this._loop=e.loop,this.callback=e.callback,this.value=e.value,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._state=new t.TimelineState(t.State.Stopped),this._playbackRate=1,this._startOffset=0,this.probability=e.probability,this.humanize=e.humanize,this.mute=e.mute,this.playbackRate=e.playbackRate},t.extend(t.Event),t.Event.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,value:null,probability:1,mute:!1,humanize:!1},t.Event.prototype._rescheduleEvents=function(e){return e=this.defaultArg(e,-1),this._state.forEachFrom(e,function(e){var n;if(e.state===t.State.Started){this.isUndef(e.id)||t.Transport.clear(e.id);var r=e.time+Math.round(this.startOffset/this._playbackRate);if(this._loop){n=1/0,this.isNumber(this._loop)&&(n=(this._loop-1)*this._getLoopDuration());var i=this._state.getEventAfter(r);null!==i&&(n=Math.min(n,i.time-r)),n!==1/0&&(this._state.setStateAtTime(t.State.Stopped,r+n+1),n+="i"),e.id=t.Transport.scheduleRepeat(this._tick.bind(this),this._getLoopDuration().toString()+"i",r+"i",n)}else e.id=t.Transport.schedule(this._tick.bind(this),r+"i")}}.bind(this)),this},Object.defineProperty(t.Event.prototype,"state",{get:function(){return this._state.getStateAtTime(t.Transport.ticks)}}),Object.defineProperty(t.Event.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t}}),t.Event.prototype.start=function(e){return e=this.toTicks(e),this._state.getStateAtTime(e)===t.State.Stopped&&(this._state.addEvent({state:t.State.Started,time:e,id:void 0}),this._rescheduleEvents(e)),this},t.Event.prototype.stop=function(e){if(this.cancel(e),e=this.toTicks(e),this._state.getStateAtTime(e)===t.State.Started){this._state.setStateAtTime(t.State.Stopped,e);var n=this._state.getEventBefore(e),r=e;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this},t.Event.prototype.cancel=function(e){return e=this.defaultArg(e,-(1/0)),e=this.toTicks(e),this._state.forEachFrom(e,function(e){t.Transport.clear(e.id)}),this._state.cancel(e),this},t.Event.prototype._tick=function(e){if(!this.mute&&this._state.getStateAtTime(t.Transport.ticks)===t.State.Started){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var n=.02;this.isBoolean(this.humanize)||(n=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*n}this.callback(e,this.value)}},t.Event.prototype._getLoopDuration=function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)},Object.defineProperty(t.Event.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopEnd",{get:function(){return this.toNotation(this._loopEnd+"i")},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"loopStart",{get:function(){return this.toNotation(this._loopStart+"i")},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}}),Object.defineProperty(t.Event.prototype,"progress",{get:function(){if(this._loop){var e=t.Transport.ticks,n=this._state.getEvent(e);if(null!==n&&n.state===t.State.Started){var r=this._getLoopDuration(),i=(e-n.time)%r;return i/r}return 0}return 0}}),t.Event.prototype.dispose=function(){this.cancel(),this._state.dispose(),this._state=null,this.callback=null,this.value=null},t.Event}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(399),n(20),n(23)],i=function(t){"use strict";return t.Part=function(){var e=this.optionsObject(arguments,["callback","events"],t.Part.defaults);this._loop=e.loop,this._loopStart=this.toTicks(e.loopStart),this._loopEnd=this.toTicks(e.loopEnd),this._playbackRate=e.playbackRate,this._probability=e.probability,this._humanize=e.humanize,this._startOffset=0,this._state=new t.TimelineState(t.State.Stopped),this._events=[],this.callback=e.callback,this.mute=e.mute;var n=this.defaultArg(e.events,[]);if(!this.isUndef(e.events))for(var r=0;r<n.length;r++)Array.isArray(n[r])?this.add(n[r][0],n[r][1]):this.add(n[r])},t.extend(t.Part,t.Event),t.Part.defaults={callback:t.noOp,loop:!1,loopEnd:"1m",loopStart:0,playbackRate:1,probability:1,humanize:!1,mute:!1},t.Part.prototype.start=function(e,n){var r=this.toTicks(e);return this._state.getStateAtTime(r)!==t.State.Started&&(n=this._loop?this.defaultArg(n,this._loopStart):this.defaultArg(n,0),n=this.toTicks(n),this._state.addEvent({state:t.State.Started,time:r,offset:n}),this._forEach(function(t){this._startNote(t,r,n)})),this},t.Part.prototype._startNote=function(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(e+"i")):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(e+"i")):t.startOffset>=n&&t.start(e+"i")},Object.defineProperty(t.Part.prototype,"startOffset",{get:function(){return this._startOffset},set:function(t){this._startOffset=t,this._forEach(function(t){t.startOffset+=this._startOffset})}}),t.Part.prototype.stop=function(e){var n=this.toTicks(e);return this._state.getStateAtTime(n)===t.State.Started&&(this._state.setStateAtTime(t.State.Stopped,n),this._forEach(function(t){t.stop(e)})),this},t.Part.prototype.at=function(t,e){t=this.toTicks(t);for(var n=this.ticksToSeconds(1),r=0;r<this._events.length;r++){var i=this._events[r];if(Math.abs(t-i.startOffset)<n)return this.isUndef(e)||(i.value=e),i}return this.isUndef(e)?null:(this.add(t+"i",e),this._events[this._events.length-1])},t.Part.prototype.add=function(e,n){this.isObject(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time,delete n.time),e=this.toTicks(e);var r;return n instanceof t.Event?(r=n,r.callback=this._tick.bind(this)):r=new t.Event({callback:this._tick.bind(this),value:n}),r.startOffset=e,r.set({loopEnd:this.loopEnd,loopStart:this.loopStart,loop:this.loop,humanize:this.humanize,playbackRate:this.playbackRate,probability:this.probability}),this._events.push(r),this._restartEvent(r),this},t.Part.prototype._restartEvent=function(e){var n=this._state.getEvent(this.now());n&&n.state===t.State.Started&&this._startNote(e,n.time,n.offset)},t.Part.prototype.remove=function(e,n){this.isObject(e)&&e.hasOwnProperty("time")&&(n=e,e=n.time),e=this.toTicks(e);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i.remove(e,n):i.startOffset===e&&(this.isUndef(n)||!this.isUndef(n)&&i.value===n)&&(this._events.splice(r,1),i.dispose())}return this},t.Part.prototype.removeAll=function(){return this._forEach(function(t){t.dispose()}),this._events=[],this},t.Part.prototype.cancel=function(t){return this._forEach(function(e){e.cancel(t)}),this._state.cancel(t),this},t.Part.prototype._forEach=function(e,n){n=this.defaultArg(n,this);for(var r=this._events.length-1;r>=0;r--){var i=this._events[r];i instanceof t.Part?i._forEach(e,n):e.call(n,i)}return this},t.Part.prototype._setAll=function(t,e){this._forEach(function(n){n[t]=e})},t.Part.prototype._tick=function(t,e){this.mute||this.callback(t,e)},t.Part.prototype._testLoopBoundries=function(e){e.startOffset<this._loopStart||e.startOffset>=this._loopEnd?e.cancel():e.state===t.State.Stopped&&this._restartEvent(e)},Object.defineProperty(t.Part.prototype,"probability",{get:function(){return this._probability},set:function(t){this._probability=t,this._setAll("probability",t)}}),Object.defineProperty(t.Part.prototype,"humanize",{get:function(){return this._humanize},set:function(t){this._humanize=t,this._setAll("humanize",t)}}),Object.defineProperty(t.Part.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop=t,this._forEach(function(e){e._loopStart=this._loopStart,e._loopEnd=this._loopEnd,e.loop=t,this._testLoopBoundries(e)})}}),Object.defineProperty(t.Part.prototype,"loopEnd",{get:function(){return this.toNotation(this._loopEnd+"i")},set:function(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach(function(t){t.loopEnd=this.loopEnd,this._testLoopBoundries(t)})}}),Object.defineProperty(t.Part.prototype,"loopStart",{get:function(){return this.toNotation(this._loopStart+"i")},set:function(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach(function(t){t.loopStart=this.loopStart,this._testLoopBoundries(t)})}}),Object.defineProperty(t.Part.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._setAll("playbackRate",t)}}),Object.defineProperty(t.Part.prototype,"length",{get:function(){return this._events.length}}),t.Part.prototype.dispose=function(){return this.removeAll(),this._state.dispose(),this._state=null,this.callback=null,this._events=null,this},t.Part}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(400),n(23)],i=function(t){"use strict";return t.Sequence=function(){var e=this.optionsObject(arguments,["callback","events","subdivision"],t.Sequence.defaults),n=e.events;if(delete e.events,t.Part.call(this,e),this._subdivision=this.toTicks(e.subdivision),this.isUndef(e.loopEnd)&&!this.isUndef(n)&&(this._loopEnd=n.length*this._subdivision),this._loop=!0,!this.isUndef(n))for(var r=0;r<n.length;r++)this.add(r,n[r])},t.extend(t.Sequence,t.Part),t.Sequence.defaults={subdivision:"4n"},Object.defineProperty(t.Sequence.prototype,"subdivision",{get:function(){return this.toNotation(this._subdivision+"i")}}),t.Sequence.prototype.at=function(e,n){return this.isArray(n)&&this.remove(e),t.Part.prototype.at.call(this,this._indexTime(e),n)},t.Sequence.prototype.add=function(e,n){if(null===n)return this;if(this.isArray(n)){var r=Math.round(this._subdivision/n.length)+"i";n=new t.Sequence(this._tick.bind(this),n,r)}return t.Part.prototype.add.call(this,this._indexTime(e),n),this},t.Sequence.prototype.remove=function(e,n){return t.Part.prototype.remove.call(this,this._indexTime(e),n),
this},t.Sequence.prototype._indexTime=function(t){return this.isTicks(t)?t:t*this._subdivision+this.startOffset+"i"},t.Sequence.prototype.dispose=function(){return t.Part.prototype.dispose.call(this),this},t.Sequence}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(20)],i=function(t){"use strict";return t.Instrument=function(e){e=this.defaultArg(e,t.Instrument.defaults),this._volume=this.output=new t.Volume(e.volume),this.volume=this._volume.volume,this._readOnly("volume")},t.extend(t.Instrument),t.Instrument.defaults={volume:0},t.Instrument.prototype.triggerAttack=t.noOp,t.Instrument.prototype.triggerRelease=t.noOp,t.Instrument.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),e=this.toSeconds(e),this.triggerAttack(t,n,r),this.triggerRelease(n+e),this},t.Instrument.prototype.dispose=function(){return t.prototype.dispose.call(this),this._volume.dispose(),this._volume=null,this._writable(["volume"]),this.volume=null,this},t.Instrument}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(158),n(394),n(164),n(18),n(393),n(162)],i=function(t){"use strict";return t.MonoSynth=function(e){e=this.defaultArg(e,t.MonoSynth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new t.Filter(e.filter),this.filterEnvelope=new t.FrequencyEnvelope(e.filterEnvelope),this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.filter,this.envelope,this.output),this.oscillator.start(),this.filterEnvelope.connect(this.filter.frequency),this._readOnly(["oscillator","frequency","detune","filter","filterEnvelope","envelope"])},t.extend(t.MonoSynth,t.Monophonic),t.MonoSynth.defaults={frequency:"C4",detune:0,oscillator:{type:"square"},filter:{Q:6,type:"lowpass",rolloff:-24},envelope:{attack:.005,decay:.1,sustain:.9,release:1},filterEnvelope:{attack:.06,decay:.2,sustain:.5,release:2,baseFrequency:200,octaves:7,exponent:2}},t.MonoSynth.prototype._triggerEnvelopeAttack=function(t,e){return this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this},t.MonoSynth.prototype._triggerEnvelopeRelease=function(t){return this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this},t.MonoSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.filterEnvelope.dispose(),this.filterEnvelope=null,this.filter.dispose(),this.filter=null,this.frequency=null,this.detune=null,this},t.MonoSynth}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(403),n(31)],i=function(t){"use strict";return t.PolySynth=function(){t.Instrument.call(this);var e=this.optionsObject(arguments,["polyphony","voice"],t.PolySynth.defaults);e=this.defaultArg(e,t.Instrument.defaults),this.voices=new Array(e.polyphony),this._triggers=new Array(e.polyphony);for(var n=0;n<e.polyphony;n++){var r=new e.voice(arguments[2],arguments[3]);this.voices[n]=r,r.connect(this.output),this._triggers[n]={release:-1,note:null,voice:r}}this.volume.value=e.volume},t.extend(t.PolySynth,t.Instrument),t.PolySynth.defaults={polyphony:4,volume:0,voice:t.MonoSynth},t.PolySynth.prototype.triggerAttack=function(t,e,n){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var r=0;r<t.length;r++){for(var i=t[r],o=this._triggers[0],a=0,s=1;s<this._triggers.length;s++)this._triggers[s].release<o.release&&(o=this._triggers[s],a=s);o.release=1/0,o.note=JSON.stringify(i),o.voice.triggerAttack(i,e,n)}return this},t.PolySynth.prototype.triggerAttackRelease=function(t,e,n,r){return n=this.toSeconds(n),this.triggerAttack(t,n,r),this.triggerRelease(t,n+this.toSeconds(e)),this},t.PolySynth.prototype.triggerRelease=function(t,e){Array.isArray(t)||(t=[t]),e=this.toSeconds(e);for(var n=0;n<t.length;n++)for(var r=JSON.stringify(t[n]),i=0;i<this._triggers.length;i++){var o=this._triggers[i];o.note===r&&o.release>e&&(o.voice.triggerRelease(e),o.release=e)}return this},t.PolySynth.prototype.set=function(t,e,n){for(var r=0;r<this.voices.length;r++)this.voices[r].set(t,e,n);return this},t.PolySynth.prototype.get=function(t){return this.voices[0].get(t)},t.PolySynth.prototype.releaseAll=function(t){t=this.toSeconds(t);for(var e=0;e<this._triggers.length;e++){var n=this._triggers[e];n.release>t&&(n.release=t,n.voice.triggerRelease(t))}return this},t.PolySynth.prototype.dispose=function(){t.Instrument.prototype.dispose.call(this);for(var e=0;e<this.voices.length;e++)this.voices[e].dispose(),this.voices[e]=null;return this.voices=null,this._triggers=null,this},t.PolySynth}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(158),n(164),n(18),n(162)],i=function(t){"use strict";return t.SimpleSynth=function(e){e=this.defaultArg(e,t.SimpleSynth.defaults),t.Monophonic.call(this,e),this.oscillator=new t.OmniOscillator(e.oscillator),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new t.AmplitudeEnvelope(e.envelope),this.oscillator.chain(this.envelope,this.output),this.oscillator.start(),this._readOnly(["oscillator","frequency","detune","envelope"])},t.extend(t.SimpleSynth,t.Monophonic),t.SimpleSynth.defaults={oscillator:{type:"triangle"},envelope:{attack:.005,decay:.1,sustain:.3,release:1}},t.SimpleSynth.prototype._triggerEnvelopeAttack=function(t,e){return this.envelope.triggerAttack(t,e),this},t.SimpleSynth.prototype._triggerEnvelopeRelease=function(t){return this.envelope.triggerRelease(t),this},t.SimpleSynth.prototype.dispose=function(){return t.Monophonic.prototype.dispose.call(this),this._writable(["oscillator","frequency","detune","envelope"]),this.oscillator.dispose(),this.oscillator=null,this.envelope.dispose(),this.envelope=null,this.frequency=null,this.detune=null,this},t.SimpleSynth}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(18)],i=function(t){"use strict";return t.Add=function(e){t.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._param=this.input[1]=new t.Signal(e),this._param.connect(this._sum)},t.extend(t.Add,t.Signal),t.Add.prototype.dispose=function(){return t.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},t.Add}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(69),n(18)],i=function(t){"use strict";return t.AudioToGain=function(){this._norm=this.input=this.output=new t.WaveShaper(function(t){return(t+1)/2})},t.extend(t.AudioToGain,t.SignalBase),t.AudioToGain.prototype.dispose=function(){return t.prototype.dispose.call(this),this._norm.dispose(),this._norm=null,this},t.AudioToGain}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(69)],i=function(t){"use strict";return t.Pow=function(e){this._exp=this.defaultArg(e,1),this._expScaler=this.input=this.output=new t.WaveShaper(this._expFunc(this._exp),8192)},t.extend(t.Pow,t.SignalBase),Object.defineProperty(t.Pow.prototype,"value",{get:function(){return this._exp},set:function(t){this._exp=t,this._expScaler.setMap(this._expFunc(this._exp))}}),t.Pow.prototype._expFunc=function(t){return function(e){return Math.pow(Math.abs(e),t)}},t.Pow.prototype.dispose=function(){return t.prototype.dispose.call(this),this._expScaler.dispose(),this._expScaler=null,this},t.Pow}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(406),n(53),n(18)],i=function(t){"use strict";return t.Scale=function(e,n){this._outputMin=this.defaultArg(e,0),this._outputMax=this.defaultArg(n,1),this._scale=this.input=new t.Multiply(1),this._add=this.output=new t.Add(0),this._scale.connect(this._add),this._setRange()},t.extend(t.Scale,t.SignalBase),Object.defineProperty(t.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(t){this._outputMin=t,this._setRange()}}),Object.defineProperty(t.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(t){this._outputMax=t,this._setRange()}}),t.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},t.Scale.prototype.dispose=function(){return t.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},t.Scale}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4)],i=function(t){"use strict";return t.SignalBase=function(){},t.extend(t.SignalBase),t.SignalBase.prototype.connect=function(e,n,r){return t.Signal&&t.Signal===e.constructor||t.Param&&t.Param===e.constructor||t.TimelineSignal&&t.TimelineSignal===e.constructor?(e._param.cancelScheduledValues(0),e._param.value=0,e.overridden=!0):e instanceof AudioParam&&(e.cancelScheduledValues(0),e.value=0),t.prototype.connect.call(this,e,n,r),this},t.SignalBase}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(45),n(53),n(38),n(407)],i=function(t){"use strict";return t.AMOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","modulationType"],t.AMOscillator.defaults);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this.detune.value=e.detune,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this._modulationScale=new t.AudioToGain,this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.connect(this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),this.phase=e.phase,this._readOnly(["frequency","detune","harmonicity"])},t.extend(t.AMOscillator,t.Oscillator),t.AMOscillator.defaults={frequency:440,detune:0,phase:0,modulationType:"square",harmonicity:1},t.AMOscillator.prototype._start=function(t){t=this.toSeconds(t),this._modulator.start(t),this._carrier.start(t)},t.AMOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._modulator.stop(t),this._carrier.stop(t)},Object.defineProperty(t.AMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.AMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.AMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.AMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune","harmonicity"]),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this._modulationScale.dispose(),this._modulationScale=null,this},t.AMOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(45),n(53),n(38)],i=function(t){"use strict";return t.FMOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","modulationType"],t.FMOscillator.defaults);t.Source.call(this,e),this._carrier=new t.Oscillator(e.frequency,e.type),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=this._carrier.detune,this.detune.value=e.detune,this.modulationIndex=new t.Multiply(e.modulationIndex),this.modulationIndex.units=t.Type.Positive,this._modulator=new t.Oscillator(e.frequency,e.modulationType),this.harmonicity=new t.Multiply(e.harmonicity),this.harmonicity.units=t.Type.Positive,this._modulationNode=new t.Gain(0),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),this.phase=e.phase,this._readOnly(["modulationIndex","frequency","detune","harmonicity"])},t.extend(t.FMOscillator,t.Oscillator),t.FMOscillator.defaults={frequency:440,detune:0,phase:0,modulationIndex:2,modulationType:"square",harmonicity:1},t.FMOscillator.prototype._start=function(t){t=this.toSeconds(t),this._modulator.start(t),this._carrier.start(t)},t.FMOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._modulator.stop(t),this._carrier.stop(t)},Object.defineProperty(t.FMOscillator.prototype,"type",{get:function(){return this._carrier.type},set:function(t){this._carrier.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"modulationType",{get:function(){return this._modulator.type},set:function(t){this._modulator.type=t}}),Object.defineProperty(t.FMOscillator.prototype,"phase",{get:function(){return this._carrier.phase},set:function(t){this._carrier.phase=t,this._modulator.phase=t}}),Object.defineProperty(t.FMOscillator.prototype,"partials",{get:function(){return this._carrier.partials},set:function(t){this._carrier.partials=t}}),t.FMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["modulationIndex","frequency","detune","harmonicity"]),this.frequency.dispose(),this.frequency=null,this.detune=null,this.harmonicity.dispose(),this.harmonicity=null,this._carrier.dispose(),this._carrier=null,this._modulator.dispose(),this._modulator=null,this._modulationNode.dispose(),this._modulationNode=null,this.modulationIndex.dispose(),this.modulationIndex=null,this},t.FMOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(45),n(53),n(38)],i=function(t){"use strict";return t.FatOscillator=function(){var e=this.optionsObject(arguments,["frequency","type","spread"],t.FatOscillator.defaults);t.Source.call(this,e),this.frequency=new t.Signal(e.frequency,t.Type.Frequency),this.detune=new t.Signal(e.detune,t.Type.Cents),this._oscillators=[],this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=this.defaultArg(e.partials,[]),this.count=e.count,this._readOnly(["frequency","detune"])},t.extend(t.FatOscillator,t.Oscillator),t.FatOscillator.defaults={frequency:440,detune:0,phase:0,spread:20,count:3,type:"sawtooth"},t.FatOscillator.prototype._start=function(t){t=this.toSeconds(t),this._forEach(function(e){e.start(t)})},t.FatOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._forEach(function(e){e.stop(t)})},t.FatOscillator.prototype._forEach=function(t){for(var e=0;e<this._oscillators.length;e++)t.call(this,this._oscillators[e],e)},Object.defineProperty(t.FatOscillator.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t,this._forEach(function(e){e.type=t})}}),Object.defineProperty(t.FatOscillator.prototype,"spread",{get:function(){return this._spread},set:function(t){if(this._spread=t,this._oscillators.length>1){var e=-t/2,n=t/(this._oscillators.length-1);this._forEach(function(t,r){t.detune.value=e+n*r})}}}),Object.defineProperty(t.FatOscillator.prototype,"count",{get:function(){return this._oscillators.length},set:function(e){if(e=Math.max(e,1),this._oscillators.length!==e){this._forEach(function(t){t.dispose()}),this._oscillators=[];for(var n=0;n<e;n++){var r=new t.Oscillator;this.type===t.Oscillator.Type.Custom?r.partials=this._partials:r.type=this._type,r.phase=this._phase,r.volume.value=-6-e,this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,this.state===t.State.Started&&this._forEach(function(t){t.start()})}}}),Object.defineProperty(t.FatOscillator.prototype,"phase",{get:function(){return this._phase},set:function(t){this._phase=t,this._forEach(function(e){e.phase=t})}}),Object.defineProperty(t.FatOscillator.prototype,"partials",{get:function(){return this._partials},set:function(e){this._partials=e,this._type=t.Oscillator.Type.Custom,this._forEach(function(t){t.partials=e})}}),t.FatOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._writable(["frequency","detune"]),this.frequency.dispose(),this.frequency=null,this.detune.dispose(),this.detune=null,this._forEach(function(t){t.dispose()}),this._oscillators=null,this._partials=null,this},t.FatOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e,n){var r,i;r=[n(4),n(31),n(165),n(45),n(53)],i=function(t){"use strict";return t.PWMOscillator=function(){var e=this.optionsObject(arguments,["frequency","modulationFrequency"],t.PWMOscillator.defaults);t.Source.call(this,e),this._pulse=new t.PulseOscillator(e.modulationFrequency),this._pulse._sawtooth.type="sine",this._modulator=new t.Oscillator({frequency:e.frequency,detune:e.detune,phase:e.phase}),this._scale=new t.Multiply(1.01),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this.modulationFrequency=this._pulse.frequency,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),this._readOnly(["modulationFrequency","frequency","detune"])},t.extend(t.PWMOscillator,t.Oscillator),t.PWMOscillator.defaults={frequency:440,detune:0,phase:0,modulationFrequency:.4},t.PWMOscillator.prototype._start=function(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)},t.PWMOscillator.prototype._stop=function(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)},Object.defineProperty(t.PWMOscillator.prototype,"type",{get:function(){return"pwm"}}),Object.defineProperty(t.PWMOscillator.prototype,"partials",{get:function(){return[]}}),Object.defineProperty(t.PWMOscillator.prototype,"phase",{get:function(){return this._modulator.phase},set:function(t){this._modulator.phase=t}}),t.PWMOscillator.prototype.dispose=function(){return t.Source.prototype.dispose.call(this),this._pulse.dispose(),this._pulse=null,this._scale.dispose(),this._scale=null,this._modulator.dispose(),this._modulator=null,this._writable(["modulationFrequency","frequency","detune"]),this.frequency=null,this.detune=null,this.modulationFrequency=null,this},t.PWMOscillator}.apply(e,r),!(void 0!==i&&(t.exports=i))},function(t,e){}]);